/*!
 * JavaScript Debug - v0.4 - 6/22/2010
 * http://benalman.com/projects/javascript-debug-console-log/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 * 
 * With lots of help from Paul Irish!
 * http://paulirish.com/
 */

// Script: JavaScript Debug: A simple wrapper for console.log
//
// *Version: 0.4, Last Updated: 6/22/2010*
// 
// Tested with Internet Explorer 6-8, Firefox 3-3.6, Safari 3-4, Chrome 3-5, Opera 9.6-10.5
// 
// Home       - http://benalman.com/projects/javascript-debug-console-log/
// GitHub     - http://github.com/cowboy/javascript-debug/
// Source     - http://github.com/cowboy/javascript-debug/raw/master/ba-debug.js
// (Minified) - http://github.com/cowboy/javascript-debug/raw/master/ba-debug.min.js (1.1kb)
// 
// About: License
// 
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
// 
// About: Support and Testing
// 
// Information about what browsers this code has been tested in.
// 
// Browsers Tested - Internet Explorer 6-8, Firefox 3-3.6, Safari 3-4, Chrome
// 3-5, Opera 9.6-10.5
// 
// About: Examples
// 
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
// 
// Examples - http://benalman.com/code/projects/javascript-debug/examples/debug/
// 
// About: Revision History
// 
// 0.4 - (6/22/2010) Added missing passthrough methods: exception,
//       groupCollapsed, table
// 0.3 - (6/8/2009) Initial release
// 
// Topic: Pass-through console methods
// 
// assert, clear, count, dir, dirxml, exception, group, groupCollapsed,
// groupEnd, profile, profileEnd, table, time, timeEnd, trace
// 
// These console methods are passed through (but only if both the console and
// the method exists), so use them without fear of reprisal. Note that these
// methods will not be passed through if the logging level is set to 0 via
// <debug.setLevel>.

/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

/*!
 * accounting.js v0.3.2
 * Copyright 2011, Joss Crowcroft
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://josscrowcroft.github.com/accounting.js/
 */

/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 0.11.1
 * @requires jQuery v1.2.3+
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2012, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 *
 * This version has been modified to include the set of friendly timestamp
 * strings which we intend to use here at Tictail.
 */

/*
 * Mixpanel JS Library v2.2.0
 *
 * Copyright 2012, Mixpanel, Inc. All Rights Reserved
 * http://mixpanel.com/
 *
 * Includes portions of Underscore.js
 * http://documentcloud.github.com/underscore/
 * (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
 * Released under the MIT License.
 */

/*! jQuery UI - v1.10.3 - 2013-12-16
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.sortable.js, jquery.ui.effect.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */

/*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */

/**
 * @license wysihtml5 v0.3.0
 * https://github.com/xing/wysihtml5
 *
 * Author: Christopher Blum (https://github.com/tiff)
 *
 * Copyright (C) 2012 XING AG
 * Licensed under the MIT license (MIT)
 *
 */

/**
 * @license Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2011, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.2
 * Build date: 13 November 2011
 */

/*
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/

/**
 * Inspired by the rangy CSS Applier module written by Tim Down and licensed under the MIT license.
 * http://code.google.com/p/rangy/
 *
 * changed in order to be able ...
 *    - to use custom tags
 *    - to detect and replace similar css classes via reg exp
 */

/**
 * Copyright (c) 2011 Felix Gnass [fgnass at neteye dot de]
 * Licensed under the MIT license
 */

/*
jed.js
v0.5.0

https://github.com/SlexAxton/Jed
-----------
A gettext compatible i18n library for modern JavaScript Applications

by Alex Sexton - AlexSexton [at] gmail - @SlexAxton
WTFPL license for use
Dojo CLA for contributions

Jed offers the entire applicable GNU gettext spec'd set of
functions, but also offers some nicer wrappers around them.
The api for gettext was written for a language with no function
overloading, so Jed allows a little more of that.

Many thanks to Joshua I. Miller - unrtst@cpan.org - who wrote
gettext.js back in 2008. I was able to vet a lot of my ideas
against his. I also made sure Jed passed against his tests
in order to offer easy upgrades -- jsgettext.berlios.de
*/

// Underscore 1.3.0 was used to port and is licensed

/**
   sprintf() for JavaScript 0.7-beta1
   http://www.diveintojavascript.com/projects/javascript-sprintf

   Copyright (c) Alexandru Marasteanu <alexaholic [at) gmail (dot] com>
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions are met:
       * Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.
       * Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in the
         documentation and/or other materials provided with the distribution.
       * Neither the name of sprintf() for JavaScript nor the
         names of its contributors may be used to endorse or promote products
         derived from this software without specific prior written permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   DISCLAIMED. IN NO EVENT SHALL Alexandru Marasteanu BE LIABLE FOR ANY
   DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
   ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  */

/**
 * @license RequireJS i18n 1.0.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/*! NProgress (c) 2013, Rico Sta. Cruz
 *  http://ricostacruz.com/nprogress */

/**
 * @license RequireJS text 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*! http://mths.be/placeholder v2.0.7 by @mathias */

/**
 * Copyright Facebook Inc.
 *
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */

/**
         * @providesModule JSON3
         * @preserve-header
         *
         *! JSON v3.2.3 | http://bestiejs.github.com/json3 | Copyright 2012, Kit Cambridge | http://kit.mit-license.org
         */

/*
 * jQuery File Upload Plugin 5.40.0
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/*
 * jQuery Iframe Transport Plugin 1.8.2
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

/*!
 * Braintree End-to-End Encryption Library
 * http://www.braintreepayments.com
 * Copyright (c) 2009-2013 Braintree Payment Solutions
 *
 * JSBN
 * Copyright (c) 2005  Tom Wu
 *
 * Both Licensed under the MIT License.
 * http://opensource.org/licenses/MIT
 *
 * ASN.1 JavaScript decoder
 * Copyright (c) 2008-2009 Lapo Luchini <lapo@lapo.it>
 * Licensed under the ISC License.
 * http://opensource.org/licenses/ISC
 */

// ASN.1 JavaScript decoder
// Copyright (c) 2008-2009 Lapo Luchini <lapo@lapo.it>

// Permission to use, copy, modify, and/or distribute this software for any
// purpose with or without fee is hereby granted, provided that the above
// copyright notice and this permission notice appear in all copies.
// 
// THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

// Copyright (c) 2005  Tom Wu
// All Rights Reserved.
// See "LICENSE" for details.

/** @fileOverview Low-level AES implementation.
 *
 * This file contains a low-level implementation of AES, optimized for
 * size and for efficiency on several browsers.  It is based on
 * OpenSSL's aes_core.c, a public-domain implementation by Vincent
 * Rijmen, Antoon Bosselaers and Paulo Barreto.
 *
 * An older version of this implementation is available in the public
 * domain, but this one is (c) Emily Stark, Mike Hamburg, Dan Boneh,
 * Stanford University 2008-2010 and BSD-licensed for liability
 * reasons.
 *
 * @author Emily Stark
 * @author Mike Hamburg
 * @author Dan Boneh
 */

/** @fileOverview Javascript SHA-256 implementation.
 *
 * An older version of this implementation is available in the public
 * domain, but this one is (c) Emily Stark, Mike Hamburg, Dan Boneh,
 * Stanford University 2008-2010 and BSD-licensed for liability
 * reasons.
 *
 * Special thanks to Aldo Cortesi for pointing out several bugs in
 * this code.
 *
 * @author Emily Stark
 * @author Mike Hamburg
 * @author Dan Boneh
 */

/*
 * Copyright (c) 2012 Stripe (alex@stripe.com)
 * 
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 */

window.debug=function(){function c(t){i&&(s||!n||!n.log)&&i.apply(e,t)}function h(e){return o>0?o>e:u.length+o<=e}var e=this,t=Array.prototype.slice,n=e.console,r={},i,s,o=9,u=["error","warn","info","debug","log"],a="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),f=a.length,l=[];while(--f>=0)(function(e){r[e]=function(){o!==0&&n&&n[e]&&n[e].apply(n,arguments)}})(a[f]);f=u.length;while(--f>=0)(function(i,s){r[s]=function(){var r=t.call(arguments),o=[s].concat(r);l.push(o),c(o);if(!n||!h(i))return;n.firebug?n[s].apply(e,r):n[s]?n[s](r):n.log(r)}})(f,u[f]);return r.setLevel=function(e){o=typeof e=="number"?e:9},r.setCallback=function(){var e=t.call(arguments),n=l.length,r=n;i=e.shift()||null,s=typeof e[0]=="boolean"?e.shift():!1,r-=typeof e[0]=="number"?e.shift():n;while(r<n)c(l[r++])},r}(),define("thirdparty/ba-debug",function(){}),define("tictail/component/log",["thirdparty/ba-debug"],function(){var e=this;e.TT=e.TT||{};var t=e.TT.Log=window.debug,n=window.ClientSession&&window.ClientSession.production,r=window.localStorage&&window.localStorage.debug;return n&&!r&&t.setLevel(0),t}),define("tictail/mediator",["underscore","backbone","./component/log"],function(e,t,n){var r=this;r.TT=r.TT||{};var i=r.TT.Mediator=e.extend(t.Events,{subscribe:function(e){n.debug("Mediator event subscription added to "+e),this.on.apply(this,arguments)},remove:function(){n.debug("Mediator event remove",arguments),this.off.apply(this,arguments)},publish:function(e){n.debug("Mediator event publish with name "+e),this.trigger.apply(this,arguments)}});return i}),function(e){e.cookie=function(t,n,r){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||n===null||n===undefined)){r=e.extend({},r);if(n===null||n===undefined)r.expires=-1;if(typeof r.expires=="number"){var i=r.expires,s=r.expires=new Date;s.setDate(s.getDate()+i)}return n=String(n),document.cookie=[encodeURIComponent(t),"=",r.raw?n:encodeURIComponent(n),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}r=n||{};var o=r.raw?function(e){return e}:decodeURIComponent,u=document.cookie.split("; ");for(var a=0,f;f=u[a]&&u[a].split("=");a++)if(o(f[0])===t)return o(f[1]||"");return null}}(window.jQuery),define("jquery-cookie",function(){}),define("tictail/component/xsrf",["jquery-cookie"],function(){var e=this;e.TT=e.TT||{};var t=e.TT.XSRF=function(e){return this.set(e),this};return t.getFromCookie=function(){return $.cookie("_xsrf")},t.prototype={_token:undefined,set:function(e){this._token=e},get:function(e){if(this._token)return this._token;if(e!==!1)throw new Error("No XSRF token is set");return!1},getIfExists:function(){return this.get(!1)},refresh:function(){this.set(this.getFromCookie())},validate:function(){return this.get()===this.getFromCookie()}},new t(t.getFromCookie())}),define("tictail/component/api",["jquery","underscore","backbone","../mediator","./xsrf","json2"],function(e,t,n,r,i){var s=this;s.TT=s.TT||{};var o=function(e){var t=window.location.origin;return t===undefined&&(t=window.location.protocol+"//"+window.location.host),t+e},u=s.TT.API={};u.generateEventName=function(e,t){return"api."+e+":"+t},u.ENDPOINT=o("/apiv2/rpc/v1/"),u.ERROR_CODES={PARSE_ERROR:-32700,INVALID_REQUEST:-32600,METHOD_NOT_FOUND:-32601,INVALID_PARAMS:-32602,INTERNAL:-32603,INSUFFICIENT_PERMISSIONS:-32001,UNAUTHENTICATED:-32002,INCORRECT_HTTP_METHOD:-32003,QUOTA_EXCEEDED:-32004,CART_NOT_CREATED:-32010,CART_NOT_FOUND:-32011,CART_CANNOT_ADD_ITEM:-32012,CART_ITEM_NOT_FOUND:-32013,CART_IS_STALE:-32014,CART_IS_OVERLOADED:-32015,CART_INVALID_SHIPPING:-32016,CART_INVALID_DISCOUNT:-32017,ORDER_RECEIVER_CREATE_FAILED:-32020,ORDER_RECEIVER_BIND_FAILED:-32021,ABORTED:-32097,TIMED_OUT:-32098,UNKNOWN:-32099,SEARCH_BAD_QUERY:-32040,PRODUCT_MODIFY_DELETED:-32101,STOREKEEPER_BIND:-32110,STORE_SUBDOMAIN_OCCUPIED:-32210,STORE_NOT_CREATED:-32211,STORE_SUBDOMAIN_ILLEGAL:-32212,USER_INCORRECT_CREDENTIALS:-32310,USER_NOT_CREATED:-32311,USER_ALREADY_EXISTS:-32312,USER_PASSWORD_TOO_SHORT:-32313,SHIPPING_NOT_CREATED:-33010,STORE_PASSWORD_MATCH_USER_PASSWORD:-33020,THEME_TOO_LARGE:-33110,CHECKOUT_CREATING_CONSUMER:-34010,CHECKOUT_CREATING_RECEIVER:-34011,CHECKOUT_STATE_HASH:-34013,CHECKOUT_STORE_CURRENCY:-34014,CHECKOUT_SHIPPING_COST:-34015,CHECKOUT_TOTAL_COST:-34016,CHECKOUT_PURCHASE_DENIED:-34017,CHECKOUT_KLARNA:-34018,CHECKOUT_MARK_AS_PAID:-34019,CHECKOUT_PAYPAL:-34020,CHECKOUT_PAYPAL_CONFIRMATION:-34021,CHECKOUT_CONFIRM_ALREADY_HANDLED:-34022,APPSTORE_INSTALLATION_REQUIRES_CREDIT_CARD:-35001,APPSTORE_INSTALLATION_CREDIT_CARD_EXPIRED:-35002,APPSTORE_PRORATE_PAYMENT_FAILED:-35003};var a=u.Batch=function(){return this.locked=!1,this.xsrf=!1,this._stack=[],this};t.extend(a.prototype,{reset:function(){this._stack&&this._stack.length&&t.invoke(this._stack,"unregister"),this.locked=!1,this.xsrf=!1,this._stack=[],this.off()},append:function(e,t,n,r,i){this.appendRequest(new f(e,t,n,r,i))},appendRequest:function(e){if(this.locked)throw new Error("Cannot append "+e+" to API batch - batch is locked!");this._stack.push(e),e.xsrf&&(this.xsrf=!0)},add:function(e,t){t||(t={});var n=e.fetch({getRequest:!0,data:t});this.appendRequest(n)},getStackLength:function(){return this._stack.length},getPayload:function(){var e=[];t.each(this._stack,function(t){e.push(t.getPayload())}),this.getStackLength()===1&&(e=e[0]);var n={jsonrpc:JSON.stringify(e)};return this.xsrf&&t.extend(n,{_xsrf:i.get()}),n},send:function(){this._execute(this.xsrf?"POST":"GET")},validate:function(){if(this.getStackLength()===0)throw new Error("Skipping API batch execution since batch is empty!")},onSuccess:function(e,n,r){t.isArray(e)!==!0&&(e=new Array(e));var i=Array.prototype.slice.call(arguments,0);this.trigger.apply(this,["success"].concat(i,this)),t.each(e,function(e,t){var i="error",s=e.id;e.hasOwnProperty("result")?(e=e.result,i="success"):e=e.error,this._triggerEvent(i,t,e,r,n)},this)},onHTTPError:function(e,t,n){var r=Array.prototype.slice.call(arguments,0);this.trigger.apply(this,["error"].concat(r,this)),this._triggerEvent("error.http",!1,e,t,n);var i=u.ERROR_CODES,s={abort:i.ABORTED,timeout:i.TIMED_OUT,parsererror:i.PARSE_ERROR},o={};o.code=s[t]||i.INTERNAL,t==="error"&&(o.message=n),this._triggerEvent("error",!1,o,e,t)},onComplete:function(e,t){var n=Array.prototype.slice.call(arguments,0);this.trigger.apply(this,["complete"].concat(n,this)),this._triggerEvent("complete",!1,e,t),this.reset()},_execute:function(n){this.locked=!0,this.validate(),this.trigger("sending",this),this._triggerEvent("sending",!1),e.ajax({type:n,url:u.ENDPOINT,data:this.getPayload(),success:t.bind(this.onSuccess,this),error:t.bind(this.onHTTPError,this),complete:t.bind(this.onComplete,this),dataType:"json"})},_triggerEvent:function(e,n){var r=this._stack;t.isNumber(n)&&(r=new Array(r[n]));var i=Array.prototype.slice.call(arguments,2),s=[e].concat(i);t.each(r,function(t){t.trigger.apply(t,s);var n=t.getEventName(e);this._sendEvent(n,i,t)},this)},_sendEvent:function(e,t,n){var i=function(e){return[e].concat(t,n)},s=e.split(":");if(s.length===2){var o=s[0].split("."),u="";for(var a=0,f=o.length;a<f;a++)u!==""&&(u+="."),u+=o[a],r.publish.apply(r,i(u))}r.publish.apply(r,i(e))}},n.Events);var f=u.Request=function(e,t,n,r,i){return this.action=e,this.id=r!==undefined?r:null,this.params=t!==undefined?t:null,this.method=n!==undefined?n:"POST",this.method=this.method.toUpperCase(),this.xsrf=i!==undefined?i:this.method!=="GET",this};return t.extend(f.prototype,{getEventName:function(e){return u.generateEventName(e,this.action)},setOnSuccess:function(e,t){this.on("success",e,t)},setOnError:function(e,t){this.on("error",e,t)},setOnComplete:function(e,t){this.on("complete",e,t)},getPayload:function(){return{jsonrpc:"2.0",method:this.action,params:this.params,id:this.id}},send:function(){var e=new a;e.appendRequest(this),e.send()},unregister:function(){this.off()}},n.Events),u}),define("tictail/component/storage",["underscore"],function(e){var t=this;t.TT=t.TT||{};var n=t.TT.Storage=function(e){var t,n=(new Date).toString();try{t=e===!0?window.sessionStorage:window.localStorage,t.setItem(n,n),t.removeItem(n)}catch(r){t=null}this._storage=t};return e.extend(n.prototype,{isAvailable:function(){return this._storage!==null},getItem:function(e){return this._storage!==null?this._storage.getItem(e):null},getObject:function(e){if(this._storage!==null){var t=this._storage.getItem(e);if(t!==null)return JSON.parse(t)}return null},each:function(e,t){var n=this._storage;if(n!==null){t=t||window;for(var r=0,i=n.length;r<i;r++){var s=n.key(r);e.call(t,n.getItem(s),s,this)}}},setItem:function(e,t){if(this._storage!==null)try{return this._storage.setItem(e,t),!0}catch(n){}return!1},setObject:function(e,t){if(this._storage!==null){t=JSON.stringify(t);try{return this._storage.setItem(e,t),!0}catch(n){}}return!1},removeItem:function(e){if(this._storage!==null)try{this._storage.removeItem(e)}catch(t){}},clear:function(){if(this._storage!==null)try{this._storage.clear()}catch(e){}}}),n}),function(e,t){function o(e){return!!(e===""||e&&e.charCodeAt&&e.substr)}function u(e){return i?i(e):s.call(e)==="[object Array]"}function a(e){return e&&s.call(e)==="[object Object]"}function f(e,t){var n;e=e||{},t=t||{};for(n in t)t.hasOwnProperty(n)&&e[n]==null&&(e[n]=t[n]);return e}function l(e,t,n){var i=[],s,o;if(!e)return i;if(r&&e.map===r)return e.map(t,n);for(s=0,o=e.length;s<o;s++)i[s]=t.call(n,e[s],s,e);return i}function c(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function h(e){var t=n.settings.currency.format;return typeof e=="function"&&(e=e()),o(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:!e||!e.pos||!e.pos.match("%v")?o(t)?n.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t:e}var n={};n.version="0.3.2",n.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var r=Array.prototype.map,i=Array.isArray,s=Object.prototype.toString,p=n.unformat=n.parse=function(e,t){if(u(e))return l(e,function(e){return p(e,t)});e=e||0;if(typeof e=="number")return e;t=t||n.settings.number.decimal;var r=new RegExp("[^0-9-"+t+"]",["g"]),i=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(r,"").replace(t,"."));return isNaN(i)?0:i},d=n.toFixed=function(e,t){t=c(t,n.settings.number.precision);var r=Math.pow(10,t);return(Math.round(n.unformat(e)*r)/r).toFixed(t)},v=n.formatNumber=function(e,t,r,i){if(u(e))return l(e,function(e){return v(e,t,r,i)});e=p(e);var s=f(a(t)?t:{precision:t,thousand:r,decimal:i},n.settings.number),o=c(s.precision),h=e<0?"-":"",m=parseInt(d(Math.abs(e||0),o),10)+"",g=m.length>3?m.length%3:0;return h+(g?m.substr(0,g)+s.thousand:"")+m.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+s.thousand)+(o?s.decimal+d(Math.abs(e),o).split(".")[1]:"")},m=n.formatMoney=function(e,t,r,i,s,o){if(u(e))return l(e,function(e){return m(e,t,r,i,s,o)});e=p(e);var d=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:o},n.settings.currency),g=h(d.format),y=e>0?g.pos:e<0?g.neg:g.zero;return y.replace("%s",d.symbol).replace("%v",v(Math.abs(e),c(d.precision),d.thousand,d.decimal))};n.formatColumn=function(e,t,r,i,s,d){if(!e)return[];var m=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:d},n.settings.currency),g=h(m.format),y=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,b=0,w=l(e,function(e,t){if(u(e))return n.formatColumn(e,m);e=p(e);var r=e>0?g.pos:e<0?g.neg:g.zero,i=r.replace("%s",m.symbol).replace("%v",v(Math.abs(e),c(m.precision),m.thousand,m.decimal));return i.length>b&&(b=i.length),i});return l(w,function(e,t){return o(e)&&e.length<b?y?e.replace(m.symbol,m.symbol+(new Array(b-e.length+1)).join(" ")):(new Array(b-e.length+1)).join(" ")+e:e})},typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.accounting=n):typeof define=="function"&&define.amd?define("accounting",[],function(){return n}):(n.noConflict=function(r){return function(){return e.accounting=r,n.noConflict=t,n}}(e.accounting),e.accounting=n)}(this),function(e){typeof define=="function"&&define.amd?define("tictail/jquery/timeago",["jquery"],e):e(jQuery)}(function(e){function n(){var t=r(this);return isNaN(t.datetime)||e(this).text(i(t.datetime)),this}function r(n){n=e(n);if(!n.data("timeago")){n.data("timeago",{datetime:t.datetime(n)});var r=e.trim(n.text());r.length>0&&n.attr("title",r)}return n.data("timeago")}function i(e){return t.inWords(e)}function s(e){return(new Date).getTime()-e.getTime()}Date.prototype.getWeek=function(){var e=new Date(this.valueOf()),t=(this.getDay()+6)%7;e.setDate(e.getDate()-t+3);var n=e.valueOf();return e.setMonth(0,1),e.getDay()!=4&&e.setMonth(0,1+(4-e.getDay()+7)%7),1+Math.ceil((n-e)/6048e5)},Date.prototype.getWeekYear=function(){var e=new Date(this.valueOf());return e.setDate(e.getDate()-(this.getDay()+6)%7+3),e.getFullYear()},e.timeago=function(t){return t instanceof Date?i(t):typeof t=="string"?i(e.timeago.parse(t)):i(e.timeago.datetime(t))};var t=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},weekDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],isThisYear:function(e){return e.getFullYear()===(new Date).getFullYear()},isThisMonth:function(e){return this.isThisYear(e)!==!0?!1:e.getMonth()===(new Date).getMonth()},isThisDay:function(e){return this.isThisMonth(e)!==!0?!1:e.getDate()===(new Date).getDate()},isToday:function(e){return this.isThisDay(e)},isThisWeek:function(e){return this.isThisMonth(e)!==!0?!1:e.getWeek()===(new Date).getWeek()},isYesterday:function(e){return this.isThisMonth(e)!==!0?!1:e.getDate()===(new Date).getDate()-1},getDatetime:function(e){return this.getMonthName(e)+" "+e.getDate()+" "+e.getFullYear()+", "+this.getTimeWatch(e)},getDate:function(e){return this.getMonthName(e)+" "+e.getDate()+" "+e.getFullYear()},getTimeWatch:function(e){var t=function(e){return e>=10?e:"0"+e};return t(e.getHours())+":"+t(e.getMinutes())},getWeekday:function(e){return this.weekDays[e.getDay()]},getMonthName:function(e){return this.months[e.getMonth()]},inWords:function(t){function c(r,i){var s=e.isFunction(r)?r(i,t):r,o=n.numbers&&n.numbers[i]||i;return s.replace(/%d/i,o)}var n=this.settings.strings,r=n.prefixAgo,i=n.suffixAgo;this.settings.allowFuture&&t<0&&(r=n.prefixFromNow,i=n.suffixFromNow);var o=s(t),u=Math.abs(o)/1e3,a=u/60,f=a/60,l=f/24;if(this.isThisDay(t)!==!0){var h=this.getTimeWatch(t);if(this.isYesterday(t)!==!1)return"Yesterday, "+h;if(this.isThisWeek(t)!==!1)return this.getWeekday(t)+", "+h;var p=this.getMonthName(t);return this.isThisYear(t)!==!1?p+" "+t.getDate()+", "+h:this.getDatetime(t)}var d=u<45&&c(n.seconds,Math.round(u))||u<90&&c(n.minute,1)||a<45&&c(n.minutes,Math.round(a))||a<90&&c(n.hour,1)||f<24&&c(n.hours,Math.round(f))||f<42&&c(n.day,1)||l<30&&c(n.days,Math.round(l))||l<45&&c(n.month,1)||l<365&&c(n.months,Math.round(l/30))||years<1.5&&c(n.year,1)||c(n.years,Math.round(years)),v=n.wordSeparator===undefined?" ":n.wordSeparator;return e.trim([r,d,i].join(v))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},datetime:function(n){var r=e(n).get(0).tagName.toLowerCase()==="time",i=r?e(n).attr("datetime"):e(n).attr("title");return t.parse(i)}}),e.fn.timeago=function(){var e=this;e.each(n);var r=t.settings;return r.refreshMillis>0&&setInterval(function(){e.each(n)},r.refreshMillis),e},document.createElement("abbr"),document.createElement("time")}),define("tictail/utility",["jquery","underscore","accounting","tictail/jquery/timeago"],function(e,t,n){var r=this;r.TT=r.TT||{};var i=r.TT.Utility={},s=i.getDateFromTimestamp=function(e){var t=new Date(0);return t.setUTCSeconds(e),t},o=i.getDatetime=function(t){var n=s(t);return e.timeago.getDatetime(n)},u=i.getDate=function(t){var n=s(t);return e.timeago.getDate(n)},a=i.getTimeInISO8601=function(e){function t(e){return e<10?"0"+e:e}var n=e.getUTCFullYear()+"-";return n+=t(e.getUTCMonth()+1)+"-",n+=t(e.getUTCDate())+"T",n+=t(e.getUTCHours())+":",n+=t(e.getUTCMinutes())+":",n+=t(e.getUTCSeconds())+"Z",n},f=i.generateTimeNode=function(t){return t instanceof Date||(t=s(t)),e("<time/>").attr("datetime",a(t)).attr("title",t.toLocaleString()).timeago()},l=i.truncateString=function(e,n,r){if(t.isNumber(n)!==!0)throw new Error("Given maximum chars is not a number: "+n);return r=r||"...",n=parseInt(n,10),e.length<=n?e:(e=e.slice(0,n),e+r)},c=i.renderTemplateVars=function(e,t){return t?e.replace(/\{\s*(\w*)\s*\}/g,function(e,n){return t.hasOwnProperty(n)?t[n]:""}):str},h=i.getCurrentQueryParams=function(){var e=window.location.href.indexOf("?");if(e===-1)return{};var t=window.location.href.slice(e+1);return this.getQueryParams(t)},p=i.getQueryParams=function(e){var t={};return e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,n,r,i){t[n]=i}),t},d=i.toFixed=function(e,t){return n.toFixed(e,t)},v=i.formatPrice=function(e,n){t.isNumber(e)&&(e=i.toFixed(e,2));var r=e;return t.isUndefined(n)||(r+=' <abbr class="currency">'+n+"</abbr>"),r},m=i.shake=function(e){var t,n=2,r=3,i=250,s=i/n;for(t=n;t>=0;t--)e.animate({left:-r,right:r},s/4).animate({left:r,right:-r},s/2).animate({left:0,right:0},s/4)},g=i.formatPercentage=function(e,t){return e=parseFloat(e)*100,i.toFixed(e,t).replace(/\.[0]+$|[0]+$/,"")},y=i.OrderedHash=function(e){return this.hash={},this.sorted=[],t.each(e,function(e,t){this.add(e,t)}),this};return y.prototype={get:function(e){return this.hash[e]},getAll:function(){return this.hash},getAllKeys:function(){return t.keys(this.hash)},has:function(e){t.isString(e)&&(e=new Array(e));var n=t.difference(e,this.getAllKeys());return t.isEmpty(n)?!0:n},add:function(e,t){this.remove(e),this.hash[e]=t;var n=this.sorted.push(e)-1},remove:function(e){if(t.has(this.hash,e)!==!0)return;var n=this.indexOf(e);delete this.hash[e],this.sorted.splice(n,1)},indexOf:function(e){return t.indexOf(this.sorted,e,!0)},positionedAt:function(e){return this.sorted.length===0?-1:this.indexOf(e)+1},first:function(){return this.sorted.length===0?null:this.get(this.sorted[0])},last:function(){return this.sorted.length===0?null:this.get(this.sorted[this.sorted.length-1])},getSorted:function(e){var n,r=this,i=this.hash,s=[];return e=e||t.keys(i),t.each(e,function(e){n=i[e],s.push({name:e,value:n})}),s}},i}),define("tictail/core",["jquery","underscore","backbone","icanhaz","./component/api","./component/storage","./utility"],function(e,t,n,r,i,s,o){var u=this,a=u.TT=n;a.getLazy=function(e,t,n){return t in e?e[t]:(e[t]=n.call(e),e[t])},a.getCached=a.getLazy,a.lang=function(e,t){return o.renderTemplateVars(e,t)};var f=function(e,t){var n=t.API_ACTION_ABORT||{};if(n[e]!==undefined)throw new Error("The model is not permitted to handle synchronization of type: "+e);var r=t.API_ACTIONS||{},i=r[e];if(i!==undefined)return i;if(t.API_NAMESPACE!==undefined)return e=="read"&&(e="get"),t.API_NAMESPACE+"."+e;throw new Error('Illegal method "'+e+'" for model '+t)},l=function(e,n,r){var i={};t.isUndefined(n.getDefaultParams)!==!0&&t.extend(i,n.getDefaultParams());var s={read:"getReadParams","delete":"getDeleteParams",create:"getCreateParams",update:"getUpdateParams"};return s=n[s[e]],t.isUndefined(s)!==!0&&t.extend(i,s.call(n,r)),e!=="read"&&e!=="delete"&&t.extend(i,n.toJSON()),t.extend(i,r.data||{}),i};a.getSyncRequest=function(e,n,r){var s=f(e,n);r=r?t.clone(r):{};var o=l(e,n,r),u=r.requestMethod?r.requestMethod:e==="read"?"GET":"POST",a=r.requestId?r.requestId:null,c=new i.Request(s,o,u,a);return r.success&&c.setOnSuccess(function(e,t,n,i){r.success(e,n,i,t)}),r.error&&c.setOnError(function(e,t,n,i){r.error(e,n,i,t)}),c},a.sync=n.sync=function(e,t,n){var r=a.getSyncRequest(e,t,n);return n.getRequest===!0?r:(r.send(),r)};var c=function(e){return e=e?t.clone(e):{},e.getRequest=!0,e};return a.Collection=a.Collection.extend({getFetchRequest:function(e){return e=c(e),a.Collection.__super__.fetch.call(this,e)}}),a.Model=a.Model.extend({getSyncRequest:function(e,t){t=c(t);var n=a.Model.__super__.sync||a.sync;return n.call(this,e,this,t)},getFetchRequest:function(e){return this.getSyncRequest("read",e)},parse:function(e){var n=t.clone(e);return delete n.success,n}}),a.getRemoteTemplates=function(t,n){r.grabTemplates(),e.ajax({method:"GET",url:t,dataType:"jsonp",jsonpCallback:"jsonpcallback",cache:!0,success:function(t){e.each(t,function(e,t){var n=e.lastIndexOf(".mustache");n!==-1&&(e=e.substr(0,n)),r.addTemplate(e,t)}),e(document).ready(function(){n()})}})},a.getSafeString=function(t){return t instanceof jQuery||(t=e("<span>"+t+"</span>")),t.text()},a.safeSprintf=function(){var e=sprintf.apply(this,arguments);return a.getSafeString(e)},a.localStorage=new s,a.sessionStorage=new s(!0),a}),function(e){if(!e.__SV){var t,n;window.mixpanel=e,e._i=[],e.init=function(r,s,o){function u(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var a=e;"undefined"!=typeof o?a=e[o]=[]:o="mixpanel",a.people=a.people||[],a.toString=function(e){var t="mixpanel";return"mixpanel"!==o&&(t+="."+o),e||(t+=" (stub)"),t},a.people.toString=function(){return a.toString(1)+".people (stub)"},t="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(n=0;n<t.length;n++)u(a,t[n]);e._i.push([r,s,o])},e.__SV=1.2}}(window.mixpanel||[]),function(e){function q(){if(q.done)return;q.done=!0,A=!0,N=!1,C.each(F,function(e){e._dom_loaded()})}var t=Array.prototype,n=Object.prototype,r=t.slice,i=n.toString,s=n.hasOwnProperty,o=window.console,u=window.navigator,a=window.document,f=u.userAgent,l="mixpanel",c="__mps",h="__mpso",p="__mpa",d="__mpap",v="$set",m="$set_once",g="$add",y="$append",b="$people_distinct_id",w="__alias",E=[c,h,p,d,b,w],S="https:"==a.location.protocol?"https://":"http://",x=e&&e.__SV||0,T=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,N=!T&&f.indexOf("MSIE")==-1,C={},k=!1,L={api_host:S+"api.mixpanel.com",cross_subdomain_cookie:!0,cookie_name:"",loaded:function(){},store_google:!0,save_referrer:!0,test:!1,verbose:!1,img:!1,track_pageview:!0,debug:!1,track_links_timeout:300,cookie_expiration:365,upgrade:!1,disable_cookie:!1,secure_cookie:!1,ip:!0},A=!1;(function(){var e=t.forEach,n=t.indexOf,o=Array.isArray,u={},a=C.each=function(t,n,r){if(t==null)return;if(e&&t.forEach===e)t.forEach(n,r);else if(t.length===+t.length){for(var i=0,o=t.length;i<o;i++)if(i in t&&n.call(r,t[i],i,t)===u)return}else for(var a in t)if(s.call(t,a)&&n.call(r,t[a],a,t)===u)return};C.extend=function(e){return a(r.call(arguments,1),function(t){for(var n in t)t[n]!==void 0&&(e[n]=t[n])}),e},C.isArray=o||function(e){return i.call(e)==="[object Array]"},C.isFunction=function(e){try{return/^\s*\bfunction\b/.test(e)}catch(t){return!1}},C.isArguments=function(e){return!!e&&!!s.call(e,"callee")},C.toArray=function(e){return e?e.toArray?e.toArray():C.isArray(e)?r.call(e):C.isArguments(e)?r.call(e):C.values(e):[]},C.values=function(e){var t=[];return e==null?t:(a(e,function(e){t[t.length]=e}),t)},C.identity=function(e){return e},C.include=function(e,t){var r=!1;return e==null?r:n&&e.indexOf===n?e.indexOf(t)!=-1:(a(e,function(e){if(r||(r=e===t))return u}),r)},C.includes=function(e,t){return e.indexOf(t)!==-1}})(),C.inherit=function(e,t){return e.prototype=new t,e.prototype.constructor=e,e.superclass=t.prototype,e},C.isObject=function(e){return e===Object(e)&&!C.isArray(e)},C.isEmptyObject=function(e){if(C.isObject(e)){for(var t in e)if(s.call(e,t))return!1;return!0}return!1},C.isUndefined=function(e){return e===void 0},C.isString=function(e){return i.call(e)=="[object String]"},C.isDate=function(e){return i.call(e)=="[object Date]"},C.isNumber=function(e){return i.call(e)=="[object Number]"},C.encodeDates=function(e){return C.each(e,function(t,n){C.isDate(t)?e[n]=C.formatDate(t):C.isObject(t)&&(e[n]=C.encodeDates(t))}),e},C.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())},C.strip_empty_properties=function(e){var t={};return C.each(e,function(e,n){C.isString(e)&&e.length>0&&(t[n]=e)}),t},C.truncate=function(e,t){var n;return typeof e=="string"?n=e.slice(0,t):C.isArray(e)?(n=[],C.each(e,function(e){n.push(C.truncate(e,t))})):C.isObject(e)?(n={},C.each(e,function(e,r){n[r]=C.truncate(e,t)})):n=e,n},C.JSONEncode=function(){return function(e){var t,n=e,r,o=function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,function(e){var t=n[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},u=function(e,t){var n="",r="    ",a=0,f="",l="",c=0,h=n,p=[],d=t[e];d&&typeof d=="object"&&typeof d.toJSON=="function"&&(d=d.toJSON(e));switch(typeof d){case"string":return o(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";n+=r,p=[];if(i.apply(d)==="[object Array]"){c=d.length;for(a=0;a<c;a+=1)p[a]=u(a,d)||"null";return l=p.length===0?"[]":n?"[\n"+n+p.join(",\n"+n)+"\n"+h+"]":"["+p.join(",")+"]",n=h,l}for(f in d)s.call(d,f)&&(l=u(f,d),l&&p.push(o(f)+(n?": ":":")+l));return l=p.length===0?"{}":n?"{"+p.join(",")+""+h+"}":"{"+p.join(",")+"}",n=h,l}};return u("",{"":n})}}(),C.JSONDecode=function(){var e,t,n={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},r,i=function(t){throw{name:"SyntaxError",message:t,at:e,text:r}},s=function(n){return n&&n!==t&&i("Expected '"+n+"' instead of '"+t+"'"),t=r.charAt(e),e+=1,t},o=function(){var e,n="";t==="-"&&(n="-",s("-"));while(t>="0"&&t<="9")n+=t,s();if(t==="."){n+=".";while(s()&&t>="0"&&t<="9")n+=t}if(t==="e"||t==="E"){n+=t,s();if(t==="-"||t==="+")n+=t,s();while(t>="0"&&t<="9")n+=t,s()}e=+n;if(!!isFinite(e))return e;i("Bad number")},u=function(){var e,r,o="",u;if(t==='"')while(s()){if(t==='"')return s(),o;if(t==="\\"){s();if(t==="u"){u=0;for(r=0;r<4;r+=1){e=parseInt(s(),16);if(!isFinite(e))break;u=u*16+e}o+=String.fromCharCode(u)}else{if(typeof n[t]!="string")break;o+=n[t]}}else o+=t}i("Bad string")},a=function(){while(t&&t<=" ")s()},f=function(){switch(t){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}i("Unexpected '"+t+"'")},l,c=function(){var e=[];if(t==="["){s("["),a();if(t==="]")return s("]"),e;while(t){e.push(l()),a();if(t==="]")return s("]"),e;s(","),a()}}i("Bad array")},h=function(){var e,n={};if(t==="{"){s("{"),a();if(t==="}")return s("}"),n;while(t){e=u(),a(),s(":"),Object.hasOwnProperty.call(n,e)&&i('Duplicate key "'+e+'"'),n[e]=l(),a();if(t==="}")return s("}"),n;s(","),a()}}i("Bad object")};return l=function(){a();switch(t){case"{":return h();case"[":return c();case'"':return u();case"-":return o();default:return t>="0"&&t<="9"?o():f()}},function(n){var s;return r=n,e=0,t=" ",s=l(),a(),t&&i("Syntax error"),s}}(),C.base64Encode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;e=C.utf8Encode(e);do n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=e.charCodeAt(l++),f=n<<16|r<<8|i,s=f>>18&63,o=f>>12&63,u=f>>6&63,a=f&63,p[c++]=t.charAt(s)+t.charAt(o)+t.charAt(u)+t.charAt(a);while(l<e.length);h=p.join("");switch(e.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"="}return h},C.utf8Encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t="",n,r,i=0,s;n=r=0,i=e.length;for(s=0;s<i;s++){var o=e.charCodeAt(s),u=null;o<128?r++:o>127&&o<2048?u=String.fromCharCode(o>>6|192,o&63|128):u=String.fromCharCode(o>>12|224,o>>6&63|128,o&63|128),u!==null&&(r>n&&(t+=e.substring(n,r)),t+=u,n=r=s+1)}return r>n&&(t+=e.substring(n,e.length)),t},C.UUID=function(){var e=function(){var e=1*new Date,t=0;while(e==1*new Date)t++;return e.toString(16)+t.toString(16)},t=function(){return Math.random().toString(16).replace(".","")},n=function(e){function o(e,t){var n,r=0;for(n=0;n<t.length;n++)r|=i[n]<<n*8;return e^r}var t=f,n,r,i=[],s=0;for(n=0;n<t.length;n++)r=t.charCodeAt(n),i.unshift(r&255),i.length>=4&&(s=o(s,i),i=[]);return i.length>0&&(s=o(s,i)),s.toString(16)};return function(){var r=(screen.height*screen.width).toString(16);return e()+"-"+t()+"-"+n()+"-"+r+"-"+e()}}(),C.isBlockedUA=function(){var e=f;return/(google web preview|baiduspider|yandexbot)/i.test(e)?!0:!1},C.HTTPBuildQuery=function(e,t){var n,r,i,s=[];return typeof t=="undefined"&&(t="&"),C.each(e,function(e,t){r=encodeURIComponent(e.toString()),i=encodeURIComponent(t),s[s.length]=i+"="+r}),s.join(t)},C.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+t+"=([^&#]*)",r=new RegExp(n),i=r.exec(e);return i===null||i&&typeof i[1]!="string"&&i[1].length?"":decodeURIComponent(i[1]).replace(/\+/g," ")},C.cookie={get:function(e){var t=e+"=",n=a.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return decodeURIComponent(i.substring(t.length,i.length))}return null},parse:function(e){var t;try{t=C.JSONDecode(C.cookie.get(e))||{}}catch(n){}return t},set:function(e,t,n,r,i){var s="",o="",u="";if(r){var f=a.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),l=f?f[0]:"";s=l?"; domain=."+l:""}if(n){var c=new Date;c.setTime(c.getTime()+n*24*60*60*1e3),o="; expires="+c.toGMTString()}i&&(u="; secure"),a.cookie=e+"="+encodeURIComponent(t)+o+"; path=/"+s+u},remove:function(e,t){C.cookie.set(e,"",-1,t)}},C.register_event=function(){function t(e,t,r){var i=function(i){i=i||n(window.event);if(!i)return undefined;var s=!0,o,u;C.isFunction(r)&&(o=r(i)),u=t.call(e,i);if(!1===o||!1===u)s=!1;return s};return i}function n(e){return e&&(e.preventDefault=n.preventDefault,e.stopPropagation=n.stopPropagation),e}var e=function(e,n,r,i){if(!e){O.error("No valid element provided to register_event");return}if(e.addEventListener&&!i)e.addEventListener(n,r,!1);else{var s="on"+n,o=e[s];e[s]=t(e,r,o)}};return n.preventDefault=function(){this.returnValue=!1},n.stopPropagation=function(){this.cancelBubble=!0},e}(),C.dom_query=function(){function e(e){return e.all?e.all:e.getElementsByTagName("*")}function n(e,n){var r=" "+n+" ";return(" "+e.className+" ").replace(t," ").indexOf(r)>=0}function r(t){if(!a.getElementsByTagName)return new Array;var r=t.split(" "),i,s=new Array(a);for(var o=0;o<r.length;o++){i=r[o].replace(/^\s+/,"").replace(/\s+$/,"");if(i.indexOf("#")>-1){var u=i.split("#"),f=u[0],l=u[1],c=a.getElementById(l);if(!c||f&&c.nodeName.toLowerCase()!=f)return new Array;s=new Array(c);continue}if(i.indexOf(".")>-1){var u=i.split("."),f=u[0],h=u[1];f||(f="*");var p=new Array,d=0;for(var v=0;v<s.length;v++){var m;f=="*"?m=e(s[v]):m=s[v].getElementsByTagName(f);for(var g=0;g<m.length;g++)p[d++]=m[g]}s=new Array;var y=0;for(var b=0;b<p.length;b++)p[b].className&&C.isString(p[b].className)&&n(p[b],h)&&(s[y++]=p[b]);continue}if(i.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){var f=RegExp.$1,w=RegExp.$2,E=RegExp.$3,S=RegExp.$4;f||(f="*");var p=new Array,d=0;for(var v=0;v<s.length;v++){var m;f=="*"?m=e(s[v]):m=s[v].getElementsByTagName(f);for(var g=0;g<m.length;g++)p[d++]=m[g]}s=new Array;var y=0,x;switch(E){case"=":x=function(e){return e.getAttribute(w)==S};break;case"~":x=function(e){return e.getAttribute(w).match(new RegExp("\\b"+S+"\\b"))};break;case"|":x=function(e){return e.getAttribute(w).match(new RegExp("^"+S+"-?"))};break;case"^":x=function(e){return e.getAttribute(w).indexOf(S)==0};break;case"$":x=function(e){return e.getAttribute(w).lastIndexOf(S)==e.getAttribute(w).length-S.length};break;case"*":x=function(e){return e.getAttribute(w).indexOf(S)>-1};break;default:x=function(e){return e.getAttribute(w)}}s=new Array,y=0;for(var b=0;b<p.length;b++)x(p[b])&&(s[y++]=p[b]);continue}f=i;var p=new Array,d=0;for(var v=0;v<s.length;v++){var m=s[v].getElementsByTagName(f);for(var g=0;g<m.length;g++)p[d++]=m[g]}s=p}return s}var t=/[\t\r\n]/g;return r}(),C.info={campaignParams:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),t="",n={};return C.each(e,function(e){t=C.getQueryParam(a.URL,e),t.length&&(n[e]=t)}),n},searchEngine:function(e){return e.search("https?://(.*)google.([^/?]*)")===0?"google":e.search("https?://(.*)bing.com")===0?"bing":e.search("https?://(.*)yahoo.com")===0?"yahoo":e.search("https?://(.*)duckduckgo.com")===0?"duckduckgo":null},searchInfo:function(e){var t=C.info.searchEngine(e),n=t!="yahoo"?"q":"p",r={};if(t!==null){r.$search_engine=t;var i=C.getQueryParam(e,n);i.length&&(r.mp_keyword=i)}return r},browser:function(){var e=f,t=u.vendor||"";return window.opera?C.includes(e,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":C.includes(e,"Chrome")?"Chrome":C.includes(t,"Apple")?C.includes(e,"Mobile")?"Mobile Safari":"Safari":C.includes(e,"Android")?"Android Mobile":C.includes(e,"Konqueror")?"Konqueror":C.includes(e,"Firefox")?"Firefox":C.includes(e,"MSIE")?"Internet Explorer":C.includes(e,"Gecko")?"Mozilla":""},os:function(){var e=f;return/Windows/i.test(e)?/Phone/.test(e)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":""},device:function(){var e=f;return/iPhone/.test(e)?"iPhone":/iPad/.test(e)?"iPad":/iPod/.test(e)?"iPod Touch":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Windows Phone/i.test(e)?"Windows Phone":/Android/.test(e)?"Android":""},referringDomain:function(e){var t=e.split("/");return t.length>=3?t[2]:""},properties:function(){return C.strip_empty_properties({$os:C.info.os(),$browser:C.info.browser(),$referrer:a.referrer,$referring_domain:C.info.referringDomain(a.referrer),$device:C.info.device(),mp_lib:"web"})},people_properties:function(){return C.strip_empty_properties({$os:C.info.os(),$browser:C.info.browser()})},pageviewInfo:function(e){return C.strip_empty_properties({mp_page:e,mp_referrer:a.referrer,mp_browser:C.info.browser(),mp_platform:C.info.os()})}};var O={log:function(){if(k&&!C.isUndefined(o)&&o)try{o.log.apply(o,arguments)}catch(e){C.each(arguments,function(e){o.log(e)})}},error:function(){if(k&&!C.isUndefined(o)&&o){var e=["Mixpanel error:"].concat(C.toArray(arguments));try{o.error.apply(o,e)}catch(t){C.each(e,function(e){o.error(e)})}}},critical:function(){if(!C.isUndefined(o)&&o){var e=["Mixpanel error:"].concat(C.toArray(arguments));try{o.error.apply(o,e)}catch(t){C.each(e,function(e){o.error(e)})}}}},M=function(){};M.prototype.create_properties=function(){},M.prototype.event_handler=function(){},M.prototype.after_track_handler=function(){},M.prototype.init=function(e){return this.mp=e,this},M.prototype.track=function(e,t,n,r){var i=this,s=C.dom_query(e);if(s.length==0){O.error("The DOM query ("+e+") returned 0 elements");return}return C.each(s,function(e){C.register_event(e,this.override_event,function(e){var s={},o=i.create_properties(n,this),u=i.mp.get_config("track_links_timeout");i.event_handler(e,this,s),window.setTimeout(i.track_callback(r,o,s,!0),u),i.mp.track(t,o,i.track_callback(r,o,s))})},this),!0},M.prototype.track_callback=function(e,t,n,r){r=r||!1;var i=this;return function(){if(n.callback_fired)return;n.callback_fired=!0;if(e&&e(r,t)===!1)return;i.after_track_handler(t,n,r)}},M.prototype.create_properties=function(e,t){var n;return typeof e=="function"?n=e(t):n=C.extend({},e),n};var _=function(){this.override_event="click"};C.inherit(_,M),_.prototype.create_properties=function(e,t){var n=_.superclass.create_properties.apply(this,arguments);return t.href&&(n.url=t.href),n},_.prototype.event_handler=function(e,t,n){n.new_tab=e.which===2||e.metaKey||t.target==="_blank",n.href=t.href,n.new_tab||e.preventDefault()},_.prototype.after_track_handler=function(e,t,n){if(t.new_tab)return;setTimeout(function(){window.location=t.href},0)};var D=function(){this.override_event="submit"};C.inherit(D,M),D.prototype.event_handler=function(e,t,n){n.element=t,e.preventDefault()},D.prototype.after_track_handler=function(e,t,n){setTimeout(function(){t.element.submit()},0)};var P=function(e){this.props={},this.campaign_params_saved=!1,e.cookie_name?this.name="mp_"+e.cookie_name:this.name="mp_"+e.token+"_mixpanel",this.load(),this.update_config(e),this.upgrade(e),this.save()};P.prototype.properties=function(){var e={};return C.each(this.props,function(t,n){C.include(E,n)||(e[n]=t)}),e},P.prototype.load=function(){if(this.disabled)return;var e=C.cookie.parse(this.name);e&&(this.props=C.extend({},e))},P.prototype.upgrade=function(e){var t=e.upgrade,n,r;t&&(n="mp_super_properties",typeof t=="string"&&(n=t),r=C.cookie.parse(n),C.cookie.remove(n),C.cookie.remove(n,!0),r&&(this.props=C.extend(this.props,r.all,r.events))),!e.cookie_name&&e.name!=="mixpanel"&&(n="mp_"+e.token+"_"+e.name,r=C.cookie.parse(n),r&&(C.cookie.remove(n),C.cookie.remove(n,!0),this.register_once(r)))},P.prototype.save=function(){if(this.disabled)return;C.cookie.set(this.name,C.JSONEncode(this.props),this.expire_days,this.cross_subdomain,this.secure)},P.prototype.remove=function(){C.cookie.remove(this.name,!1),C.cookie.remove(this.name,!0)},P.prototype.clear=function(){this.remove(),this.props={}},P.prototype.register_once=function(e,t,n){return C.isObject(e)?(typeof t=="undefined"&&(t="None"),this.expire_days=typeof n=="undefined"?this.default_expiry:n,C.each(e,function(e,n){if(!this.props[n]||this.props[n]===t)this.props[n]=e},this),this.save(),!0):!1},P.prototype.register=function(e,t){return C.isObject(e)?(this.expire_days=typeof t=="undefined"?this.default_expiry:t,C.extend(this.props,e),this.save(),!0):!1},P.prototype.unregister=function(e){e in this.props&&(delete this.props[e],this.save())},P.prototype.update_campaign_params=function(){this.campaign_params_saved||(this.register_once(C.info.campaignParams()),this.campaign_params_saved=!0)},P.prototype.update_search_keyword=function(e){this.register(C.info.searchInfo(e))},P.prototype.update_referrer_info=function(e){this.register_once({$initial_referrer:e||"$direct",$initial_referring_domain:C.info.referringDomain(e)||"$direct"},"")},P.prototype.get_referrer_info=function(){return C.strip_empty_properties({$initial_referrer:this.props.$initial_referrer,$initial_referring_domain:this.props.$initial_referring_domain})},P.prototype.safe_merge=function(e){return C.each(this.props,function(t,n){n in e||(e[n]=t)}),e},P.prototype.update_config=function(e){this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_cookie),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie)},P.prototype.set_disabled=function(e){this.disabled=e,this.disabled&&this.remove()},P.prototype.set_cross_subdomain=function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())},P.prototype.get_cross_subdomain=function(){return this.cross_subdomain},P.prototype.set_secure=function(e){e!==this.secure&&(this.secure=e?!0:!1,this.remove(),this.save())},P.prototype._add_to_people_queue=function(e,t){var n=this._get_queue_key(e),r=t[e],i=this._get_or_create_queue(v),s=this._get_or_create_queue(m),o=this._get_or_create_queue(g),u=this._get_or_create_queue(y,[]);n===c?(C.extend(i,r),this._pop_from_people_queue(g,r)):n===h?C.each(r,function(e,t){t in s||(s[t]=e)}):n===p?C.each(r,function(e,t){t in i?i[t]+=e:(t in o||(o[t]=0),o[t]+=e)},this):n===d&&u.push(r),O.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"),O.log(t),this.save()},P.prototype._pop_from_people_queue=function(e,t){var n=this._get_queue(e);C.isUndefined(n)||(C.each(t,function(e,t){delete n[t]},this),this.save())},P.prototype._get_queue_key=function(e){if(e===v)return c;if(e===m)return h;if(e===g)return p;if(e===y)return d;O.error("Invalid queue:",e)},P.prototype._get_queue=function(e){return this.props[this._get_queue_key(e)]},P.prototype._get_or_create_queue=function(e,t){var n=this._get_queue_key(e),t=C.isUndefined(t)?{}:t;return this.props[n]||(this.props[n]=t)};var H=function(t,n,r){var i,s=r===l?e:e[r];if(s&&!C.isArray(s)){O.error("You have already initialized "+r);return}return i=new B,i._init(t,n,r),i.people=new j,i.people._init(i),k=k||i.get_config("debug"),C.isUndefined(s)||(i._execute_array.call(i.people,s.people),i._execute_array(s)),i},B=function(){};B.prototype.init=function(t,n,r){if(typeof r=="undefined"){O.error("You must name your new library: init(token, config, name)");return}if(r===l){O.error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");return}var i=H(t,n,r);return e[r]=i,i._loaded(),i},B.prototype._init=function(e,t,n){this.__loaded=!0,this.config={},this.set_config(C.extend({},L,t,{name:n,token:e,callback_fn:(n===l?n:l+"."+n)+"._jsc"})),this._jsc=function(){},this.__dom_loaded_queue=[],this.__request_queue=[],this.__disabled_events=[],this._flags={disable_all_events:!1,identify_called:!1},this.cookie=new P(this.config),this.register_once({distinct_id:C.UUID()},"")},B.prototype._loaded=function(){this.get_config("loaded")(this),this.get_config("track_pageview")&&this.track_pageview()},B.prototype._dom_loaded=function(){C.each(this.__dom_loaded_queue,function(e){this._track_dom.apply(this,e)},this),C.each(this.__request_queue,function(e){this._send_request.apply(this,e)},this),delete this.__dom_loaded_queue,delete this.__request_queue},B.prototype._track_dom=function(e,t){if(this.get_config("img"))return O.error("You can't use DOM tracking functions with img = true."),!1;if(!A)return this.__dom_loaded_queue.push([e,t]),!1;var n=(new e).init(this);return n.track.apply(n,t)},B.prototype._prepare_callback=function(e,t){if(C.isUndefined(e))return null;if(T){var n=function(n){e(n,t)};return n}var r=this._jsc,i=""+Math.floor(Math.random()*1e8),s=this.get_config("callback_fn")+'["'+i+'"]';return r[i]=function(n){delete r[i],e(n,t)},s},B.prototype._send_request=function(e,t,n){if(N){this.__request_queue.push(arguments);return}var r=this.get_config("verbose");this.get_config("test")&&(t.test=1),r&&(t.verbose=1),this.get_config("img")&&(t.img=1);if(!T)if(n)t.callback=n;else if(r||this.get_config("test"))t.callback="(function(){})";t.ip=this.get_config("ip")?1:0,t._=(new Date).getTime().toString(),e+="?"+C.HTTPBuildQuery(t);if("img"in t){var i=a.createElement("img");i.src=e,a.body.appendChild(i)}else if(T){var s=new XMLHttpRequest;s.open("GET",e,!0),s.withCredentials=!0,s.onreadystatechange=function(e){if(s.readyState===4)if(s.status===200)n&&(r?n(C.JSONDecode(s.responseText)):n(Number(s.responseText)));else{var t="Bad HTTP status: "+s.status+" "+s.statusText;O.error(t),n&&(r?n({status:0,error:t}):n(0))}},s.send(null)}else{var o=a.createElement("script");o.type="text/javascript",o.async=!0,o.defer=!0,o.src=e;var u=a.getElementsByTagName("script")[0];u.parentNode.insertBefore(o,u)}},B.prototype._execute_array=function(e){var t,n=[],r=[],i=[];C.each(e,function(e){e&&(t=e[0],typeof e=="function"?e.call(this):C.isArray(e)&&t==="alias"?n.push(e):C.isArray(e)&&t.indexOf("track")!=-1&&typeof this[t]=="function"?i.push(e):r.push(e))},this);var s=function(e,t){C.each(e,function(e){this[e[0]].apply(this,e.slice(1))},t)};s(n,this),s(r,this),s(i,this)},B.prototype.push=function(e){this._execute_array([e])},B.prototype.disable=function(e){typeof e=="undefined"?this._flags.disable_all_events=!0:this.__disabled_events=this.__disabled_events.concat(e)},B.prototype.track=function(e,t,n){if(typeof e=="undefined"){O.error("No event name provided to mixpanel.track");return}if(C.isBlockedUA()||this._flags.disable_all_events||C.include(this.__disabled_events,e)){typeof n!="undefined"&&n(0);return}t=t||{},t.token=t.token||this.get_config("token"),this.cookie.update_search_keyword(a.referrer),this.get_config("store_google")&&this.cookie.update_campaign_params(),this.get_config("save_referrer")&&this.cookie.update_referrer_info(a.referrer),t=C.extend({},C.info.properties(),this.cookie.properties(),t);var r={event:e,properties:t},i=C.truncate(r,255),s=C.JSONEncode(i),o=C.base64Encode(s);return O.log("MIXPANEL REQUEST:"),O.log(i),this._send_request(this.get_config("api_host")+"/track/",{data:o},this._prepare_callback(n,i)),i},B.prototype.track_pageview=function(e){typeof e=="undefined"&&(e=a.location.href),this.track("mp_page_view",C.info.pageviewInfo(e))},B.prototype.track_links=function(){return this._track_dom.call(this,_,arguments)},B.prototype.track_forms=function(){return this._track_dom.call(this,D,arguments)},B.prototype.register=function(e,t){this.cookie.register(e,t)},B.prototype.register_once=function(e,t,n){this.cookie.register_once(e,t,n)},B.prototype.unregister=function(e){this.cookie.unregister(e)},B.prototype._register_single=function(e,t){var n={};n[e]=t,this.register(n)},B.prototype.identify=function(e,t,n,r,i){e!=this.get_distinct_id()&&e!=this.get_property(w)&&(this.unregister(w),this._register_single("distinct_id",e)),this._flags.identify_called=!0,this.people._flush(t,n,r,i)},B.prototype.get_distinct_id=function(){return this.get_property("distinct_id")},B.prototype.alias=function(e,t){if(e===this.get_property(b))return O.critical("Attempting to create alias for existing People user - aborting."),-2;var n=this;return C.isUndefined(t)&&(t=this.get_distinct_id()),e!==t?(this._register_single(w,e),this.track("$create_alias",{alias:e,distinct_id:t},function(t){n.identify(e)})):(O.error("alias matches current distinct_id - skipping api call."),this.identify(e),-1)},B.prototype.name_tag=function(e){this._register_single("mp_name_tag",e)},B.prototype.set_config=function(e){C.isObject(e)&&(C.extend(this.config,e),this.cookie&&this.cookie.update_config(this.config),k=k||this.get_config("debug"))},B.prototype.get_config=function(e){return this.config[e]},B.prototype.get_property=function(e){return this.cookie.props[e]},B.prototype.toString=function(){var e=this.get_config("name");return e!==l&&(e=l+"."+e),e};var j=function(){};j.prototype._init=function(e){this._mixpanel=e},j.prototype.set=function(e,t,n){var r={},i={};return C.isObject(e)?(C.each(e,function(e,t){if(t=="$distinct_id"||t=="$token")return;i[t]=e}),n=t):i[e]=t,this._get_config("save_referrer")&&this._mixpanel.cookie.update_referrer_info(a.referrer),i=C.extend({},C.info.people_properties(),this._mixpanel.cookie.get_referrer_info(),i),r[v]=i,this._send_request(r,n)},j.prototype.set_once=function(e,t,n){var r={},i={};return C.isObject(e)?(C.each(e,function(e,t){if(t=="$distinct_id"||t=="$token")return;i[t]=e}),n=t):i[e]=t,r[m]=i,this._send_request(r,n)},j.prototype.increment=function(e,t,n){var r={},i={};return C.isObject(e)?(C.each(e,function(e,t){if(t=="$distinct_id"||t=="$token")return;if(isNaN(parseFloat(e))){O.error("Invalid increment value passed to mixpanel.people.increment - must be a number");return}i[t]=e}),n=t):(C.isUndefined(t)&&(t=1),i[e]=t),r[g]=i,this._send_request(r,n)},j.prototype.append=function(e,t,n){var r={},i={};return C.isObject(e)?(C.each(e,function(e,t){if(t=="$distinct_id"||t=="$token")return;i[t]=e}),n=t):i[e]=t,r[y]=i,this._send_request(r,n)},j.prototype.track_charge=function(e,t,n){if(!C.isNumber(e)){e=parseFloat(e);if(isNaN(e)){O.error("Invalid value passed to mixpanel.people.track_charge - must be a number");return}}return this.append("$transactions",C.extend({$amount:e},t),n)},j.prototype.clear_charges=function(e){return this.set("$transactions",[],e)},j.prototype.delete_user=function(){if(!this._identify_called()){O.error("mixpanel.people.delete_user() requires you to call identify() first");return}var e={$delete:this._mixpanel.get_distinct_id()};return this._send_request(e)},j.prototype.toString=function(){return this._mixpanel.toString()+".people"},j.prototype._send_request=function(e,t){e.$token=this._get_config("token"),e.$distinct_id=this._mixpanel.get_distinct_id();var n=C.encodeDates(e),r=C.truncate(n,255),i=C.JSONEncode(n),s=C.base64Encode(i);return this._identify_called()?(O.log("MIXPANEL PEOPLE REQUEST:"),O.log(r),this._mixpanel._send_request(this._get_config("api_host")+"/engage/",{data:s},this._mixpanel._prepare_callback(t,r)),r):(this._enqueue(e),C.isUndefined(t)||(this._get_config("verbose")?t({status:-1,error:null}):t(-1)),r)},j.prototype._get_config=function(e){return this._mixpanel.get_config(e)},j.prototype._identify_called=function(){return this._mixpanel._flags.identify_called===!0},j.prototype._enqueue=function(e){v in e?this._mixpanel.cookie._add_to_people_queue(v,e):m in e?this._mixpanel.cookie._add_to_people_queue(m,e):g in e?this._mixpanel.cookie._add_to_people_queue(g,e):y in e?this._mixpanel.cookie._add_to_people_queue(y,e):O.error("Invalid call to _enqueue():",e)},j.prototype._flush=function(e,t,n,r){var i=this,s=C.extend({},this._mixpanel.cookie._get_queue(v)),o=C.extend({},this._mixpanel.cookie._get_queue(m)),u=C.extend({},this._mixpanel.cookie._get_queue(g)),a=this._mixpanel.cookie._get_queue(y);!C.isUndefined(s)&&C.isObject(s)&&!C.isEmptyObject(s)&&(i._mixpanel.cookie._pop_from_people_queue(v,s),this.set(s,function(t,n){t==0&&i._mixpanel.cookie._add_to_people_queue(v,s),C.isUndefined(e)||e(t,n)})),!C.isUndefined(o)&&C.isObject(o)&&!C.isEmptyObject(o)&&(i._mixpanel.cookie._pop_from_people_queue(m,o),this.set_once(o,function(e,t){e==0&&i._mixpanel.cookie._add_to_people_queue(m,o),C.isUndefined(r)||r(e,t)})),!C.isUndefined(u)&&C.isObject(u)&&!C.isEmptyObject(u)&&(i._mixpanel.cookie._pop_from_people_queue(g,u),this.increment(u,function(e,n){e==0&&i._mixpanel.cookie._add_to_people_queue(g,u),C.isUndefined(t)||t(e,n)}));if(!C.isUndefined(a)&&C.isArray(a)&&a.length){for(var f=a.length-1;f>=0;f--){var l=a.pop();i.append(l,function(e,t){e==0&&i._mixpanel.cookie._add_to_people_queue(y,l),C.isUndefined(n)||n(e,t)})}i._mixpanel.cookie.save()}},C.toArray=C.toArray,C.isObject=C.isObject,C.JSONEncode=C.JSONEncode,C.JSONDecode=C.JSONDecode,C.isEmptyObject=C.isEmptyObject,B.prototype.init=B.prototype.init,B.prototype.disable=B.prototype.disable,B.prototype.track=B.prototype.track,B.prototype.track_links=B.prototype.track_links,B.prototype.track_forms=B.prototype.track_forms,B.prototype.track_pageview=B.prototype.track_pageview,B.prototype.register=B.prototype.register,B.prototype.register_once=B.prototype.register_once,B.prototype.unregister=B.prototype.unregister,B.prototype.identify=B.prototype.identify,B.prototype.alias=B.prototype.alias,B.prototype.name_tag=B.prototype.name_tag,B.prototype.set_config=B.prototype.set_config,B.prototype.get_config=B.prototype.get_config,B.prototype.get_property=B.prototype.get_property,B.prototype.get_distinct_id=B.prototype.get_distinct_id,B.prototype.toString=B.prototype.toString,P.prototype.properties=P.prototype.properties,P.prototype.update_search_keyword=P.prototype.update_search_keyword,P.prototype.update_referrer_info=P.prototype.update_referrer_info,P.prototype.get_cross_subdomain=P.prototype.get_cross_subdomain,P.prototype.clear=P.prototype.clear,j.prototype.set=j.prototype.set,j.prototype.set_once=j.prototype.set_once,j.prototype.increment=j.prototype.increment,j.prototype.append=j.prototype.append,j.prototype.track_charge=j.prototype.track_charge,j.prototype.clear_charges=j.prototype.clear_charges,j.prototype.delete_user=j.prototype.delete_user,j.prototype.toString=j.prototype.toString;if(C.isUndefined(e)){O.critical("'mixpanel' object not initialized. Ensure you are using the latest version of the Mixpanel JS Library along with the snippet we provide.");return}if(e.__loaded||e.config&&e.cookie){O.error("Mixpanel library has already been downloaded at least once.");return}if(x<1.1){O.critical("Version mismatch; please ensure you're using the latest version of the Mixpanel code snippet.");return}var F={};C.each(e._i,function(e){var t,n;e&&C.isArray(e)&&(t=e[e.length-1],n=H.apply(this,e),F[t]=n)});var I=function(){C.each(F,function(t,n){n!==l&&(e[n]=t)}),e._=C};e.init=function(t,n,r){if(r)e[r]||(e[r]=F[r]=H(t,n,r),e[r]._loaded());else{var i=e;F[l]?i=F[l]:t&&(i=H(t,n,l)),window[l]=e=i,I()}},e.init(),C.each(F,function(e){e._loaded()});if(a.addEventListener)a.readyState=="complete"?q():a.addEventListener("DOMContentLoaded",q,!1);else if(a.attachEvent){a.attachEvent("onreadystatechange",q);var R=!1;try{R=window.frameElement==null}catch(U){}if(a.documentElement.doScroll&&R){function z(){try{a.documentElement.doScroll("left")}catch(e){setTimeout(z,1);return}q()}z()}}C.register_event(window,"load",q,!0)}(window.mixpanel),define("thirdparty/mixpanel",function(){}),define("tictail/component/mixpanel",["underscore","tictail/component/log","thirdparty/mixpanel"],function(e,t){var n=this;n.TT=n.TT||{};var r=n.TT.Mixpanel={},i=function(e){if(r.failed)return;return r.init(),function(){try{e.apply(e,arguments)}catch(t){}}};return r.loaded=!1,r.failed=!1,r.init=function(){if(!r.loaded){if(e.isUndefined(MixpanelToken)){t.debug("Can't init Mixpanel because MixpanelToken is undefined!");return}try{window.mixpanel.init(MixpanelToken),r.loaded=!0}catch(n){r.failed=!0,t.log("Mixpanel failed to initialize, so no tracking is available.")}}},r.people={},r.identify=i(function(e){window.mixpanel.identify(e)}),r.alias=i(function(e){window.mixpanel.alias(e)}),r.track=i(function(e,t,n){window.mixpanel.track(e,t,n)}),r.register=i(function(e){window.mixpanel.register(e)}),r.name_tag=i(function(e){window.mixpanel.name_tag(e)}),r.people.set=i(function(e,t,n){window.mixpanel.people.set(e,t,n)}),r.people.set_once=i(function(e,t,n){window.mixpanel.people.set_once(e,t,n)}),r.people.increment=i(function(e,t,n){window.mixpanel.people.increment(e,t,n)}),r}),define("tictail/component/tracker",["jquery","backbone","underscore","underscore.string","./mixpanel","tictail/utility","tictail/mediator","json2"],function(e,t,n,r,i,s,o){var u=this;u.TT=u.TT||{};var a=u.TT.Tracker={};return a.prefix="Default",a.init=function(){var t=TT.session.getStorekeeper(),r=TT.session.getCurrentStore(),i=TT.session.social;a.identify(t.external_id),a.name_tag(t.email+" (Storekeeper)"),properties={store_count:t.stores.length,store_subdomain:r.get("subdomain"),store_country:r.get("country"),store_language:r.get("language"),store_currency:r.get("currency"),store_online:r.get("online"),deprecated_browser:e("html").hasClass("deprecated")},a.registerExperiments(t.experiments),a.register(properties),a.trackPerson({"User ID":t.external_id,"Full Name":t.name||"N/A","Store Count":t.stores.length||0,"Store Subdomain":r.get("subdomain"),"Store URL":"http://"+r.get("subdomain")+".tictail.com","Store Country":r.get("country"),"Store Language":r.get("language"),"Store Currency":r.get("currency"),"Store Online":r.get("online")?"Yes":"No",$created:new Date(t.created_at*1e3),Facebook:n.isEmpty(i.facebook.attributes)?"No":"Yes",Twitter:n.isEmpty(i.twitter.attributes)?"No":"Yes",$email:t.email,$name:t.email}),a.setupEventListeners()},a.registerExperiments=function(e){var t={};n.each(e,function(e){var n="experiment_"+r.underscored(e.name),i=r.underscored(e.variant);t[n]=i}),a.register(t)},a.setupEventListeners=function(){o.on("app.installed",n.bind(a.trackAppEvent,null,"Installed application")),o.on("app.removed",n.bind(a.trackAppEvent,null,"Uninstalled application"))},a.trackAppEvent=function(e,t){a.track(e,t.get("namespace"),{"Application ID":t.get("id"),"Application Name":t.get("name")})},a.identify=function(e){e!=null&&i.identify(e)},a.alias=function(e){e!=null&&i.alias(e)},a.register=function(e){if(n.isUndefined(e)==1)return;i.register(e)},a.name_tag=function(e){if(n.isUndefined(e)==1)return;i.name_tag(e)},a.track=function(e,r,s){n.isUndefined(s)&&(s={}),n.isUndefined(r)||(s.mp_note=r);if(t&&t.history&&t.history.fragment){var o=t.history.fragment.replace(/store\/.*?\//,"");s.Page="/"+o}e=a.prefix+": "+e,i.track(e,s)},a.trackPerson=function(e,t){var t=t||!1,n=i.people,r=t?n.set_once:n.set;e!=null&&r(e)},a.trackOnboarding=function(e){if(e==null)return;var t=s.getTimeInISO8601(new Date);a.trackPerson({"Onboarding Stage":e,"Onboarding Stage Date":t})},a.increment=function(e){e!=null&&i.people.increment(e)},a}),define("jquery-ui",["jquery"],function(e){(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return typeof n=="number"?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})})(e),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(e),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(e),function(e,t){function n(e,t,n){return e>t&&e<t+n}function r(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||r(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,i=!1,s=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type==="static")return!1;this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,s.widgetName+"-item")===s)return r=e(this),!1}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target));if(!r)return!1;if(this.options.handle&&!n){e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)});if(!i)return!1}return this.currentItem=r,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i,s,o=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&o.cursor!=="auto"&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i,s,o=this.options,u=!1;this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?u=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(u=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?u=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(u=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";for(n=this.items.length-1;n>=0;n--){r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r);if(!s)continue;if(r.instance!==this.currentContainer)continue;if(i!==this.currentItem[0]&&this.placeholder[s===1?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&(this.options.type==="semi-dynamic"?!e.contains(this.element[0],i):!0)){this.direction=s===1?"down":"up";if(this.options.tolerance!=="pointer"&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=this.placeholder.offset(),s=this.options.axis,o={};if(!s||s==="x")o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft);if(!s||s==="y")o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop);this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper==="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=this.options.axis==="x"||r+f>u&&r+f<a,h=this.options.axis==="y"||t+l>s&&t+l<o,p=c&&h;return this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(e){var t=this.options.axis==="x"||n(this.positionAbs.top+this.offset.click.top,e.top,e.height),r=this.options.axis==="y"||n(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=t&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o==="right"||s==="down"?2:1:s&&(s==="down"?2:1):!1},_intersectsWithSides:function(e){var t=n(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=n(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s==="right"&&r||s==="left"&&!r:i&&(i==="down"&&t||i==="up"&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!==0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!==0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n,r,i,s,o=[],u=[],a=this._connectWith();if(a&&t)for(n=a.length-1;n>=0;n--){i=e(a[n]);for(r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&u.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s])}u.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(n=u.length-1;n>=0;n--)u[n][0].each(function(){o.push(this)});return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--){i=e(h[n]);for(r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s))}for(n=c.length-1;n>=0;n--){o=c[n][1],u=c[n][0];for(r=0,f=u.length;r<f;r++)a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--){r=this.items[n];if(r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0])continue;i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;if(!r.placeholder||r.placeholder.constructor===String)n=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),i=e("<"+r+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return r==="tr"?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)}):r==="img"&&i.attr("src",t.currentItem.attr("src")),n||i.css("visibility","hidden"),i},update:function(e,i){if(n&&!r.forcePlaceholderSize)return;i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}};t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var i,s,o,u,a,f,l,c,h,p,d=null,v=null;for(i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(d&&e.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],v=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(!d)return;if(this.containers.length===1)this.containers[v].containerCache.over||(this.containers[v]._trigger("over",t,this._uiHash(this)),this.containers[v].containerCache.over=1);else{o=1e4,u=null,p=d.floating||r(this.currentItem),a=p?"left":"top",f=p?"width":"height",l=this.positionAbs[a]+this.offset.click[a];for(s=this.items.length-1;s>=0;s--){if(!e.contains(this.containers[v].element[0],this.items[s].item[0]))continue;if(this.items[s].item[0]===this.currentItem[0])continue;if(p&&!n(this.positionAbs.top+this.offset.click.top,this.items[s].top,this.items[s].height))continue;c=this.items[s].item.offset()[a],h=!1,Math.abs(c-l)>Math.abs(c+this.items[s][f]-l)&&(h=!0,c+=this.items[s][f]),Math.abs(c-l)<o&&(o=Math.abs(c-l),u=this.items[s],this.direction=h?"up":"down")}if(!u&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[v])return;u?this._rearrange(t,u,null,!0):this._rearrange(t,null,this.containers[v].element,!0),this._trigger("change",t,this._uiHash()),this.containers[v]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[v],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[v]._trigger("over",t,this._uiHash(this)),this.containers[v].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper==="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!=="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;i.containment==="parent"&&(i.containment=this.helper[0].parentNode);if(i.containment==="document"||i.containment==="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(i.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(i.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r=e(t).css("overflow")!=="hidden",this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return this.cssPosition==="relative"&&(this.scrollParent[0]===document||this.scrollParent[0]===this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var n,r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)if(this._storedCSS[n]==="auto"||this._storedCSS[n]==="static")this._storedCSS[n]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!t&&r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(n=this.containers.length-1;n>=0;n--)t||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!t){this._trigger("beforeStop",e,this._uiHash());for(n=0;n<r.length;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!t){for(n=0;n<r.length;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(e),function(t,n){var r="ui-effects-";t.effects={effect:{}},function(e,t){function h(e,t,n){var r=u[t.type]||{};return e==null?n||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:r.max<e?r.max:e)}function p(t){var n=s(),r=n._rgba=[];return t=t.toLowerCase(),c(i,function(e,i){var s,u=i.re.exec(t),a=u&&i.parse(u),f=i.space||"rgba";if(a)return s=n[f](a),n[o[f].cache]=s[o[f].cache],r=n._rgba=s._rgba,!1}),r.length?(r.join()==="0,0,0,0"&&e.extend(r,l.transparent),n):l[t]}function d(e,t,n){return n=(n+1)%1,n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}var n="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],s=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},o={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},a=s.support={},f=e("<p>")[0],l,c=e.each;f.style.cssText="background-color:rgba(1,1,1,.5)",a.rgba=f.style.backgroundColor.indexOf("rgba")>-1,c(o,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),s.fn=e.extend(s.prototype,{parse:function(n,r,i,u){if(n===t)return this._rgba=[null,null,null,null],this;if(n.jquery||n.nodeType)n=e(n).css(r),r=t;var a=this,f=e.type(n),d=this._rgba=[];r!==t&&(n=[n,r,i,u],f="array");if(f==="string")return this.parse(p(n)||l._default);if(f==="array")return c(o.rgba.props,function(e,t){d[t.idx]=h(n[t.idx],t)}),this;if(f==="object")return n instanceof s?c(o,function(e,t){n[t.cache]&&(a[t.cache]=n[t.cache].slice())}):c(o,function(t,r){var i=r.cache;c(r.props,function(e,t){if(!a[i]&&r.to){if(e==="alpha"||n[e]==null)return;a[i]=r.to(a._rgba)}a[i][t.idx]=h(n[e],t,!0)}),a[i]&&e.inArray(null,a[i].slice(0,3))<0&&(a[i][3]=1,r.from&&(a._rgba=r.from(a[i])))}),this},is:function(e){var t=s(e),n=!0,r=this;return c(o,function(e,i){var s,o=t[i.cache];return o&&(s=r[i.cache]||i.to&&i.to(r._rgba)||[],c(i.props,function(e,t){if(o[t.idx]!=null)return n=o[t.idx]===s[t.idx],n})),n}),n},_space:function(){var e=[],t=this;return c(o,function(n,r){t[r.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var n=s(e),r=n._space(),i=o[r],a=this.alpha()===0?s("transparent"):this,f=a[i.cache]||i.to(a._rgba),l=f.slice();return n=n[i.cache],c(i.props,function(e,r){var i=r.idx,s=f[i],o=n[i],a=u[r.type]||{};if(o===null)return;s===null?l[i]=o:(a.mod&&(o-s>a.mod/2?s+=a.mod:s-o>a.mod/2&&(s-=a.mod)),l[i]=h((o-s)*t+s,r))}),this[r](l)},blend:function(t){if(this._rgba[3]===1)return this;var n=this._rgba.slice(),r=n.pop(),i=s(t)._rgba;return s(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});return n[3]===1&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return e==null&&(e=t>2?1:0),t&&t<3&&(e=Math.round(e*100)+"%"),e});return n[3]===1&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();return t&&n.push(~~(r*255)),"#"+e.map(n,function(e){return e=(e||0).toString(16),e.length===1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}}),s.fn.parse.prototype=s.fn,o.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*.5,l,c;return o===s?l=0:t===s?l=60*(n-r)/u+360:n===s?l=60*(r-t)/u+120:l=60*(t-n)/u+240,u===0?c=0:f<=.5?c=u/a:c=u/(2-a),[Math.round(l)%360,c,f,i==null?1:i]},o.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;return[Math.round(d(o,s,t+1/3)*255),Math.round(d(o,s,t)*255),Math.round(d(o,s,t-1/3)*255),i]},c(o,function(n,i){var o=i.props,u=i.cache,a=i.to,f=i.from;s.fn[n]=function(n){a&&!this[u]&&(this[u]=a(this._rgba));if(n===t)return this[u].slice();var r,i=e.type(n),l=i==="array"||i==="object"?n:arguments,p=this[u].slice();return c(o,function(e,t){var n=l[i==="object"?e:t.idx];n==null&&(n=p[t.idx]),p[t.idx]=h(n,t)}),f?(r=s(f(p)),r[u]=p,r):s(p)},c(o,function(t,i){if(s.fn[t])return;s.fn[t]=function(s){var o=e.type(s),u=t==="alpha"?this._hsla?"hsla":"rgba":n,a=this[u](),f=a[i.idx],l;return o==="undefined"?f:(o==="function"&&(s=s.call(this,f),o=e.type(s)),s==null&&i.empty?this:(o==="string"&&(l=r.exec(s),l&&(s=f+parseFloat(l[2])*(l[1]==="+"?1:-1))),a[i.idx]=s,this[u](a)))}})}),s.hook=function(t){var n=t.split(" ");c(n,function(t,n){e.cssHooks[n]={set:function(t,r){var i,o,u="";if(r!=="transparent"&&(e.type(r)!=="string"||(i=p(r)))){r=s(i||r);if(!a.rgba&&r._rgba[3]!==1){o=n==="backgroundColor"?t.parentNode:t;while((u===""||u==="transparent")&&o&&o.style)try{u=e.css(o,"backgroundColor"),o=o.parentNode}catch(f){}r=r.blend(u&&u!=="transparent"?u:"_default")}r=r.toRgbaString()}try{t.style[n]=r}catch(f){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=s(t.elem,n),t.end=s(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},s.hook(n),e.cssHooks.borderColor={expand:function(e){var t={};return c(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e}),t}},l=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(e),function(){function s(e){var n,r,i=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,s={};if(i&&i.length&&i[0]&&i[i[0]]){r=i.length;while(r--)n=i[r],typeof i[n]=="string"&&(s[t.camelCase(n)]=i[n])}else for(n in i)typeof i[n]=="string"&&(s[n]=i[n]);return s}function o(e,n){var r={},s,o;for(s in n)o=n[s],e[s]!==o&&!i[s]&&(t.fx.step[s]||!isNaN(parseFloat(o)))&&(r[s]=o);return r}var r=["add","remove","toggle"],i={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(n,r){t.fx.step[r]=function(t){if(t.end!=="none"&&!t.setAttr||t.pos===1&&!t.setAttr)e.style(t.elem,r,t.end),t.setAttr=!0}}),t.fn.addBack||(t.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),t.effects.animateClass=function(e,n,i,u){var a=t.speed(n,i,u);return this.queue(function(){var n=t(this),i=n.attr("class")||"",u,f=a.children?n.find("*").addBack():n;f=f.map(function(){var e=t(this);return{el:e,start:s(this)}}),u=function(){t.each(r,function(t,r){e[r]&&n[r+"Class"](e[r])})},u(),f=f.map(function(){return this.end=s(this.el[0]),this.diff=o(this.start,this.end),this}),n.attr("class",i),f=f.map(function(){var e=this,n=t.Deferred(),r=t.extend({},a,{queue:!1,complete:function(){n.resolve(e)}});return this.el.animate(this.diff,r),n.promise()}),t.when.apply(t,f.get()).done(function(){u(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),a.complete.call(n[0])})})},t.fn.extend({addClass:function(e){return function(n,r,i,s){return r?t.effects.animateClass.call(this,{add:n},r,i,s):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(n,r,i,s){return arguments.length>1?t.effects.animateClass.call(this,{remove:n},r,i,s):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(r,i,s,o,u){return typeof i=="boolean"||i===n?s?t.effects.animateClass.call(this,i?{add:r}:{remove:r},s,o,u):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:r},i,s,o)}}(t.fn.toggleClass),switchClass:function(e,n,r,i,s){return t.effects.animateClass.call(this,{add:n,remove:e},r,i,s)}})}(),function(){function e(e,n,r,i){t.isPlainObject(e)&&(n=e,e=e.effect),e={effect:e},n==null&&(n={}),t.isFunction(n)&&(i=n,r=null,n={});if(typeof n=="number"||t.fx.speeds[n])i=r,r=n,n={};return t.isFunction(r)&&(i=r,r=null),n&&t.extend(e,n),r=r||n.duration,e.duration=t.fx.off?0:typeof r=="number"?r:r in t.fx.speeds?t.fx.speeds[r]:t.fx.speeds._default,e.complete=i||n.complete,e}function i(e){return!e||typeof e=="number"||t.fx.speeds[e]?!0:typeof e=="string"&&!t.effects.effect[e]?!0:t.isFunction(e)?!0:typeof e=="object"&&!e.effect?!0:!1}t.extend(t.effects,{version:"1.10.3",save:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.data(r+t[n],e[0].style[t[n]])},restore:function(e,t){var i,s;for(s=0;s<t.length;s++)t[s]!==null&&(i=e.data(r+t[s]),i===n&&(i=""),e.css(t[s],i))},setMode:function(e,t){return t==="toggle"&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var n={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},r=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:e.width(),height:e.height()},s=document.activeElement;try{s.id}catch(o){s=document.body}return e.wrap(r),(e[0]===s||t.contains(e[0],s))&&t(s).focus(),r=e.parent(),e.css("position")==="static"?(r.css({position:"relative"}),e.css({position:"relative"})):(t.extend(n,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,r){n[r]=e.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(i),r.css(n).show()},removeWrapper:function(e){var n=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===n||t.contains(e[0],n))&&t(n).focus()),e},setTransition:function(e,n,r,i){return i=i||{},t.each(n,function(t,n){var s=e.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),t.fn.extend({effect:function(){function o(e){function u(){t.isFunction(i)&&i.call(r[0]),t.isFunction(e)&&e()}var r=t(this),i=n.complete,o=n.mode;(r.is(":hidden")?o==="hide":o==="show")?(r[o](),u()):s.call(r[0],n,u)}var n=e.apply(this,arguments),r=n.mode,i=n.queue,s=t.effects.effect[n.effect];return t.fx.off||!s?r?this[r](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):i===!1?this.each(o):this.queue(i||"fx",o)},show:function(t){return function(n){if(i(n))return t.apply(this,arguments);var r=e.apply(this,arguments);return r.mode="show",this.effect.call(this,r)}}(t.fn.show),hide:function(t){return function(n){if(i(n))return t.apply(this,arguments);var r=e.apply(this,arguments);return r.mode="hide",this.effect.call(this,r)}}(t.fn.hide),toggle:function(t){return function(n){if(i(n)||typeof n=="boolean")return t.apply(this,arguments);var r=e.apply(this,arguments);return r.mode="toggle",this.effect.call(this,r)}}(t.fn.toggle),cssUnit:function(e){var n=this.css(e),r=[];return t.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,n){e[n]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return e===0||e===1?e:-Math.pow(2,8*(e-1))*Math.sin(((e-1)*80-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){var t,n=4;while(e<((t=Math.pow(2,--n))-1)/11);return 1/Math.pow(4,3-n)-7.5625*Math.pow((t*3-2)/22-e,2)}}),t.each(e,function(e,n){t.easing["easeIn"+e]=n,t.easing["easeOut"+e]=function(e){return 1-n(1-e)},t.easing["easeInOut"+e]=function(e){return e<.5?n(e*2)/2:1-n(e*-2+2)/2}})}()}(e)});var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function m(e){window.alert("Rangy not supported in your browser. Reason: "+e),v.initialized=!0,v.supported=!1}function g(e){var t="Rangy warning: "+e;v.config.alertOnWarn?window.alert(t):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(t)}function w(){if(v.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0),e.detach());var s=a(document,"body")?document.body:document.getElementsByTagName("body")[0];s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0)),!t&&!n&&m("Neither Range nor TextRange are implemented"),v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n};var o=b.concat(y);for(var f=0,l=o.length;f<l;++f)try{o[f](v)}catch(h){a(window,"console")&&u(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}function S(e){e=e||window,w();for(var t=0,n=E.length;t<n;++t)E[t](e)}function x(e){this.name=e,this.initialized=!1,this.supported=!1}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),v={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};v.fail=m,v.warn=g,{}.hasOwnProperty?v.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:m("hasOwnProperty not supported");var y=[],b=[];v.init=w,v.addInitListener=function(e){v.initialized?e(v):y.push(e)};var E=[];v.addCreateMissingNativeApiListener=function(e){E.push(e)},v.createMissingNativeApi=S,x.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},x.prototype.warn=function(e){v.warn("Module "+this.name+": "+e)},x.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},v.createModule=function(e,t){var n=new x(e);v.modules[e]=n,b.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},v.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=v.modules[i];if(!r||!(r instanceof x))throw new Error("Module '"+i+"' not found");if(!r.supported)throw new Error("Module '"+i+"' not supported")}};var T=!1,N=function(e){T||(T=!0,v.initialized||w())};if(typeof window==n){m("No window found");return}if(typeof document==n){m("No document found");return}return u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),u(window,"addEventListener")?window.addEventListener("load",N,!1):u(window,"attachEvent")?window.attachEvent("onload",N):m("Window does not have required addEventListener or attachEvent method"),v}(),rangy.createModule("DomUtil",function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)t++;return t}function l(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function d(e){var t=e.nodeType;return t==3||t==4||t==8}function v(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function m(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),v(n,e),n}function g(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return g(e.parentNode);throw new Error("getDocument: no document found for node")}function y(e){var t=g(e);if(typeof t.defaultView!=n)return t.defaultView;if(typeof t.parentWindow!=n)return t.parentWindow;throw new Error("Cannot get a window object for node")}function b(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function w(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function E(e){return r.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function S(e){var t;while(t=e.parentNode)e=t;return e}function x(e,t,n,r){var i,s,o,u,a;if(e==n)return t===r?0:t<r?-1:1;if(i=p(n,e,!0))return t<=f(i)?-1:1;if(i=p(e,n,!0))return f(i)<r?-1:1;s=c(e,n),o=e===s?s:p(e,s,!0),u=n===s?s:p(n,s,!0);if(o===u)throw new Error("comparePoints got to case 4 and childA and childB are the same!");a=s.firstChild;while(a){if(a===o)return-1;if(a===u)return 1;a=a.nextSibling}throw new Error("Should not be here!")}function T(e){var t=g(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function N(e){if(!e)return"[No node]";if(d(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function C(e){this.root=e,this._next=e}function k(e){return new C(e)}function L(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1};C.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},L.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+N(this.node)+":"+this.offset+")]"}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},A.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,getClosestAncestorIn:p,isCharacterDataNode:d,insertAfter:v,splitDataNode:m,getDocument:g,getWindow:y,getIframeWindow:w,getIframeDocument:b,getBody:E,getRootContainer:S,comparePoints:x,inspectNode:N,fragmentFromNodeChildren:T,createIterator:k,DomPosition:L},e.DOMException=A}),rangy.createModule("DomRange",function(e,t){function s(e,t){return e.nodeType!=3&&(n.isAncestorOf(e,t.startContainer,!0)||n.isAncestorOf(e,t.endContainer,!0))}function o(e){return n.getDocument(e.startContainer)}function u(e,t,n){var r=e._listeners[t];if(r)for(var i=0,s=r.length;i<s;++i)r[i].call(e,{target:e,args:n})}function a(e){return new r(e.parentNode,n.getNodeIndex(e))}function f(e){return new r(e.parentNode,n.getNodeIndex(e)+1)}function l(e,t,r){var i=e.nodeType==11?e.firstChild:e;return n.isCharacterDataNode(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:n.splitDataNode(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function c(e){var t;for(var n,r=o(e.range).createDocumentFragment(),s;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(s=e.getSubtreeIterator(),n.appendChild(c(s)),s.detach(!0));if(n.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function h(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),h(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function p(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),p(t),t.detach(!0)):e.remove()}function d(e){for(var t,n=o(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function v(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var o=[];return h(new g(e,!1),function(e){(!r||i.test(e.nodeType))&&(!s||n(e))&&o.push(e)}),o}function m(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&n.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!n.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:n.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!n.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:n.getClosestAncestorIn(this.ec,r,!0))}}function y(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function b(e,t,n){this.nodes=v(e,t,n),this._next=this.nodes[0],this._position=0}function N(e){return function(t,r){var i,s=r?t:t.parentNode;while(s){i=s.nodeType;if(n.arrayContains(e,i))return s;s=s.parentNode}return null}}function O(e,t){if(A(e,t))throw new y("INVALID_NODE_TYPE_ERR")}function M(e){if(!e.startContainer)throw new i("INVALID_STATE_ERR")}function _(e,t){if(!n.arrayContains(t,e.nodeType))throw new y("INVALID_NODE_TYPE_ERR")}function D(e,t){if(t<0||t>(n.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function P(e,t){if(k(e,!0)!==k(t,!0))throw new i("WRONG_DOCUMENT_ERR")}function H(e){if(L(e,!0))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function B(e,t){if(!e)throw new i(t)}function j(e){return!n.arrayContains(E,e.nodeType)&&!k(e,!0)}function F(e,t){return t<=(n.isCharacterDataNode(e)?e.length:e.childNodes.length)}function I(e){M(e);if(j(e.startContainer)||j(e.endContainer)||!F(e.startContainer,e.startOffset)||!F(e.endContainer,e.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function Z(){}function et(e){e.START_TO_START=X,e.START_TO_END=V,e.END_TO_END=$,e.END_TO_START=J,e.NODE_BEFORE=K,e.NODE_AFTER=Q,e.NODE_BEFORE_AND_AFTER=G,e.NODE_INSIDE=Y}function tt(e){et(e),et(e.prototype)}function nt(e,t){return function(){I(this);var r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,o=new g(this,!0),u,a;r!==s&&(u=n.getClosestAncestorIn(r,s,!0),a=f(u),r=a.node,i=a.offset),h(o,H),o.reset();var l=e(o);return o.detach(),t(this,r,i,r,i),l}}function rt(t,r,i){function o(e,t){return function(n){M(this),_(n,w),_(C(n),E);var r=(e?a:f)(n);(t?u:l)(this,r.node,r.offset)}}function u(e,t,i){var s=e.endContainer,o=e.endOffset;if(t!==e.startContainer||i!==e.startOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==1)s=t,o=i;r(e,t,i,s,o)}}function l(e,t,i){var s=e.startContainer,o=e.startOffset;if(t!==e.endContainer||i!==e.endOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==-1)s=t,o=i;r(e,s,o,t,i)}}function c(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&r(e,t,n,t,n)}t.prototype=new Z,e.util.extend(t.prototype,{setStart:function(e,t){M(this),O(e,!0),D(e,t),u(this,e,t)},setEnd:function(e,t){M(this),O(e,!0),D(e,t),l(this,e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){I(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){M(this),O(e,!0),r(this,e,0,e,n.getNodeLength(e))},selectNode:function(e){M(this),O(e,!1),_(e,w);var t=a(e),n=f(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:nt(d,r),deleteContents:nt(p,r),canSurroundContents:function(){I(this),H(this.startContainer),H(this.endContainer);var e=new g(this,!0),t=e._first&&s(e._first,this)||e._last&&s(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset,o=e===i;n.isCharacterDataNode(i)&&s>0&&s<i.length&&n.splitDataNode(i,s),n.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=n.splitDataNode(e,t),o?(s-=t,i=e):i==e.parentNode&&s>=n.getNodeIndex(e)&&s++,t=0),r(this,e,t,i,s)},normalizeBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,s=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},u=function(r){var o=r.previousSibling;if(o&&o.nodeType==r.nodeType){e=r;var u=r.length;t=o.length,r.insertData(0,o.data),o.parentNode.removeChild(o);if(e==i)s+=t,i=e;else if(i==r.parentNode){var a=n.getNodeIndex(r);s==a?(i=r,s=u):s>a&&s--}}},a=!0;if(n.isCharacterDataNode(i))i.length==s&&o(i);else{if(s>0){var f=i.childNodes[s-1];f&&n.isCharacterDataNode(f)&&o(f)}a=!this.collapsed}if(a){if(n.isCharacterDataNode(e))t==0&&u(e);else if(t<e.childNodes.length){var l=e.childNodes[t];l&&n.isCharacterDataNode(l)&&u(l)}}else e=i,t=s;r(this,e,t,i,s)},collapseToPoint:function(e,t){M(this),O(e,!0),D(e,t),c(this,e,t)}}),tt(t)}function it(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function st(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!==n,o=e.endContainer!==r||e.endOffset!==i;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,it(e),u(e,"boundarychange",{startMoved:s,endMoved:o})}function ot(e){M(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,u(e,"detach",null),e._listeners=null}function ut(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},it(this)}e.requireModules(["DomUtil"]);var n=e.dom,r=n.DomPosition,i=e.DOMException;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,n.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,r;!n.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,r=e===this.ec?this.eo:e.length,t!=r&&e.deleteData(t,r-t))},isPartiallySelectedSubtree:function(){var e=this._current;return s(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new ut(o(this.range));var t=this._current,r=t,i=0,s=t,u=n.getNodeLength(t);n.isAncestorOf(t,this.sc,!0)&&(r=this.sc,i=this.so),n.isAncestorOf(t,this.ec,!0)&&(s=this.ec,u=this.eo),st(e,r,i,s,u)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},y.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},y.prototype.toString=function(){return this.message},b.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var w=[1,3,4,5,7,8,10],E=[2,9,11],S=[5,6,10,12],x=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],C=n.getRootContainer,k=N([9,11]),L=N(S),A=N([6,10,12]),q=document.createElement("style"),R=!1;try{q.innerHTML="<b>x</b>",R=q.firstChild.nodeType==3}catch(U){}e.features.htmlParsingConforms=R;var z=R?function(e){var t=this.startContainer,r=n.getDocument(t);if(!t)throw new i("INVALID_STATE_ERR");var s=null;return t.nodeType==1?s=t:n.isCharacterDataNode(t)&&(s=n.parentElement(t)),s===null||s.nodeName=="HTML"&&n.isHtmlNamespace(n.getDocument(s).documentElement)&&n.isHtmlNamespace(s)?s=r.createElement("body"):s=s.cloneNode(!1),s.innerHTML=e,n.fragmentFromNodeChildren(s)}:function(e){M(this);var t=o(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],X=0,V=1,$=2,J=3,K=0,Q=1,G=2,Y=3;Z.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){I(this),P(this.startContainer,t.startContainer);var r,i,s,o,u=e==J||e==X?"start":"end",a=e==V||e==X?"start":"end";return r=this[u+"Container"],i=this[u+"Offset"],s=t[a+"Container"],o=t[a+"Offset"],n.comparePoints(r,i,s,o)},insertNode:function(e){I(this),_(e,x),H(this.startContainer);if(n.isAncestorOf(e,this.startContainer,!0))throw new i("HIERARCHY_REQUEST_ERR");var t=l(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){I(this);var e,t;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&n.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=o(this).createDocumentFragment(),t.appendChild(e),t;var r=new g(this,!0);return e=c(r),r.detach(),e},canSurroundContents:function(){I(this),H(this.startContainer),H(this.endContainer);var e=new g(this,!0),t=e._first&&s(e._first,this)||e._last&&s(e._last,this);return e.detach(),!t},surroundContents:function(e){_(e,T);if(!this.canSurroundContents())throw new y("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);l(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){I(this);var e=new ut(o(this)),t=W.length,n;while(t--)n=W[t],e[n]=this[n];return e},toString:function(){I(this);var e=this.startContainer;if(e===this.endContainer&&n.isCharacterDataNode(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new g(this,!0);return h(r,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){I(this);var t=e.parentNode,r=n.getNodeIndex(e);if(!t)throw new i("NOT_FOUND_ERR");var s=this.comparePoint(t,r),o=this.comparePoint(t,r+1);return s<0?o>0?G:K:o>0?Q:Y},comparePoint:function(e,t){return I(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:n.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:z,toHtml:function(){I(this);var e=o(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){I(this),B(e,"NOT_FOUND_ERR");if(n.getDocument(e)!==o(this))return!1;var r=e.parentNode,i=n.getNodeIndex(e);B(r,"NOT_FOUND_ERR");var s=n.comparePoints(r,i,this.endContainer,this.endOffset),u=n.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?s<=0&&u>=0:s<0&&u>0},isPointInRange:function(e,t){return I(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&n.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){I(this);if(o(e)!=o(this))throw new i("WRONG_DOCUMENT_ERR");var r=n.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),s=n.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?r<=0&&s>=0:r<0&&s>0},intersection:function(e){if(this.intersectsRange(e)){var t=n.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=n.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return t==-1&&i.setStart(e.startContainer,e.startOffset),r==1&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return n.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),n.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new y("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Y},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return I(this),new b(this,e,t)},getNodes:function(e,t){return I(this),v(this,e,t)},getDocument:function(){return o(this)},collapseBefore:function(e){M(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){M(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return ut.rangesEqual(this,e)},inspect:function(){return m(this)}},rt(ut,st,ot),e.rangePrototype=Z.prototype,ut.rangeProperties=W,ut.RangeIterator=g,ut.copyComparisonConstants=tt,ut.createPrototypeRange=rt,ut.inspect=m,ut.getRangeDocument=o,ut.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=ut,e.RangeException=y}),rangy.createModule("WrappedRange",function(e,t){function o(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=i==s?i:r.getCommonAncestor(i,s);return o==t?o:r.getCommonAncestor(t,o)}function u(e){return e.compareEndPoints("StartToEnd",e)==0}function a(e,t,n,s){var o=e.duplicate();o.collapse(n);var u=o.parentElement();r.isAncestorOf(t,u,!0)||(u=t);if(!u.canHaveHTML)return new i(u.parentNode,r.getNodeIndex(u));var a=r.getDocument(u).createElement("span"),f,l=n?"StartToStart":"StartToEnd",c,h,p,d;do u.insertBefore(a,a.previousSibling),o.moveToElementText(a);while((f=o.compareEndPoints(l,e))>0&&a.previousSibling);d=a.nextSibling;if(f==-1&&d&&r.isCharacterDataNode(d)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var v;if(/[\r\n]/.test(d.data)){var m=o.duplicate(),g=m.text.replace(/\r\n/g,"\r").length;v=m.moveStart("character",g);while((f=m.compareEndPoints("StartToEnd",m))==-1)v++,m.moveStart("character",1)}else v=o.text.length;p=new i(d,v)}else c=(s||!n)&&a.previousSibling,h=(s||n)&&a.nextSibling,h&&r.isCharacterDataNode(h)?p=new i(h,0):c&&r.isCharacterDataNode(c)?p=new i(c,c.length):p=new i(u,r.getNodeIndex(a));return a.parentNode.removeChild(a),p}function f(e,t){var n,i,s=e.offset,o=r.getDocument(e.node),u,a,f=o.body.createTextRange(),l=r.isCharacterDataNode(e.node);return l?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?i.insertBefore(u,n):i.appendChild(u),f.moveToElementText(u),f.collapse(!t),i.removeChild(u),l&&f[t?"moveStart":"moveEnd"]("character",s),f}e.requireModules(["DomUtil","DomRange"]);var n,r=e.dom,i=r.DomPosition,s=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange))(function(){function u(e){var t=i.length,n;while(t--)n=i[t],e[n]=e.nativeRange[n]}function a(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i;if(s||o)e.setEnd(r,i),e.setStart(t,n)}function f(e){e.nativeRange.detach(),e.detached=!0;var t=i.length,n;while(t--)n=i[t],e[n]=null}var t,i=s.rangeProperties,o,l;n=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,a,f),t=n.prototype,t.selectNode=function(e){this.nativeRange.selectNode(e),u(this)},t.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},t.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},t.collapse=function(e){this.nativeRange.collapse(e),u(this)},t.cloneRange=function(){return new n(this.nativeRange.cloneRange())},t.refresh=function(){u(this)},t.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");r.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),o=!0,t.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},t.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},l=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(p){o=!1,t.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},t.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}t.setStartBefore=l("setStartBefore","setEndBefore"),t.setStartAfter=l("setStartAfter","setEndAfter"),t.setEndBefore=l("setEndBefore","setStartBefore"),t.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(c),h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length?t.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),u(this)}:t.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,s.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,4),d.setStart(c,2),h.compareBoundaryPoints(h.START_TO_END,d)==-1&h.compareBoundaryPoints(h.END_TO_START,d)==1?t.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),r.getBody(document).removeChild(c),h.detach(),d.detach()})(),e.createNativeRange=function(e){return e=e||document,e.createRange()};else if(e.features.implementsTextRange){n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,n=o(this.textRange);u(this.textRange)?t=e=a(this.textRange,n,!0,!0):(e=a(this.textRange,n,!0,!1),t=a(this.textRange,n,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},s.copyComparisonConstants(n);var l=function(){return this}();typeof l.Range=="undefined"&&(l.Range=n),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}e.features.implementsTextRange&&(n.rangeToTextRange=function(e){if(e.collapsed){var t=f(new i(e.startContainer,e.startOffset),!0);return t}var n=f(new i(e.startContainer,e.startOffset),!0),s=f(new i(e.endContainer,e.endOffset),!1),o=r.getDocument(e.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",n),o.setEndPoint("EndToEnd",s),o}),n.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createRange=function(t){return t=t||document,new n(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new s(e)},e.createIframeRange=function(t){return e.createRange(r.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(r.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function p(e){return(e||window).getSelection()}function d(e){return(e||window).document.selection}function L(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function A(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function O(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function M(t){var n;return t instanceof o?(n=t._selectionNativeRange,n||(n=e.createNativeRange(i.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof u?n=t.nativeRange:e.features.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function _(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function D(e){var t=e.getNodes();if(!_(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function P(e){return!!e&&typeof e.text!="undefined"}function H(e,t){var n=new u(t);e._ranges=[n],L(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function B(t){t._ranges.length=0;if(t.docSelection.type=="None")O(t);else{var n=t.docSelection.createRange();if(P(n))H(t,n);else{t.rangeCount=n.length;var r,s=i.getDocument(n.item(0));for(var o=0;o<t.rangeCount;++o)r=e.createRange(s),r.selectNode(n.item(o)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,L(t,t._ranges[t.rangeCount-1],!1)}}}function j(e,t){var n=e.docSelection.createRange(),r=D(t),s=i.getDocument(n.item(0)),o=i.getBody(s).createControlRange();for(var u=0,a=n.length;u<a;++u)o.add(n.item(u));try{o.add(r)}catch(f){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),B(e)}function I(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e,t){var n=i.getDocument(t[0].startContainer),r=i.getBody(n).createControlRange();for(var s=0,o;s<rangeCount;++s){o=D(t[s]);try{r.add(o)}catch(u){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),B(e)}function V(e,t){if(e.anchorNode&&i.getDocument(e.anchorNode)!==i.getDocument(t))throw new a("WRONG_DOCUMENT_ERR")}function $(e){var t=[],n=new f(e.anchorNode,e.anchorOffset),r=new f(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,u=e.rangeCount;s<u;++s)t[s]=o.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var n="boolean",r="_rangySelection",i=e.dom,s=e.util,o=e.DomRange,u=e.WrappedRange,a=e.DOMException,f=i.DomPosition,l,c,h="Control",v=e.util.isHostMethod(window,"getSelection"),m=e.util.isHostObject(document,"selection"),g=m&&(!v||e.config.preferTextRange);g?(l=d,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return n.type!="None"||i.getDocument(n.createRange().parentElement())==t}):v?(l=p,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=l;var y=l(),b=e.createNativeRange(document),w=i.getBody(document),E=s.areHostObjects(y,["anchorNode","focusNode"]&&s.areHostProperties(y,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=E;var S=s.isHostMethod(y,"extend");e.features.selectionHasExtend=S;var x=typeof y.rangeCount=="number";e.features.selectionHasRangeCount=x;var T=!1,N=!0;s.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount=="number"&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");w.appendChild(e);var t=i.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=i.getIframeWindow(e).getSelection(),r=t.documentElement,s=r.lastChild,o=s.firstChild,u=t.createRange();u.setStart(o,1),u.collapse(!0),n.addRange(u),N=n.rangeCount==1,n.removeAllRanges();var a=u.cloneRange();u.setStart(o,0),a.setEnd(o,2),n.addRange(u),n.addRange(a),T=n.rangeCount==2,u.detach(),a.detach(),w.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=T,e.features.collapsedNonEditableSelectionsSupported=N;var C=!1,k;w&&s.isHostMethod(w,"createControlRange")&&(k=w.createControlRange(),s.areHostProperties(k,["item","add"])&&(C=!0)),e.features.implementsControlRange=C,E?c=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:c=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var F;s.isHostMethod(y,"getRangeAt")?F=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:E&&(F=function(t){var n=i.getDocument(t.anchorNode),r=e.createRange(n);return r.setStart(t.anchorNode,t.anchorOffset),r.setEnd(t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&(r.setStart(t.focusNode,t.focusOffset),r.setEnd(t.anchorNode,t.anchorOffset)),r}),e.getSelection=function(e){e=e||window;var t=e[r],n=l(e),i=m?d(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh(e)):(t=new I(n,i,e),e[r]=t),t},e.getIframeSelection=function(t){return e.getSelection(i.getIframeWindow(t))};var q=I.prototype;if(!g&&E&&s.areHostMethods(y,["removeAllRanges","addRange"])){q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),O(this)};var U=function(t,n){var r=o.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(M(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};x?q.addRange=function(t,n){if(C&&m&&this.docSelection.type==h)j(this,t);else if(n&&S)U(this,t);else{var r;T?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(M(t)),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=F(this.nativeSelection,this.rangeCount-1);i&&!o.rangesEqual(i,t)&&(t=new u(i))}this._ranges[this.rangeCount-1]=t,L(this,t,X(this.nativeSelection)),this.isCollapsed=c(this)}else this.refresh()}}:q.addRange=function(e,t){t&&S?U(this,e):(this.nativeSelection.addRange(M(e)),this.refresh())},q.setRanges=function(e){if(C&&e.length>1)R(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(s.isHostMethod(y,"empty")&&s.isHostMethod(b,"select")&&C&&g))return t.fail("No means of selecting a Range or TextRange was found"),!1;q.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=i.getDocument(this.anchorNode);else if(this.docSelection.type==h){var t=this.docSelection.createRange();t.length&&(e=i.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}O(this)},q.addRange=function(e){this.docSelection.type==h?j(this,e):(u.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,e,!1))},q.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?R(this,e):t&&this.addRange(e[0])}}q.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new a("INDEX_SIZE_ERR");return this._ranges[e]};var z;if(g)z=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=i.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==h?B(t):P(n)?H(t,n):O(t)};else if(s.isHostMethod(y,"getRangeAt")&&typeof y.rangeCount=="number")z=function(t){if(C&&m&&t.docSelection.type==h)B(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));L(t,t._ranges[t.rangeCount-1],X(t.nativeSelection)),t.isCollapsed=c(t)}else O(t)}};else{if(!E||typeof y.isCollapsed!=n||typeof b.collapsed!=n||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;z=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=F(n,0),e._ranges=[t],e.rangeCount=1,A(e),e.isCollapsed=c(e)):O(e)}}q.refresh=function(e){var t=e?this._ranges.slice(0):null;z(this);if(e){var n=t.length;if(n!=this._ranges.length)return!1;while(n--)if(!o.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var W=function(e,t){var n=e.getAllRanges(),r=!1;e.removeAllRanges();for(var i=0,s=n.length;i<s;++i)r||t!==n[i]?e.addRange(n[i]):r=!0;e.rangeCount||O(e)};C?q.removeRange=function(e){if(this.docSelection.type==h){var t=this.docSelection.createRange(),n=D(e),r=i.getDocument(t.item(0)),s=i.getBody(r).createControlRange(),o,u=!1;for(var a=0,f=t.length;a<f;++a)o=t.item(a),o!==n||u?s.add(t.item(a)):u=!0;s.select(),B(this)}else W(this,e)}:q.removeRange=function(e){W(this,e)};var X;!g&&E&&e.features.implementsDomRange?(X=function(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t},q.isBackwards=function(){return X(this)}):X=q.isBackwards=function(){return!1},q.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},q.collapse=function(t,n){V(this,t);var r=e.createRange(i.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},q.collapseToStart=function(){if(!this.rangeCount)throw new a("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},q.collapseToEnd=function(){if(!this.rangeCount)throw new a("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},q.selectAllChildren=function(t){V(this,t);var n=e.createRange(i.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},q.deleteFromDocument=function(){if(C&&m&&this.docSelection.type==h){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}},q.getAllRanges=function(){return this._ranges.slice(0)},q.setSingleRange=function(e){this.setRanges([e])},q.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},q.toHtml=function(){var e="";if(this.rangeCount){var t=o.getRangeDocument(this._ranges[0]).createElement("div");for(var n=0,r=this._ranges.length;n<r;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},q.getName=function(){return"WrappedSelection"},q.inspect=function(){return $(this)},q.detach=function(){this.win[r]=null,this.win=this.anchorNode=this.focusNode=null},I.inspect=$,e.Selection=I,e.selectionPrototype=q,e.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var r=new this;n.call(r,e),r.base=function(){},delete Base._prototyping;var i=r.constructor,s=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,i.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||n).call(arguments[0],r)};return s.ancestor=this,s.extend=this.extend,s.forEach=this.forEach,s.implement=this.implement,s.prototype=r,s.toString=this.toString,s.valueOf=function(e){return e=="object"?s:i.valueOf()},n.call(s,t),typeof s.init=="function"&&s.init(),s},Base.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&typeof t=="function"&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var r=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=r.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return e=="object"?t:r},t.toString=Base.toString}this[e]=t}else if(e){var i=Base.prototype.extend;!Base._prototyping&&typeof this!="function"&&(i=this.extend||i);var s={toSource:null},o=["constructor","toString","valueOf"],u=Base._prototyping?0:1;while(a=o[u++])e[a]!=s[a]&&i.call(this,a,e[a]);for(var a in e)s[a]||i.call(this,a,e[a])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)this.prototype[r]===undefined&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)typeof arguments[e]=="function"?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function u(e){return(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[,0])[1]}var e=navigator.userAgent,t=document.createElement("div"),n=e.indexOf("MSIE")!==-1&&e.indexOf("Opera")===-1,r=e.indexOf("Gecko")!==-1&&e.indexOf("KHTML")===-1,i=e.indexOf("AppleWebKit/")!==-1,s=e.indexOf("Chrome/")!==-1,o=e.indexOf("Opera/")!==-1;return{USER_AGENT:e,supported:function(){var e=this.USER_AGENT.toLowerCase(),n="contentEditable"in t,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,i=document.querySelector&&document.querySelectorAll,s=this.isIos()&&u(e)<5||e.indexOf("opera mobi")!==-1||e.indexOf("hpwos/")!==-1;return n&&r&&i&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var e=this.USER_AGENT.toLowerCase();return e.indexOf("webkit")!==-1&&e.indexOf("mobile")!==-1},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!r},hasCurrentStyleProperty:function(){return"currentStyle"in t},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in t||function(){return t.setAttribute("on"+e,"return;"),typeof t["on"+e]=="function"}()},supportsEventsInIframeCorrectly:function(){return!o},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return i||r},supportsDataTransfer:function(){try{return i&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(e){return!1}},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:n,insertUnorderedList:n||o||i,insertOrderedList:n||o||i},t={insertHTML:r};return function(n,r){var i=e[r];if(!i){try{return n.queryCommandSupported(r)}catch(s){}try{return n.queryCommandEnabled(r)}catch(o){return!!t[r]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||o||i},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return e.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return r||n||o},clearsListsInContentEditableCorrectly:function(){return r||n||i},autoScrollsToCaret:function(){return!i},autoClosesUnclosedTags:function(){var e=t.cloneNode(!1),n,r;return e.innerHTML="<p><div></div>",r=e.innerHTML.toLowerCase(),n=r==="<p></p><div></div>"||r==="<p><div></div></p>",this.autoClosesUnclosedTags=function(){return n},n},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in t},needsSpaceAfterLineBreak:function(){return o},supportsSpeechApiOn:function(t){var n=e.match(/Chrome\/(\d+)/)||[,0];return n[1]>=11&&("onwebkitspeechchange"in t||"speech"in t)},crashesWhenDefineProperty:function(e){return n&&(e==="XMLHttpRequest"||e==="XDomainRequest")},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return r||s||o}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(e.indexOf)return e.indexOf(t)!==-1;for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1},without:function(t){t=wysihtml5.lang.array(t);var n=[],r=0,i=e.length;for(;r<i;r++)t.contains(e[r])||n.push(e[r]);return n},get:function(){var t=0,n=e.length,r=[];for(;t<n;t++)r.push(e[t]);return r}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(e,t){this.events=this.events||{};var n=this.events[e]||[],r=0;for(;r<n.length;r++)n[r].call(this,t);return this},stopObserving:function(e,t){this.events=this.events||{};var n=0,r,i;if(e){r=this.events[e]||[],i=[];for(;n<r.length;n++)r[n]!==t&&t&&i.push(r[n]);this.events[e]=i}else this.events={};return this}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(){var t={},n;for(n in e)t[n]=e[n];return t},isArray:function(){return Object.prototype.toString.call(e)==="[object Array]"}}},function(){var e=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(n){return n=String(n),{trim:function(){return n.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)n=this.replace("#{"+t+"}").by(e[t]);return n},replace:function(e){return{by:function(t){return n.split(e).join(t)}}}}}}(),function(e){function o(e){return l(e)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),c(e))}function u(e){return e.replace(n,function(e,t){var n=(t.match(r)||[])[1]||"",o=s[n];t=t.replace(r,""),t.split(o).length>t.split(n).length&&(t+=n,n="");var u=t,a=t;return t.length>i&&(a=a.substr(0,i)+"..."),u.substr(0,4)==="www."&&(u="http://"+u),'<a href="'+u+'">'+a+"</a>"+n})}function a(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function f(e){var t=e.parentNode,n=a(t.ownerDocument);n.innerHTML="<span></span>"+u(e.data),n.removeChild(n.firstChild);while(n.firstChild)t.insertBefore(n.firstChild,e);t.removeChild(e)}function l(e){var n;while(e.parentNode){e=e.parentNode,n=e.nodeName;if(t.contains(n))return!0;if(n==="body")return!1}return!1}function c(r){if(t.contains(r.nodeName))return;if(r.nodeType===e.TEXT_NODE&&r.data.match(n)){f(r);return}var i=e.lang.array(r.childNodes).get(),s=i.length,o=0;for(;o<s;o++)c(i[o]);return r}var t=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),n=/((https?:\/\/|www\.)[^\s<]{3,})/gi,r=/([^\w\/\-](,?))$/i,i=100,s={")":"(","]":"[","}":"{"};e.dom.autoLink=o,e.dom.autoLink.URL_REG_EXP=n}(wysihtml5),function(e){var t=e.browser.supportsClassList(),n=e.dom;n.addClass=function(e,r){if(t)return e.classList.add(r);if(n.hasClass(e,r))return;e.className+=" "+r},n.removeClass=function(e,n){if(t)return e.classList.remove(n);e.className=e.className.replace(new RegExp("(^|\\s+)"+n+"(\\s+|$)")," ")},n.hasClass=function(e,n){if(t)return e.classList.contains(n);var r=e.className;return r.length>0&&(r==n||(new RegExp("(^|\\s)"+n+"(\\s|$)")).test(r))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;if(e.contains)return function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)};if(e.compareDocumentPosition)return function(e,t){return!!(e.compareDocumentPosition(t)&16)}}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}function t(e,t){return e.createElement(t)}function n(n,r){if(n.nodeName==="UL"||n.nodeName==="OL"||n.nodeName==="MENU")return n;var i=n.ownerDocument,s=t(i,r),o=n.querySelectorAll("br"),u=o.length,a,f,l,c,h,p,d,v,m;for(m=0;m<u;m++){c=o[m];while((h=c.parentNode)&&h!==n&&h.lastChild===c){if(wysihtml5.dom.getStyle("display").from(h)==="block"){h.removeChild(c);break}wysihtml5.dom.insert(c).after(c.parentNode)}}a=wysihtml5.lang.array(n.childNodes).get(),f=a.length;for(m=0;m<f;m++){v=v||e(i,s),l=a[m],p=wysihtml5.dom.getStyle("display").from(l)==="block",d=l.nodeName==="BR";if(p){v=v.firstChild?e(i,s):v,v.appendChild(l),v=null;continue}if(d){v=v.firstChild?null:v;continue}v.appendChild(l)}return n.parentNode.replaceChild(s,n),s}return n}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){var r,i=0,s=e.length;for(;i<s;i++)r=e[i],typeof t[r]!="undefined"&&t[r]!==""&&(n[r]=t[r]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(t){return r(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},r=function(n){var r=0,i=t.length;for(;r<i;r++)if(e.getStyle(t[r]).from(n)==="border-box")return t[r]};e.copyStyles=function(r){return{from:function(i){n(i)&&(r=wysihtml5.lang.array(r).without(t));var s="",o=r.length,u=0,a;for(;u<o;u++)a=r[u],s+=a+":"+e.getStyle(a).from(i)+";";return{to:function(t){return e.setStyles(s).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,r,i){return e.dom.observe(t,r,function(r){var s=r.target,o=e.lang.array(t.querySelectorAll(n));while(s&&s!==t){if(o.contains(s)){i.call(s,r);break}s=s.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(r){}return t.body.removeChild(n),n},t=function(e){if(e._wysihtml5_supportsHTML5Tags)return;for(var t=0,r=n.length;t<r;t++)e.createElement(n[t]);e._wysihtml5_supportsHTML5Tags=!0},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,r){r=r||document;var i;return typeof n=="object"&&n.nodeType?(i=r.createElement("div"),i.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(r)?(i=r.createElement("div"),i.innerHTML=n):(t(r),i=e(n,r)),i}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return!t||!t.length?!0:typeof t=="string"?e===t:wysihtml5.lang.array(t).contains(e)}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function n(e,t,n){var r=(e.className||"").match(n)||[];return t?r[r.length-1]===t:!!r.length}function r(t,n,r){while(r--&&t&&t.nodeName!=="BODY"){if(e(t.nodeName,n))return t;t=t.parentNode}return null}function i(r,i,s,o,u){while(u--&&r&&r.nodeName!=="BODY"){if(t(r)&&e(r.nodeName,i)&&n(r,s,o))return r;r=r.parentNode}return null}return function(e,t,n){return n=n||50,t.className||t.classRegExp?i(e,t.nodeName,t.className,t.classRegExp,n):r(e,t.nodeName,n)}}(),wysihtml5.dom.getStyle=function(){function n(e){return e.replace(t,function(e){return e.charAt(1).toUpperCase()})}var e={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},t=/\-[a-z]/g;return function(t){return{from:function(r){if(r.nodeType!==wysihtml5.ELEMENT_NODE)return;var i=r.ownerDocument,s=e[t]||n(t),o=r.style,u=r.currentStyle,a=o[s];if(a)return a;if(u)try{return u[s]}catch(f){}var l=i.defaultView||i.parentWindow,c=(t==="height"||t==="width")&&r.nodeName==="TEXTAREA",h,p;if(l.getComputedStyle)return c&&(h=o.overflow,o.overflow="hidden"),p=l.getComputedStyle(r,null).getPropertyValue(t),c&&(o.overflow=h||""),p}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function n(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=t++)}var e={},t=1;return function(t,r){var i=n(t)+":"+r,s=e[i];return s||(s=e[i]=t.getElementsByTagName(r)),s.length>0}}(),function(e){function r(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;e.dom.hasElementWithClassName=function(n,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!n.querySelector("."+i);var s=r(n)+":"+i,o=t[s];return o||(o=t[s]=n.getElementsByClassName(i)),o.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.head||t.getElementsByTagName("head")[0],r=t.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(t.createTextNode(e)),n&&n.appendChild(r)}}},wysihtml5.dom.observe=function(e,t,n){t=typeof t=="string"?[t]:t;var r,i,s=0,o=t.length;for(;s<o;s++)i=t[s],e.addEventListener?e.addEventListener(i,n,!1):(r=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,r));return{stop:function(){var i,s=0,o=t.length;for(;s<o;s++)i=t[s],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,r)}}},wysihtml5.dom.parse=function(){function s(e,t,n,s){wysihtml5.lang.object(i).merge(r).merge(t).get(),n=n||e.ownerDocument||document;var u=n.createDocumentFragment(),a=typeof e=="string",f,l,c;a?f=wysihtml5.dom.getAsDom(e,n):f=e;while(f.firstChild)c=f.firstChild,f.removeChild(c),l=o(c,s),l&&u.appendChild(l);return f.innerHTML="",f.appendChild(u),a?wysihtml5.quirks.getCorrectInnerHTML(f):f}function o(n,r){var i=n.nodeType,s=n.childNodes,u=s.length,a,f=e[i],l=0;a=f&&f(n);if(!a)return null;for(l=0;l<u;l++)newChild=o(s[l],r),newChild&&a.appendChild(newChild);return r&&a.childNodes.length<=1&&a.nodeName.toLowerCase()===t&&!a.attributes.length?a.firstChild:a}function u(e){var n,r,s,o=i.tags,u=e.nodeName.toLowerCase(),f=e.scopeName;if(e._wysihtml5)return null;e._wysihtml5=1;if(e.className==="wysihtml5-temp")return null;f&&f!="HTML"&&(u=f+":"+u),"outerHTML"in e&&!wysihtml5.browser.autoClosesUnclosedTags()&&e.nodeName==="P"&&e.outerHTML.slice(-4).toLowerCase()!=="</p>"&&(u="div");if(u in o){n=o[u];if(!n||n.remove)return null;n=typeof n=="string"?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:t}}return r=e.ownerDocument.createElement(n.rename_tag||u),a(e,r,n),e=null,r}function a(e,t,r){var s={},o=r.set_class,u=r.add_class,a=r.set_attributes,f=r.check_attributes,c=i.classes,h=0,v=[],m=[],g=[],y=[],b,w,E,S,x,T,N;a&&(s=wysihtml5.lang.object(a).clone());if(f)for(x in f){N=p[f[x]];if(!N)continue;T=N(l(e,x)),typeof T=="string"&&(s[x]=T)}o&&v.push(o);if(u)for(x in u){N=d[u[x]];if(!N)continue;S=N(l(e,x)),typeof S=="string"&&v.push(S)}c["_wysihtml5-temp-placeholder"]=1,y=e.getAttribute("class"),y&&(v=v.concat(y.split(n))),b=v.length;for(;h<b;h++)E=v[h],c[E]&&m.push(E);w=m.length;while(w--)E=m[w],wysihtml5.lang.array(g).contains(E)||g.unshift(E);g.length&&(s["class"]=g.join(" "));for(x in s)try{t.setAttribute(x,s[x])}catch(C){}s.src&&(typeof s.width!="undefined"&&t.setAttribute("width",s.width),typeof s.height!="undefined"&&t.setAttribute("height",s.height))}function l(e,t){t=t.toLowerCase();var n=e.nodeName;if(n=="IMG"&&t=="src"&&c(e)===!0)return e.src;if(f&&"outerHTML"in e){var r=e.outerHTML.toLowerCase(),i=r.indexOf(" "+t+"=")!=-1;return i?e.getAttribute(t):null}return e.getAttribute(t)}function c(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&e.readyState==="complete")return!0}}function h(e){return e.ownerDocument.createTextNode(e.data)}var e={1:u,3:h},t="span",n=/\s+/,r={tags:{},classes:{}},i={},f=!wysihtml5.browser.supportsGetAttributeCorrectly(),p={url:function(){var e=/^https?:\/\//i;return function(t){return!t||!t.match(e)?null:t.replace(e,function(e){return e.toLowerCase()})}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),href:function(){var e=/^(\/|https?:\/\/|mailto:)/i;return function(t){return!t||!t.match(e)?null:t.replace(e,function(e){return e.toLowerCase()})}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}()},d={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()};return s}(),wysihtml5.dom.removeEmptyTextNodes=function(e){var t,n=wysihtml5.lang.array(e.childNodes).get(),r=n.length,i=0;for(;i<r;i++)t=n[i],t.nodeType===wysihtml5.TEXT_NODE&&t.data===""&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){var n=e.ownerDocument.createElement(t),r;while(r=e.firstChild)n.appendChild(r);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(n),e.parentNode.replaceChild(n,e),n},wysihtml5.dom.replaceWithChildNodes=function(e){if(!e.parentNode)return;if(!e.firstChild){e.parentNode.removeChild(e);return}var t=e.ownerDocument.createDocumentFragment();while(e.firstChild)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null},function(e){function t(t){return e.getStyle("display").from(t)==="block"}function n(e){return e.nodeName==="BR"}function r(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function i(e){if(e.nodeName!=="MENU"&&e.nodeName!=="UL"&&e.nodeName!=="OL")return;var i=e.ownerDocument,s=i.createDocumentFragment(),o=e.previousElementSibling||e.previousSibling,u,a,f,l,c;o&&!t(o)&&r(s);while(c=e.firstChild){a=c.lastChild;while(u=c.firstChild)f=u===a,l=f&&!t(u)&&!n(u),s.appendChild(u),l&&r(s);c.parentNode.removeChild(c)}e.parentNode.replaceChild(s,e)}e.resolveList=i}(wysihtml5.dom),function(e){var t=document,n=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],r=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],i=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.iframe=this._createIframe()},insertInto:function(e){typeof e=="string"&&(e=t.getElementById(e)),e.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,r=t.createElement("iframe");return r.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(r),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(r.src="javascript:'<html></html>'"),r.onload=function(){r.onreadystatechange=r.onload=null,n._onLoadIframe(r)},r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=r.onload=null,n._onLoadIframe(r))},r},_onLoadIframe:function(s){if(!e.dom.contains(t.documentElement,s))return;var o=this,u=s.contentWindow,a=s.contentWindow.document,f=t.characterSet||t.charset||"utf-8",l=this._getHtml({charset:f,stylesheets:this.config.stylesheets});a.open("text/html","replace"),a.write(l),a.close(),this.getWindow=function(){return s.contentWindow},this.getDocument=function(){return s.contentWindow.document},u.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)};if(!e.browser.supportsSandboxedIframes()){var c,h;for(c=0,h=n.length;c<h;c++)this._unset(u,n[c]);for(c=0,h=r.length;c<h;c++)this._unset(u,r[c],e.EMPTY_FUNCTION);for(c=0,h=i.length;c<h;c++)this._unset(a,i[c]);this._unset(a,"cookie","",!0)}this.loaded=!0,setTimeout(function(){o.callback(o)},0)},_getHtml:function(t){var n=t.stylesheets,r="",i=0,s;n=typeof n=="string"?[n]:n;if(n){s=n.length;for(;i<s;i++)r+='<link rel="stylesheet" href="'+n[i]+'">'}return t.stylesheets=r,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,r,i){try{t[n]=r}catch(s){}try{t.__defineGetter__(n,function(){return r})}catch(s){}if(i)try{t.__defineSetter__(n,function(){})}catch(s){}if(!e.browser.crashesWhenDefineProperty(n))try{var o={get:function(){return r}};i&&(o.set=function(){}),Object.defineProperty(t,n,o)}catch(s){}}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var r in t)n.setAttribute(e[r]||r,t[r])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var n=t.style;if(typeof e=="string"){n.cssText+=";"+e;return}for(var r in e)r==="float"?(n.cssFloat=e[r],n.styleFloat=e[r]):n[r]=e[r]}}},function(e){e.simulatePlaceholder=function(t,n,r){var i="placeholder",s=function(){n.hasPlaceholderSet()&&n.clear(),e.removeClass(n.element,i)},o=function(){n.isEmpty()&&(n.setValue(r),e.addClass(n.element,i))};t.observe("set_placeholder",o).observe("unset_placeholder",s).observe("focus:composer",s).observe("paste:composer",s).observe("blur:composer",o),o()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function t(t,n,r){n=n||e,r=r||t.ownerDocument||document;var i,s=typeof t=="string",o,u,a,f,l=0;s?i=wysihtml5.dom.getAsDom(t,r):i=t;for(f in n){u=i.querySelectorAll(f),o=n[f],a=u.length;for(;l<a;l++)o(u[l])}return u=t=n=null,s?i.innerHTML:i}var e={"a u":wysihtml5.dom.replaceWithChildNodes};return t}(),function(e){var t=e.dom;e.quirks.ensureProperClearing=function(){var e=function(e){var t=this;setTimeout(function(){var e=t.innerHTML.toLowerCase();if(e=="<p>&nbsp;</p>"||e=="<p>&nbsp;</p><p>&nbsp;</p>")t.innerHTML=""},0)};return function(n){t.observe(n.element,["cut","keydown"],e)}}(),e.quirks.ensureProperClearingOfLists=function(){var n=["OL","UL","MENU"],r=function(r,i){if(!i.firstChild||!e.lang.array(n).contains(i.firstChild.nodeName))return;var s=t.getParentElement(r,{nodeName:n});if(!s)return;var o=s==i.firstChild;if(!o)return;var u=s.childNodes.length<=1;if(!u)return;var a=s.firstChild?s.firstChild.innerHTML==="":!0;if(!a)return;s.parentNode.removeChild(s)};return function(n){t.observe(n.element,"keydown",function(t){if(t.keyCode!==e.BACKSPACE_KEY)return;var i=n.selection.getSelectedNode();r(i,n.element)})}}()}(wysihtml5),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var r=n.innerHTML;if(r.indexOf(t)===-1)return r;var i=n.querySelectorAll("[href*='~'], [src*='~']"),s,o,u,a;for(a=0,u=i.length;a<u;a++)s=i[a].href||i[a].src,o=e.lang.string(s).replace("~").by(t),r=e.lang.string(r).replace(o).by(s);return r}}(wysihtml5),function(e){var t=e.dom,n=["LI","P","H1","H2","H3","H4","H5","H6"],r=["UL","OL","MENU"];e.quirks.insertLineBreakOnReturn=function(i){function s(n){var r=t.getParentElement(n,{nodeName:["P","DIV"]},2);if(!r)return;var s=document.createTextNode(e.INVISIBLE_SPACE);t.insert(s).before(r),t.replaceWithChildNodes(r),i.selection.selectNode(s)}function o(o){var u=o.keyCode;if(o.shiftKey||u!==e.ENTER_KEY&&u!==e.BACKSPACE_KEY)return;var a=o.target,f=i.selection.getSelectedNode(),l=t.getParentElement(f,{nodeName:n},4);if(l){l.nodeName!=="LI"||u!==e.ENTER_KEY&&u!==e.BACKSPACE_KEY?l.nodeName.match(/H[1-6]/)&&u===e.ENTER_KEY&&setTimeout(function(){s(i.selection.getSelectedNode())},0):setTimeout(function(){var e=i.selection.getSelectedNode(),n,o;if(!e)return;n=t.getParentElement(e,{nodeName:r},2);if(n)return;s(e)},0);return}u===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(i.commands.exec("insertLineBreak"),o.preventDefault())}t.observe(i.element.ownerDocument,"keydown",o)}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var r=n.ownerDocument;r.execCommand("italic",!1,null),r.execCommand("italic",!1,null)}catch(i){}}}(wysihtml5),function(e){function n(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}var t=e.dom;e.Selection=Base.extend({constructor:function(e){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){if(!e)return;this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(n){var r=rangy.createRange(this.doc),i=n.nodeType===e.ELEMENT_NODE,s="canHaveHTML"in n?n.canHaveHTML:n.nodeName!=="IMG",o=i?n.innerHTML:n.data,u=o===""||o===e.INVISIBLE_SPACE,a=t.getStyle("display").from(n),f=a==="block"||a==="list-item";if(u&&i&&s)try{n.innerHTML=e.INVISIBLE_SPACE}catch(l){}s?r.selectNodeContents(n):r.selectNode(n),s&&u&&i?r.collapse(f):s&&u&&(r.setStartAfter(n),r.setEndAfter(n)),this.setSelection(r)},getSelectedNode:function(e){var t,n;if(e&&this.doc.selection&&this.doc.selection.type==="Control"){n=this.doc.selection.createRange();if(n&&n.length)return n.item(0)}return t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body)},executeAndRestore:function(t,n){var r=this.doc.body,i=n&&r.scrollTop,s=n&&r.scrollLeft,o="_wysihtml5-temp-placeholder",u='<span class="'+o+'">'+e.INVISIBLE_SPACE+"</span>",a=this.getRange(this.doc),f;if(!a){t(r,r);return}var l=a.createContextualFragment(u);a.insertNode(l);try{t(a.startContainer,a.endContainer)}catch(c){setTimeout(function(){throw c},0)}caretPlaceholder=this.doc.querySelector("."+o),caretPlaceholder?(f=rangy.createRange(this.doc),f.selectNode(caretPlaceholder),f.deleteContents(),this.setSelection(f)):r.focus(),n&&(r.scrollTop=i,r.scrollLeft=s);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(h){}},executeAndRestoreSimple:function(e){var t=this.getRange(),n=this.doc.body,r,i,s,o,u;if(!t){e(n,n);return}o=t.getNodes([3]),i=o[0]||t.startContainer,s=o[o.length-1]||t.endContainer,u={collapsed:t.collapsed,startContainer:i,startOffset:i===t.startContainer?t.startOffset:0,endContainer:s,endOffset:s===t.endContainer?t.endOffset:s.length};try{e(t.startContainer,t.endContainer)}catch(a){setTimeout(function(){throw a},0)}r=rangy.createRange(this.doc);try{r.setStart(u.startContainer,u.startOffset)}catch(f){}try{r.setEnd(u.endContainer,u.endOffset)}catch(l){}try{this.setSelection(r)}catch(c){}},insertHTML:function(e){var t=rangy.createRange(this.doc),n=t.createContextualFragment(e),r=n.lastChild;this.insertNode(n),r&&this.setAfter(r)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t=this.getRange();if(!t)return;try{t.surroundContents(e),this.selectNode(e)}catch(n){e.appendChild(t.extractContents()),t.insertNode(e)}},scrollIntoView:function(){var t=this.doc,r=t.documentElement.scrollHeight>t.documentElement.offsetHeight,i=t._wysihtml5ScrollIntoViewElement=t._wysihtml5ScrollIntoViewElement||function(){var n=t.createElement("span");return n.innerHTML=e.INVISIBLE_SPACE,n}(),s;r&&(this.insertNode(i),s=n(i),i.parentNode.removeChild(i),s>t.body.scrollTop&&(t.body.scrollTop=s))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("extend","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e=this.doc.selection.createRange(),t=e.boundingTop,n=e.boundingHeight,r=this.doc.body.scrollWidth,i,s,o,u,a;if(!e.moveToPoint)return;t===0&&(o=this.doc.createElement("span"),this.insertNode(o),t=o.offsetTop,o.parentNode.removeChild(o)),t+=1;for(u=-10;u<r;u+=2)try{e.moveToPoint(u,t);break}catch(f){}i=t,s=this.doc.selection.createRange();for(a=r;a>=0;a--)try{s.moveToPoint(a,i);break}catch(l){}e.setEndPoint("EndToEnd",s),e.select()},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},getRange:function(){var e=this.getSelection();return e&&e.rangeCount&&e.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.getSelection(t);return n.setSingleRange(e)}})}(wysihtml5),function(e,t){function i(e,t,n){if(!e.className)return!1;var r=e.className.match(n)||[];return r[r.length-1]===t}function s(e,t,n){e.className?(o(e,n),e.className+=" "+t):e.className=t}function o(e,t){e.className&&(e.className=e.className.replace(t,""))}function u(e,t){return e.className.replace(r," ")==t.className.replace(r," ")}function a(e){var t=e.parentNode;while(e.firstChild)t.insertBefore(e.firstChild,e);t.removeChild(e)}function f(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n=0,r=e.attributes.length,i,s,o;n<r;++n){i=e.attributes[n],o=i.name;if(o!="class"){s=t.attributes.getNamedItem(o);if(i.specified!=s.specified)return!1;if(i.specified&&i.nodeValue!==s.nodeValue)return!1}}return!0}function l(e,n){return t.dom.isCharacterDataNode(e)?n==0?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function c(e,n,r){var i;t.dom.isCharacterDataNode(n)&&(r==0?(r=t.dom.getNodeIndex(n),n=n.parentNode):r==n.length?(r=t.dom.getNodeIndex(n)+1,n=n.parentNode):i=t.dom.splitDataNode(n,r));if(!i){i=n.cloneNode(!1),i.id&&i.removeAttribute("id");var s;while(s=n.childNodes[r])i.appendChild(s);t.dom.insertAfter(i,n)}return n==e?i:c(e,i.parentNode,t.dom.getNodeIndex(i))}function h(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function p(e,t,r,i){this.tagNames=e||[n],this.cssClass=t||"",this.similarClassRegExp=r,this.normalize=i,this.applyToAnyTagName=!1}var n="span",r=/\s+/g;h.prototype={doMerge:function(){var e=[],t,n,r;for(var i=0,s=this.textNodes.length;i<s;++i)t=this.textNodes[i],n=t.parentNode,e[i]=t.data,i&&(n.removeChild(t),n.hasChildNodes()||n.parentNode.removeChild(n));return this.firstTextNode.data=r=e.join(""),r},getLength:function(){var e=this.textNodes.length,t=0;while(e--)t+=this.textNodes[e].length;return t},toString:function(){var e=[];for(var t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},p.prototype={getAncestorWithClass:function(n){var r;while(n){r=this.cssClass?i(n,this.cssClass,this.similarClassRegExp):!0;if(n.nodeType==e.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},postApply:function(e,t){var n=e[0],r=e[e.length-1],i=[],s,o=n,u=r,a=0,f=r.length,l,c;for(var p=0,d=e.length;p<d;++p)l=e[p],c=this.getAdjacentMergeableTextNode(l.parentNode,!1),c?(s||(s=new h(c),i.push(s)),s.textNodes.push(l),l===n&&(o=s.firstTextNode,a=o.length),l===r&&(u=s.firstTextNode,f=s.getLength())):s=null;var v=this.getAdjacentMergeableTextNode(r.parentNode,!0);v&&(s||(s=new h(r),i.push(s)),s.textNodes.push(v));if(i.length){for(p=0,d=i.length;p<d;++p)i[p].doMerge();t.setStart(o,a),t.setEnd(u,f)}},getAdjacentMergeableTextNode:function(t,n){var r=t.nodeType==e.TEXT_NODE,i=r?t.parentNode:t,s,o=n?"nextSibling":"previousSibling";if(r){s=t[o];if(s&&s.nodeType==e.TEXT_NODE)return s}else{s=i[o];if(s&&this.areElementsMergeable(t,s))return s[n?"firstChild":"lastChild"]}return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&u(e,n)&&f(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),t},applyToTextNode:function(e){var n=e.parentNode;if(n.childNodes.length==1&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase()))this.cssClass&&s(n,this.cssClass,this.similarClassRegExp);else{var r=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(r,e),r.appendChild(e)}},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&e.lang.string(n.className).trim()==this.cssClass},undoToTextNode:function(e,t,n){if(!t.containsNode(n)){var r=t.cloneRange();r.selectNode(n),r.isPointInRange(t.endContainer,t.endOffset)&&l(t.endContainer,t.endOffset)&&(c(n,t.endContainer,t.endOffset),t.setEndAfter(n)),r.isPointInRange(t.startContainer,t.startOffset)&&l(t.startContainer,t.startOffset)&&(n=c(n,t.startContainer,t.startOffset))}this.similarClassRegExp&&o(n,this.similarClassRegExp),this.isRemovable(n)&&a(n)},applyToRange:function(t){var n=t.getNodes([e.TEXT_NODE]);if(!n.length)try{var r=this.createContainer(t.endContainer.ownerDocument);t.surroundContents(r),this.selectNode(t,r);return}catch(i){}t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE]);if(n.length){var s;for(var o=0,u=n.length;o<u;++o)s=n[o],this.getAncestorWithClass(s)||this.applyToTextNode(s);t.setStart(n[0],0),s=n[n.length-1],t.setEnd(s,s.length),this.normalize&&this.postApply(n,t)}},undoToRange:function(t){var n=t.getNodes([e.TEXT_NODE]),r,i;if(n.length)t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE]);else{var s=t.endContainer.ownerDocument,o=s.createTextNode(e.INVISIBLE_SPACE);t.insertNode(o),t.selectNode(o),n=[o]}for(var u=0,a=n.length;u<a;++u)r=n[u],i=this.getAncestorWithClass(r),i&&this.undoToTextNode(r,t,i);a==1?this.selectNode(t,n[0]):(t.setStart(n[0],0),r=n[n.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(n,t))},selectNode:function(t,n){var r=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,s=r?n.innerHTML:n.data,o=s===""||s===e.INVISIBLE_SPACE;if(o&&r&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(u){}t.selectNodeContents(n),o&&r?t.collapse(!1):o&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var r=n.intersection(t),i=r?r.toString():"";return n.detach(),i},isAppliedToRange:function(t){var n=[],r,i=t.getNodes([e.TEXT_NODE]);if(!i.length)return r=this.getAncestorWithClass(t.startContainer),r?[r]:!1;for(var s=0,o=i.length,u;s<o;++s){u=this.getTextSelectedByRange(i[s],t),r=this.getAncestorWithClass(i[s]);if(u!=""&&!r)return!1;n.push(r)}return n},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)}},e.selection.HTMLApplier=p}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],r=wysihtml5.lang.array(arguments).get(),i=n&&n.exec,s=null;this.editor.fire("beforecommand:composer");if(i)r.unshift(this.composer),s=i.apply(n,r);else try{s=this.doc.execCommand(e,!1,t)}catch(o){}return this.editor.fire("aftercommand:composer"),s},state:function(e,t){var n=wysihtml5.commands[e],r=wysihtml5.lang.array(arguments).get(),i=n&&n.state;if(i)return r.unshift(this.composer),i.apply(n,r);try{return this.doc.queryCommandState(e)}catch(s){return!1}},value:function(e){var t=wysihtml5.commands[e],n=t&&t.value;if(n)return n.call(t,this.composer,e);try{return this.doc.queryCommandValue(e)}catch(r){return null}}}),function(e){var t;e.commands.bold={exec:function(t,n){return e.commands.formatInline.exec(t,n,"b")},state:function(t,n,r){return e.commands.formatInline.state(t,n,"b")},value:function(){return t}}}(wysihtml5),function(e){function i(e,t){var n=t.length,i=0,s,o,u;for(;i<n;i++)s=t[i],o=r.getParentElement(s,{nodeName:"code"}),u=r.getTextContent(s),u.match(r.autoLink.URL_REG_EXP)&&!o?o=r.renameElement(s,"code"):r.replaceWithChildNodes(s)}function s(i,s){var o=i.doc,u="_wysihtml5-temp-"+ +(new Date),a=/non-matching-class/g,f=0,l,c,h,p,d,v,m,g,y;e.commands.formatInline.exec(i,t,n,u,a),c=o.querySelectorAll(n+"."+u),l=c.length;for(;f<l;f++){h=c[f],h.removeAttribute("class");for(y in s)h.setAttribute(y,s[y])}v=h,l===1&&(m=r.getTextContent(h),p=!!h.querySelector("*"),d=m===""||m===e.INVISIBLE_SPACE,!p&&d&&(r.setTextContent(h,s.text||h.href),g=o.createTextNode(" "),i.selection.setAfter(h),i.selection.insertNode(g),v=g)),i.selection.setAfter(v)}var t,n="A",r=e.dom;e.commands.createLink={exec:function(e,t,n){var r=this.state(e,t);r?e.selection.executeAndRestore(function(){i(e,r)}):(n=typeof n=="object"?n:{href:n},s(e,n))},state:function(t,n){return e.commands.formatInline.state(t,n,"A")},value:function(){return t}}}(wysihtml5),function(e){var t,n=/wysiwyg-font-size-[a-z\-]+/g;e.commands.fontSize={exec:function(t,r,i){return e.commands.formatInline.exec(t,r,"span","wysiwyg-font-size-"+i,n)},state:function(t,r,i){return e.commands.formatInline.state(t,r,"span","wysiwyg-font-size-"+i,n)},value:function(){return t}}}(wysihtml5),function(e){var t,n=/wysiwyg-color-[a-z]+/g;e.commands.foreColor={exec:function(t,r,i){return e.commands.formatInline.exec(t,r,"span","wysiwyg-color-"+i,n)},state:function(t,r,i){return e.commands.formatInline.state(t,r,"span","wysiwyg-color-"+i,n)},value:function(){return t}}}(wysihtml5),function(e){function s(e,t,n){e.className?(o(e,n),e.className+=" "+t):e.className=t}function o(e,t){e.className=e.className.replace(t,"")}function u(t){return t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim()}function a(e){var t=e.previousSibling;while(t&&u(t))t=t.previousSibling;return t}function f(e){var t=e.nextSibling;while(t&&u(t))t=t.nextSibling;return t}function l(e){var t=e.ownerDocument,n=f(e),r=a(e);n&&!d(n)&&e.parentNode.insertBefore(t.createElement("br"),n),r&&!d(r)&&e.parentNode.insertBefore(t.createElement("br"),e)}function c(e){var t=f(e),n=a(e);t&&p(t)&&t.parentNode.removeChild(t),n&&p(n)&&n.parentNode.removeChild(n)}function h(e){var t=e.lastChild;t&&p(t)&&t.parentNode.removeChild(t)}function p(e){return e.nodeName==="BR"}function d(e){return p(e)?!0:n.getStyle("display").from(e)==="block"?!0:!1}function v(t,r,i,s){if(s)var o=n.observe(t,"DOMNodeInserted",function(t){var r=t.target,i;if(r.nodeType!==e.ELEMENT_NODE)return;i=n.getStyle("display").from(r),i.substr(0,6)!=="inline"&&(r.className+=" "+s)});t.execCommand(r,!1,i),o&&o.stop()}function m(e,t){e.selection.selectLine(),e.selection.surround(t),c(t),h(t),e.selection.selectNode(t)}function g(t){return!!e.lang.string(t.className).trim()}var t,n=e.dom,r="DIV",i=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",r];e.commands.formatBlock={exec:function(t,u,a,f,c){var h=t.doc,p=this.state(t,u,a,f,c),d;a=typeof a=="string"?a.toUpperCase():a;if(p){t.selection.executeAndRestoreSimple(function(){c&&o(p,c);var e=g(p);!e&&p.nodeName===(a||r)?(l(p),n.replaceWithChildNodes(p)):e&&n.renameElement(p,r)});return}if(a===null||e.lang.array(i).contains(a)){d=t.selection.getSelectedNode(),p=n.getParentElement(d,{nodeName:i});if(p){t.selection.executeAndRestoreSimple(function(){a&&(p=n.renameElement(p,a)),f&&s(p,f,c)});return}}if(t.commands.support(u)){v(h,u,a||r,f);return}p=h.createElement(a||r),f&&(p.className=f),m(t,p)},state:function(e,t,r,i,s){r=typeof r=="string"?r.toUpperCase():r;var o=e.selection.getSelectedNode();return n.getParentElement(o,{nodeName:r,className:i,classRegExp:s})},value:function(){return t}}}(wysihtml5),function(e){function i(e){var t=n[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function s(t,n,s){var o=t+":"+n;return r[o]||(r[o]=new e.selection.HTMLApplier(i(t),n,s,!0)),r[o]}var t,n={strong:"b",em:"i",b:"strong",i:"em"},r={};e.commands.formatInline={exec:function(e,t,n,r,i){var o=e.selection.getRange();if(!o)return!1;s(n,r,i).toggleRange(o),e.selection.setSelection(o)},state:function(t,r,i,o,u){var a=t.doc,f=n[i]||i,l;return!e.dom.hasElementWithTagName(a,i)&&!e.dom.hasElementWithTagName(a,f)?!1:o&&!e.dom.hasElementWithClassName(a,o)?!1:(l=t.selection.getRange(),l?s(i,o,u).isAppliedToRange(l):!1)},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(e){var t="IMG";e.commands.insertImage={exec:function(n,r,i){i=typeof i=="object"?i:{src:i};var s=n.doc,o=this.state(n),u,a,f;if(o){n.selection.setBefore(o),f=o.parentNode,f.removeChild(o),e.dom.removeEmptyTextNodes(f),f.nodeName==="A"&&!f.firstChild&&(n.selection.setAfter(f),f.parentNode.removeChild(f)),e.quirks.redraw(n.element);return}o=s.createElement(t);for(a in i)o[a]=i[a];n.selection.insertNode(o),e.browser.hasProblemsSettingCaretAfterImg()?(u=s.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(u),n.selection.setAfter(u)):n.selection.setAfter(o)},state:function(n){var r=n.doc,i,s,o;return e.dom.hasElementWithTagName(r,t)?(i=n.selection.getSelectedNode(),i?i.nodeName===t?i:i.nodeType!==e.ELEMENT_NODE?!1:(s=n.selection.getText(),s=e.lang.string(s).trim(),s?!1:(o=n.selection.getNodes(e.ELEMENT_NODE,function(e){return e.nodeName==="IMG"}),o.length!==1?!1:o[0])):!1):!1},value:function(e){var t=this.state(e);return t&&t.src}}}(wysihtml5),function(e){var t,n="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(t,r){t.commands.support(r)?(t.doc.execCommand(r,!1,null),e.browser.autoScrollsToCaret()||t.selection.scrollIntoView()):t.commands.exec("insertHTML",n)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertOrderedList={exec:function(t,n){var r=t.doc,i=t.selection.getSelectedNode(),s=e.dom.getParentElement(i,{nodeName:"OL"}),o=e.dom.getParentElement(i,{nodeName:"UL"}),u="_wysihtml5-temp-"+(new Date).getTime(),a,f;if(t.commands.support(n)){r.execCommand(n,!1,null);return}s?t.selection.executeAndRestoreSimple(function(){e.dom.resolveList(s)}):o?t.selection.executeAndRestoreSimple(function(){e.dom.renameElement(o,"ol")}):(t.commands.exec("formatBlock","div",u),f=r.querySelector("."+u),a=f.innerHTML===""||f.innerHTML===e.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){s=e.dom.convertToList(f,"ol")}),a&&t.selection.selectNode(s.querySelector("li")))},state:function(t){var n=t.selection.getSelectedNode();return e.dom.getParentElement(n,{nodeName:"OL"})},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertUnorderedList={exec:function(t,n){var r=t.doc,i=t.selection.getSelectedNode(),s=e.dom.getParentElement(i,{nodeName:"UL"}),o=e.dom.getParentElement(i,{nodeName:"OL"}),u="_wysihtml5-temp-"+(new Date).getTime(),a,f;if(t.commands.support(n)){r.execCommand(n,!1,null);return}s?t.selection.executeAndRestoreSimple(function(){e.dom.resolveList(s)}):o?t.selection.executeAndRestoreSimple(function(){e.dom.renameElement(o,"ul")}):(t.commands.exec("formatBlock","div",u),f=r.querySelector("."+u),a=f.innerHTML===""||f.innerHTML===e.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){s=e.dom.convertToList(f,"ul")}),a&&t.selection.selectNode(s.querySelector("li")))},state:function(t){var n=t.selection.getSelectedNode();return e.dom.getParentElement(n,{nodeName:"UL"})},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.italic={exec:function(t,n){return e.commands.formatInline.exec(t,n,"i")},state:function(t,n,r){return e.commands.formatInline.state(t,n,"i")},value:function(){return t}}}(wysihtml5),function(e){var t,n="wysiwyg-text-align-center",r=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyCenter={exec:function(t,i){return e.commands.formatBlock.exec(t,"formatBlock",null,n,r)},state:function(t,i){return e.commands.formatBlock.state(t,"formatBlock",null,n,r)},value:function(){return t}}}(wysihtml5),function(e){var t,n="wysiwyg-text-align-left",r=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyLeft={exec:function(t,i){return e.commands.formatBlock.exec(t,"formatBlock",null,n,r)},state:function(t,i){return e.commands.formatBlock.state(t,"formatBlock",null,n,r)},value:function(){return t}}}(wysihtml5),function(e){var t,n="wysiwyg-text-align-right",r=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyRight={exec:function(t,i){return e.commands.formatBlock.exec(t,"formatBlock",null,n,r)},state:function(t,i){return e.commands.formatBlock.state(t,"formatBlock",null,n,r)},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.underline={exec:function(t,n){return e.commands.formatInline.exec(t,n,"u")},state:function(t,n){return e.commands.formatInline.state(t,n,"u")},value:function(){return t}}}(wysihtml5),function(e){function f(e){var t;while(t=e.querySelector("._wysihtml5-temp"))t.parentNode.removeChild(t)}var t=90,n=89,r=8,i=46,s=40,o='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",u='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",a=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.history=[this.composer.getValue()],this.position=1,this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var s=this,l=this.composer.sandbox.getDocument(),c;a.observe(this.element,"keydown",function(e){if(e.altKey||!e.ctrlKey&&!e.metaKey)return;var r=e.keyCode,i=r===t&&!e.shiftKey,o=r===t&&e.shiftKey||r===n;i?(s.undo(),e.preventDefault()):o&&(s.redo(),e.preventDefault())}),a.observe(this.element,"keydown",function(e){var t=e.keyCode;if(t===c)return;c=t,(t===r||t===i)&&s.transact()});if(e.browser.hasUndoInContextMenu()){var h,p,d=function(){f(l),clearInterval(h)};a.observe(this.element,"contextmenu",function(){d(),s.composer.selection.executeAndRestoreSimple(function(){s.element.lastChild&&s.composer.selection.setAfter(s.element.lastChild),l.execCommand("insertHTML",!1,o),l.execCommand("insertHTML",!1,u),l.execCommand("undo",!1,null)}),h=setInterval(function(){l.getElementById("_wysihtml5-redo")?(d(),s.redo()):l.getElementById("_wysihtml5-undo")||(d(),s.undo())},400),p||(p=!0,a.observe(document,"mousedown",d),a.observe(l,["mousedown","paste","cut","copy"],d))})}this.editor.observe("newword:composer",function(){s.transact()}).observe("beforecommand:composer",function(){s.transact()})},transact:function(){var e=this.history[this.position-1],t=this.composer.getValue();if(t==e)return;var n=this.history.length=this.position;n>s&&(this.history.shift(),this.position--),this.position++,this.history.push(t)},undo:function(){this.transact();if(this.position<=1)return;this.set(this.history[--this.position-1]),this.editor.fire("undo:composer")},redo:function(){if(this.position>=this.history.length)return;this.set(this.history[++this.position-1]),this.editor.fire("redo:composer")},set:function(e){this.composer.setValue(e),this.editor.focus(!0)}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.observe("beforeload",function(){e.parent.observe("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")===this.element)return;try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var n=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t&&(n=this.parent.parse(n)),n=e.lang.string(n).replace(e.INVISIBLE_SPACE).by(""),n},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.innerHTML=e},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),this._displayStyle==="none"&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&(n.nodeName==="BR"?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var e=this.element.innerHTML,t="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return e===""||e===this.CARET_HACK||this.hasPlaceholderSet()||this.getTextContent()===""&&!this.element.querySelector(t)},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var n=document.createElement("input");n.type="hidden",n.name="_wysihtml5_mode",n.value=1;var r=this.textarea.element;t.insert(this.iframe).after(r),t.insert(n).after(r)},_create:function(){var r=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),this.selection=new e.Selection(this.parent),this.commands=new e.Commands(this.parent),t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var i=this.config.name;i&&(t.addClass(this.element,i),t.addClass(this.iframe,i));var s=typeof this.config.placeholder=="string"?this.config.placeholder:this.textarea.element.getAttribute("placeholder");s&&t.simulatePlaceholder(this.parent,this,s),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){r.focus()},100),e.quirks.insertLineBreakOnReturn(this),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),n.clearsListsInContentEditableCorrectly()||e.quirks.ensureProperClearingOfLists(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,i=n.canDisableAutoLinking(),s=n.doesAutoLinkingInContentEditable();i&&this.commands.exec("autoUrlDetect",!1);if(!this.config.autoLink)return;(!s||s&&i)&&this.parent.observe("newword:composer",function(){r.selection.executeAndRestore(function(e,n){t.autoLink(n.parentNode)})});var o=this.sandbox.getDocument().getElementsByTagName("a"),u=t.autoLink.URL_REG_EXP,a=function(n){var r=e.lang.string(t.getTextContent(n)).trim();return r.substr(0,4)==="www."&&(r="http://"+r),r};t.observe(this.element,"keydown",function(e){if(!o.length)return;var n=r.selection.getSelectedNode(e.target.ownerDocument),i=t.getParentElement(n,{nodeName:"A"},4),s;if(!i)return;s=a(i),setTimeout(function(){var e=a(i);if(e===s)return;e.match(u)&&i.setAttribute("href",e)},0)})},_initObjectResizing:function(){var r=["width","height"],i=r.length,s=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?n.supportsEvent("resizeend")&&t.observe(s,"resizeend",function(t){var n=t.target||t.srcElement,o=n.style,u=0,a;for(;u<i;u++)a=r[u],o[a]&&(n.setAttribute(a,parseInt(o[a],10)),o[a]="");e.quirks.redraw(s)}):n.supportsEvent("resizestart")&&t.observe(s,"resizestart",function(e){e.preventDefault()})},_initUndoManager:function(){new e.UndoManager(this.parent)}})}(wysihtml5),function(e){var t=e.dom,n=document,r=window,i=n.createElement("div"),s=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],o=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],u=["width","height","top","left","right","bottom"],a=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],f=function(e){if(e.setActive)try{e.setActive()}catch(i){}else{var s=e.style,o=n.documentElement.scrollTop||n.body.scrollTop,u=n.documentElement.scrollLeft||n.body.scrollLeft,a={position:s.position,top:s.top,left:s.left,WebkitUserSelect:s.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(a).on(e),r.scrollTo&&r.scrollTo(u,o)}};e.views.Composer.prototype.style=function(){var l=this,c=n.querySelector(":focus"),h=this.textarea.element,p=h.hasAttribute("placeholder"),d=p&&h.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||i.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||i.cloneNode(!1),p&&h.removeAttribute("placeholder"),h===c&&h.blur(),t.copyStyles(o).from(h).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(s).from(h).to(this.element).andTo(this.blurStylesHost),t.insertCSS(a).into(this.element.ownerDocument),f(h),t.copyStyles(o).from(h).to(this.focusStylesHost),t.copyStyles(s).from(h).to(this.focusStylesHost);var v=e.lang.array(o).without(["display"]);c?c.focus():h.blur(),p&&h.setAttribute("placeholder",d);if(!e.browser.hasCurrentStyleProperty())var m=t.observe(r,"resize",function(){if(!t.contains(document.documentElement,l.iframe)){m.stop();return}var e=t.getStyle("display").from(h),n=t.getStyle("display").from(l.iframe);h.style.display="",l.iframe.style.display="none",t.copyStyles(u).from(h).to(l.iframe).andTo(l.focusStylesHost).andTo(l.blurStylesHost),l.iframe.style.display=n,h.style.display=e});return this.parent.observe("focus:composer",function(){t.copyStyles(v).from(l.focusStylesHost).to(l.iframe),t.copyStyles(s).from(l.focusStylesHost).to(l.element)}),this.parent.observe("blur:composer",function(){t.copyStyles(v).from(l.blurStylesHost).to(l.iframe),t.copyStyles(s).from(l.blurStylesHost).to(l.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,r={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var i=this,s=this.getValue(),o=this.sandbox.getIframe(),u=this.element,a=n.supportsEventsInIframeCorrectly()?u:this.sandbox.getWindow(),f=n.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];t.observe(o,"DOMNodeRemoved",function(){clearInterval(l),i.parent.fire("destroy:composer")});var l=setInterval(function(){t.contains(document.documentElement,o)||(clearInterval(l),i.parent.fire("destroy:composer"))},250);t.observe(a,"focus",function(){i.parent.fire("focus").fire("focus:composer"),setTimeout(function(){s=i.getValue()},0)}),t.observe(a,"blur",function(){s!==i.getValue()&&i.parent.fire("change").fire("change:composer"),i.parent.fire("blur").fire("blur:composer")}),e.browser.isIos()&&t.observe(u,"blur",function(){var e=u.ownerDocument.createElement("input"),t=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft;try{i.selection.insertNode(e)}catch(r){u.appendChild(e)}e.focus(),e.parentNode.removeChild(e),window.scrollTo(n,t)}),t.observe(u,"dragenter",function(){i.parent.fire("unset_placeholder")}),n.firesOnDropOnlyWhenOnDragOverIsCancelled()&&t.observe(u,["dragover","dragenter"],function(e){e.preventDefault()}),t.observe(u,f,function(e){var t=e.dataTransfer,r;t&&n.supportsDataTransfer()&&(r=t.getData("text/html")||t.getData("text/plain")),r?(u.focus(),i.commands.exec("insertHTML",r),i.parent.fire("paste").fire("paste:composer"),e.stopPropagation(),e.preventDefault()):setTimeout(function(){i.parent.fire("paste").fire("paste:composer")},0)}),t.observe(u,["keyup","keydown","keypress"],function(e){i.parent.fire(e.type,e).fire(e.type+":composer",e)}),t.observe(u,"keyup",function(t){var n=t.keyCode;(n===e.SPACE_KEY||n===e.ENTER_KEY)&&i.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){i.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||t.observe(u,"mousedown",function(e){var t=e.target;t.nodeName==="IMG"&&(i.selection.selectNode(t),e.preventDefault())}),t.observe(u,"keydown",function(e){var t=e.keyCode,n=r[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&n&&(i.commands.exec(n),e.preventDefault())}),t.observe(u,"keydown",function(t){var n=i.selection.getSelectedNode(!0),r=t.keyCode,s;n&&n.nodeName==="IMG"&&(r===e.BACKSPACE_KEY||r===e.DELETE_KEY)&&(s=n.parentNode,s.removeChild(n),s.nodeName==="A"&&!s.firstChild&&s.parentNode.removeChild(s),setTimeout(function(){e.quirks.redraw(u)},0),t.preventDefault())});var c={IMG:"Image: ",A:"Link: "};t.observe(u,"mouseover",function(e){var t=e.target,n=t.nodeName,r;if(n!=="A"&&n!=="IMG")return;var i=t.hasAttribute("title");i||(r=c[n]+(t.getAttribute("href")||t.getAttribute("src")),t.setAttribute("title",r))})}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue();t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){this.editor.currentView.name==="textarea"?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var n,r=this,i=this.textarea.element.form,s=function(){n=setInterval(function(){r.fromComposerToTextarea()},t)},o=function(){clearInterval(n),n=null};s(),i&&(e.dom.observe(i,"submit",function(){r.sync(!0)}),e.dom.observe(i,"reset",function(){setTimeout(function(){r.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(e){e==="composer"&&!n?(r.fromTextareaToComposer(!0),s()):e==="textarea"&&(r.fromComposerToTextarea(!0),o())}),this.editor.observe("destroy:composer",o)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value,r=!n;return e&&r||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},r=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change","keyup","keydown","keypress"]:["focus","blur","change"];t.observe("beforeload",function(){wysihtml5.dom.observe(e,r,function(e){var r=n[e.type]||e.type;t.fire(r).fire(r+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t=e.dom,n="wysihtml5-command-dialog-opened",r="input, select, textarea",i="[data-wysihtml5-dialog-field]",s="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(this._observed)return;var i=this,s=function(e){var t=i._serialize();t==i.elementToChange?i.fire("edit",t):i.fire("save",t),i.hide(),e.preventDefault(),e.stopPropagation()};t.observe(i.link,"click",function(e){t.hasClass(i.link,n)&&setTimeout(function(){i.hide()},0)}),t.observe(this.container,"keydown",function(t){var n=t.keyCode;n===e.ENTER_KEY&&s(t),n===e.ESCAPE_KEY&&(i.fire("cancel"),i.hide())}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",s),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){i.fire("cancel"),i.hide(),e.preventDefault(),e.stopPropagation()});var o=this.container.querySelectorAll(r),u=0,a=o.length,f=function(){clearInterval(i.interval)};for(;u<a;u++)t.observe(o[u],"change",f);this._observed=!0},_serialize:function(){var e=this.elementToChange||{},t=this.container.querySelectorAll(i),n=t.length,r=0;for(;r<n;r++)e[t[r].getAttribute(s)]=t[r].value;return e},_interpolate:function(e){var t,n,r,o=document.querySelector(":focus"),u=this.container.querySelectorAll(i),a=u.length,f=0;for(;f<a;f++){t=u[f];if(t===o)continue;if(e&&t.type==="hidden")continue;n=t.getAttribute(s),r=this.elementToChange?this.elementToChange[n]||"":t.defaultValue,t.value=r}},show:function(e){var i=this,s=this.container.querySelector(r);this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){i._interpolate(!0)},500)),t.addClass(this.link,n),this.container.style.display="",this.fire("show");if(s&&!e)try{s.focus()}catch(o){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,n),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},r={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},i={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},s={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(o,u){var a=document.createElement("input");if(!e.browser.supportsSpeechApiOn(a)){u.style.display="none";return}var f=document.createElement("div");e.lang.object(r).merge({width:u.offsetWidth+"px",height:u.offsetHeight+"px"}),t.insert(a).into(f),t.insert(f).into(u),t.setStyles(i).on(a),t.setAttributes(s).on(a),t.setStyles(r).on(f),t.setStyles(n).on(u);var l="onwebkitspeechchange"in a?"webkitspeechchange":"speechchange";t.observe(a,l,function(){o.execCommand("insertText",a.value),a.value=""}),t.observe(a,"click",function(e){t.hasClass(u,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",n="wysihtml5-commands-disabled",r="wysihtml5-command-active",i="wysihtml5-action-active",s=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(t,n){this.editor=t,this.container=typeof n=="string"?document.getElementById(n):n,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();var r=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),i=r.length,s=0;for(;s<i;s++)new e.toolbar.Speech(this,r[s])},_getLinks:function(t){var n=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),r=n.length,i=0,s=this[t+"Mapping"]={},o,u,a,f,l;for(;i<r;i++)o=n[i],a=o.getAttribute("data-wysihtml5-"+t),f=o.getAttribute("data-wysihtml5-"+t+"-value"),u=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+a+"']"),l=this._getDialog(o,a),s[a+":"+f]={link:o,group:u,name:a,value:f,dialog:l,state:!1}},_getDialog:function(t,n){var r=this,i=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']"),s,o;return i&&(s=new e.toolbar.Dialog(t,i),s.observe("show",function(){o=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:n,dialogContainer:i,commandLink:t})}),s.observe("save",function(e){o&&r.composer.selection.setBookmark(o),r._execCommand(n,e),r.editor.fire("save:dialog",{command:n,dialogContainer:i,commandLink:t})}),s.observe("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:n,dialogContainer:i,commandLink:t})})),s},execCommand:function(e,t){if(this.commandsDisabled)return;var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;switch(e){case"change_view":t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")}},_observe:function(){var e=this,t=this.editor,r=this.container,i=this.commandLinks.concat(this.actionLinks),o=i.length,u=0;for(;u<o;u++)s.setAttributes({href:"javascript:;",unselectable:"on"}).on(i[u]);s.delegate(r,"[data-wysihtml5-command]","mousedown",function(e){e.preventDefault()}),s.delegate(r,"[data-wysihtml5-command]","click",function(t){var n=this,r=n.getAttribute("data-wysihtml5-command"),i=n.getAttribute("data-wysihtml5-command-value");e.execCommand(r,i),t.preventDefault()}),s.delegate(r,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),t.observe("focus:composer",function(){e.bookmark=null,clearInterval(e.interval),e.interval=setInterval(function(){e._updateLinkStates()},500)}),t.observe("blur:composer",function(){clearInterval(e.interval)}),t.observe("destroy:composer",function(){clearInterval(e.interval)}),t.observe("change_view",function(t){setTimeout(function(){e.commandsDisabled=t!=="composer",e._updateLinkStates(),e.commandsDisabled?s.addClass(r,n):s.removeClass(r,n)},0)})},_updateLinkStates:function(){var n=this.composer.element,o=this.commandMapping,u=this.actionMapping,a,f,l,c;for(a in o){c=o[a],this.commandsDisabled?(f=!1,s.removeClass(c.link,r),c.group&&s.removeClass(c.group,r),c.dialog&&c.dialog.hide()):(f=this.composer.commands.state(c.name,c.value),e.lang.object(f).isArray()&&(f=f.length===1?f[0]:!0),s.removeClass(c.link,t),c.group&&s.removeClass(c.group,t));if(c.state===f)continue;c.state=f,f?(s.addClass(c.link,r),c.group&&s.addClass(c.group,r),c.dialog&&(typeof f=="object"?c.dialog.show(f):c.dialog.hide())):(s.removeClass(c.link,r),c.group&&s.removeClass(c.group,r),c.dialog&&c.dialog.hide())}for(a in u)l=u[a],l.name==="change_view"&&(l.state=this.editor.currentView===this.editor.textarea,l.state?s.addClass(l.link,i):s.removeClass(l.link,i))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){var t,n={name:t,style:!0,toolbar:t,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:t,allowObjectResizing:!0,supportTouchDevices:!0};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,r){this.textareaElement=typeof t=="string"?document.getElementById(t):t,this.config=e.lang.object({}).merge(n).merge(r).get(),this.textarea=new e.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=e.browser.supported();if(!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var i=this;setTimeout(function(){i.fire("beforeload").fire("load")},0);return}e.dom.addClass(document.body,this.config.bodyClassName),this.composer=new e.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,typeof this.config.parser=="function"&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(s){}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e){return this.currentView.getValue(e)},setValue:function(e,t){return e?(this.currentView.setValue(e,t),this):this.clear()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var n=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return typeof t=="object"&&e.quirks.redraw(t),n},_initParser:function(){this.observe("paste:composer",function(){var t=!0,n=this;n.composer.selection.executeAndRestore(function(){e.quirks.cleanPastedHTML(n.composer.element),n.parse(n.composer.element)},t)})}})}(wysihtml5),define("thirdparty/wysihtml5",function(){}),function(e,t,n){function o(e,n){var r=t.createElement(e||"div"),i;for(i in n)r[i]=n[i];return r}function u(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function f(e,t,n,r){var o=["opacity",t,~~(e*100),n,r].join("-"),u=.01+n/r*100,f=Math.max(1-(1-e)/t*(100-u),e),l=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return i[o]||(a.insertRule("@"+c+"keyframes "+o+"{"+"0%{opacity:"+f+"}"+u+"%{opacity:"+e+"}"+(u+.01)+"%{opacity:1}"+(u+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",0),i[o]=1),o}function l(e,t){var i=e.style,s,o;if(i[t]!==n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(o=0;o<r.length;o++){s=r[o]+t;if(i[s]!==n)return s}}function c(e,t){for(var n in t)e.style[l(e,n)||n]=t[n];return e}function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function p(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}var r=["webkit","Moz","ms","O"],i={},s,a=function(){var e=o("style");return u(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),d={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},v=function m(e){if(!this.spin)return new m(e);this.opts=h(e||{},m.defaults,d)};v.defaults={},v.prototype={spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=c(o(0,{className:n.className}),{position:"relative",zIndex:n.zIndex}),i=n.radius+n.length+n.width,u,a;e&&(e.insertBefore(r,e.firstChild||null),a=p(e),u=p(r),c(r,{left:(n.left=="auto"?a.x-u.x+(e.offsetWidth>>1):n.left+i)+"px",top:(n.top=="auto"?a.y-u.y+(e.offsetHeight>>1):n.top+i)+"px"})),r.setAttribute("aria-role","progressbar"),t.lines(r,t.opts);if(!s){var f=0,l=n.fps,h=l/n.speed,d=(1-n.opacity)/(h*n.trail/100),v=h/n.lines;!function m(){f++;for(var e=n.lines;e;e--){var i=Math.max(1-(f+e*v)%h*d,n.opacity);t.opacity(r,n.lines-e,i,n)}t.timeout=t.el&&setTimeout(m,~~(1e3/l))}()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function i(e,r){return c(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.width>>1)+"px"})}var n=0,r;for(;n<t.lines;n++)r=c(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:s&&f(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&u(r,c(i("#000","0 0 4px #000"),{top:"2px"})),u(e,u(r,i(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}},!function(){var e=c(o("group"),{behavior:"url(#default#VML)"}),t;if(!l(e,"transform")&&e.adj){for(t=4;t--;)a.addRule(["group","roundrect","fill","stroke"][t],"behavior:url(#default#VML)");v.prototype.lines=function(e,t){function i(){return c(o("group",{coordsize:r+" "+r,coordorigin:-n+" "+ -n}),{width:r,height:r})}function l(e,r,s){u(a,u(c(i(),{rotation:360/t.lines*e+"deg",left:~~r}),u(c(o("roundrect",{arcsize:1}),{width:n,height:t.width,left:t.radius,top:-t.width>>1,filter:s}),o("fill",{color:t.color,opacity:t.opacity}),o("stroke",{opacity:0}))))}var n=t.length+t.width,r=2*n,s=-(t.width+t.length)*2+"px",a=c(i(),{position:"absolute",top:s,left:s}),f;if(t.shadow)for(f=1;f<=t.lines;f++)l(f,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(f=1;f<=t.lines;f++)l(f);return u(e,a)},v.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}else s=l(e,"animation")}(),e.Spinner=v}(window,document),define("thirdparty/spin",function(){}),define("tictail/component/ui",["jquery","underscore","jquery-ui","thirdparty/wysihtml5","thirdparty/spin"],function(e,t){var n=function(){var e=[],t;for(var n=0;n<document.styleSheets.length;n++)t=document.styleSheets[n],t.href&&t.href.indexOf("fonts.googleapis.com")!==-1&&e.push(t.href);return e},r={init:function(){var t=e.browser.msie&&parseInt(e.browser.version,10)<=7;return this.each(function(){e("input[type=checkbox].ui:not(.replaced), input[type=radio].ui:not(.replaced)",this).each(function(){if(t){e(this).addClass("plain");return}new s(this)});if(t)return;e("select.ui:not([multiple]):not(.replaced)",this).each(function(){new o(this)}),e("textarea.wysiwyg:not(.replaced)",this).each(function(){new u(this)})})},setChecked:function(t){return this.each(function(){var n=e(this),r;if(n.is("input[type=checkbox]")||n.is("input[type=radio]"))n.prop("checked",t),r=n.data("replacement"),r&&r.toggleClass("checked",t)})},setLoading:function(t,n){return this.each(function(){var r=e(this),i="loading",s=function(){r.data("origContents",r.contents().detach()).append(e('<span class="loading"/>')).dequeue(i)};if(!r.is("button[type=submit]")&&!r.is("button.highlighted"))return;if(t!==!1){if(r.data("loading")===!0)return;r.data("loading",!0).data("origDisabled",r.prop("disabled")).prop("disabled",!0),n?r.delay(500,i).queue(i,s).dequeue(i):s()}else r.clearQueue(i).find("span.loading").remove().end().append(r.data("origContents")).prop("disabled",r.data("origDisabled")||!1).removeData("loading").removeData("origContents").removeData("origDisabled")})},setError:function(t){return this.each(function(){var n=e(this).toggleClass("error",t),r=n.data("replacement");r&&r.toggleClass("error",t)})}};e.fn.ui=function(t){t||(t="init");if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));e.error("Method "+t+" does not exist")},e.propHooks.disabled={set:function(t,n){var r=e(t);(r.is("input[type=checkbox].ui.replaced")||r.is("input[type=radio].ui.replaced")||r.is("select.ui.replaced"))&&r.data("replacement").toggleClass("disabled",n)}},e.fn.spin=function(t){return this.each(function(){var n=e(this),r=n.data();r.spinner&&(r.spinner.stop(),delete r.spinner),t!==!1&&(r.spinner=(new Spinner(e.extend({lines:9,length:0,width:4,radius:7,rotate:13,trail:50,speed:1.5,color:n.css("color")||"#6a6a6a"},t))).spin(this),e(r.spinner.el).css({top:"",left:""}))})};var i={},s=i.Checkbox=function(e){this._setup(e)};t.extend(s.prototype,{_setup:function(t){t=e(t);var n=t.attr("type")==="radio",r=e("<div/>").addClass("ui").toggleClass("checkbox",!n).toggleClass("radio-button",n).click(function(e){e.preventDefault();var i=t.prop("checked");if(n&&i)return;r.hasClass("disabled")||t.prop("checked",!i).change()});t.attr("id")&&r.attr("id",t.attr("id")+"-replacement"),t.attr("tabindex")&&r.attr("tabindex",t.attr("tabindex")),t.prop("checked")&&r.addClass("checked"),t.prop("disabled")&&r.addClass("disabled"),r.keyup(function(e){if(e.which===13||e.which===32){e.preventDefault();var r=t.prop("checked");if(n&&r)return;t.prop("disabled")||t.prop("checked",!r).change()}}).keydown(function(e){e.which===32&&e.preventDefault()}),!n&&t.hasClass("switch")&&r.addClass("switch").append(e('<div class="border"/>').append(e('<div class="track"/>').append(e('<div class="label yes"/>').text(t.attr("data-yes-label")||"Yes")).append(e('<div class="label no"/>').text(t.attr("data-no-label")||"No")).append(e('<div class="handle"/>')))),t.data("replacement",r).change(function(i,s){r.toggleClass("checked",t.prop("checked")),n&&s!==!0&&t.attr("name")&&e('input[type=radio][name="'+t.attr("name")+'"].ui').not(t).trigger("change",!0)}).after(r).addClass("replaced")}});var o=i.Select=function(e){this._setup(e)};t.extend(o.prototype,{_curFilterString:null,_setup:function(n){n=e(n);var r=this,i,s,u,a,f=navigator.userAgent,l=f.match(/iPhone/i)||f.match(/iPod/i)||f.match(/iPad/i),c=f.match(/Android/i);i=e('<div class="ui select"/>').append(e("<span/>")).click(function(e){if(e.target===s.get(0)&&i.hasClass("searching"))return;e.preventDefault(),i.hasClass("disabled")||r.toggleOpen()}).focus(function(){e(document).keydown(r._globalKeyHandler)}).blur(function(){e(document).unbind("keydown",r._globalKeyHandler)}).keypress(function(e){e.which!==13&&!r._isOpen()&&!i.hasClass("disabled")&&(r.toggleOpen(),i.addClass("searching"))}).keyup(function(e){e.which===13||e.which===32?(e.preventDefault(),!i.hasClass("disabled")&&(e.which!==32||!i.hasClass("open"))&&r.toggleOpen()):(e.which===40||e.which===38)&&!r._isOpen()&&(e.preventDefault(),r.toggleOpen())}),n.attr("id")&&i.attr("id",n.attr("id")+"-replacement"),n.attr("tabindex")&&i.attr("tabindex",n.attr("tabindex")),n.prop("disabled")&&i.addClass("disabled"),s=e('<input type="text"/>').keyup(function(e){t.has(o.OFFSET_MAP,e.which)||r.filter(this.value)}).appendTo(i),u=e("<ul/>").appendTo(i),e('<li class="empty"/>').text(n.attr("data-str-empty")||"Empty").appendTo(u),e('<li class="no-matches"/>').text(n.attr("data-str-no-matches")||"No matches found").appendTo(u),n.data("replacement",i).change(function(){r.setSelectedIndex(n.prop("selectedIndex"))}).bind("changeOptions",function(){r.changeOptionsHandler()}).after(i).addClass("replaced"),(l||c)&&n.click(function(e){e.stopPropagation()}).addClass("overlaid").appendTo(i),this.select=n,this.replacement=i,this.input=s,this.ul=u,this.lis=a,this.visibleLis=a,this.renderOptions()},renderOptions:function(t){var n=this,r=this.select,i=this.ul,s=[],o=0;this.hasPlaceholder=!1,i.empty(),r.find("option").each(function(t,u){var a=e(u),f=a.text(),l=a.data("alt");if(u.selected||u.defaultSelected)o=t;if(t===0&&a.hasClass("placeholder")){n.hasPlaceholder=!0;return}l&&(f+='<span class="alt">'+l+"</span>");var c=e("<li/>").html(f).data("index",t).click(function(){r.prop("selectedIndex",t).change()}).appendTo(i);s.push(c.get(0))}),s=e(s),e('<li class="empty"/>').text(r.attr("data-str-empty")||"Empty").appendTo(i),e('<li class="no-matches"/>').text(r.attr("data-str-no-matches")||"No matches found").appendTo(i),this.replacement.toggleClass("empty",s.length===0),this.lis=s,this.visibleLis=s,t!==!1&&this.setSelectedIndex(o)},changeOptionsHandler:function(){this.replacement.hasClass("open")&&this.toggleOpen(),this.filter(null),this.renderOptions()},toggleOpen:function(){var t=this.replacement,n=this;this._isOpen()?(e("html").unbind("click",this._clickOutsideHandler),t.removeClass("open searching").unbind("keydown",this._keyHandler),this.input.unbind("keypress"),document.activeElement===this.input.get(0)&&t.focus()):(e("html").bind("click",this,this._clickOutsideHandler),t.addClass("open").bind("keydown",this,this._keyHandler),this.filter(null),this.input.val("").focus().keypress(function r(){e(this).unbind("keypress",r),t.addClass("searching")}),this.scrollToItem(this.visibleLis.filter(".selected")))},scrollToItem:function(e){e&&e.length!==0&&this.ul.scrollTop(e.offset().top-this.ul.offset().top+this.ul.scrollTop())},ensureItemIsVisible:function(e){var t=this.ul,n=t.offset(),r=t.height(),i=e.offset(),s=e.outerHeight();n.top>i.top?t.scrollTop(i.top-n.top+t.scrollTop()):n.top+r<i.top+s&&t.scrollTop(i.top+s-(n.top+r)+t.scrollTop())},_isOpen:function(){return this.replacement.hasClass("open")},_clickOutsideHandler:function(t){var n=t.data;e(t.target).parents().add(t.target).is(n.replacement)||n.toggleOpen()},_globalKeyHandler:function(e){e.which>=32&&e.which<=40&&e.preventDefault()},_keyHandler:function(e){var n=e.data;if(e.which===27)e.preventDefault(),e.stopPropagation(),n.toggleOpen();else if(e.which===9)n.setSelectedIndex(n.selectionIndex),n.select.prop("selectedIndex",n.selectionIndex).change(),n._isOpen()&&n.toggleOpen();else if(t.has(o.OFFSET_MAP,e.which))e.preventDefault(),n.moveSelection(o.OFFSET_MAP[e.which]);else if(e.which===13){e.preventDefault();var r=n.selectionToSelected(n.selectionIndex);n.setSelectedIndex(r),n.select.prop("selectedIndex",r).change()}},selectedToSelection:function(e){return Math.max(this.hasPlaceholder?e-1:e,0)},selectionToSelected:function(e){return this.hasPlaceholder?e+1:e},setSelectedIndex:function(t,n){var r=t>=0?this.select.get(0).options[t]:null;if(!r)return;this.selectionIndex=this.selectedToSelection(t);if(n!==!1){var i=e(r).data("alt"),s=i?i:r.text;this.replacement.children("span").text(s)}this.replacement.toggleClass("unselected",t===0&&this.hasPlaceholder),this.lis.filter(".selected").removeClass("selected");if(!this.hasPlaceholder||t!==0){var o=this.lis.eq(this.selectionIndex).addClass("selected");this.replacement.hasClass("open")&&this.ensureItemIsVisible(o)}},moveSelection:function(t){var n=this.selectionIndex;this.isFiltered()?(this.visibleLis.each(function(t){if(e(this).hasClass("selected"))return n=t,!1}),n=Math.min(Math.max(n+t,0),this.visibleLis.length-1),this.setSelectedIndex(this.visibleLis.eq(n).data("index"))):(n=Math.min(Math.max(n+t,0),this.lis.length-1),this.setSelectedIndex(this.selectionToSelected(n),!1))},isFiltered:function(){return!!this._curFilterString},filter:function(t){if(this._curFilterString===t)return;if(!t){this.visibleLis=this.lis.show(),this.scrollToItem(this.lis.filter(".selected")),this.replacement.removeClass("no-matches"),this._curFilterString=t;return}var n=this.select.get(0).options,r=this.lis,i=[],s=this.hasPlaceholder?1:0,o,u=-1,a=!1;try{o=new RegExp(t,"ig")}catch(f){var l=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");o=new RegExp(l,"ig")}for(var c=s,h=n.length;c<h;c++){var p=r.eq(c-s),d=n[c],v=d.text;e(d).data("alt")&&(v+=" "+e(d).data("alt")),v.match(o)?(p.show(),i.push(p.get(0)),u===-1&&(u=c)):(p.hide(),this.selectionIndex===c-s&&(a=!0))}this.visibleLis=e(i),u!==-1&&(a?this.setSelectedIndex(u,!1):this.scrollToItem(r.filter(".selected"))),this.replacement.toggleClass("no-matches",this.visibleLis.length===0),this._curFilterString=t}}),o.OFFSET_MAP={33:-9,34:9,35:99999,36:-99999,38:-1,40:1};var u=i.WysiwygEditor=function(e,n){n=t.extend({toolbarButtons:["bold","italic","underline","ordered-list","unordered-list","link","html"]},n),this._setup(e,n)};t.extend(u.prototype,{_setup:function(t,r){t=e(t);var i=this,s,o=e('<div class="wysiwyg-editor no-wysiwyg"/>').insertBefore(t),u=this._createToolbar(r).appendTo(o),a=this._createCloseButton(r);u.add(a).mousedown(function(e){e.preventDefault(),e.stopImmediatePropagation()}),t.appendTo(o),s=new wysihtml5.Editor(t.get(0),{toolbar:u.get(0),stylesheets:n(),parserRules:{tags:{a:{check_attributes:{href:"href"},set_attributes:{rel:"nofollow",target:"_blank"}},abbr:{},align:{},article:{},aside:{},audio:{},b:{},base:{},big:{},blink:{},blockquote:{},br:{},center:{},cite:{},code:{},col:{},colgroup:{},del:{},div:{},em:{},embed:{},fieldset:{},figure:{},font:{},footer:{},form:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},header:{},hr:{},href:{},i:{},iframe:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers",frameborder:"numbers",allowfullscreen:"alt"}},img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},input:{},label:{},left:{},li:{},link:{},marquee:{},meta:{},object:{},ol:{},option:{},p:{},pre:{},s:{},section:{},sence:{},size:{},small:{},span:{},strike:{},strong:{},style:{},sup:{},table:{},tbody:{},td:{check_attributes:{colspan:"numbers"}},textarea:{},thead:{},title:{},tr:{},u:{},ul:{},"var":{},video:{},wbr:{}},classes:{}},style:!1}),t.attr("tabindex")&&s.composer&&e(s.composer.iframe).attr("tabindex",t.attr("tabindex")),s.on("load",function(){var t=s.composer;if(!t)return;var n=e(t.iframe);t.style(),n.css("display",""),n.add(e(t.focusStylesHost)).add(e(t.blurStylesHost)).css("height",""),o.removeClass("no-wysiwyg"),n.click(function(){s.focus()})}).on("focus",function(){o.addClass("focused")}).on("blur",function(){o.removeClass("focused")}).on("show:dialog",function(e){var t=s.toolbar.commandMapping[e.command+":null"];t&&t.state===!1&&i.showDialog(e)}).on("save:dialog",function(e){i.hideDialog(e)}).on("cancel:dialog",function(e){i.hideDialog(e)}).on("change_view",function(e){i.toggleHtmlMode(e==="textarea")}),t.data("replacement",o).data("editor",s).addClass("replaced"),this.editor=s,this.wrapper=o,this.htmlClose=a},_createToolbar:function(t){var n=e('<div class="wysiwyg-toolbar"/>'),r=t.toolbarButtons||[],i=r.length;for(var s=0;s<i;s++)this._createToolbarButton(r[s]).appendTo(n);return this._createCreateLinkDialog(t).appendTo(n),n},_createToolbarButton:function(t){var n=u.TOOLBAR_BUTTONS[t];if(n===undefined)return null;var r=e('<a class="manual"/>').addClass(t).text(n.label);return n.command!==undefined?r.attr("data-wysihtml5-command",n.command):n.action!==undefined&&r.attr("data-wysihtml5-action",n.action),n.alignRight&&r.addClass("right"),r},_createCreateLinkDialog:function(t){var n=Math.round(Math.random()*1e7),r=e('<div class="field"/>').append(e("<label/>").attr("for","wysiwyg-link-href-"+n).text("Link URL")).append(e('<input type="text" data-wysihtml5-dialog-field="href"/>').attr("id","wysiwyg-link-href-"+n).attr("value","http://")),i=e('<div class="actions"/>').append(e('<button type="button" class="highlighted" data-wysihtml5-dialog-action="save"/>').text("OK")).append(e('<a href="#" class="manual" data-wysihtml5-dialog-action="cancel"/>').text("Cancel and close"));return e('<div class="wysiwyg-dialog wysiwyg-link-dialog" data-wysihtml5-dialog="createLink"/>').append(r).append(i)},_createCloseButton:function(t){var n=this;return e('<div class="ui close"/>').click(function(e){e.preventDefault(),n.editor.toolbar.execAction("change_view")})},toggleHtmlMode:function(e){this.wrapper.addClass("disable-animations").toggleClass("html-mode",e).removeClass("disable-animations"),e?this.htmlClose.appendTo(this.wrapper):this.htmlClose.detach()},_triggerEvent:function(e,t,n){document.createEvent?(n=document.createEvent("MouseEvents"),n.initMouseEvent(t,!0,!0,e.ownerDocument.defaultView,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n)):e.fireEvent&&e.fireEvent("on"+t)},showDialog:function(t){var n=this,r=e("body");this.curtain||(this.curtain=e('<div class="wysiwyg-curtain"/>').click(function(){n._triggerEvent(e(t.dialogContainer).find("[data-wysihtml5-dialog-action=cancel]").get(0),"click")})),this.curtain.stop(!0).hide().fadeIn(100).appendTo(r),e(t.dialogContainer).stop(!0).css({top:"55%",opacity:0}).animate({top:"50%",opacity:1},{duration:400,easing:"easeOutCubic"}).appendTo(r)},hideDialog:function(t){this.curtain&&this.curtain.detach(),e(t.dialogContainer).detach()}}),u.TOOLBAR_BUTTONS={bold:{label:"Bold",command:"bold"},italic:{label:"Italic",command:"italic"},underline:{label:"Underline",command:"underline"},"ordered-list":{label:"Ordered list",command:"insertOrderedList"},"unordered-list":{label:"Unordered list",command:"insertUnorderedList"},link:{label:"Insert link",command:"createLink"},html:{label:"HTML",action:"change_view",alignRight:!0}};var a=i.getLoadingImage=function(n,r,i,s){r=r||{},t.extend(r,{src:n});var o={};t.isNumber(i)&&t.extend(o,{width:i}),t.isNumber(s)&&t.extend(o,{height:s,"line-height":s});var u=new Image,a=e('<div class="image loading"/>');return e(u).load(function(){var t=e(this),n=e("<div/>");n.css(o),n.append(this),t.css("display","none"),a.addClass("loaded"),a.removeClass("loading").append(n),t.fadeIn()}).error(function(){}).attr(r),a};return i}),define("tictail/view",["jquery","underscore","icanhaz","backbone","mustache","tictail/component/ui"],function(e,t,n,r,i){var s={parentNode:e("body"),opened:[],open:function(n,r){var i=this,s,o,u=r.closeButton;return t.isUndefined(r.canUserClose)&&(r.canUserClose=!0),t.isUndefined(u)===!0&&(u=r.canUserClose),this.options=r,this.isOverlaid(n)?(o=this.viewToOverlay(n),o.options=t.extend(o.options,r),o.spinner&&this.showOverlay(o)):(s=e('<div class="overlay"><div class="info" /><div class="inner" /></div>'),u&&(s.find(".inner").html(e('<div class="ui close"></div>')),s.find(".close").click(function(e){e.preventDefault(),i.close(o)}).end()),o={view:n,node:s,options:r||{}},n._overlay=o,this.opened.push(o),r.requiresLoading?this.createSpinner(o):this.showOverlay(o)),this},close:function(t){var n,r=null;for(var i=this.opened.length-1;i>=0;i--){n=this.opened[i];if(t===n||t===n.view){r=i;break}}return r===null?this:(this.removeSpinner(n),n.node.remove(),delete n.view._overlay,this.opened.splice(r,1),this.opened.length||(this.removeCurtain(),e(window).unbind("resize",this._windowResizeHandler),this.options.canUserClose&&e(window.document).unbind("keydown",this._keyDownHandler)),n.options.closeCallback&&n.options.closeCallback(n.view),n.options.parentView&&n.options.parentView.removeChildView(n.view),this)},removeAll:function(){for(var e=this.opened.length-1;e>=0;e--)this.opened[e].view.remove();return this},isOverlaid:function(e){return e._overlay!==undefined},viewToOverlay:function(e){return e._overlay||null},showOverlay:function(t){return t?(this.removeSpinner(t).createCurtain(t.options),t.node.css({width:t.options.width||"",height:t.options.height||""}).appendTo(this.parentNode),t.view.appendTo(t.node.children(".inner")),this.move(t,!1).animateIn(t),e(window).resize(this,this._windowResizeHandler),this.options.canUserClose&&e(window.document).keydown(this,this._keyDownHandler),this):this},createCurtain:function(t){if(this.curtain)return this;var n=this,r=this.curtain=e('<div id="overlay-curtain"/>');return this.options.canUserClose&&r.click(function(e){e.preventDefault(),n.removeAll()}),r.appendTo(this.parentNode),t.showCurtain===!1?this.curtain.css("opacity",0):t.animateCurtain!==!1&&this.curtain.hide().fadeIn(100,function(){e(this).removeAttr("style")}),this},removeCurtain:function(){return this.curtain?(this.curtain.remove(),this.curtain=null,this):this},createSpinner:function(t){if(t.spinner)return this;var n=this;return t.spinner=e('<div class="overlay-spinner"><div class="inner"/></div>').click(function(e){e.preventDefault(),n.close(t)}).appendTo(this.parentNode).children(".inner").spin().hide().fadeIn(200).end(),this},removeSpinner:function(e){return e.spinner?(e.spinner.remove(),delete e.spinner,this):this},animateIn:function(e){if(e.options.animation===!1)return this;var t=this,n=e.node.children(".inner"),r=n.children(".ui.close").hide();return e.options.animation==="bounceIn"?n.css({left:"25%",top:"25%",width:"50%",height:"50%",opacity:0}).animate({left:"0%",top:"0%",width:"100%",height:"100%",opacity:1},{duration:300,easing:"easeOutBack",complete:function(){r.fadeIn(200)}}):n.css({top:100,opacity:0}).animate({top:0,opacity:1},{duration:400,easing:"easeOutCubic",complete:function(){r.fadeIn(200)}}),this},move:function(t,n){if(!t)return this;var r=e(window),i=t.node,s=Math.max(Math.round((r.width()-i.width())*.5),20),o=Math.max(Math.round((r.height()-i.height())*.5+r.scrollTop()),20);return n!==!1?i.clearQueue().animate({top:o,left:s},200,"swing"):i.css({top:o,left:s}),this},_windowResizeHandler:function(e){var t=e.data;t._resizeTimeout||(t._resizeTimeout=setTimeout(function(){for(var e=t.opened.length-1;e>=0;e--)t.move(t.opened[e]);delete t._resizeTimeout},200))},_keyDownHandler:function(e){var t=e.data;e.which===27&&t.close(t.opened[t.opened.length-1])}},o=function(e,n,r,i){this.obj=e,this.event=n,t.isUndefined(e.jquery)?(this.cbk=r,this.ctx=i):this.cbk=t.bind(r,i)};o.prototype.bind=function(){return this.obj.on(this.event,this.cbk,this.ctx)},o.prototype.unbind=function(){return this.obj.off(this.event,this.cbk,this.ctx)};var u=r.View,a=u.extend({template:null,constructor:function(){this.childViews={},a.__super__.constructor.apply(this,arguments)},bindTo:function(e,n,r,i){t.isUndefined(i)&&(i=this);var s=new o(e,n,r,i);return t.isUndefined(this._eventBindings)&&(this._eventBindings=[]),this._eventBindings.push(s),s.bind()},unbindAll:function(){var e=this._eventBindings;t.isUndefined(e)||(t.invoke(e,"unbind"),e.length=0)},addChildView:function(e,n){n===undefined&&(n=this.$el);var r=this.childViews,i=function(e){r[e.cid]=e,n&&e.appendTo(n)};return t.isArray(e)?t.each(e,i):i(e),this},removeChildView:function(e,n){var r=this.childViews,i=function(e){n!==!1&&e.remove(),delete r[e.cid]};return t.isArray(e)?t.each(e,i):i(e),this},empty:function(e){return e!==!1&&t.each(this.childViews,function(e){e.remove()}),this.childViews={},this.$el.empty(),this},prependTo:function(e){return this._append("prependTo",e)},appendTo:function(e){return this._append("appendTo",e)},insertBefore:function(e){return this._append("insertBefore",e)},insertAfter:function(e){return this._append("insertAfter",e)},_append:function(n,r){r instanceof u&&(r=r.$el),this.render(),this.$el[n](r);if(e(r).closest(window.document.body).length){t.isFunction(this.didAppend)&&this.didAppend();var i=this.el,s=function(e){t.each(e,function(e){e.didAppend&&e.$el.closest(i).length&&e.didAppend(),s(e.childViews)})};s(this.childViews)}return this},remove:function(){return t.isFunction(this.willRemove)&&this.willRemove(),this.unbindAll(),t.each(this.childViews,function(e){e.remove()}),s.isOverlaid(this)&&s.close(this),u.prototype.remove.apply(this,arguments)},getContent:function(){return null},getTemplate:function(){var t=this.template;if(typeof t!="string")return!1;var r=this.getTemplateData()||{};return e(n[t](r))},getTemplateData:function(){return null},prepareContent:function(e){if(!e||!(e instanceof jQuery))return;e.ui()},renderTemplate:function(){var e=this.getTemplate();if(!e)return this;var n=this.templateContainer||this.$el;return t.isString(n)&&(n=this.$(n)),this.prepareContent(e),n.append(e),this},renderContent:function(e){e=e||this.getContent();if(!e)return this;var n=this.container||this.$el;return t.isString(n)&&(n=this.$(n)),e instanceof a||t.isArray(e)?this.addChildView(e,n):(this.prepareContent(e),n.append(e)),this},render:function(){return this.empty(),this.renderTemplate(),this.renderContent(),this.didRender()},didRender:function(){return this},overlay:function(e){return s.open(this,e),this},isOverlaid:function(){return s.isOverlaid(this)},getOverlay:function(){return s.viewToOverlay(this)}});return a}),define("tictail/component/grid",["jquery","underscore","../view"],function(e,t,n){var r=this;r.TT=r.TT||{};var i=n.extend({tagName:"div",attributes:{"class":"column"},gutterClass:"",initialize:function(e){this.setSize(e.size),this.content=e.content,i.__super__.initialize.call(this,e)},setSize:function(e){var t=i.columnClasses[e];t===undefined&&(t=e),this.$el.addClass(t)},getContent:function(){return this.content},makeGutter:function(e){return this.make("div",{"class":e||"gutter"})},setupGutter:function(t){if(i.useBorderBoxGutter)this.$el.removeClass("no-gutter no-gutter-l no-gutter-r").addClass(t);else{var n=null;t==="no-gutter-r"?n="gutter-l":t==="no-gutter-l"?n="gutter-r":t!=="no-gutter"&&(n="gutter"),n!==null&&(this.container=e(this.makeGutter(n)).appendTo(this.$el))}},render:function(){this.empty(),delete this.container;var e=this.gutterClass;return t.isUndefined(this.options.gutterClass)!==!0&&(e=this.options.gutterClass),this.setupGutter(e),this.renderContent(),this.didRender()}},{columnClasses:{"1/1":"one","1/2":"one-in-two","1/3":"one-in-three","2/3":"two-in-three","1/4":"one-in-four","3/4":"three-in-four","1/5":"one-in-five","2/5":"two-in-five","3/5":"three-in-five","4/5":"four-in-five","1/6":"one-in-six","5/6":"five-in-six","1/8":"one-in-eight","3/8":"three-in-eight","5/8":"five-in-eight","1/10":"one-in-ten","3/10":"three-in-ten","7/10":"seven-in-ten","9/10":"nine-in-ten","1/12":"one-in-twelve","5/12":"five-in-twelve","7/12":"seven-in-twelve","11/12":"eleven-in-twelve","1/16":"one-in-sixteen","3/16":"three-in-sixteen","5/16":"five-in-sixteen","7/16":"seven-in-sixteen","9/16":"nine-in-sixteen","11/16":"eleven-in-sixteen","13/16":"thirteen-in-sixteen","14/16":"fourteen-in-sixteen","15/16":"fiftheen-in-sixteen","1/24":"one-in-twentyfour","5/24":"five-in-twentyfour","7/24":"seven-in-twentyfour","11/24":"eleven-in-twentyfour","13/24":"thirtheen-in-twentyfour","17/24":"seventeen-in-twentyfour","19/24":"nineteen-in-twentyfour","23/24":"twentythree-in-twentyfour"},useBorderBoxGutter:!1}),s=r.TT.Grid=n.extend({tagName:"div",className:"row",initialize:function(e){e=e||{},this.columns=[];var n=e.columns||[];t.each(n,function(e){this.addColumn(e.size,e.content,e)},this),s.__super__.initialize.apply(this,arguments)},addColumn:function(e,n,r){return r=t.extend({size:e,content:n},r),this.columns.push(new i(r))},getContent:function(){return this.columns}});return s.Column=i,s}),define("tictail/model/feed",["../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{};var n=t.TT.Model.Feed=e.Model.extend({markAsPerformed:function(){this.set({status:n.STATUS.PERFORMED,performed_at:Math.round(+(new Date)/1e3)})}},{STATUS:{NEW:20,PERFORMED:10,POSTPONED:30,IGNORED:40}});return n}),define("tictail/collection/feed",["underscore","../core","../model/feed"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{};var i=r.TT.Collection.Feed=t.Collection.extend({API_ACTIONS:{read:"feed.item.get.many"},model:n,API_METHOD_ABORT:{create:!0,"delete":!0,update:!0},initialize:function(t,n){if(e.isUndefined(n.storeId))throw new Error("No store identifier given in store feed collection");this.storeId=n.storeId},getDefaultParams:function(){return{store_id:this.storeId}}});return i}),define("tictail/model/theme",["../core"],function(e){var t=e.Model.extend({API_NAMESPACE:"theme"});return t}),define("tictail/collection/theme",["underscore","../core","../model/theme"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{};var i=r.TT.Collection.Theme=t.Collection.extend({API_ACTIONS:{read:"theme.list.get"},model:n});return i}),define("tictail/model/store/shipping",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Shipping=e.Model.extend({API_NAMESPACE:"store.settings.shipping"});return n}),define("tictail/collection/store/shipping",["underscore","../../core","../../model/store/shipping"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{},r.TT.Collection.Store=r.TT.Collection.Store||{};var i=r.TT.Collection.Store.Shipping=t.Collection.extend({API_NAMESPACE:"store.settings.shipping",model:n,initialize:function(t,n){if(e.isUndefined(n.storeId))throw new Error("No store identifier given in store shipping collection");this.storeId=n.storeId},getDefaultParams:function(){return{store_id:this.storeId}}});return i}),define("tictail/model/store/order",["underscore","../../core","../../utility","../../component/api","../../component/log"],function(e,t,n,r,i){var s=this;s.TT=s.TT||{},s.TT.Model=s.TT.Model||{},s.TT.Model.Store=s.TT.Model.Store||{};var o=s.TT.Model.Store.Order=t.Model.extend({API_NAMESPACE:"store.order",API_SET_STATUS_METHOD:"store.order.status.update",statusPaid:2,statusShipped:4,statusCancelled:5,statusRefunded:6,statusPending:7,statusDenied:8,statusReversed:10,statusUpdateCallbacks:{},getDefaultParams:function(){return{store_id:this.get("store_id"),id:this.get("id")}},getDaysSincePayment:function(){var r=this.get("paid_at");return e.isNull(r)!==!1?undefined:(r=n.getDateFromTimestamp(r),t.getLazy(this,"daysSincePayment",function(){var e=Math.abs(new Date-r)/1e3,t=e/60/60/24;return t}))},isShipped:function(){return this.get("status")===this.statusShipped},isOverdue:function(){var e=this.get("status");if(e!==this.statusPaid)return!1;var t=this.getDaysSincePayment();return t>=2},isCancelled:function(){return this.get("status")===this.statusCancelled},isRefunded:function(){return this.get("status")===this.statusRefunded},getStatusName:function(){var e=this.get("status");switch(e){case this.statusShipped:return"shipped";case this.statusCancelled:return"cancelled";case this.statusRefunded:return"refunded";case this.statusPending:return"pending";case this.statusDenied:return"denied";case this.statusShipped:return"shipped"}return this.isOverdue()?"overdue":"paid"},setShippedStatus:function(e,t){var n={};e&&(this.set("shipped_at",Math.round(new Date/1e3),{silent:!0}),t&&(n={send_message:t.get("send_message"),ship_message:t.get("send_message")?t.get("ship_message"):null,tracking_number:t.get("tracking_number"),shipping_company:t.get("shipping_company"),receiver_name:t.get("receiver").name})),this.setStatus("shipped",e,this.statusShipped,n)},setCancelStatus:function(e){this.setStatus("cancelled",e,this.statusCancelled)},setRefundStatus:function(e){this.setStatus("refunded",e,this.statusRefunded)},getStatusUpdateParams:function(t,n){var r={};return r[t]=n,e.extend(r,{id:this.get("id"),store_id:this.get("store_id")}),r},setStatus:function(t,n,s,o){var u=this.API_SET_STATUS_METHOD,a=this.getStatusUpdateParams(t,n);o&&e.extend(a,o);var f=this.get("status"),l=new r.Request(u,a,"POST");l.setOnSuccess(function(){i.info("Did change order status from",f,"to",this.get("status")),this.trigger("save:status",this.get("status"),this)},this),l.setOnError(function(){i.error("Could not change order status to",this.get("status"),"from",f),this.set("status",f)},this),n?this.set("status",s):this.set("status",this.statusPaid),l.send()}});return o}),define("tictail/collection/store/order",["underscore","../../core","../../model/store/order"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{},r.TT.Collection.Store=r.TT.Collection.Store||{};var i=r.TT.Collection.Store.Order=t.Collection.extend({API_ACTIONS:{read:"store.order.search"},model:n,API_METHOD_ABORT:{create:!0,"delete":!0,update:!0},initialize:function(t,n){if(e.isUndefined(n.storeId))throw new Error("No store identifier given in store shipping collection");this.storeId=n.storeId},getDefaultParams:function(){return{store_id:this.storeId}}});return i}),define("tictail/model/store/product/variation",["../../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{},t.TT.Model.Store.Product=t.TT.Model.Store.Product||{};var n=t.TT.Model.Store.Product.Variation=e.Model.extend({isUnlimited:function(){return this.get("unlimited")===!0},setUnlimited:function(e){e=!!e;if(this.get("unlimited")===e)return;var t;e?(this._oldQuantity=this.get("quantity"),t=null):(t=this._oldQuantity||0,delete this._oldQuantity),this.set({unlimited:e,quantity:t})}});return n}),define("tictail/collection/store/product/variation",["../../../core","../../../model/store/product/variation"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Collection=n.TT.Collection||{},n.TT.Collection.Store=n.TT.Collection.Store||{},n.TT.Collection.Store.Product=n.TT.Collection.Store.Product||{};var r=n.TT.Collection.Store.Product.Variation=e.Collection.extend({model:t});return r}),define("tictail/model/store/product/image",["underscore","../../../core"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Model=n.TT.Model||{},n.TT.Model.Store=n.TT.Model.Store||{},n.TT.Model.Store.Product=n.TT.Model.Store.Product||{};var r=n.TT.Model.Store.Product.Image=t.Model.extend({initialize:function(e,t){r.__super__.initialize.call(this,e,t),this.toDelete=!1},toJSON:function(){var t=this,n={};return e.each(["id","filename","extension","width","height"],function(e){n[e]=t.get(e)}),n}});return r}),define("tictail/collection/store/product/image",["underscore","../../../core","../../../model/store/product/image"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{},r.TT.Collection.Store=r.TT.Collection.Store||{},r.TT.Collection.Store.Product=r.TT.Collection.Store.Product||{};var i=r.TT.Collection.Store.Product.Image=t.Collection.extend({model:n,initialize:function(e,t){i.__super__.initialize.call(this,e,t),this.toDelete=[],this.toCreate=[],this.reposition=!1},getByFilename:function(e){return this.where({filename:e})},add:function(t,n){var r=this,s=i.__super__.add;t=e.isArray(t)?t.slice():[t],e.each(t,function(e,t){s.call(r,e,n),e.id||r.toCreate.push(e.cid)})}});return i}),define("tictail/model/store/product/base",["underscore","../../../core","../../../collection/store/product/variation","../../../collection/store/product/image","./variation","./image"],function(e,t,n,r,i,s){var o=this;o.TT=o.TT||{},o.TT.Model=o.TT.Model||{},o.TT.Model.Store=o.TT.Model.Store||{};var u=o.TT.Model.Store.Product=t.Model.extend({API_NAMESPACE:"store.product",statusUnpublished:0,statusPublished:1,initialize:function(t,o){u.__super__.initialize.call(this,t,o);var a=[];e.isUndefined(t.primary_image)===!1&&a.push(new s(t.primary_image)),this.images=new r(a);if(e.isUndefined(this.id)!==!0)return;this.variations=new n([new i({unlimited:!0})])},toJSON:function(t){var n=u.__super__.toJSON.call(this);return e.isUndefined(this.variations)!==!0&&(n.variations=this.variations.toJSON()),e.isUndefined(this.images)===!1&&(n.images=this.images.toJSON()),n},isOnline:function(){return this.get("status")===this.statusPublished},setIsOnline:function(e){this.set("status",e?this.statusPublished:this.statusUnpublished)},getVariations:function(){return this.variations},setVariations:function(e){this.variations=e},isInNavigationItem:function(t){var n=this.get("navigation_ids")||[];return e.indexOf(n,t)!==-1},addToNavigationItems:function(t,n){e.isArray(t)||(t=[t]);var r=this.get("navigation_ids")||[];r=e.union(r,t),this.set({navigation_ids:r},n)},removeFromNavigationItems:function(t,n){e.isArray(t)||(t=[t]);var r=this.get("navigation_ids")||[];r=e.without.apply(e,[r].concat(t)),this.set({navigation_ids:r},n)},getDefaultParams:function(){return{store_id:this.get("store_id")}},getReadParams:function(e){return{slug:decodeURIComponent(this.get("slug")),published:this.get("published")}},getDeleteParams:function(e){return{id:this.id}},set:function(t,i,s){var o;e.isObject(t)||t===null?(o=t,s=i):(o={},o[t]=i);var a=e.pick(o,["id","created_at","modified_at","description","position","price","status","store_id","title","url","url_title","slug","published","navigation_ids"]);e.isUndefined(o.images)===!1&&(this.images=new r(o.images),delete o.images);var f=o.variations;return e.isUndefined(f)!==!0&&(this.variations=f=new n(f),delete o.variations),u.__super__.set.call(this,a,s),this}});return u}),define("tictail/collection/store/product/base",["underscore","../../../core","../../../model/store/product/base"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{},r.TT.Collection.Store=r.TT.Collection.Store||{};var i=r.TT.Collection.Store.Product=t.Collection.extend({API_ACTIONS:{read:"store.product.search"},model:n,API_METHOD_ABORT:{create:!0,"delete":!0,update:!0},initialize:function(t,n){if(e.isUndefined(n.storeId))throw new Error("No store identifier given in store shipping collection");e.isUndefined(n.published)&&(n.published=!1),this.storeId=n.storeId,this.published=n.published,this.positionOffset=0},reset:function(e,t){return this.positionOffset=0,i.__super__.reset.call(this,e,t),this},getDefaultParams:function(){return{store_id:this.storeId,published:this.published,limit:1e4}}});return i}),define("tictail/collection/store/product/search",["./base"],function(e){var t=this;t.TT=t.TT||{},t.TT.Collection=t.TT.Collection||{},t.TT.Collection.Store=t.TT.Collection.Store||{},t.TT.Collection.Store.Product=t.TT.Collection.Store.Product||{};var n=t.TT.Collection.Store.Product.Search=e.extend({API_ACTIONS:{read:"store.product.search"},initialize:function(){n.__super__.initialize.apply(this,arguments),this.query=""},getQuery:function(){return this.query},setQuery:function(e,t){if(e===this.query)return;this.query=e,t!==!1&&this.reset()},getDefaultParams:function(){return{store_id:this.storeId,published:this.published,query:this.query}}});return n}),define("tictail/model/store/navigation",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Navigation=e.Model.extend({API_NAMESPACE:"store.navigation",getDefaultParams:function(){return{store_id:this.get("store_id"),id:this.get("id")}},toJSON:function(){var e=n.__super__.toJSON.apply(this,arguments);return delete e.used_by,e}});return n}),define("tictail/collection/store/navigation",["underscore","../../core","../../model/store/navigation"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{},r.TT.Collection.Store=r.TT.Collection.Store||{};var i=r.TT.Collection.Store.Navigation=t.Collection.extend({API_ACTIONS:{read:"store.navigation.get.many"},model:n,initialize:function(t,n){if(e.isUndefined(n.storeId))throw new Error("No store identifier given in store shipping collection");this.storeId=n.storeId,this.comparator=function(e){return e.get("position")||0}},getDefaultParams:function(){return{store_id:this.storeId}},getChildrenForItem:function(e){return this.where({parent_id:e||0})}});return i}),define("tictail/model/store/app",["underscore","../../core","../../utility","../../mediator","../../component/api","../../component/log"],function(e,t,n,r,i,s){var o=this;o.TT=o.TT||{},o.Dashboard=o.Dashboard||{},o.TT.Model=o.TT.Model||{},o.TT.Model.Store=o.TT.Model.Store||{};var u=o.TT.Model.Store.App=t.Model.extend({API_NAMESPACE:"store.app",API_ACTIONS:{read:"appstore.apps.get_by_namespace"},getReadParams:function(){return{store_id:this.get("store_id"),namespace:this.get("namespace")}},getDefaultParams:function(){return{store_id:this.get("store_id"),id:this.get("id")}},uninstall:function(e){var n=t.session.getCurrentStore().id,s=this;if(this.get("is_installed")&&window.confirm("Are you sure? "+this.get("name")+" will be completely disabled")){var o={store_id:n,app_id:this.get("id")},u=new i.Request("store.app.uninstall",o,"POST");u.setOnSuccess(function(){s.set("is_installed",!1),r.publish("app.removed",s),e&&e()}),u.send()}},getPath:function(){var e=Dashboard.getCurrentPathComponents();return"app/"+this.get("namespace")+e.query},getExternalPath:function(){var e=t.session.getCurrentStore().get("subdomain"),n=window.location.origin||window.location.protocol+"//"+window.location.host;return n+"/dashboard/store/"+e+"/"+this.getPath()+"/redirect"}});return u}),define("tictail/collection/store/app",["underscore","../../core","../../model/store/app"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{},r.TT.Collection.Store=r.TT.Collection.Store||{};var i=r.TT.Collection.Store.App=t.Collection.extend({API_ACTIONS:{read:"appstore.apps.list"},model:n,API_METHOD_ABORT:{create:!0,"delete":!0,update:!0},initialize:function(t,n){if(e.isUndefined(n.storeId))throw new Error("No store identifier given in store app collection");this.storeId=n.storeId},getDefaultParams:function(){return{store_id:this.storeId}}});return i}),define("tictail/model/store/legal",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Legal=e.Model.extend({API_NAMESPACE:"store.settings.legal"});return n}),define("tictail/model/store/base",["underscore","../../core","../../mediator","../../component/log","../../collection/feed","../../collection/theme","../../collection/store/shipping","../../collection/store/order","../../collection/store/product/base","../../collection/store/product/search","../../collection/store/navigation","../../collection/store/app","../../model/store/order","../../model/store/legal","../../model/store/product/base"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=this;v.TT=v.TT||{},v.TT.Model=v.TT.Model||{};var m=v.TT.Model.Store=t.Model.extend({relations:{legal:{attribute:"legal",getInstance:"getLegalModel"},shipping:{attribute:"shipping",getInstance:"getShippingCollection"},orders:{attribute:"orders",getInstance:"getOrderCollection",modelClass:h},products:{attribute:"products",getInstance:"getProductCollection"},feed:{attribute:"feed",getInstance:"getFeedCollection"},theme:{attribute:"theme",getInstance:"getThemeCollection"},products_search:{attribute:"products_search",getInstance:"getProductSearchCollection"},navigation:{attribute:"navigation",getInstance:"getNavigationCollection"}},cachedInstances:{},getRequiredId:function(){if(this.has("id")!==!0)throw new Error("Missing store identifier");return this.get("id")},getRequiredRelationship:function(t){var n=this.relations[t];if(e.isUndefined(n))throw new Error("No relationship exists to "+t);return n},hasForeignAttribute:function(t){var n=this.getForeignAttribute(t),i=e.isUndefined(n)!==!0;return r.info("Has foreign attribute of type",t,":",i),i},getForeignAttribute:function(e){var t=this.getRequiredRelationship(e),n=this[t.attribute];return r.debug("Foreign attribute of type",e,"contains",n),n},getInitiatedForeignAttribute:function(t){var n=this.getForeignAttribute(t);if(e.isObject(n)!==!1)return n;var i=this.getRequiredId(),s=this.getRequiredRelationship(t),o=this[s.getInstance];r.debug("Foreign attribute initializer callback of type",t,"is",o);if(e.isUndefined(o))throw new Error("Cannto get foreign attribute instance initiator");n=o(i);var u=o(i);return this[s.attribute]=u,r.info("Initialized foreign attribute of type",t,"with the instance",u),u},triggerForeignLoaded:function(e){var t=this.getForeignAttribute(e),n=this.getForeignEventName(e,"loaded");r.info("Will trigger the",n,"event for foreign type",e),this.trigger(n,t)},loadForeign:function(e){var t=this.getForeignFetchRequest(e);if(t===!1){r.info("Foreign type",e,"had already been initialized and loaded"),this.triggerForeignLoaded(e);return}r.info("Load foreign type ",e,"with the request",t),t.send()},loadForeignInstance:function(t,n,i,s,o){n=e.isUndefined(n)?t:n,s=s!==!1?!0:!1,o=o||{},r.info("Load foreign instance of type",t,"with the reference",i);var u=this,a=t+".model.loaded",f=function(e){r.info("Trigger the onload event for foreign instance retrieval of type "+t+" with identifier",i),r.info("Trigger ",a,"for foreign type",t,"with instance",e),u.trigger(a,e)},l=this.getForeignAttribute(n);if(s&&e.isUndefined(l)!==!0){var c,h=o.getFromCollection;e.isFunction(h)!==!1?(h=e.bind(h,this),c=h(l,i)):c=l.get(i)}var p,d=o.getModelInstance;if(e.isFunction(d)){d=e.bind(d,this),p=d(i);if(p===!1)return}else{var v=this.getRequiredRelationship(n),m=v.modelClass;if(e.isUndefined(m)!==!1)throw new Error("Cannot retrieve instance of type "+t+" since their is no corresponding model");p=new m({store_id:this.id,id:i})}var g=p.getFetchRequest();r.info("Retrieve foreign reference of type",t,"using the constructed instance model",p,"and the prepared API request",g),g.setOnSuccess(function(e){p.set(e),r.info("Retrieved foreign store reference from API",p),u.trigger(a,p)});var y=t+".model.error";g.setOnError(function(){r.info("Caught an API error when attempting to retrieve foreign type ",t);var e=Array.prototype.slice.call(arguments);e.splice(0,0,y),u.trigger.apply(u.trigger,e)}),g.send()},cacheForeignInstance:function(t,n,i){var s=this.cachedInstances;e.isUndefined(s[t])!==!1&&(s[t]={}),r.info("Cache foreign instance of type",t,"with the instance",i),s[t][n]=i},getForeignEventName:function(e,t){return e+"."+t},getCachedForeignFetchRequest:function(e){return this.hasForeignAttribute(e)?(r.info("No need to load foreign reference of type "+e+" since it is already loaded"),!1):this.getForeignFetchRequest(e)},getForeignFetchRequest:function(r){var i=this.getRequiredRelationship(r),s=function(t,n,s){if(s===!0&&e.isUndefined(i[n]))throw new Error("Could not find required callback with name "+n);var o=this,u=this[i[n]],a=this.getForeignEventName(r,t);return function(){e.isUndefined(u)!==!0&&u.apply(o,arguments);var t=Array.prototype.slice.call(arguments);t.splice(0,0,a),o.trigger.apply(o,t)}};s=e.bind(s,this);var o=this,u=t.getLazy(i,"instance-"+this.id,function(){return o.getInitiatedForeignAttribute(r)}),a=o.getForeignEventName,f=u.getFetchRequest();return n.subscribe(f.getEventName("success"),function(){var e=s("success","onSuccess").apply(o,arguments);o.triggerForeignLoaded(r)},f),n.subscribe(f.getEventName("error"),s("error","onError"),f),n.subscribe(f.getEventName("sending"),s("sending","onSending"),f),n.subscribe(f.getEventName("http.error"),s("http.error","onHTTPError"),f),f},loadOrder:function(t){t=parseInt(t,10);if(e.isNumber(t)!==!0)throw new Error("Cannot retrieve order since given identifier is incorrect");this.loadForeignInstance("order","orders",t,!1)},loadProduct:function(e){this.loadForeignInstance("product","products",e,!0,{getFromCollection:function(e,t){return e.where({url:"/product/"+t})},getModelInstance:function(e){return new d({store_id:this.id,slug:e,published:!1})}})},getShippingCollection:function(e){return new o([],{storeId:e})},getOrderCollection:function(e){return new u([],{storeId:e})},getProductCollection:function(e){return new a([],{storeId:e,published:!1})},getProductSearchCollection:function(e){return new f([],{storeId:e,published:!1})},getLegalModel:function(e){return new p({store_id:e})},getFeedCollection:function(e){return new i([],{storeId:e})},getThemeCollection:function(){return new s([])},getNavigationCollection:function(e){return new l([],{storeId:e})},getAppCollection:function(e){return new c([],{storeId:e})}});return m}),define("tictail/collection/store/base",["../../core","../../model/store/base"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Collection=n.TT.Collection||{};var r=n.TT.Collection.Store=e.Collection.extend({model:t});return r}),define("tictail/model/user/facebook",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.User=t.TT.Model.User||{};var n=t.TT.Model.User.Facebook=e.Model.extend({API_NAMESPACE:"social.facebook.user"});return n}),define("tictail/model/user/twitter",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.User=t.TT.Model.User||{};var n=t.TT.Model.User.Twitter=e.Model.extend({API_NAMESPACE:"social.twitter.user"});return n}),define("tictail/component/session",["jquery","underscore","../core","../collection/store/base","../model/user/facebook","../model/user/twitter","jquery-cookie"],function(e,t,n,r,i,s){var o=this;o.TT=o.TT||{};var u=o.TT.Session=function(e){return e.length===0?this:(this.data=t.isString(e)?JSON.parse(e):e,this.authenticated=!1,this.has("storekeeper")?(this.setStorekeeper(this.data.storekeeper),this.setSocial(this.data.social),this):this)};return u.prototype={get:function(e,t){var n=this.data[e];return n!==undefined?n:t},has:function(e){return this.data[e]!==undefined},getStorekeeper:function(){return this.get("storekeeper")},getStoreBySubdomain:function(e){var n=this.getStorekeeper().stores,r=n.where({subdomain:e});return r.length!==0?t.first(r):null},setStorekeeper:function(e){e.stores=this.initStores(e.stores),this.data.storekeeper=e,this.authenticated=!0},setSocial:function(e){this.social=this.social||{},this.social.facebook=new i(e.facebook),this.social.twitter=new s(e.twitter)},setCurrentStoreId:function(e){var t=this.getCurrentStore();t&&t.off(),e=parseInt(e,10);var r=this.getStorekeeper().stores.get(e);if(r===undefined)throw new Error("Current session does not include given store");this.getStorekeeper()._currentStoreId=r.id,n.localStorage.setItem("currentStoreId",r.id)},setCurrentStoreBySubdomain:function(e){var t=this.getStoreBySubdomain(e);if(!t)throw new Error("No store found with given subdomain: "+e);this.setCurrentStoreId(t.id)},hasAuthCookie:function(){return!e.cookie(this.get("auth_cookie"))},hasStore:function(e){var t=this.getStoreBySubdomain(e);return t!==null},initStores:function(e){var i=t.sortBy(e,function(e){return e.name});e=new r(i);var s=n.localStorage.getItem("currentStoreId");if(s===null||t.isUndefined(e.get(s)))s=e.at(0).id;return this.getStorekeeper()._currentStoreId=s,e},getCurrentStore:function(){return this.getStorekeeper().stores.get(this.getStorekeeper()._currentStoreId)}},u}),function(e,t){function l(e){return f.PF.compile(e||"nplurals=2; plural=(n != 1);")}function c(e,t){this._key=e,this._i18n=t}var n=Array.prototype,r=Object.prototype,i=n.slice,s=r.hasOwnProperty,o=n.forEach,u={},a={forEach:function(e,t,n){var r,i,a;if(e===null)return;if(o&&e.forEach===o)e.forEach(t,n);else if(e.length===+e.length){for(r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e)===u)return}else for(a in e)if(s.call(e,a)&&t.call(n,e[a],a,e)===u)return},extend:function(e){return this.forEach(i.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e}},f=function(e){this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"},this.options=a.extend({},this.defaults,e),this.textdomain(this.options.domain);if(e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};f.context_delimiter=String.fromCharCode(4),a.extend(c.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return{}.toString.call(e)!="[object Array]"&&(e=[].slice.call(arguments)),(e&&e.length?f.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),a.extend(f.prototype,{translate:function(e){return new c(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,t,t,e)},dgettext:function(e,n){return this.dcnpgettext.call(this,e,t,n)},dcgettext:function(e,n){return this.dcnpgettext.call(this,e,t,n)},ngettext:function(e,n,r){return this.dcnpgettext.call(this,t,t,e,n,r)},dngettext:function(e,n,r,i){return this.dcnpgettext.call(this,e,t,n,r,i)},dcngettext:function(e,n,r,i){return this.dcnpgettext.call(this,e,t,n,r,i)},pgettext:function(e,n){return this.dcnpgettext.call(this,t,e,n)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,n,r,i){return this.dcnpgettext.call(this,t,e,n,r,i)},dnpgettext:function(e,t,n,r,i){return this.dcnpgettext.call(this,e,t,n,r,i)},dcnpgettext:function(e,t,n,r,i){r=r||n,e=e||this._textdomain,i=typeof i=="undefined"?1:i;var s;if(!this.options)return s=new f,s.dcnpgettext.call(s,undefined,undefined,n,r,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");if(typeof i!="number"){i=parseInt(i,10);if(isNaN(i))throw new Error("The number that was passed in is not a number.")}var o=t?t+f.context_delimiter+n:n,u=this.options.locale_data,a=u[e],c=a[""].plural_forms||(u.messages||this.defaults.locale_data.messages)[""].plural_forms,h=l(c)(i)+1,p,d;if(!a)throw new Error("No domain named `"+e+"` could be found.");return p=a[o],!p||h>=p.length?(this.options.missing_key_callback&&this.options.missing_key_callback(o),d=[null,n,r],d[l(c)(i)+1]):(d=p[h],d?d:(d=[null,n,r],d[l(c)(i)+1]))}});var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i=1,s=n.length,o="",u,a=[],f,l,c,p,d,v;for(f=0;f<s;f++){o=e(n[f]);if(o==="string")a.push(n[f]);else if(o==="array"){c=n[f];if(c[2]){u=r[i];for(l=0;l<c[2].length;l++){if(!u.hasOwnProperty(c[2][l]))throw h('[sprintf] property "%s" does not exist',c[2][l]);u=u[c[2][l]]}}else c[1]?u=r[c[1]]:u=r[i++];if(/[^s]/.test(c[8])&&e(u)!="number")throw h("[sprintf] expecting number but found %s",e(u));if(typeof u=="undefined"||u===null)u="";switch(c[8]){case"b":u=u.toString(2);break;case"c":u=String.fromCharCode(u);break;case"d":u=parseInt(u,10);break;case"e":u=c[7]?u.toExponential(c[7]):u.toExponential();break;case"f":u=c[7]?parseFloat(u).toFixed(c[7]):parseFloat(u);break;case"o":u=u.toString(8);break;case"s":u=(u=String(u))&&c[7]?u.substring(0,c[7]):u;break;case"u":u=Math.abs(u);break;case"x":u=u.toString(16);break;case"X":u=u.toString(16).toUpperCase()}u=/[def]/.test(c[8])&&c[3]&&u>=0?"+"+u:u,d=c[4]?c[4]=="0"?"0":c[4].charAt(1):" ",v=c[6]-String(u).length,p=c[6]?t(d,v):"",a.push(c[5]?u+p:p+u)}}return a.join("")},n.cache={},n.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw"[sprintf] huh?";s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw"[sprintf] huh?";s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}(),p=function(e,t){return t.unshift(e),h.apply(null,t)};f.parse_plural=function(e,t){return e=e.replace(/n/g,t),f.parse_expression(e)},f.sprintf=function(e,t){return{}.toString.call(t)=="[object Array]"?p(e,[].slice.call(t)):h.apply(this,[].slice.call(arguments))},f.prototype.sprintf=function(){return f.sprintf.apply(this,arguments)},f.PF={},f.PF.parse=function(e){var t=f.PF.extractPluralExpr(e);return f.PF.parser.parse.call(f.PF.parser,t)},f.PF.compile=function(e){function t(e){return e===!0?1:e?e:0}var n=f.PF.parse(e);return function(e){return t(f.PF.interpreter(n)(e))}},f.PF.interpreter=function(e){return function(t){var n;switch(e.type){case"GROUP":return f.PF.interpreter(e.expr)(t);case"TERNARY":if(f.PF.interpreter(e.expr)(t))return f.PF.interpreter(e.truthy)(t);return f.PF.interpreter(e.falsey)(t);case"OR":return f.PF.interpreter(e.left)(t)||f.PF.interpreter(e.right)(t);case"AND":return f.PF.interpreter(e.left)(t)&&f.PF.interpreter(e.right)(t);case"LT":return f.PF.interpreter(e.left)(t)<f.PF.interpreter(e.right)(t);case"GT":return f.PF.interpreter(e.left)(t)>f.PF.interpreter(e.right)(t);case"LTE":return f.PF.interpreter(e.left)(t)<=f.PF.interpreter(e.right)(t);case"GTE":return f.PF.interpreter(e.left)(t)>=f.PF.interpreter(e.right)(t);case"EQ":return f.PF.interpreter(e.left)(t)==f.PF.interpreter(e.right)(t);case"NEQ":return f.PF.interpreter(e.left)(t)!=f.PF.interpreter(e.right)(t);case"MOD":return f.PF.interpreter(e.left)(t)%f.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},f.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t=/nplurals\=(\d+);/,n=/plural\=(.*);/,r=e.match(t),i={},s;if(r.length>1){i.nplurals=r[1],e=e.replace(t,""),s=e.match(n);if(!(s&&s.length>1))throw new Error("`plural` expression not found: "+e);return s[1]}throw new Error("nplurals not found in plural_forms string: "+e)},f.PF.parser=function(){var e={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:return{type:"GROUP",expr:o[a-1]};case 2:this.$={type:"TERNARY",expr:o[a-4],truthy:o[a-2],falsey:o[a]};break;case 3:this.$={type:"OR",left:o[a-2],right:o[a]};break;case 4:this.$={type:"AND",left:o[a-2],right:o[a]};break;case 5:this.$={type:"LT",left:o[a-2],right:o[a]};break;case 6:this.$={type:"LTE",left:o[a-2],right:o[a]};break;case 7:this.$={type:"GT",left:o[a-2],right:o[a]};break;case 8:this.$={type:"GTE",left:o[a-2],right:o[a]};break;case 9:this.$={type:"NEQ",left:o[a-2],right:o[a]};break;case 10:this.$={type:"EQ",left:o[a-2],right:o[a]};break;case 11:this.$={type:"MOD",left:o[a-2],right:o[a]};break;case 12:this.$={type:"GROUP",expr:o[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(t)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(t,n){throw new Error(t)},parse:function(t){function d(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function v(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var m,g,y,b,w,E,S={},x,T,N,C;for(;;){y=r[r.length-1],this.defaultActions[y]?b=this.defaultActions[y]:(m==null&&(m=v()),b=o[y]&&o[y][m]);if(typeof b=="undefined"||!b.length||!b[0]){if(!l){C=[];for(x in o[y])this.terminals_[x]&&x>2&&C.push("'"+this.terminals_[x]+"'");var k="";this.lexer.showPosition?k="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+C.join(", ")+", got '"+this.terminals_[m]+"'":k="Parse error on line "+(a+1)+": Unexpected "+(m==1?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:p,expected:C})}if(l==3){if(m==h)throw new Error(k||"Parsing halted.");f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,m=v()}for(;;){if(c.toString()in o[y])break;if(y==0)throw new Error(k||"Parsing halted.");d(1),y=r[r.length-1]}g=m,m=c,y=r[r.length-1],b=o[y]&&o[y][c],l=3}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+m);switch(b[0]){case 1:r.push(m),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(b[1]),m=null,g?(m=g,g=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:T=this.productions_[b[1]][1],S.$=i[i.length-T],S._$={first_line:s[s.length-(T||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(T||1)].first_column,last_column:s[s.length-1].last_column},E=this.performAction.call(S,u,f,a,this.yy,b[1],i,s);if(typeof E!="undefined")return E;T&&(r=r.slice(0,-1*T*2),i=i.slice(0,-1*T),s=s.slice(0,-1*T)),r.push(this.productions_[b[1]][0]),i.push(S.$),s.push(S._$),N=o[r[r.length-2]][r[r.length-1]],r.push(N);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e;var t=e.match(/\n/);return t&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r;this._more||(this.yytext="",this.match="");var i=this._currentRules();for(var s=0;s<i.length;s++){t=this._input.match(this.rules[i[s]]);if(t){r=t[0].match(/\n.*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,i[s],this.conditionStack[this.conditionStack.length-1]);if(e)return e;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},e.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],e.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}},e}();return e.lexer=t,e}(),typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=f),exports.Jed=f):(typeof define=="function"&&define.amd&&define("thirdparty/jed",[],function(){return f}),e.Jed=f)}(this),define("tictail/component/i18n",["thirdparty/jed","tictail/component/log","json2"],function(e,t){var n={};return n.friendlyNames={en:"English",sv:"Swedish",fr:"French"},n.defaultLanguage="en",n.supportedLanguages=["en","sv"],n.validDomains=["payment","themes","core","storefront"],n.setLanguage=function(e,n,r){var i=this,s={domain:n,locale_data:{}};if(!this.isLangSupported(e)||!this.validateDomain(n))return t.debug("Language or domain not found - falling back"),s.locale_data[n]={"":{domain:n}},this.init(s,r);t.debug("Setting language to "+e);var o="/static/js/i18n/"+e+"_"+n+".json";require(["text!"+o],function(e){return s.locale_data[n]=JSON.parse(e),i.init(s,r)})},n.isLangSupported=function(e){return e===this.defaultLanguage?!1:_.indexOf(this.supportedLanguages,e)>=0},n.validateDomain=function(e){return _.indexOf(this.validDomains,e)>=0},n.init=function(t,r){n._jed=new e(t),window.gettext=_.bind(n._jed.gettext,n._jed),window.sprintf=_.bind(n._jed.sprintf,n._jed);if(typeof r=="function")return r()},n}),define("tictail/model/experiment",["../core"],function(e){var t=e.Model.extend({API_NAMESPACE:"experiment"});return t}),define("tictail/collection/experiment",["underscore","../core","../model/experiment"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Collection=r.TT.Collection||{};var i=r.TT.Collection.Feed=t.Collection.extend({API_ACTIONS:{read:"experiment.get_participations"},model:n,API_METHOD_ABORT:{create:!0,"delete":!0,update:!0}});return i}),function(){function n(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function r(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s))&&n.push(s)}function i(e,n,r){for(var i in n)!(i in t)&&(!(i in e)||r)&&(e[i]=n[i])}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,t={};define("i18n",{version:"1.0.0",load:function(t,s,o,u){u=u||{};var a,f=e.exec(t),l=f[1],c=f[4],h=f[5],p=c.split("-"),d=[],v={},m,g,y="";f[5]?(l=f[1],a=l+h):(a=t,h=f[4],c=u.locale||(u.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),p=c.split("-"));if(u.isBuild){d.push(a),r(s,"root",d,l,h);for(m=0;g=p[m];m++)y+=(y?"-":"")+g,r(s,y,d,l,h);s(d,function(){o()})}else s([a],function(e){var t=[];n("root",e,t,d,l,h);for(m=0;g=p[m];m++)y+=(y?"-":"")+g,n(y,e,t,d,l,h);s(d,function(){var n,r;for(n=t.length-1;n>-1&&(g=t[n]);n--){r=e[g];if(r===!0||r===1)r=s(l+g+"/"+h);i(v,r)}o(v)})})}})}(),define("dashboard/nls/core",{root:{price_in_currency:"Price in ",feedback:{saved:"Saved!"}}}),define("dashboard/model/store/base",["tictail/model/store/base","i18n!../../nls/core"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Model=n.Dashboard.Model||{};var r=n.Dashboard.Model.Store=e.extend({API_NAMESPACE:"store",API_METHOD_ABORT:{create:!0,"delete":!0},getPriceLabel:function(){return t.price_in_currency+this.get("currency")},generateUrl:function(e){return r.generateStoreUrl(this,e)},shouldShowMetrics:function(){return this.get("online")}},{generateStoreUrl:function(e,t){return"store/"+e.get("subdomain")+t},generateCurrentStoreUrl:function(e){return r.generateStoreUrl(TT.session.getCurrentStore(),e)},generateCurrentBaseUrl:function(e){return"/dashboard/"+this.generateCurrentStoreUrl(e)},generateStoreUrlById:function(e,t){var n=TT.session.stores.get(e);return r.generateStoreUrl(n,t)},getStoreSubdomainByUrlPath:function(){var e=Dashboard.getCurrentPath();e=e.replace("/dashboard/store/","");var t=e.search("/");return t>0?e.slice(0,t):e}},e);return r}),function(e){typeof module=="function"?module.exports=e(this.jQuery||require("jquery")):typeof define=="function"&&define.amd?define("thirdparty/nprogress",["jquery"],function(t){return e(t)}):this.NProgress=e(this.jQuery)}(function(e){function r(e,t,n){return e<t?t:e>n?n:e}function i(e){return(-1+e)*100}function s(e,t,r){var s;return n.positionUsing==="translate3d"?s={transform:"translate3d("+i(e)+"%,0,0)"}:n.positionUsing==="translate"?s={transform:"translate("+i(e)+"%,0)"}:s={"margin-left":i(e)+"%"},s.transition="all "+t+"ms "+r,s}var t={};t.version="0.1.2";var n=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};return t.configure=function(t){return e.extend(n,t),this},t.status=null,t.set=function(e){var i=t.isStarted();e=r(e,n.minimum,1),t.status=e===1?null:e;var o=t.render(!i),u=o.find('[role="bar"]'),a=n.speed,f=n.easing;return o[0].offsetWidth,o.queue(function(r){n.positionUsing===""&&(n.positionUsing=t.getPositioningCSS()),u.css(s(e,a,f)),e===1?(o.css({transition:"none",opacity:1}),o[0].offsetWidth,setTimeout(function(){o.css({transition:"all "+a+"ms linear",opacity:0}),setTimeout(function(){t.remove(),r()},a)},a)):setTimeout(r,a)}),this},t.isStarted=function(){return typeof t.status=="number"},t.start=function(){t.status||t.set(0);var e=function(){setTimeout(function(){if(!t.status)return;t.trickle(),e()},n.trickleSpeed)};return n.trickle&&e(),this},t.done=function(e){return!e&&!t.status?this:t.inc(.3+.5*Math.random()).set(1)},t.inc=function(e){var n=t.status;return n?(typeof e!="number"&&(e=(1-n)*r(Math.random()*n,.1,.95)),n=r(n+e,0,.994),t.set(n)):t.start()},t.trickle=function(){return t.inc(Math.random()*n.trickleRate)},function(){var e=0,n=0;t.promise=function(r){return!r||r.state()=="resolved"?this:(n==0&&t.start(),e++,n++,r.always(function(){n--,n==0?(e=0,t.done()):t.set((e-n)/e)}),this)}}(),t.render=function(r){if(t.isRendered())return e("#nprogress");e("html").addClass("nprogress-busy");var s=e("<div id='nprogress'>").html(n.template),o=r?"-100":i(t.status||0);return s.find('[role="bar"]').css({transition:"all 0 linear",transform:"translate3d("+o+"%,0,0)"}),n.showSpinner||s.find('[role="spinner"]').remove(),s.appendTo(document.body),s},t.remove=function(){e("html").removeClass("nprogress-busy"),e("#nprogress").remove()},t.isRendered=function(){return e("#nprogress").length>0},t.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"},t}),define("dashboard/view",["jquery","underscore","tictail/core","tictail/view","tictail/mediator","tictail/utility","./model/store/base"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{};var a=u.Dashboard.View=r.extend({initialize:function(e){a.__super__.initialize.call(this,e),this.isReady=!0},getCurrentStore:function(){return n.session.getCurrentStore()},navigate:function(e,n){n=t.extend({trigger:!0},n),n.relative!==!1&&(e=o.generateCurrentStoreUrl(e)),Dashboard.router.navigate(e,n)},bindOnClick:function(t,n,r){r!==!1&&(r=!0);var i=this.getCurrentStore().generateUrl(n);e(t).click(function(e){e.preventDefault(),Dashboard.router.navigate(i,{trigger:r})})},getLoadingSpinner:function(){return n.getLazy(this,"loadingSpinner",function(){var t=e("<div/>").attr("id","page-load-spinner");return t.spin(),t})},setLoadingSpinner:function(){this.isReady=!1,i.publish("page.loading");var e=this.getLoadingSpinner();e.clearQueue().fadeIn(400),this.$el.append(e)},removeLoadingSpinner:function(){this.setReady(),this.getLoadingSpinner().remove()},setFriendlyTimestamps:function(e){var t=s.generateTimeNode;this.handleContentTag("time",e,function(e){e.replaceWith(t(parseInt(e.html())))})},setLinkWatchers:function(e){this.handleContentTag("a",e,function(e){e.click(function(t){t.preventDefault();var r=e.attr("href");if(r[0]!=="/"){var i=n.session.getCurrentStore();r=i.generateUrl("/"+r)}Dashboard.router.navigate(r,{trigger:!0})})})},handleContentTag:function(t,n,r){var i,s=e(t,n);s.each(function(t,n){i=e(n),i.hasClass("manual")!==!0&&r(i)})},prepareContent:function(e){a.__super__.prepareContent.call(this,e),this.setFriendlyTimestamps(e),this.setLinkWatchers(e)},setReady:function(){i.publish("page.ready"),this.isReady=!0}});return a}),function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(){var e,n,r=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.noConflict=r(this.noConflict,this),this._TT=window.TT}return e.prototype.noConflict=function(){return window.TT=this._TT,this},e}(),n=new e,typeof define=="function"&&define.amd?define("tt-core",function(){return n}):window.TT=n,t.exports=n}).call(this)},{}],2:[function(e,t,n){(function(){var t,n,r=function(e,t){return function(){return e.apply(t,arguments)}},i=[].slice;n=e("./tt-core"),t=function(){function e(){this.set=r(this.set,this),this.get=r(this.get,this)}return e.prototype._parse=function(e){var t;try{return JSON.parse(e)||{}}catch(n){return t=n,{}}},e.prototype.request=function(){var e;return e=$.Deferred(),setTimeout(function(){return e.resolve()},0),e},e.prototype.get=function(){var e,t,n=this;return e=1<=arguments.length?i.call(arguments,0):[],t=$.Deferred(),this.request().then(function(){var r,i,s,o,u;s=n._parse(localStorage["tt-storage"]),i={};for(o=0,u=e.length;o<u;o++)r=e[o],i[r]=s[r];return t.resolve(i)}),t},e.prototype.set=function(e){var t,n=this;return t=$.Deferred(),this.request().then(function(){var r,i,s;i=n._parse(localStorage["tt-storage"]);for(r in e)s=e[r],i[r]=s;return localStorage["tt-storage"]=JSON.stringify(i),t.resolve()}),t},e.prototype.remove=function(){var e,t,n=this;return e=1<=arguments.length?i.call(arguments,0):[],t=$.Deferred(),this.request().then(function(){var r,i,s,o;i=n._parse(localStorage["tt-storage"]);for(s=0,o=e.length;s<o;s++)r=e[s],delete i[r];return localStorage["tt-storage"]=JSON.stringify(i),t.resolve()}),t},e.prototype.clear=function(){var e,t=this;return e=$.Deferred(),this.request().then(function(){return delete localStorage["tt-storage"],e.resolve()}),e},e}(),typeof define=="function"&&define.amd?define("tt-storage",["jquery","tt-core"],function(e,n){return n.storage=new t}):n.storage=new t}).call(this)},{"./tt-core":1}]},{},[2]),define("dashboard/view/header/main",["jquery","underscore","icanhaz","tictail/core","tictail/mediator","tictail/component/log","tictail/component/tracker","../../model/store/base","../../view"],function(e,t,n,r,i,s,o,u,a){var f=this;f.Dashboard=f.Dashboard||{},f.Dashboard.View=f.Dashboard.View||{};var l=f.Dashboard.View.Header=a.extend({navigation:{},navigationParams:null,storeChooserTemplate:"module/storechooser",initialize:function(){s.info("Initialize dashboard layout"),l.__super__.initialize.call(this),this.accountListeners(r.session.getCurrentStore(),!0),this.initMediatorSubscriptions()},getAccountNode:function(){var e=this;return r.getLazy(this,"_accountNode",function(){return e.$("#account")})},initAccountEventListeners:function(){var e=this;this.$("#store-chooser a").click(function(t){e.didClickStorePicker(t)})},getTrackingNote:function(e,t){return"Switched from "+e+" to "+t},initMediatorSubscriptions:e.noop,changeStore:function(e){var t=r.session.getCurrentStore().get("subdomain");this.accountListeners(r.session.getCurrentStore(),!1),r.session.setCurrentStoreId(e);var n=r.session.getCurrentStore().get("subdomain");this.accountListeners(r.session.getCurrentStore(),!0),o.track("Switched Store",this.getTrackingNote(t,n)),this.renderAccount(),i.publish("store.changed",r.session.getCurrentStore())},accountListeners:function(e,t){var n="change:name change:subdomain change:domain change:online";e[t===!0?"on":"off"](n,this.renderAccount,this)},getTemplateData:function(){return this.getStoreChooserParams()},getStoreChooserParams:function(){var e=function(e){var t=e.search("://");return t!==-1&&(e=e.slice(t+3)),e},n,i,s,o=[],a=r.session.getStorekeeper().stores,f=r.session.getCurrentStore().id,l=u.generateCurrentStoreUrl("/themes");return a.forEach(function(r){n=t.clone(r.attributes),i=e(n.url),n.clean_url=i,n.isCurrent=!1,n.id===f&&(s=n,n.isCurrent=!0),o.push(n)}),{"multiple_stores?":o.length>1,stores:o,current_store:s,"current_store_online?":s.online,preview_url:"/dashboard/"+l}},renderAccount:function(){this.getAccountNode().html(n[this.storeChooserTemplate](this.getStoreChooserParams())),this.initAccountEventListeners()},didRender:function(){this.initAccountEventListeners()},didClickHomeButton:function(e){e.preventDefault(),f.Dashboard.router.navigate(u.generateCurrentStoreUrl("/home"),{trigger:!0})},didClickStorePicker:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.currentTarget),r=this.$("#store-chooser");r.toggleClass("open");if(n.hasClass("menu-button"))e("html").one("click",function(){r.removeClass("open")});else if(n.hasClass("store"))this.changeStore(n.attr("id").split("-")[1]);else if(n.hasClass("logout"))f.Dashboard.logout();else{var i=n.attr("href");f.Dashboard.router.navigate(i,{trigger:!0})}}});return l}),define("tictail/collection/store/installed_app",["./app"],function(e){var t=e.extend({API_ACTIONS:{read:"appstore.apps.list_installed"}});return t}),define("dashboard/view/header/app_launcher",["underscore","tt-storage","tictail/core","tictail/mediator","tictail/component/api","tictail/component/tracker","dashboard/model/store/base","./main","tictail/collection/store/installed_app"],function(e,t,n,r,i,s,o,u,a){var f=u.extend({DOCK_ITEM_SIZE:43,template:"header/app_launcher",storeChooserTemplate:"header/account",dockData:null,isSorting:!1,draggedItem:null,overflowItems:[],$dock:null,$dockClone:null,$mainNav:null,$overflowItem:null,$settings:null,events:function(){return{"click #dock a":"onClickDockItem","click .overflow-item":"onClickOverflowItem","mousedown #dock a":"onMouseDownDockItem","mouseover .tooltip-item":"onMouseOverTooltipItem","mouseout .tooltip-item":"onMouseOutTooltipItem","click #account .settings-button":"onClickSettingsButton","click #settings .dropdown":"onClickSettingsDropdown","click #settings .store-link":"onClickStoreLink","click #settings .settings-link":"onClickSettingsLink","click #settings .logout-link":"onClickLogoutLink","click #logo-container":"didClickHomeButton"}},initialize:function(){f.__super__.initialize.call(this),this.dockDataReady=this.getDockData()},initMediatorSubscriptions:function(){r.on("store.changed",e.bind(this.onStoreChanged,this)),r.on("app.installed",e.bind(this.onAppInstalled,this)),r.on("app.removed",e.bind(this.onAppRemoved,this)),r.on("navigate",e.bind(this.onDashboardNavigate,this))},render:function(){$.when(this.dockDataReady).then(e.bind(this.prepareDockData,this)).then(e.bind(f.__super__.render,this))},renderAccount:function(){this.render()},didRender:function(){f.__super__.didRender.apply(this,arguments),this.$mainNav=this.$("#main-nav"),this.$settings=this.$("#settings"),this.$overflowItem=this.$(".overflow-item"),this.highlightSettingsLink(n.history.fragment),e.defer(e.bind(this.initDockSorting,this)),this.removeNewInstallFlags(this.dockData[n.session.getCurrentStore().get("id")]),$(".new-install").on("animationend webkitAnimationEnd",function(){$(this).removeClass("new-install")})},getTemplateData:function(){var t={dock:this.dockData[n.session.getCurrentStore().get("id")]};return e.extend(t,f.__super__.getTemplateData.call(this)),t},getDockData:function(){var e=$.Deferred(),n=t.get("dockOrder"),r=new i.Request("dock.get",{},"GET");return r.setOnSuccess(function(t){e.resolve(t)}),r.send(),$.when(e,n)},prepareDockData:function(t,n){this.dockOrder=n.dockOrder||{},this.dockData=t;var r=this;e.each(this.dockData,function(e,t){r.dockData[t]=r.sortDockItems(e,r.dockOrder[t])})},sortDockItems:function(t,n){var r={},i=[];return e.each(t,function(e){r[e.id]=e}),e.each(n,function(e){var t=r[e];delete r[e],t&&i.push(t)}),e.each(r,function(e){i.push(e)}),i},appendAppToDock:function(t,n,r){n.push(e.extend({icon:t.get("icon_url"),id:"app."+t.get("id"),path:t.get("dashboard_url"),external:t.get("is_external"),title:t.get("name")},r))},removeNewInstallFlags:function(t){e.each(t,function(e){delete e.newInstall})},removeAppFromDock:function(e,t){for(var n=t.length-1;n>=0;n--)t[n].id==="app."+e.get("id")&&t.splice(n,1)},initDockSorting:function(){this.$dock=$("#dock"),this.createDockClone(),this.$dock.sortable({items:".item",tolerance:"intersect",delay:100,forcePlaceholderSize:!0,revert:!1,cursor:"",start:e.bind(this.onSortStart,this),sort:e.bind(this.onSort,this),change:e.bind(this.onSortChange,this),update:e.bind(this.onSortUpdate,this),out:e.bind(this.onSortOut,this)}),this.overflowDockItems(),$(window).on("resize",e.bind(this.overflowDockItems,this)),this.trigger("ready")},createDockClone:function(){this.$dockClone=this.$dockClone||$("<ul>").attr("id","dock-clone"),this.$dockClone.empty().detach();var e=this;this.getDockItems().each(function(){var t=$(this),n=t.clone();n.css(t.position()),t.data("clone",n),e.$dockClone.append(n)}),this.$dock.after(this.$dockClone)},moveDockCloneItems:function(){this.getDockItems().each(function(){var t=$(this),n=t.data("clone");if(!n)return;n.position().top!=t.position().top&&(n.addClass("cross-row"),setTimeout(e.bind(n.removeClass,n,"cross-row"),400)),n.css(t.position())})},getDockItems:function(){return this.$dock.find(".item:not(.dragged)")},onSortStart:function(t,n){this.draggedItem=n.helper.addClass("dragged"),$(this.draggedItem.data("clone")).addClass("dragged"),$("html").addClass("sorting-dock"),this.isSorting=!0,$(".new-install").removeClass("new-install"),$(document).one("mouseup",e.bind(this.onSortRevert,this))},onSortStop:function(t,n){var r=this.draggedItem.data("clone");r.css(this.draggedItem.position()),this.draggedItem.removeClass("dragged").css("visibility",""),e.defer(function(){r.removeClass("dragged reverting")}),$(".item.bounce-left, .item.bounce-right").removeClass("bounce-left bounce-right"),$("html").removeClass("sorting-dock reverting-sort"),this.isSorting=!1,this.setTooltipPosition($(".dock-tooltip.show"))},onSortOut:function(e,t){var n=$(".ui-sortable-placeholder");n.data("width",n.data("width")||n.css("width")).addClass("shrink").css("width",0),this.$dock.sortable("refreshPositions"),this.moveDockCloneItems(),this.updateOverflowPosition()},onSort:function(e,t){this.lastDraggedItemPosition=this.draggedItem.position()},onSortRevert:function(){var t=$(".ui-sortable-placeholder");t.removeClass("shrink").css("width",t.data("width")),this.$dock.sortable("refreshPositions"),this.moveDockCloneItems(),this.draggedItem.css({visibility:"hidden",top:""});var n=this.draggedItem.data("clone");n.css(this.lastDraggedItemPosition),$("html").addClass("reverting-sort");var r=this;e.defer(function(){n.addClass("reverting").css(r.draggedItem.position())}),this.bounceDockItems(),this.updateOverflowPosition(),setTimeout(e.bind(this.onSortStop,this),250)},onSortChange:function(e,t){var n=$(".ui-sortable-placeholder");n.removeClass("shrink").css("width",n.data("width")),this.moveDockCloneItems(),this.updateOverflowPosition()},onSortUpdate:function(e,t){var n=t.item.data("id"),r=t.item.find("a").data("title"),i=this.$dock.sortable("toArray",{attribute:"data-id"}),o=i.length,u=i.indexOf(n);s.track("Dock: Changed Order",r,{dock_item_id:n,dock_item_title:r,dock_item_position:u+1,dock_length:o}),this.updateDockOrder()},updateDockOrder:function(){return this.dockOrder[n.session.getCurrentStore().get("id")]=this.$dock.sortable("toArray",{attribute:"data-id"}),t.set({dockOrder:this.dockOrder})},bounceDockItems:function(){var e=this.lastDraggedItemPosition,t=this.draggedItem.position(),n={left:e.left-t.left,top:e.top-t.top},r=Math.sqrt(Math.pow(n.left,2)+Math.pow(n.top,2)),i=Math.abs(Math.atan(n.top/n.left)),s=n.left>0?"prev":"next",o=n.left>0?"left":"right";if(i>Math.PI/6||r<150)return;var u=this.draggedItem[s](".item");while(u.length)u.data("clone").addClass("bounce-"+o),u=u[s](".item")},showTooltip:function(t){if(this.isSorting)return;var n=$('<div class="dock-tooltip">').text(t.data("title")).appendTo("body");t.data("tooltip",n),n.data("item",t),this.setTooltipPosition(n),e.defer(e.bind(n.addClass,n,"show"))},setTooltipPosition:function(e){if(!e.length)return;var t=e.data("item");e.css({top:t.offset().top+t.outerHeight(),left:Math.floor(t.offset().left+t.outerWidth()/2-e.outerWidth()/2)})},hideTooltip:function(t){var n=t.data("tooltip");if(!n)return;n.removeClass("show"),n.remove(),setTimeout(e.bind(n.remove,n),100)},overflowDockItems:function(){if($("html").hasClass("show-overflow")||!this.$dock)return;var e=this,t=this.getDockItems(),n=t.length*this.DOCK_ITEM_SIZE,r=Math.floor(this.$mainNav.width()/this.DOCK_ITEM_SIZE);t.each(function(){e.moveFromOverflow($(this))}),t.length>r?(t.slice(r).each(function(){e.moveToOverflow($(this))}),this.setOverflowedItemsCount(t.length-r),this.updateOverflowPosition()):this.$overflowItem.hide(),this.moveDockCloneItems()},moveToOverflow:function(e){e.addClass("overflown");var t=e.data("clone");t&&e.data("clone").addClass("overflown")},moveFromOverflow:function(e){e.removeClass("overflown");var t=e.data("clone");t&&e.data("clone").removeClass("overflown")},setOverflowedItemsCount:function(e){this.$overflowItem.show().text("+"+e)},updateOverflowPosition:function(){this.$overflowItem.css("left",this.$dock.outerWidth())},onStoreChanged:function(){this.render()},onAppInstalled:function(t){this.appendAppToDock(t,this.dockData[n.session.getCurrentStore().get("id")],{newInstall:!0}),this.render(),this.overflowDockItems(),e.defer(e.bind(this.updateDockOrder,this))},onAppRemoved:function(t){this.removeAppFromDock(t,this.dockData[n.session.getCurrentStore().get("id")]),this.render(),this.overflowDockItems(),e.defer(e.bind(this.updateDockOrder,this))},onClickSettingsButton:function(e){var t=this.$settings.hasClass("open");e.preventDefault(),e.stopPropagation(),t?this.closeSettings():this.openSettings()},onClickSettingsDropdown:function(e){e.preventDefault(),e.stopPropagation()},onClickOverflowItem:function(e){var t=$("html").hasClass("show-overflow");t?this.closeOverflow():this.openOverflow()},openOverflow:function(){this.$dock.css("width",this.$dock.width()),$("html").addClass("show-overflow"),this.moveDockCloneItems();var t=this;e.defer(function(){$("#header").css("height",t.$dock.outerHeight()+7)}),$(window).on("resize.overflow-events",e.bind(this.closeOverflow,this))},closeOverflow:function(){$("#header").css("height",""),self=this,setTimeout(function(){$("html").removeClass("show-overflow"),self.$dock.css("width",""),self.overflowDockItems()},150),$(window).off(".overflow-events")},onClickStoreLink:function(e){var t=$(e.target).closest(".store-link").data("id");this.changeStore(t)},onClickSettingsLink:function(e){e.preventDefault(),Dashboard.router.navigate($(e.currentTarget).attr("href").substring(1),{trigger:!0}),this.closeSettings()},onClickLogoutLink:function(e){e.preventDefault(),this.closeSettings(),Dashboard.logout()},openSettings:function(){this.closeOverflow(),this.$settings.addClass("open"),$(document).one("click.settings-dropdown",e.bind(this.closeSettings,this))},closeSettings:function(){this.$settings.removeClass("open"),$(document).off("click.settings-dropdown")},onDashboardNavigate:function(e){this.overflowDockItems(),this.highlightSettingsLink(e.fragment)},highlightSettingsLink:function(t){this.$(".settings-link.active").removeClass("active"),e.string.contains(t,"settings")&&this.$('.settings-link[href="#/'+t+'"]').addClass("active")},onClickDockItem:function(e){var t=$(e.currentTarget).attr("href");t=="http://help.tictail.com/"&&s.track("Opened Help Page");if(t[0]!=="#")return;e.preventDefault();var n=o.generateCurrentStoreUrl(t.substring(1));$(e.currentTarget).hasClass("external")?window.open("/dashboard/"+n+"/redirect","_blank"):Dashboard.router.navigate(n,{trigger:!0})},onMouseDownDockItem:function(e){$("html").addClass("expand"),$(document).one("mouseup",function(){$("html").removeClass("expand")})},onMouseOverTooltipItem:function(e){var t=$(e.target);e.preventDefault(),this.showTooltip(t)},onMouseOutTooltipItem:function(e){var t=$(e.target);e.preventDefault(),this.hideTooltip(t)}});return f}),define("text",["module"],function(e){"use strict";var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,r=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,i=typeof location!="undefined"&&location.href,s=i&&location.protocol&&location.protocol.replace(/\:/,""),o=i&&location.hostname,u=i&&(location.port||undefined),a=[],f=e.config&&e.config()||{},l,c;return l={version:"2.0.1",strip:function(e){if(e){e=e.replace(n,"");var t=e.match(r);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(n=0;n<3;n+=1){r=t[n];try{e=new ActiveXObject(r)}catch(i){}if(e){t=[r];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=l.xdRegExp.exec(e),s,o,u;return i?(s=i[2],o=i[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===t)&&(!o||o.toLowerCase()===n.toLowerCase())&&(!u&&!o||u===r)):!0},finishLoad:function(e,t,n,r){n=t?l.strip(n):n,f.isBuild&&(a[e]=n),r(n)},load:function(e,t,n,r){if(r.isBuild&&!r.inlineText){n();return}f.isBuild=r.isBuild;var a=l.parseName(e),c=a.moduleName+"."+a.ext,h=t.toUrl(c),p=f.useXhr||l.useXhr;!i||p(h,s,o,u)?l.get(h,function(t){l.finishLoad(e,a.strip,t,n)},function(e){n.error&&n.error(e)}):t([c],function(e){l.finishLoad(a.moduleName+"."+a.ext,a.strip,e,n)})},write:function(e,t,n,r){if(a.hasOwnProperty(t)){var i=l.jsEscape(a[t]);n.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,n,r,i){var s=l.parseName(t),o=s.moduleName+"."+s.ext,u=n.toUrl(s.moduleName+"."+s.ext)+".js";l.load(o,n,function(t){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},l.write(e,o,n,i)},i)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(c=require.nodeRequire("fs"),l.get=function(e,t){var n=c.readFileSync(e,"utf8");n.indexOf("")===0&&(n=n.substring(1)),t(n)}):l.createXhr()?l.get=function(e,t,n){var r=l.createXhr();r.open("GET",e,!0),f.onXhr&&f.onXhr(r,e),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):t(r.responseText))},r.send(null)}:typeof Packages!="undefined"&&(l.get=function(e,t){var n="utf-8",r=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),n)),o,u,a="";try{o=new java.lang.StringBuffer,u=s.readLine(),u&&u.length()&&u.charAt(0)===65279&&(u=u.substring(1)),o.append(u);while((u=s.readLine())!==null)o.append(i),o.append(u);a=String(o.toString())}finally{s.close()}t(a)}),l}),define("text!dashboard-template/header/app_launcher.mustache",[],function(){return'<header id="navigation-bar" class="app-launcher">\n    <div id="header" class="constant-row">\n        <div id="logo-container">\n            <h1 id="logo" class="column no-gutter">\n                <a href="#" title="Home" class="manual"></a>\n                <div id="global-spinner">\n                    <object type="image/svg+xml" data="/static/i/dashboard/modules/header/spinner.svg"></object>\n                </div>\n            </h1>\n        </div>\n        <nav id="main-nav" class="column no-gutter">\n            <ul id="dock">\n                {{#dock}}\n                <li class="item {{#newInstall}}new-install{{/newInstall}}" data-id="{{id}}">\n                    <a href="{{ path }}" class="{{#external}}external{{/external}} manual tooltip-item" data-title="{{title}}"\n                    {{#icon}}\n                        style="background-image: url({{icon}});"\n                    {{/icon}}\n                    {{#external}}\n                        target="_blank"\n                    {{/external}}\n                    ></a>\n                </li>\n                {{/dock}}\n            </ul>\n            <div class="overflow-item tooltip-item" data-title="Toggle Extras"></div>\n        </nav>\n        <div id="account">\n        {{>header/account}}\n        </div>\n    </div>\n</header>\n'}),define("text!dashboard-template/header/account.mustache",[],function(){return'<ul>\n    <li id="settings">\n        <span title="Settings" class="settings-button"></span>\n        <span class="settings-button-shadow"></span>\n\n        <ul class="dropdown">\n            {{#multiple_stores?}}\n            <li class="label">Stores</li>\n            {{#stores}}\n                <li><a href="#" data-id="{{id}}" class="store-link manual {{#isCurrent}}active{{/isCurrent}}">\n                    <span class="store-name">{{name}}</span>\n                    <span class="status {{#online}}open{{/online}}{{^online}}closed{{/online}}"></span>\n                </a></li>\n            {{/stores}}\n            <hr>\n            {{/multiple_stores?}}\n            <li class="label">Settings</li>\n            {{#current_store}}\n            <li><a href="#/store/{{subdomain}}/settings" class="settings-link manual">General</a></li>\n            <li><a href="#/store/{{subdomain}}/settings/fulfillment" class="settings-link manual">Payments, Shipping &amp; Legal</a></li>\n            <li><a href="#/store/{{subdomain}}/settings/billing" class="settings-link manual">Apps &amp; Billing</a></li>\n            <li><a href="#/user/settings" class="settings-link manual">Your Account</a></li>\n            <li><a href="#/store/{{subdomain}}/themes" class="settings-link manual">Store Design<span class="link-icon"></span></a></li>\n            {{/current_store}}\n            <hr>\n            <li><a href="/logout" class="logout-link">Log Out <span class="logout-icon"></span></a></li>\n        </ul>\n    </li>\n    <li id="storefront">\n        {{#current_store_online?}}\n        {{#current_store}}\n        <a href="{{url}}" target="_blank" title="Go to {{url}}" class="manual">\n            <span class="status open"></span>{{name}}<br/>\n            <span class="link">Open storefront<span class="link-icon"></span></span>\n        </a>\n        {{/current_store}}\n        {{/current_store_online?}}\n        {{^current_store_online?}}\n        <a href="{{preview_url}}" title="Go to preview" class="manual store-offline">\n            {{#current_store}}\n            <span class="status closed"></span>{{name}}<br/>\n            {{/current_store}}\n            <span class="link">Preview store design <span class="link-icon"></span></span>\n        </a>\n        {{/current_store_online?}}\n    </li>\n</ul>\n'}),define("text!dashboard-template/feed/item.mustache",[],function(){return'<div class="hit-area">\n    <div class="feed-item-icon">\n        {{#icon_images}}\n        <div class="feed-item-icon-image" style="background-image: url({{ src }});"></div>\n        {{/icon_images}}\n    </div>\n    <div class="feed-item-title">{{ title }}</div>\n</div>\n\n<div class="menu">\n    {{#is_ignorable}}\n    <a class="menu-item ignore-button manual" href="#">{{ ignore_button_label }}</a>\n    {{/is_ignorable}}\n    {{#is_postponable}}\n    <a class="menu-item do-later-button manual" href="#">{{ do_later_button_label }}</a>\n    {{/is_postponable}}\n    <a class="menu-item toggle-button manual" href="#">\n        <span class="open-label">{{ open_button_label }}</span>\n        <span class="close-label">{{ close_button_label }}</span>\n    </a>\n</div>\n\n<div class="check-mark"></div>\n\n<div class="content-wrap">\n    <div class="feed-item-content"></div>\n</div>\n'}),define("text!dashboard-template/feed/metrics.mustache",[],function(){return'<div class="metric visits">\n    <div class="label">{{visits_label}}</div>\n    <div class="value"></div>\n    <div class="diff"></div>\n</div>\n\n<div class="metric orders">\n    <div class="label">{{orders_label}}</div>\n    <div class="value"></div>\n    <div class="diff"></div>\n</div>\n\n<div class="metric followers">\n    <div class="label">{{followers_label}}</div>\n    <div class="value"></div>\n    <div class="diff"></div>\n    <div class="button">{{followers_button}}</div>\n</div>\n'}),define("text!dashboard-template/feed/progressbar.mustache",[],function(){return'<div class="bar">\n    <div class="tooltip">\n        <span class="progress"></span>\n        <span class="goal"></span>\n        <span class="arrow"></span>\n\n        <div class="data-boxes">\n            <div class="data-box tasks-left"></div>\n            <div class="data-box percentage"></div>\n        </div>\n    </div>\n</div>\n'}),define("text!dashboard-template/feed/completed.mustache",[],function(){return'<div id="feed-completed-notification">\n    <h2>Sweet! You\'ve completed all your tasks. Good job!</h2>\n</div>\n'}),define("text!dashboard-template/legaltext/returnpolicy.mustache",[],function(){return"<b>Our Return Policy in short</b>\n<ul>\n    <li>Contact {{ store_name }} before returning any items.</li>\n    <li>You can return the product within 30 days of delivery.</li>\n    <li>The product must be in new condition.</li>\n    <li>To avoid any Customs charges please clearly mark the package 'RETURNED GOODS'.</li>\n    <li>Want to switch to another size of the same product? You can do that, just contact us.</li>\n    <li>Want to switch to another product? You can do that, just contact us.</li>\n    <li>If a package is unclaimed you might have to pay a handling fee.</li>\n</ul>\n<br>\n<b>Return Policy</b>\n<p>\n    Please contact {{ store_name }} before returning any items.\n</p>\n<p>\n    It is appropriate that the consumer controls the delivery to verify that\n    this is accurate and error free. At the complaint, the customer contacts\n    {{ store_name }} and gives information relevant and the reason for complaint.\n</p>\n<br>\n<b>Return Conditions</b>\n<p>\n    You can return the product within 30 days of delivery. The product must\n    be in new condition. If the product is ruined or used the product shall\n    not be refunded. Make sure to include contact information with the return\n    and if possible, please provide us with a tracking number. {{ store_name }}\n    suggests you get a receipt and a package ID for the return from the\n    delivery service, as it makes it easier to follow the return shipment if\n    needed.\n</p>\n<p>\n    {{ store_name }} will make a refund of eligible returns. If you paid by\n    invoice, we will need a bank account number to transfer the money back to.\n    The easiest way is to e-mail it to us along with a brief description of\n    your case.\n</p>\n<br>\n<b>Returning A Package</b>\n<p>\n    If a returned item is shipped international, please clearly mark the\n    package 'RETURNED GOODS', to avoid any Customs charges. {{ store_name }}\n    is NOT responsible for any return Customs charges made. Any charges incurred\n    are the responsibility of the customer.\n</p>\n<br>\n<b>Want to switch to another size of the same product?</b>\n<p>\n    E-mail us, provide your customer information, and tell us you will send back\n    the product and the size you wish to receive in exchange.\n</p>\n<br>\n<b>Want to switch to another product?</b>\n<p>\n    Return the product you have received and send us an e-mail telling us which\n    product you want instead.\n</p>\n<br>\n<b>Transport Damage</b>\n<p>\n    If the product is lost or you, upon receiving, notice that the item has\n    been damaged during transport, you should immediately report this to us.\n</p>\n<br>\n<b>Unclaimed Packages</b>\n<p>\n    For packages that are not cashed at your post office within 14 days,\n    {{ store_name }} reserves the right to charge you a handling fee to cover\n    return shipping and freight companies' administrative costs.\n</p>\n<br>\n<p>All enquiries: {{ store_email }}</p>\n"}),define("text!dashboard-template/legaltext/termsandconditions.mustache",[],function(){return"<b>Terms &amp; Conditions in short</b>\n<ul>\n    <li>By ordering any of our products, you agree to be bound by these terms &amp; conditions.</li>\n    <li>By placing an order at {{ store_name }}, you warrant that you are at least 18 years old or have parents' permission to buy from us.</li>\n    <li>All personal information you provide us with or that we obtain will be handled by {{ store_name }} as responsible for the personal information.</li>\n    <li>Events outside {{ store_name }}'s control shall be considered force majeure.</li>\n    <li>The price applicable is that set at the date on which you place your order.</li>\n    <li>Shipping costs and payment fees are recognized before confirming the purchase.</li>\n    <li>Card information is transmitted over secure SSL encryption and is not stored.</li>\n    <li>Please note that local charges may occur.</li>\n    <li>{{ store_name }} reserves the right to amend any information without prior notice.</li>\n</ul>\n<br>\n<b>Terms &amp; Conditions</b>\n<p>\n    This page contains the terms &amp; conditions. Please read these terms\n    &amp; conditions carefully before ordering any products from us. You\n    should understand that by ordering any of our products, you agree to be\n    bound by these terms &amp; conditions.\n</p>\n<p>\n    By placing an order at {{ store_name }}, you warrant that you are at\n    least 18 years old (or have parents' permission to buy from us) and\n    accept these terms &amp; conditions which shall apply to all orders\n    placed or to be placed at {{ store_name }} for the sale and supply of any\n    products. None of these terms &amp; conditions affect your statutory\n    rights. No other terms or changes to the terms &amp; conditions shall be\n    binding unless agreed in writing signed by us.\n</p>\n<br>\n<b>Personal Information</b>\n<p>\n    All personal information you provide us with or that we obtain will be\n    handled by {{ store_name }} as responsible for the personal information.\n    The personal information you provide will be used to ensure deliveries to\n    you, the credit assessment, to provide offers and information on our\n    catalog to you. The information you provide is only available to\n    {{ store_name }} and Tictail and will not be shared with other third parties.\n    You have the right to inspect the information held about you. You always\n    have the right to request {{ store_name }} to delete or correct the\n    information held about you. By accepting the {{ store_name }} Conditions,\n    you agree to the above.\n</p>\n<br>\n<b>Force Majeure</b>\n<p>\n    Events outside {{ store_name }}'s control, which is not reasonably\n    foreseeable, shall be considered force majeure, meaning that\n    {{ store_name }} is released from {{ store_name }}'s obligations to fulfill\n    contractual agreements. Example of such events are government action or\n    omission, new or amended legislation, conflict, embargo, fire or flood,\n    sabotage, accident, war, natural disasters, strikes or lack of delivery\n    from suppliers. The force majeure also includes government decisions that\n    affect the market negatively and products, for example, restrictions,\n    warnings, ban, etc.\n</p>\n<br>\n<b>Payment</b>\n<p>\n    All products remain {{ store_name }}'s property until full payment is made.\n    The price applicable is that set at the date on which you place your order.\n    Shipping costs and payment fees are recognized before confirming the\n    purchase. If you are under 18 years old you must have parents' permission to\n    buy from {{ store_name }}.\n</p>\n<p>\n    All transfers conducted through {{ store_name }} are handled and transacted\n    through third party dedicated gateways to guarantee your protection. Card\n    information is not stored and all card information is handled over SSL\n    encryption. Please read the terms &amp; conditions for the payment gateway\n    choosen for the transaction as they are responsible for the transactions made.\n</p>\n<br>\n<b>Local Taxes</b>\n<p>\n    Please note that local charges (sales tax, customs duty) may occur, depending\n    on your region and local customs duties. These charges are at the customers\n    own expense.\n</p>\n<br>\n<b>Cookies</b>\n<p>\n    {{ store_name }} uses cookies according to the new Electronic Communications\n    Act, which came into force on 25 July 2003. A cookie is a small text file stored\n    on your computer that contains information that helps the website to identify\n    and track the visitor. Cookies do no harm to your computer, consist only of\n    text, can not contain viruses and occupies virtually no space on your hard\n    drive. There are two types of cookies: \"Session Cookies\" and cookies that are\n    saved permanently on your computer.\n</p>\n<p>\n    The first type of cookie commonly used is \"Session Cookies\". During the time\n    you visit the website, our web server assigns your browser a unique identifier\n    string so as not to confuse you with other visitors. A \"Session Cookie\" is\n    never stored permanently on your computer and disappears when you close your\n    browser. To use {{ store_name }} without troubles you need to have cookies\n    enabled.\n</p>\n<p>\n    The second type of cookie saves a file permanently on your computer. This type\n    of cookie is used to track how visitors move around on the website. This\n    is only used to offer visitors better services and support. The text files can\n    be deleted. On {{ store_name }} we use this type of cookie to keep track of\n    your shopping cart and to keep statistics of our visitors. The information\n    stored on your computer is only a unique number, without any connection to\n    personal information.\n</p>\n<br>\n<b>Additional Information</b>\n<p>\n    {{ store_name }} reserves the right to amend any information, including but not\n    limited to prices, technical specifications, terms of purchase and product\n    offerings without prior notice. At the event of when a product is sold out,\n    {{ store_name }} has the right to cancel the order and refund any amount paid in\n    the best way. {{ store_name }} shall also notify the customer of equivalent\n    replacement products if available.\n</p>\n<p>\n    Tictail AB is not responsible for any content, interactions or transfers made\n    on {{ store_url }}.\n</p>\n<br>\n<p>All enquiries: {{ store_email }}</p>\n"}),define("text!dashboard-template/module/actionbar.mustache",[],function(){return'<ul class="inner-right-column">\n    {{#button}}\n    <li><button id="name-{{name}}" class="ui" type="{{type}}" tabindex="{{tabIndex}}">{{label}}</button></li>\n    {{/button}}\n    {{#link}}\n    <li><a id="name-{{name}}" href="#" class="manual" tabindex="{{tabIndex}}">{{label}}</a></li>\n    {{/link}}\n</ul>\n'}),define("text!dashboard-template/module/layout.mustache",[],function(){return"<h1>{{page_title}}</h1>\n"}),define("text!dashboard-template/module/page.mustache",[],function(){return"{{#has_title}}\n<h1>{{ title }}</h1>\n{{/has_title}}\n"}),define("text!dashboard-template/module/plain.mustache",[],function(){return'<div class="content"></div>\n'}),define("text!dashboard-template/module/preview.mustache",[],function(){return'<iframe width="1100" height="80%" src="/dashboard/{{store_url}}/themes/preview/{{theme_id}}"></iframe>\n'}),define("text!dashboard-template/module/subnavigation.mustache",[],function(){return'<ul>\n    {{#link}}\n    <li><a id="name-{{name}}" href="#">{{label}}</a></li>\n    {{/link}}\n    {{#button}}\n    <li><button id="name-{{name}}" class="ui"{{#type?}} type="{{type}}"{{/type?}}>{{label}}</button></li>\n    {{/button}}\n</ul>\n'}),define("text!dashboard-template/module/overlay.mustache",[],function(){return'<h1>{{heading}}</h1>\n{{#sub_heading}}<h2>{{{sub_heading}}}</h2>{{/sub_heading}}\n<div class="icon"></div>\n<hr>\n{{#error_message}}\n<div class="content with-error">\n  <div class="error">{{error_message}}</div>\n  <div class="actions"><ul class="inner-right-column">\n      <li><a href="#" class="manual cancel" tabindex="999">Cancel</a></li>\n  </ul></div>\n</div>\n{{/error_message}}\n{{^error_message}}\n<div class="content"></div>\n{{/error_message}}\n'}),define("text!dashboard-template/module/creditcard.mustache",[],function(){return'<div class="creditcard-show-view">\n    {{#masked_number}}\n    <label>Credit Card Number</label>\n    <span class="card_type {{ card_type }}" /><span>{{ masked_number }}</span>\n    <label>Expires</label>\n    <span>{{ expiry_month }}/{{ expiry_year }}</span>\n    {{/masked_number}}\n    {{^masked_number}}\n    {{{info_on_invalid_card}}}\n    {{/masked_number}}\n</div>\n'}),define("text!dashboard-template/module/upcoming_billing.mustache",[],function(){return'{{#has_orders}}\n{{#orders}}\n<p id="upcoming-billing-heading">On {{at}}, you will be billed {{{ price }}}</p>\n<div class="data-table" id="upcoming-billing-table">\n    <table>\n        <thead>\n            <tr>\n                <th class="title">Title</th>\n                <th class="amount">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n        {{#installations}}\n            <tr>\n                <td class="title">{{ title }}</td>\n                <td class="amount">{{{ price }}}</td>\n            </tr>\n        {{/installations}}\n        </tbody>\n    </table>\n</div>\n{{/orders}}\n{{/has_orders}}\n{{^has_orders}}\n    <p>No upcoming billing.</p>\n{{/has_orders}}\n'}),define("text!dashboard-template/module/installed_apps.mustache",[],function(){return'{{#has_apps}}\n<div class="data-table" id="installed-apps-table">\n    <table>\n        <thead>\n            <tr>\n                <th class="title">Name</th>\n                <th class="price">Price</th>\n                <th class="manage">Manage</th>\n            </tr>\n        </thead>\n        <tbody>\n        {{#apps}}\n            <tr>\n                <td class="name"><img src="{{ icon_url }}" alt="">{{ name }}</td>\n                <td class="price">\n                  {{#is_free}}\n                    <div class="free">Free</div>\n                  {{/is_free}}\n                  {{^is_free}}\n                   {{ price }} <span class="currency">{{ currency }}</span>\n                  {{/is_free}}\n                </td>\n                <td class="manage"><a href="" class="remove-app" data-id=\'{{ id }}\'>Remove App</a></td>\n            </tr>\n        {{/apps}}\n        </tbody>\n    </table>\n</div>\n{{/has_apps}}\n{{^has_apps}}\n    <p>It does not look like you have any apps. Have you taken a look at our <a href="dashboard/apps" class="app-store-link">great selection</a>?</p>\n{{/has_apps}}\n'}),define("text!dashboard-template/module/billing_history.mustache",[],function(){return'{{#has_orders}}\n<p id="billing-history-heading">\n  Thank you for your purchases! We love you for your support.\n</p>\n<div class="data-table" id="billing-history-table">\n    <table>\n        <thead>\n            <tr>\n                <th class="date">Date</th>\n                <th class="paid-with">Paid with</th>\n                <th class="amount">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n        {{#orders}}\n            <tr>\n                <td class="date">\n                     <a href="{{ href }}" target="_blank" class="view-order">\n                        {{ at }}\n                    </a>\n                </td>\n                <td class="paid-with">{{ paid_with }}</td>\n                <td class="amount">{{{ price }}}</td>\n            </tr>\n        {{/orders}}\n        </tbody>\n    </table>\n</div>\n{{/has_orders}}\n{{^has_orders}}\n    <p>No billing history.</p>\n{{/has_orders}}\n'}),define("text!dashboard-template/module/social/follow.mustache",[],function(){return'<div class="follow-buttons">\n    <div class="follow-button twitter-button">\n        <a href="https://twitter.com/tictail" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @tictail</a>\n        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>\n    </div>\n\n    <div class="follow-button facebook-button">\n        <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Ftictail&amp;send=false&amp;layout=button_count&amp;width=130&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21&amp;appId=309860612371078" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:130px; height:21px;" allowTransparency="true"></iframe>\n    </div>\n</div>\n\n<div class="actions">\n    <a href="#" class="continue-link manual">{{continue_link_label}}</a>\n</div>\n'}),define("text!dashboard-template/social/share_tips.mustache",[],function(){return'<div class="share-tips">\n    <div class="inner">\n        <div class="heading">{{ heading }}</div>\n        <p class="tip">{{ tip }}</p>\n        <button type="button" class="refresh"></button>\n    </div>\n</div>\n'}),define("text!dashboard-template/module/klarnapclasses/base.mustache",[],function(){return'<h1>Klarna</h1>\n<div class="table-container"></div>\n<hr>\n<div class="action-bar">\n    <button id="pclasses-done" class="ui highlighted" type="button">Done</button>\n</div>\n'}),define("text!dashboard-template/module/productnavigation/base.mustache",[],function(){return'<div class="nav-column root-column">\n	<h3>Main menu</h3>\n	<div class="scroll-area">\n		<ul></ul>\n		<div class="add-new">\n			<a href="#" class="manual"><span class="plus">+ </span>Create New Menu Item</a>\n		</div>\n	</div>\n</div>\n'}),define("text!dashboard-template/module/productnavigation/childcolumn.mustache",[],function(){return'<div class="nav-column child-column">\n	<h3><span class="parent-item-label"></span><span class="arrow"></span><span class="item-label">Submenu</span></h3>\n	<div class="scroll-area">\n		<ul></ul>\n		<div class="add-new">\n			<a href="#" class="manual"><span class="plus">+ </span>Create New Submenu Item <span class="thin">in <span class="parent-item-label"></span></span></a>\n		</div>\n	</div>\n</div>\n'}),define("text!dashboard-template/module/productnavigation/itemtools.mustache",[],function(){return'<div class="item-tools">\n	<div class="ui button"></div>\n	<div class="balloon">\n		<div class="tip"></div>\n		<ul>\n			<li class="rename">Rename</li>\n			<li class="delete">Delete</li>\n		</ul>\n	</div>\n</div>\n'}),define("text!dashboard-template/module/productnavigation/menuitem.mustache",[],function(){return'<li class="item item-{{ id }}">\n	<label>\n		<input type="checkbox" class="ui" value="{{ id }}"/>\n		<span class="label">{{ label }}</span>\n	</label>\n	{{#is_root}}\n	<span class="arrow"></span>\n	{{/is_root}}\n</li>\n'}),define("text!dashboard-template/module/theme/edit.mustache",[],function(){return'<div class="theme-toolbar">\n    <button type="button" class="preview-button">{{preview_button_label}}</button>\n    <a href="settings" class="back-button button right">{{back_button_label}}</a>\n    <button type="button" class="save-button highlighted right">{{save_button_label}}</button>\n</div>\n\n<div class="content">\n    <div class="reattach-box">\n        <button type="button" class="reattach-button">{{reattach_button_label}}</button>\n    </div>\n</div>\n'}),define("text!dashboard-template/module/theme/editortoolbar.mustache",[],function(){return'<ul class="theme-editor-toolbar">\n{{#detachable}}\n    <li class="item-detach"><a href="#" class="manual" title="{{detach_item_label}}"></a></li>\n{{/detachable}}\n    <li class="item-wrap-mode"><a href="#" class="manual" title="{{wrap_mode_item_label}}"></a></li>\n    <li class="item-documentation"><a href="#" class="manual" title="{{documentation_item_label}}"></a></li>\n</ul>\n'}),define("text!dashboard-template/module/theme/gallery.mustache",[],function(){return'<div class="theme-toolbar">\n    <a href="themes" class="back-button button right">{{back_button_label}}</a>\n    <button type="button" class="use-theme-button highlighted right"></button>\n</div>\n\n<div class="content">\n    <ul class="theme-list">\n    {{#themes}}\n        <li class="theme-thumb" id="theme-thumb-{{id}}" data-id="{{id}}">\n            <div class="thumb" {{#screenshot_url}}style="background-image: url({{screenshot_url}});"{{/screenshot_url}}>\n                <div class="screenshot"></div>\n            </div>\n            <span class="byline"></span>\n        </li>\n    {{/themes}}\n    </ul>\n</div>\n'}),define("text!dashboard-template/module/theme/previewcontainer.mustache",[],function(){return'{{#preview_url}}\n<iframe name="theme_preview" src="{{preview_url}}" class="theme-preview" scrolling="auto" frameBorder="0"></iframe>\n{{/preview_url}}\n'}),define("text!dashboard-template/module/theme/sidebar.mustache",[],function(){return'<div class="wrap">\n    <div class="navigation-bar">\n        <ul class="content-menu">\n            <li class="item-start"><a href="themes">{{start_item_label}}</a></li>\n            <li class="item-edit"><a href="themes/edit">{{edit_item_label}}</a></li>\n            {{!<li class="item-dropbox"><a href="themes/dropbox">{ {dropbox_item_label} }</a></li>}}\n        </ul>\n\n        <ul class="toolbar">\n{{#columns_mode_supported}}\n            <li class="item-lock"><a href="#" class="manual">{{lock_item_label}}</a></li>\n{{/columns_mode_supported}}\n        </ul>\n    </div>\n\n    <div class="content-wrap"></div>\n\n    <div class="resize-handle"></div>\n</div>\n'}),define("text!dashboard-template/module/theme/start.mustache",[],function(){return'<div class="theme-toolbar">\n    <a href="settings" class="back-button button right">{{back_button_label}}</a>\n    <button type="button" class="save-button highlighted right" style="display: none">Save</button>\n</div>\n\n<div class="content">\n    {{#current_theme}}\n    <div class="current-theme">\n        <div class="small-heading">{{current_theme_heading}}</div>\n        <div class="theme-thumb">\n            <div class="thumb" {{#screenshot_url}}style="background-image: url({{screenshot_url}});"{{/screenshot_url}}></div>\n        </div>\n    </div>\n    {{/current_theme}}\n\n    <a href="themes/gallery" class="button full-width">{{gallery_button_label}}</a>\n\n    <div class="options"></div>\n</div>'}),define("text!dashboard-template/module/embedded/index.mustache",[],function(){return'<iframe src="{{app_uri}}{{appendPath}}" id="{{app_id}}"></iframe>'}),define("text!dashboard-template/welcome/index.mustache",[],function(){return'<div id="welcome-header">\n    <div class="appsize">\n        <h1>{{ page_title }}</h1>\n        <div class="subtitle">{{ subtitle }}</div>\n\n        <div class="button-container">\n            <button type="button" id="welcome-done-button" class="yellow large" disabled="disabled">{{ done_button_label }}</button>\n            <div class="flash-container"><div class="flash"></div></div>\n        </div>\n    </div>\n</div>\n\n<div id="page" class="appsize">\n    <ul id="welcome-theme-list">\n        {{#themes}}\n        <li data-theme-id="{{ id }}">\n            <div class="image-container hit-area" {{#screenshot_url}}style="background-image: url({{ screenshot_url }})"{{/screenshot_url}}>\n                <div class="screenshot"></div>\n                <div class="overlay"></div>\n            </div>\n            <div class="label">\n                {{ name }}\n                <a target="_blank" class="manual" href="{{ theme_base_url }}/{{ id }}">({{ preview_label }})</a>\n            </div>\n        </li>\n        {{/themes}}\n    </ul>\n</div>\n'}),define("text!dashboard-template/order/message_container.mustache",[],function(){return'<fieldset class="row">\n    <h4 class="column inner-left-column">\n        Your messages\n    </h4>\n\n    <div id="order-messages" class="column inner-right-column">\n    {{#messages}}\n        {{>order/message}}\n    {{/messages}}\n    </div>\n</fieldset>\n'}),define("text!dashboard-template/order/message.mustache",[],function(){return'<div class="note bottom-gap">\n    <div class="pre">{{ body }}</div>\n</div>\n'}),define("text!dashboard-template/order/details.mustache",[],function(){return'<div class="row bottom-gap">\n    <div class="column one-in-two">\n        <div class="heading">Order date</div>\n        {{#paid_at}}\n            <time>{{ paid_at }}</time>\n        {{/paid_at}}\n        {{^paid_at}}\n            Pending payment\n        {{/paid_at}}\n    </div>\n\n    {{#payment_alternative}}\n    <div class="column one-in-two">\n        <div class="heading">Payment</div>\n        Paid with <a href="{{ url }}" target="_blank" class="manual">{{ name }}</a>\n        {{#ref_id}}\n        <br>Reference: {{ ref_id }}\n        {{/ref_id}}\n    </div>\n    {{/payment_alternative}}\n</div>\n\n<div class="row bottom-gap">\n    <div class="column one-in-two">\n        {{^is_shipped}}\n        <div class="heading">Shipping option</div>\n        {{shipping.label}}\n        {{/is_shipped}}\n\n        {{#is_shipped}}\n        <div class="heading">Shipped with</div>\n        {{ shipping_company }}{{^shipping_company}}{{#shipping}}{{ label }}{{/shipping}}{{/shipping_company}}, <time>{{ shipped_at }}</time>\n        {{/is_shipped}}\n    </div>\n\n    {{#has_discounts}}\n    <div class="column one-in-two">\n        <div class="heading">Discounts</div>\n        <ul id="order-discounts-list">\n            {{#discounts}}\n            <li><a href="app/discounts/{{ id }}">{{ title }}</a></li>\n            {{/discounts}}\n        </ul>\n    </div>\n    {{/has_discounts}}\n</div>\n\n{{#tracking_number}}\n<div class="row bottom-gap">\n    <div class="column one-in-two">\n        <div class="heading">Tracking number</div>\n        {{ tracking_number }}\n    </div>\n</div>\n{{/tracking_number}}\n'}),define("text!dashboard-template/order/index.mustache",[],function(){return'<h1>Orders</h1>\n\n<hr/>\n\n<div id="order-index-toolbar" class="ui toolbar">\n    <select class="ui" id="order-filters">\n        <option value="inbox" {{inbox_selected}}>Inbox</option>\n        <option value="archive" {{archive_selected}}>Archive</option>\n        <option value="all" {{all_selected}}>All</option>\n    </select>\n    <input type="search" class="ui" id="order-search-box" placeholder="Search by name, address or other attributes"/>\n    <div class="export ui drop">\n        <div class="menu">\n            <div class="arrow" />\n            <ul>\n                <div class="label">Export Current View</div>\n                <li value="csv">CSV</li>\n                <li value="excel">Excel</li>\n            </ul>\n        </div>\n    </div>\n</div>\n'}),define("text!dashboard-template/order/manage.mustache",[],function(){return'<h1>Order #{{ id }} {{#is_pending}} is pending {{/is_pending}}</h1>\n\n<div class="dotted-border">&nbsp;</div>\n\n<fieldset id="receiver-address" class="row borderless">\n    <h4 class="column inner-left-column">\n        Order information\n    </h4>\n\n    <div class="column inner-right-column no-gutter">\n        {{#receiver}}\n        <div class="row bottom-gap">\n            <div class="column one-in-two" id="order-contact-info">\n                <img src="{{ avatar_url }}" width="70" height="70" alt="{{ name }}" class="avatar"/>\n                <h2 class="name heading">{{ name }}</h2>\n                <a href="mailto:{{ email }}" class="email manual">{{ email }}</a>\n                <p class="telephone">{{ phone }}</p>\n            </div>\n\n            <div class="column one-in-two">\n                <div id="order-status-badge" title="This order has not yet been shipped"></div>\n            </div>\n        </div>\n\n        <div class="row bottom-gap">\n            <div class="column one-in-two">\n                <div class="order-address">\n                    <h4 class="heading">Billing address</h4>\n                    <p>{{ name }}</p>\n                    <p>{{ address }}</p>\n                {{^state}}\n                    <p>{{ zipcode }} {{ city }}</p>\n                {{/state}}\n                {{#state}}\n                    <p>{{ city }}, {{ state }}</p>\n                    <p>{{ zipcode }}</p>\n                {{/state}}\n                    <p>{{ country }}</p>\n                </div>\n            </div>\n\n            <div class="column one-in-two">\n                <div class="order-address">\n                    <h4 class="heading">Shipping address</h4>\n                    <p>{{ name }}</p>\n                    <p>{{ address }}</p>\n                {{^state}}\n                    <p>{{ zipcode }} {{ city }}</p>\n                {{/state}}\n                {{#state}}\n                    <p>{{ city }}, {{ state }}</p>\n                    <p>{{ zipcode }}</p>\n                {{/state}}\n                    <p>{{ country }}</p>\n                </div>\n            </div>\n        </div>\n        {{/receiver}}\n\n        {{^is_pending}}\n        <div class="row">\n            <div class="column one">\n                <button type="button" id="order-print-button" class="top-gap">Print Order</button>\n            </div>\n        </div>\n        {{/is_pending}}\n    </div>\n</fieldset>\n\n<fieldset class="row">\n    <h4 class="column inner-left-column">\n        Products\n    </h4>\n\n    <div class="column inner-right-column">\n        <ul id="order-product-images">\n            {{#items}}\n                {{#product}}\n                    {{#image}}\n                    <li><a href="{{#sizes}}{{ 500 }}{{/sizes}}" class="thumb manual" style="background-image: url({{#sizes}}{{ 100 }}{{/sizes}});">{{ title }}</a></li>\n                    {{/image}}\n                {{/product}}\n            {{/items}}\n        </ul>\n\n        <div class="data-table" id="order-products-table">\n            <table>\n                <thead>\n                    <tr>\n                        <th class="title">Title</th>\n                        <th class="price">Price</th>\n                        <th class="quantity">Qty</th>\n                        <th class="total">Total</th>\n                    </tr>\n                </thead>\n                <tbody>\n                {{#items}}\n                    <tr>\n                        {{#product}}\n                        <td class="title">\n                        {{#slug}}<a href="product/{{ slug }}">{{/slug}}\n                            {{ title }}\n                            {{#variation}}\n                                {{#label}}\n                                    <span class="variation">, {{ label }}</span>\n                                {{/label}}\n                            {{/variation}}\n                        {{#slug}}</a>{{/slug}}\n                        </td>\n                        {{/product}}\n                        <td class="price">{{ price }} <abbr class="currency">{{ currency }}</abbr></td>\n                        <td class="quantity">{{ quantity }}</td>\n                        <td class="total">{{ total_price }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                {{/items}}\n                </tbody>\n                <tfoot>\n                    {{#discounts}}\n                    <tr class="discount">\n                        <td colspan="2">{{ title }}</td>\n                        <td colspan="2">- {{ reduced_price }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                    {{/discounts}}\n                    <tr>\n                        <td colspan="2">Subtotal</td>\n                        <td colspan="2">{{ item_cost }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                    <tr>\n                        <td colspan="2">Shipping</td>\n                        <td colspan="2">{{ shipping_cost }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                    {{#has_invoice_fee}}\n                    <tr>\n                        <td colspan="2">Invoice fee</td>\n                        <td colspan="2">{{ invoice_fee }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                    {{/has_invoice_fee}}\n                    <tr class="tax">\n                        <td colspan="2">Tax</td>\n                        <td colspan="2">{{ tax }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                    <tr class="grand-total">\n                        <td colspan="2">Grand total</td>\n                        <td colspan="2">{{ grand_total }} <abbr class="currency">{{ currency }}</abbr></td>\n                    </tr>\n                </tfoot>\n            </table>\n        </div>\n    </div>\n</fieldset>\n{{#note}}\n    {{#receiver}}\n        <fieldset class="row">\n            <h4 class="column inner-left-column">\n                Customer message\n            </h4>\n\n            <div class="column inner-right-column">\n                <div class="note bottom-gap">\n                    <div class="heading">{{ name }} wrote:</div>\n                    <div class="pre">{{ note }}</div>\n                </div>\n\n                <a href="mailto:{{ email }}" class="action-link manual">Reply to {{ name }} </a>\n            </div>\n        </fieldset>\n    {{/receiver}}\n{{/note}}\n\n{{#has_messages}}\n    {{>order/message_container}}\n{{/has_messages}}\n\n<fieldset id="order-details-section" class="row">\n    <h4 class="column inner-left-column">\n        Order details\n    </h4>\n\n    <div class="column inner-right-column no-gutter">\n        <div id="order-details-container">\n            {{>order/details}}\n        </div>\n\n        <div class="row">\n            <div class="column one" id="order-controls">\n                <button type="button" class="highlighted" id="order-shipped-button">Mark as Shipped</button>\n                <button type="button" id="order-cancel-button">Cancel Order</button>\n                <div id="order-status-info"></div>\n            </div>\n        </div>\n    </div>\n</fieldset>\n\n{{#show_back_link}}\n<div class="actions">\n    <ul class="inner-right-column">\n        <li>\n            <a href="#" id="order-back-link" class="action-link manual">Back to order list</a>\n        </li>\n    </ul>\n</div>\n{{/show_back_link}}\n'}),define("text!dashboard-template/order/print.mustache",[],function(){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8" />\n    <title>Order #{{ id }}</title>\n    {{#css_files}}\n    <link type="text/css" rel="stylesheet" href="{{ href }}" />\n    {{/css_files}}\n    <style type="text/css">\n    body {\n        margin: 0;\n        padding: 20px 40px;\n        background-color: #fff;\n        font-family: \'Open Sans\', \'Helvetica Neue\', Helvetica, arial, sans-serif;\n        font-size: 14px;\n        line-height: 1.25;\n        color: #000;\n    }\n    @media print {\n        body {\n            padding: 0;\n            font-size: 11px;\n        }\n    }\n    h1, h2 {\n        padding: 0;\n        font-weight: bold;\n    }\n    h1 {\n        margin: 0 0 20px;\n        padding: 0 0 15px;\n        border-bottom: 0.1em solid #000;\n        font-size: 1.7em;\n    }\n    h2 {\n        margin: 0 0 8px;\n        font-size: 1.14em;\n    }\n    .row {\n        letter-spacing: -0.31em; /* webkit: collapse white-space between units */\n        *letter-spacing: normal; /* reset IE < 8 */\n        word-spacing: -0.43em; /* IE < 8 && gecko: collapse white-space between units */\n        overflow: hidden;\n    }\n    .column {\n        display: inline-block;\n        zoom: 1;\n        *display: inline; /* IE < 8: fake inline-block */\n        letter-spacing: normal;\n        word-spacing: normal;\n        vertical-align: top;\n        width: 50%;\n    }\n    .top-gap {\n        margin-top: 20px;\n    }\n    .currency {\n        font-size: 0.85em;\n    }\n    #header {\n        margin: 0 0 20px;\n        line-height: 1.3;\n    }\n    #store-name {\n        font-size: 1.14em;\n        line-height: 1.4;\n        font-weight: bold;\n    }\n    .info {\n        line-height: 1.4;\n    }\n    .info p {\n        margin: 0;\n    }\n    #status {\n        margin-top: 20px;\n    }\n    #products {\n        width: 100%;\n        margin: 70px 0;\n        padding: 0;\n        table-layout: fixed;\n        border-collapse: collapse;\n        border-spacing: 0;\n    }\n    #products th {\n        padding: 0 0 3px;\n        border-bottom: 1px solid #000;\n        font-size: 0.8em;\n        font-weight: bold;\n        color: #555;\n    }\n    #products td {\n        padding: 8px 0;\n        vertical-align: top;\n    }\n    #products tbody tr:first-child td {\n        padding-top: 14px;\n    }\n    #products tbody tr:last-child td {\n        padding-bottom: 14px;\n    }\n    #products .title {\n        width: 62%;\n        font-weight: bold;\n        text-align: left;\n    }\n    #products .variation {\n        margin-top: 2px;\n        font-weight: normal;\n    }\n    #products .price,\n    #products .total {\n        width: 14%;\n        text-align: right;\n    }\n    #products .quantity {\n        width: 10%;\n        padding-left: 8%;\n        text-align: left;\n    }\n    #products tfoot td {\n        padding: 3px 0;\n        text-align: right;\n    }\n    #products tfoot tr:first-child td {\n        padding-top: 20px;\n        border-top: 1px solid #888;\n    }\n    #products .grand-total {\n        font-weight: bold;\n    }\n    #products .vat {\n        font-size: 0.92em;\n    }\n    #return-policy {\n        margin-top: 70px;\n        padding: 10px 10px 2px;\n        border: 1px solid #000;\n        -webkit-border-radius: 5px;\n        -moz-border-radius: 5px;\n        border-radius: 5px;\n        font-size: 0.86em;\n    }\n    #return-policy h2 {\n        margin: 0 -10px 10px;\n        padding: 0 10px 10px;\n        border-bottom: 1px solid #000;\n        font-size: 1.3em;\n        font-weight: normal;\n    }\n    #return-policy p {\n        margin: 10px 0;\n    }\n    #footer {\n        margin-top: 40px;\n        font-size: 1.14em;\n        font-weight: bold;\n        text-align: center;\n    }\n    </style>\n</head>\n<body>\n    <div id="header">\n        {{#store}}\n            <h3 id="store-name">{{name}}</h3>\n            {{ email }}<br/>\n            {{ url }}\n        {{/store}}\n    </div>\n\n    <h1>Order #{{ id }} - {{ paid_at_pretty }}</h1>\n\n    {{#receiver}}\n    <div class="row">\n        <div class="column">\n            <div id="billing-address" class="info">\n                <h2>Billing address</h2>\n                <p>{{ name }}</p>\n                <p>{{ address }}</p>\n                {{^state}}\n                    <p>{{ zipcode }} {{ city }}</p>\n                {{/state}}\n                {{#state}}\n                    <p>{{ city }}, {{ state }}</p>\n                    <p>{{ zipcode }}</p>\n                {{/state}}\n                <p>{{ country }}</p>\n            </div>\n        </div>\n\n        <div class="column">\n            <div id="shipping-address" class="info">\n                <h2>Shipping address</h2>\n                <p>{{ name }}</p>\n                <p>{{ address }}</p>\n                {{^state}}\n                    <p>{{ zipcode }} {{ city }}</p>\n                {{/state}}\n                {{#state}}\n                    <p>{{ city }}, {{ state }}</p>\n                    <p>{{ zipcode }}</p>\n                {{/state}}\n                <p>{{ country }}</p>\n            </div>\n        </div>\n    </div>\n    {{/receiver}}\n\n    <div class="row top-gap">\n        <div class="column">\n            {{#payment_alternative}}\n            <div id="payment-method">\n                <h2>Payment</h2>\n                Paid with {{ name }}\n                {{#ref_id}}\n                <br>Reference: {{ ref_id }}\n                {{/ref_id}}\n            </div>\n            {{/payment_alternative}}\n        </div>\n\n        <div class="column">\n            {{#receiver}}\n            <div id="customer-contact" class="info">\n                <h2>Customer contact</h2>\n                <p>{{ phone }}</p>\n                <p>{{ email }}</p>\n            </div>\n            {{/receiver}}\n        </div>\n\n        {{#is_shipped}}\n        <div class="column">\n            <div id="status">\n                Marked as shipped on {{ shipped_at_pretty }}\n            </div>\n        </div>\n        {{/is_shipped}}\n    </div>\n\n    {{#note}}\n        {{#receiver}}\n            <div class="row top-gap">\n                <div class="column">\n                    <div id="note">\n                        <h2>Customer message</h2>\n                        <p>{{ name }} wrote: &ldquo;{{ note }}&rdquo;</p>\n                    </div>\n                </div>\n            </div>\n        {{/receiver}}\n    {{/note}}\n\n    <table id="products">\n    <thead>\n        <tr>\n            <th class="title">Product title</th>\n            <th class="price">Price</th>\n            <th class="quantity">Qty</th>\n            <th class="total">Total</th>\n        </tr>\n    </thead>\n    <tbody>\n        {{#items}}\n            <tr>\n                {{#product}}\n                <td class="title">\n                    {{ title }}<span class="variation">{{#variation}}, {{ label }}{{/variation}}</span>\n                </td>\n                {{/product}}\n                <td class="price">{{ price }} <abbr class="currency">{{ currency }}</abbr></td>\n                <td class="quantity">{{ quantity }}</td>\n                <td class="total">{{ total_price }} <abbr class="currency">{{ currency }}</abbr></td>\n            </tr>\n        {{/items}}\n    </tbody>\n    <tfoot>\n        {{#discounts}}\n        <tr class="discount">\n            <td colspan="2">{{ title }}</td>\n            <td colspan="2">- {{ reduced_price }} <abbr class="currency">{{ currency }}</abbr></td>\n        </tr>\n        {{/discounts}}\n        <tr>\n            <td colspan="2">Subtotal</td>\n            <td colspan="2">{{ item_cost }} <abbr class="currency">{{ currency }}</abbr></td>\n        </tr>\n        <tr>\n            <td colspan="2">Shipping</td>\n            <td colspan="2">{{ shipping_cost }} <abbr class="currency">{{ currency }}</abbr></td>\n        </tr>\n        {{#has_invoice_fee}}\n        <tr>\n            <td colspan="2">Invoice fee</td>\n            <td colspan="2">{{ invoice_fee }} <abbr class="currency">{{ currency }}</abbr></td>\n        </tr>\n        {{/has_invoice_fee}}\n        <tr class="tax">\n            <td colspan="2">Tax</td>\n            <td colspan="2">{{ tax }} <abbr class="currency">{{ currency }}</abbr></td>\n        </tr>\n        <tr class="grand-total">\n            <td colspan="2">Grand total</td>\n            <td colspan="2">{{ grand_total }} <abbr class="currency">{{ currency }}</abbr></td>\n        </tr>\n    </tfoot>\n    </table>\n\n    {{#has_return_policy}}\n    <div id="return-policy">\n        <h2>Return policy</h2>\n        <p>{{{ return_policy }}}</p>\n    </div>\n    {{/has_return_policy}}\n\n    <div id="footer">\n        Thank you for your purchase!\n    </div>\n</body>\n</html>\n'}),define("text!dashboard-template/order/row.mustache",[],function(){return'<tr>\n	<td class="order">#{{ id }}</td>\n	{{#receiver}}\n	<td class="name">\n		<p>\n			<span style="background-image: url({{ avatar_url }});"></span>\n			{{ name }}\n		</p>\n	</td>\n	{{/receiver}}\n	<td class="time"><time>{{paid_at}}</time></td>\n	<td class="status"><p>Unfinished</p></td>\n	<td class="price"><p>{{price}} <abbr class="currency">{{ currency }}</abbr></p></td>\n</tr>\n'}),define("text!dashboard-template/order/table.mustache",[],function(){return'<table>\n<thead>\n    <tr>\n        <th class="order"><a href="#" class="sort id">Order</a></th>\n        <th class="name"><a href="#" class="sort name">Name</a></th>\n        <th class="time"><a href="#" class="sort paid_at">Date</a></th>\n        <th class="status"><a href="#" class="sort status">Status</a></th>\n        <th class="price"><a href="#" class="sort price">Total</a></th>\n    </tr>\n</thead>\n<tbody></tbody>\n</table>\n\n<div class="message inbox">\n    Your inbox is empty right now.<br/>\n    We\'ll email you when new orders arrive!\n</div>\n\n<div class="message all">\n    You don\'t have any orders yet, but don\'t worry<br/>\n    neither did Amazon in 1993 ;)\n</div>\n\n<div class="message archive">\n    This is where your resolved orders will live.<br/>\n    New orders will show up in your inbox.\n</div>\n\n<div class="message filtered">\n    Sorry, we couldn\'t find a matching order!\n</div>\n\n<div class="message error">\n    Sorry, we got an error while searching for your orders!\n    <button id="retry-search" class="ui">Try again</button>\n</div>\n\n<div class="message error_query">\n    Sorry, we could not understand this search!\n</div>\n'}),define("text!dashboard-template/order/pending_curtain.mustache",[],function(){return'<div id="pending-curtain">\n    <strong>{{ payment_gateway}} says: {{ pending_reason}} </strong>\n    <a target="_blank" href="{{ help_link }}">{{ help_link_text }}</a>\n</div>\n'}),define("text!dashboard-template/product/index.mustache",[],function(){return'<h1>Products</h1>\n\n<hr/>\n\n<div id="product-index-toolbar" class="ui toolbar">\n    <input type="search" class="ui" id="product-search-box" placeholder="Search title, description, price or other attributes"/>\n    <button type="button" class="ui right" id="add-product-button">Add Product</button>\n</div>\n'}),define("text!dashboard-template/product/row.mustache",[],function(){return'<tr>\n    <td class="position draggable"></td>\n    <td class="title">\n        {{#image}}\n            {{#sizes}}\n                <a href="{{ 500 }}" class="thumb manual" style="background-image: url({{ 100 }});"></a>\n            {{/sizes}}\n        {{/image}}\n        <a href="product/{{ url_title }}">{{ title }}</a>\n    </td>\n    <td class="price clickable"><p>{{ price }} <abbr class="currency">{{ currency }}</abbr></p></td>\n    <td class="spacing clickable"></td>\n    <td class="time clickable"><time>{{ modified_at }}</time></td>\n    <td class="quantity clickable">\n        <div class="inner">\n            <p>\n            {{#has_unlimited}}\n            &mdash;\n            {{/has_unlimited}}\n            {{^has_unlimited}}\n            {{ aggregated_quantity }}\n            {{/has_unlimited}}\n            </p>\n            {{#show_variations}}\n            <ul>\n            {{#variations}}\n                <li><p><span>{{#is_unlimited}}&infin;{{/is_unlimited}}{{^is_unlimited}}{{ quantity }}{{/is_unlimited}}</span> {{ label }}</p></li>\n            {{/variations}}\n            </ul>\n            {{/show_variations}}\n        </div>\n    </td>\n    <td class="status clickable">\n        <span{{#is_online}} class="visible"{{/is_online}}></span>\n    </td>\n</tr>\n'}),define("text!dashboard-template/product/table.mustache",[],function(){return'<table>\n<thead>\n    <tr>\n        <th class="position"><a href="#" class="sort position"><span>#</span></a></th>\n        <th class="title"><a href="#" class="sort title">Title</a></th>\n        <th class="price"><a href="#" class="sort price">Price</a></th>\n        <th class="spacing"></th>\n        <th class="time"><a href="#" class="sort time">Last Modified</a></th>\n        <th class="quantity"><a href="#" class="sort quantity">Qty</a></th>\n        <th class="status"><a href="#" class="sort status">Visible</a></th>\n    </tr>\n</thead>\n<tbody></tbody>\n</table>\n\n<div class="message empty">\n    The first step to selling stuff online<br/>\n    is adding a product ...\n</div>\n\n<div class="message filtered">\n    We couldn\'t find the product you were looking for\n</div>\n\n<div class="message error">\n    Sorry, we got an error while searching for your products!\n    <button id="retry-search" class="ui">Try again</button>\n</div>\n\n<div class="message error_query">\n    Sorry, we could not understand this search!\n</div>\n'}),define("text!dashboard-template/theme/standaloneeditor.mustache",[],function(){return'<div class="theme-toolbar">\n    <button type="button" class="preview-button">{{preview_button_label}}</button>\n    <button type="button" class="save-button highlighted right">{{save_button_label}}</button>\n</div>\n'}),define("dashboard/templates",["icanhaz","text!dashboard-template/header/app_launcher.mustache","text!dashboard-template/header/account.mustache","text!dashboard-template/feed/item.mustache","text!dashboard-template/feed/metrics.mustache","text!dashboard-template/feed/progressbar.mustache","text!dashboard-template/feed/completed.mustache","text!dashboard-template/legaltext/returnpolicy.mustache","text!dashboard-template/legaltext/termsandconditions.mustache","text!dashboard-template/module/actionbar.mustache","text!dashboard-template/module/layout.mustache","text!dashboard-template/module/page.mustache","text!dashboard-template/module/plain.mustache","text!dashboard-template/module/preview.mustache","text!dashboard-template/module/subnavigation.mustache","text!dashboard-template/module/overlay.mustache","text!dashboard-template/module/creditcard.mustache","text!dashboard-template/module/upcoming_billing.mustache","text!dashboard-template/module/installed_apps.mustache","text!dashboard-template/module/billing_history.mustache","text!dashboard-template/module/social/follow.mustache","text!dashboard-template/social/share_tips.mustache","text!dashboard-template/module/klarnapclasses/base.mustache","text!dashboard-template/module/productnavigation/base.mustache","text!dashboard-template/module/productnavigation/childcolumn.mustache","text!dashboard-template/module/productnavigation/itemtools.mustache","text!dashboard-template/module/productnavigation/menuitem.mustache","text!dashboard-template/module/theme/edit.mustache","text!dashboard-template/module/theme/editortoolbar.mustache","text!dashboard-template/module/theme/gallery.mustache","text!dashboard-template/module/theme/previewcontainer.mustache","text!dashboard-template/module/theme/sidebar.mustache","text!dashboard-template/module/theme/start.mustache","text!dashboard-template/module/embedded/index.mustache","text!dashboard-template/welcome/index.mustache","text!dashboard-template/order/message_container.mustache","text!dashboard-template/order/message.mustache","text!dashboard-template/order/details.mustache","text!dashboard-template/order/index.mustache","text!dashboard-template/order/manage.mustache","text!dashboard-template/order/print.mustache","text!dashboard-template/order/row.mustache","text!dashboard-template/order/table.mustache","text!dashboard-template/order/pending_curtain.mustache","text!dashboard-template/product/index.mustache","text!dashboard-template/product/row.mustache","text!dashboard-template/product/table.mustache","text!dashboard-template/theme/standaloneeditor.mustache"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$){e.addTemplate("header/app_launcher",t),e.addTemplate("header/account",n),e.addTemplate("feed/item",r),e.addTemplate("feed/metrics",i),e.addTemplate("feed/progressbar",s),e.addTemplate("feed/completed",o),e.addTemplate("legaltext/returnpolicy",u),e.addTemplate("legaltext/termsandconditions",a),e.addTemplate("module/actionbar",f),e.addTemplate("module/layout",l),e.addTemplate("module/page",c),e.addTemplate("module/plain",h),e.addTemplate("module/preview",p),e.addTemplate("module/subnavigation",d),e.addTemplate("module/overlay",v),e.addTemplate("module/creditcard",m),e.addTemplate("module/upcoming_billing",g),e.addTemplate("module/installed_apps",y),e.addTemplate("module/billing_history",b),e.addTemplate("module/social/follow",w),e.addTemplate("social/share_tips",E),e.addTemplate("module/klarnapclasses/base",S),e.addTemplate("module/productnavigation/base",x),e.addTemplate("module/productnavigation/childcolumn",T),e.addTemplate("module/productnavigation/itemtools",N),e.addTemplate("module/productnavigation/menuitem",C),e.addTemplate("module/theme/edit",k),e.addTemplate("module/theme/editortoolbar",L),e.addTemplate("module/theme/gallery",A),e.addTemplate("module/theme/previewcontainer",O),e.addTemplate("module/theme/sidebar",M),e.addTemplate("module/theme/start",_),e.addTemplate("module/embedded/index",D),e.addTemplate("welcome/index",P),e.addTemplate("order/message_container",H),e.addTemplate("order/message",B),e.addTemplate("order/details",j),e.addTemplate("order/index",F),e.addTemplate("order/manage",I),e.addTemplate("order/print",q),e.addTemplate("order/row",R),e.addTemplate("order/table",U),e.addTemplate("order/pending_curtain",z),e.addTemplate("product/index",W),e.addTemplate("product/row",X),e.addTemplate("product/table",V),e.addTemplate("theme/standaloneeditor",$)}),define("dashboard/view/layout",["jquery","underscore","icanhaz","thirdparty/nprogress","tictail/core","tictail/mediator","tictail/component/log","../model/store/base","../view","./header/app_launcher","../templates"],function(e,t,n,r,i,s,o,u,a,f){var l=this;l.Dashboard=l.Dashboard||{},l.Dashboard.View=l.Dashboard.View||{};var c=l.Dashboard.View.Layout=a.extend({id:"dashboard",nodeCurtain:e("#curtain"),contentView:null,spinnerCount:0,initialize:function(){o.info("Initialize dashboard layout"),c.__super__.initialize.call(this),this.initMediatorSubscriptions()},initHeader:function(){var e=new f;return this.addChildView(e),e},initMediatorSubscriptions:function(){s.subscribe("api.sending app.loading",this.startGlobalSpinner,this),s.subscribe("api.complete app.loaded",this.stopGlobalSpinner,this)},startGlobalSpinner:function(){this.spinnerCount++,this.spinnerCount===1&&(e("body").addClass("loading"),r.start({showSpinner:!1}))},stopGlobalSpinner:function(){this.spinnerCount>0&&(this.spinnerCount--,this.spinnerCount===0&&(e("body").removeClass("loading"),r.done()))},setContentView:function(e,t){if(this.contentView){if(this.contentView.cid===e.cid)return;this.removeChildView(this.contentView)}return this.contentView=e,this.addChildView(e,t),s.publish("dashboard.set_content_view",e.sectionName),this},didRender:function(){var e=this.initHeader();this.cleanCookies(),e.on("ready",t.bind(this.hideCurtain,this))},hideCurtain:function(){var t=e("#loading-logo"),n=this.nodeCurtain,r=!1;i.sessionStorage.getItem("fastCurtain")==="true"?r=!0:i.sessionStorage.setItem("fastCurtain","true"),r?n.fadeOut(100,function(){n.remove()}):t.find(".dots").delay(500).fadeOut(150,"linear",function(){t.animate({top:"120%"},250,"easeInQuart",function(){n.fadeOut(200,"linear",function(){n.remove()})})})},cleanCookies:function(){var e="order-nav-index";i.sessionStorage.removeItem(e)}});return c}),define("dashboard/module/page",["jquery","underscore","../view"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Module=r.Dashboard.Module||{};var i=r.Dashboard.Module.Page=n.extend({id:"page",className:"appsize",bodyId:undefined,template:"module/page",initialize:function(e){i.__super__.initialize.call(this,e),t.isUndefined(e)===!1&&(this.id=e.id||this.id,this.className=e.className||this.className,this.templateContainer=e.templateContainer||this.templateContainer,this.container=e.container||this.container,this.isSubpage=e.isSubpage),this.isSubpage&&(this.id="subpage")},getTitle:function(){return""},setBodyId:function(t){t=t||this.bodyId||"",e("body").attr("id",t)},setFocus:function(){},getTemplateData:function(){var e=this.isSubpage?null:this.getTitle(),n={title:e,has_title:t.isString(e)&&e.length!==0};return n},render:function(){return this.isSubpage||this.setBodyId(),i.__super__.render.call(this)}});return i}),define("dashboard/module/loadpage",["underscore","./page"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Module=n.Dashboard.Module||{};var r=n.Dashboard.Module.LoadPage=t.extend({storeLoadEventName:null,initialize:function(e){r.__super__.initialize.apply(this,arguments),e&&e.data?this.useCachedData(e.data):(this.setLoadingSpinner(),this.addLoadListeners(),this.load())},load:function(){},useCachedData:function(e){var t=this;setTimeout(function(){t.didLoad(e)},0)},addLoadListeners:function(){var e=this.storeLoadEventName;if(e===null)return;this.getCurrentStore().on(e,this.didLoad,this)},removeLoadListeners:function(){this.getCurrentStore().off(null,null,this)},didLoad:function(e){this.data=e,this.removeLoadListeners(),this.setContent(),this.trigger("onLoad")},getLoadedContent:function(){return null},getContent:function(){return this.data===void 0?null:this.getLoadedContent()},setContent:function(){this.removeLoadingSpinner(),this.render()},willRemove:function(){this.removeLoadListeners()}});return r}),define("tictail/constants",{onboarding:{SUBMITTED_SIGNUP_FORM:1,PERFORMED_WELCOME_CARD:2,SEEN_SHARE_HYPE_FORM:3,SEEN_LAUNCH_STORE_CARD:4,SEEN_SHARE_LAUNCH_FORM:5}}),define("dashboard/module/viewloader",["require","jquery","underscore","icanhaz","tictail/core"],function(require,$,_,ich,TT){var getTemplateName=function(e){var t=".mustache",n=e.length-t.length;if(e.substr(n)!==t)throw new Error("Invalid file type for "+e);return e.substr(0,n)},ViewLoader=function(e,t){this.path=e,this.alias=t;var n=3;this.descriptor="/static/template/"+e+".json?v="+n};return _.extend(ViewLoader.prototype,TT.Events,{isLoading:function(){return!_.isUndefined(this._xhr)},load:function(e){if(this.isLoading())throw new Error("Load in progress");return this._xhr=$.ajax({url:this.descriptor,dataType:"json",data:e,success:_.bind(this._loadSuccess,this),error:_.bind(this._loadError,this)}),this.trigger("load",this._xhr,this),this._xhr},abort:function(){if(this.isLoading()){try{this._xhr.abort()}catch(e){}delete this._xhr,this.trigger("abort",this)}},_loadSuccess:function(data,textStatus,jqXHR){if(jqXHR!==this._xhr)return;delete this._xhr,this.trigger("loaded",data,textStatus,jqXHR,this);if(data.css){var headEl=$("head");_.each(data.css,function(e){headEl.append("<style>"+e+"</style>")})}data.template&&_.each(data.template,function(e,t){var n=this.path+"/"+getTemplateName(t);_.has(ich,n)||ich.addTemplate(n,e)},this),data.js&&_.each(data.js,function(js){eval(js)}),data.view&&eval(data.view);var self=this;require([this.alias],function(e){self.trigger("complete",e,self)})},_loadError:function(e,t,n){if(e!==this._xhr)return;delete this._xhr,this.trigger("error",e,t,n,this)}}),ViewLoader}),define("dashboard/nls/feed",{root:{index:{page_title:"",progress_bar:{tasks_left:{singular:'<span class="num">{num}</span> task left',plural:'<span class="num">{num}</span> tasks left'},percentage_done:'<span class="num">{num}%</span> done'},metrics:{visits_label:"Visitors last 7 days",orders_label:"Sales last 7 days",followers_label:"Followers",followers_button:"Get more followers"},ignore:{button_label:"Skip"},do_later:{button_label:"Do later"},open_button:{open_label:"Open",close_label:"Close"},check_mark_labels:["Great job!","Like a boss!","Fantastic!","Amazing!","Incredible!","You rock!","Awesome!","Yeah!","Wow!","Boom!","Excellent!","Too good!","Kudos!","Superb!","Sweet!","Epic!","Hooray!","Yippie!","Beautiful!"]},get_followers:{share:{heading:"Get more followers!",message_label:"Message",status_message:"Get updates from my @tictail online store: {store_url}/#follow",services_label:"Sharing options",share_button_label:"Share",not_now_link_label:"Not now"}},product_reminder:{share:{description:"Share the news about your new products.",message_label:"Message",status_message:"Check out the new products on my @tictail online store: {store_url}",services_label:"Sharing options",share_button_label:"Share",section_label:null}},post_first_product:{share:{heading:"Start building hype!",description:"Excite your friends and followers about what's coming.",message_label:"Message",status_message:"Working on my @tictail online store... Keep an eye on {store_url}!",services_label:"Sharing options",share_button_label:"Share",not_now_link_label:"Not now"}},post_launch:{share:{heading:"Share the great news!",description:"Tell your friends and followers what's new.",message_label:"Message",status_message:"I just launched an online store with @tictail. Check out {store_url}!",services_label:"Sharing options",share_button_label:"Share",not_now_link_label:"Not now"},follow:{heading:"Epically launched!",description:"Do you want to get updates and special offers?",continue_link_label:"Continue"}}}}),define("dashboard/module/feed/itemcontainer",["require","jquery","underscore","tictail/core","tictail/constants","tictail/component/log","tictail/component/api","tictail/component/tracker","tictail/model/feed","../../view","../loadpage","../viewloader","i18n!../../nls/feed","../../templates"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=this;p.Dashboard=p.Dashboard||{},p.Dashboard.Module=p.Dashboard.Module||{},p.Dashboard.Module.Feed=p.Dashboard.Module.Feed||{},p.Dashboard.Module.Feed.Item=p.Dashboard.Module.Feed.Item||{};var d="loading",v="opening",m="opened",g="closing",y="closed",b=function(e){return e===d||e===v||e===m},w=function(e){return e===g||e===y},E=p.Dashboard.Module.Feed.Item.Container=f.extend({tagName:"li",className:"feed-container-view",template:"feed/item",indexName:"index.mustache",state:y,isDisabled:!1,events:function(){return{"click .hit-area":"onClickToggle","click .ignore-button":"onClickIgnore","click .do-later-button":"onClickDoLater","click .toggle-button":"onClickToggle"}},initialize:function(e){E.__super__.initialize.apply(this,arguments),e=e||{};if(n.isUndefined(e.item)===!0)throw new Error("FeedItemContainer must be given a feed item");this.item=e.item,this.data=JSON.parse(this.item.get("data")||null)||{};var t=this.item.get("type_alias")||"",r=this.item.get("type_app")||"",i=new RegExp("\\.","g");this.$el.addClass(t.replace(i," ")),this.view={path:"app/"+r,alias:t.replace(i,"/"),instance:null}},didAppend:function(){this.addItemEventListeners()},willRemove:function(){this.removeItemEventListeners()},open:function(e){this.toggle(!0,e)},close:function(e){this.toggle(!1,e)},toggle:function(e,t){e===void 0&&(e=w(this.state)),e=!!e;if(e===b(this.state)||this.isDisabled)return;if(e&&this.item.get("status")===a.STATUS.PERFORMED)return;e?this.showItemView(t):this.hideItemView(t)},isOpen:function(){return b(this.state)},_setState:function(e){if(e===this.state)return;this.state=e,this.$el.removeClass("state-loading state-opening state-opened state-closing"),e!==y&&this.$el.addClass("state-"+e),this.trigger("on"+e.charAt(0).toUpperCase()+e.slice(1),this)},disable:function(e){this.isDisabled=e!==!1},ignore:function(){var e=this;this.item.set("status",a.STATUS.IGNORED);var t=new o.Request("feed.item.ignore",{store_id:r.session.getCurrentStore().id,id:this.item.id},"POST",null);t.setOnSuccess(function(t,n,r,i){e.trackFeedEvent("Ignored Item"),u.track("Feed: Ignored "+e.item.get("type_alias"))}),t.setOnError(function(e,t,n,r){s.error("Failed to ignore feed item",e,n,r,t)}),t.send()},doLater:function(){var e=this;this.item.set("status",a.STATUS.POSTPONED);var t=new o.Request("feed.item.postpone",{store_id:r.session.getCurrentStore().id,id:this.item.id},"POST",null);t.setOnSuccess(function(t,n,r,i){e.trackFeedEvent("Postponed Item"),u.track("Feed: Postponed "+e.item.get("type_alias"))}),t.setOnError(function(e,t,n,r){s.error("Failed to postpone feed item",e,n,r,t)}),t.send()},trackFeedEvent:function(e){var t=this.item.get("feed_item_id")||this.item.get("type_alias");u.track("Feed: "+e,t,{"Feed Item Id":t})},showItemView:function(e){if(b(this.state))return;this.loadItemView(e)},loadItemView:function(t){var n=this.view.path,r=this.view.alias;if(!e.specified(r)){this._setState(d);var i=new c(n,r);i.on("complete",function(e){this.state===d&&this.initItemView(e,t)},this),i.load()}else{var s=this;e([r],function(e){s.initItemView(e,t)})}},initItemView:function(e,t){var n=null;this.view.instance===null?(n=this.view.instance=new e({isSubpage:!0,feedItemContainer:this,data:this._cachedData}),this.addChildView(n,this.$(".feed-item-content")),n.on("onPerform",function(){this.trigger("onPerform",this),this.close(),this.renderStatus(a.STATUS.PERFORMED,!0),this.item.markAsPerformed()},this),n instanceof l?n.on("onLoad",function r(){n.off("onLoad",r),this.itemViewVisible(t)},this):this.itemViewVisible(t)):(n=this.view.instance,this.itemViewVisible(t))},itemViewVisible:function(e){e!==!1?this._animateOpen():(this._setState(v),this._setState(m));var t=this.view.instance;t!==null&&t.setFocus!==void 0&&t.setFocus()},hideItemView:function(e){if(w(this.state))return;if(this.state===d){this._setState(y);return}e!==!1?this._animateClose():(this._setState(g),this._setState(y))},_animateOpen:function(){var e=this,n=this.$(".content-wrap"),r=this.$(".feed-item-content"),i=n.height();this._setState(v),this.$el.queue(function(r){n.stop(!0).css("height",0).animate({height:i,opacity:1},{duration:200,easing:"easeInOutQuart",complete:function(){t(this).css({height:"",opacity:""}),e._setState(m),r()}})})},_animateClose:function(){var e=this,n=this.$(".content-wrap");this._setState(g),this.$el.queue(function(r){n.stop(!0).animate({height:0,opacity:0},{duration:150,easing:"easeInOutQuart",complete:function(){t(this).css({height:"",opacity:""}),e._setState(y),r()}})})},willMoveElement:function(){var e=this.view.instance;e!==null&&(this._cachedData=e.data,this.removeChildView(e),this.view.instance=null)},addItemEventListeners:function(){this.item.on("change",this.onItemChange,this)},removeItemEventListeners:function(){this.item.off("change",this.onItemChange,this)},onItemChange:function(e,t){var n=t.changes||{};n.status&&(this.close(),this.renderStatus())},onClickToggle:function(e){e.preventDefault(),this.toggle()},onClickIgnore:function(e){e.preventDefault(),this.ignore()},onClickDoLater:function(e){e.preventDefault(),this.doLater()},getTemplateData:function(){var e=h.index;return{title:this.data.title,is_ignorable:this.item.get("is_ignorable"),ignore_button_label:e.ignore.button_label,is_postponable:this.item.get("is_postponable"),do_later_button_label:e.do_later.button_label,open_button_label:e.open_button.open_label,close_button_label:e.open_button.close_label,icon_images:this.data.icon_images}},didRender:function(){var e=this.item.get("type_alias");if(e==="feed.store.settings.launch"){var t=i.onboarding.SEEN_LAUNCH_STORE_CARD;u.trackOnboarding(t)}return this.renderStatus(),this},renderStatus:function(e,t){e||(e=this.item.get("status"));var n=this.$el,r="status-"+this.statusToString(e);if(n.hasClass(r))return;var i=function(){n.removeClass("status-new status-performed status-postponed status-ignored").addClass(r)};if(e===a.STATUS.PERFORMED){if(this._checkMarkLabel===void 0){var s=h.index.check_mark_labels;this._checkMarkLabel=s[this.item.id%s.length]}var o=this.$(".check-mark").text(this._checkMarkLabel);if(t===!0){o.hide(),n.queue(function(e){i(),o.fadeIn(200,e)});return}}i()},statusToString:function(e){var t=a.STATUS;switch(e){case t.PERFORMED:return"performed";case t.POSTPONED:return"postponed";case t.IGNORED:return"ignored";default:return"new"}}});return E}),define("dashboard/module/feed/list",["jquery","underscore","tictail/core","tictail/mediator","tictail/component/api","tictail/component/log","tictail/component/tracker","tictail/model/feed","../../view","./itemcontainer","i18n!../../nls/feed"],function(e,t,n,r,i,s,o,u,a,f,l){var c=this;c.Dashboard=c.Dashboard||{},c.Dashboard.Module=c.Dashboard.Module||{},c.Dashboard.Module.Feed=c.Dashboard.Module.Feed||{};var h=function(t,n){var r=t[0].nextSibling,i=t[0].parentNode;return t.detach(),r?e(r).before(n):e(i).append(n),t},p=c.Dashboard.Module.Feed.List=a.extend({id:"feed-items",initialize:function(){p.__super__.initialize.apply(this,arguments),p.loadSounds();var e=this.collection=this.options.collection;if(!e)throw new Error("FeedList module must be given a collection");e.comparator===void 0&&(e.comparator=t.bind(this.collectionComparator,this),e.length!==0&&e.sort()),this._itemViews={},this.initItemViews()},didAppend:function(){this.collection.isEmpty()&&this.renderFeedCompletedView(),this.addCollectionListeners(),this.queueRefresh()},renderFeedCompletedView:function(){var e=this._feedCompletedView=ich["feed/completed"]();this.$el.prepend(e)},removeFeedCompletedView:function(){if(t.isUndefined(this._feedCompletedView))return;this._feedCompletedView.remove()},willRemove:function(){this.removeCollectionListeners(),this.stopDelayedRefresh()},hasOpenItem:function(){return t.any(this._itemViews,function(e){return e.isOpen()})},queueRefresh:function(){this.options.repeatRefresh!==!1&&this.refreshDelayed()},refresh:function(){if(this.hasOpenItem())return s.info("Skip refresh of feed items since one item is currently opened."),this.queueRefresh(),!1;var e=this,t=this.collection,o=t.sync?t:n;s.info("Send fetch request to refresh feed items");var u=new i.Batch,a=o.getSyncRequest("read",t,{success:function(n,r,i){var o=0;for(var u=n.length-1;u>=0;u--)t.get(n[u].id)===void 0&&o++;o===0||!e.hasOpenItem()?e.applyCollectionUpdates(n):s.info("Skip update of feed since user is working on an existing item"),e.queueRefresh()}});return u.appendRequest(a),r.publish("feed.on_refresh",u),u.send(),!0},refreshDelayed:function(e,t){this.stopDelayedRefresh(),t===!0||this._refreshCount===void 0?this._refreshCount=0:this._refreshCount++,e=e||this.options.refreshDelay||6e4,e*=Math.floor(this._refreshCount/5)*2||1;var n=this;this._refreshTimeout=setTimeout(function(){n.stopDelayedRefresh(),n.refresh()},e)},stopDelayedRefresh:function(){this._refreshTimeout!==void 0&&(clearTimeout(this._refreshTimeout),delete this._refreshTimeout)},applyCollectionUpdates:function(e){var n=this.collection,r=n.parse(e),i=n.pluck("id"),s,o,u;for(var a=0,f=r.length;a<f;a++)s=r[a],o=n.get(s.id),o===void 0?n.add(s):(o.set(s),u=t.indexOf(i,s.id),~u&&i.splice(u,1));for(a=0,f=i.length;a<f;a++)n.remove(n.get(i[a]))},shouldRenderItem:function(e){var t=u.STATUS,n=e.get("status");return n!==t.NEW&&n!==t.PERFORMED?!1:!0},createItemView:function(e,t){var n=new f({id:"feed-item-"+e.id,item:e});return n},initItemView:function(e,t){t.on("onOpening",this.onItemViewOpening,this),t.on("onPerform",this.onItemPerform,this),this._itemViews[String(e)]=t},initItemViews:function(){this.collection.each(function(e,t){if(!this.shouldRenderItem(e))return;var n=this.createItemView(e,t);this.initItemView(e.id,n)},this)},getComparatorScoring:function(e,t){var n={},r=n.v1=e.get("status"),i=n.v2=t.get("status");return r!==i?n:(r=n.v1=e.get("scoring"),i=n.v2=t.get("scoring"),r!==i?n:(r=n.v1=e.get("performed_at")||0,i=n.v2=t.get("performed_at")||0,r!==i?n:(n.v1=-e.id,n.v2=-t.id,n)))},collectionComparator:function(e,t){var n=this.getComparatorScoring(e,t);return n.v1<n.v2?1:n.v1>n.v2?-1:0},addCollectionListeners:function(){this.collection.on("add",this.onCollectionItemAdd,this),this.collection.on("remove",this.onCollectionItemRemove,this),this.collection.on("reset",this.onCollectionReset,this),this.collection.on("change",this.onCollectionItemChange,this)},removeCollectionListeners:function(){this.collection.off("add",this.onCollectionItemAdd,this),this.collection.off("remove",this.onCollectionItemRemove,this),this.collection.off("reset",this.onCollectionReset,this),this.collection.off("change",this.onCollectionItemChange,this)},onCollectionItemAdd:function(e,t,n){if(!this.shouldRenderItem(e))return;this.addItemView(e,n.index,n.animate)},onCollectionItemRemove:function(e,t,n){this.removeItemView(this.getItemViewByModel(e),n.animate)},onCollectionReset:function(n,r){if(r.sorting===!0&&r.animated!==!1){var i=this,s=!1,o=[];this.getItemViewsContainerNode().children(".feed-container-view").each(function(t,r){var i=e(r).attr("id"),o=i.substr(i.lastIndexOf("-")+1),u=n.at(t);if(!u||String(u.id)!==o)return s=!0,!1});if(!s)return;t.each(this._itemViews,function(e,t,n){e.close(),o.push(e.el)}),e(o).promise().done(function(){i.sortItemViewsAnimated(r)})}else this.removeAllItemViews(),this.initItemViews(),this.renderItemViews()},onCollectionItemChange:function(e,t){var n=t.changes||{};this.options.refreshOnStatusChange!==!1&&n.status&&this.refreshDelayed(this.options.statusRefreshDelay||2e3,!0);if(!this.shouldRenderItem(e)){this.removeItemView(this.getItemViewByModel(e));return}if(this.getItemViewByModel(e)===null){this.addItemView(e,this.collection.indexOf(e));return}if(n.status||n.scoring||n.performed_at){var r=null;n.status&&(r=e),this.collection.sort({sorting:!0,sortSubject:r})}},getItemViews:function(){return this._itemViews},getItemViewByModel:function(e){return this._itemViews[String(e.id)]||null},addItemView:function(e,t,n){if(this._itemViews[String(e.id)]!==void 0)return;var r=this.createItemView(e,t),i=this.getItemViewsContainerNode(),s=t!==undefined?i.children().eq(t):null;this.initItemView(e.id,r),this.addChildView(r,null),s&&s.length!==0?r.insertBefore(s):r.appendTo(i),n!==!1&&r.$el.hide().css("opacity",0).slideDown(200).animate({opacity:1},200),this.removeFeedCompletedView(),this.$el.removeClass("empty")},removeItemView:function(e,n){if(!e)return;e.off(null,null,this),delete this._itemViews[String(e.item.id)];var r=this,i=function(){r.removeChildView(e),t.isEmpty(r._itemViews)&&(r.$el.addClass("empty"),r.renderFeedCompletedView())};n!==!1?e.$el.stop(!0,!0).animate({opacity:0},200).slideUp(200,i):i()},removeAllItemViews:function(){t.each(this._itemViews,function(e){e.off(null,null,this),e.$el.stop(!0,!0),this.removeChildView(e)},this),this.$el.addClass("empty")},sortItemViewsAnimated:function(n){var r=this.$el.offsetParent(),i=this.getItemViewsContainerNode();t.each(this._itemViews,function(t){var n=t.$el,i=n.position(),s;n.hasClass("state-sorting")?s=e("#feed-placeholder-"+t.item.id):(s=e('<li class="feed-placeholder"/>').attr("id","feed-placeholder-"+t.item.id).css({height:n.height()}),n.addClass("state-sorting").css({position:"absolute",top:i.top,left:0,width:n.width()}),t.willMoveElement(),t.disable(!0),h(n,s).appendTo(r)),n.stop("sort",!0).css("text-indent",0).animate({"text-indent":100},{queue:"sort",duration:400,step:this._makeSortStepCallback(n,i.top,s),complete:this._makeSortCompleteCallback(t,n,s)}).dequeue("sort")},this);for(var s=0,o=this.collection.length;s<o;s++)e("#feed-placeholder-"+this.collection.at(s).id).appendTo(i);if(n.sortSubject){var u=this._itemViews[String(n.sortSubject.id)];u&&u.$el.addClass("state-sort-highlighted")}},_makeSortStepCallback:function(e,t,n){return function(r){var i=n.position().top;e.css("top",i+Math.round((t-i)*(1-r/100)))}},_makeSortCompleteCallback:function(e,t,n){return function(){t.removeClass("state-sorting state-sort-highlighted").css({position:"",top:"",left:"",width:"","text-indent":""}),n.replaceWith(t),e.disable(!1)}},onItemViewOpening:function(e){t.each(this._itemViews,function(t){t!==e&&t.toggle(!1)},this),this.trackFeedEvent("Opened Item",e)},onItemPerform:function(e){p.playPerformSound(),this.trigger("onItemPerform",e.item,this),this.trackFeedEvent("Performed Item",e),o.track("Feed: Performed "+e.item.get("type_alias"))},trackFeedEvent:function(e,t){var n=t.item.get("feed_item_id")||t.item.get("type_alias");o.track("Feed: "+e,n,{"Feed Item Id":n})},getItemViewsContainerNode:function(){return n.getLazy(this,"_itemContainer",function(){return e("<ul/>").appendTo(this.$el)})},renderContent:function(){p.__super__.renderContent.apply(this,arguments),delete this._itemContainer,this.renderItemViews()},renderItemViews:function(){var n=this.getItemViewsContainerNode(),r,i=this.options.feedItemToOpen,s;this.collection.each(function(e){r=this._itemViews[String(e.id)],r&&this.addChildView(r,n),e.id===i&&(s=r)},this),this.$el.toggleClass("empty",t.isEmpty(this._itemViews));var o=function(n){n.find(".hit-area").trigger("click"),t.delay(function(){e("body,html").animate({scrollTop:n.offset().top},750)},200)};s!=null&&t.defer(o,s.$el)}},{loadSounds:function(){this._performSound===void 0&&(this._performSound=this._getSound([{type:"audio/ogg",src:"feed_item_performed.ogg"},{type:"audio/mpeg",src:"feed_item_performed.mp3"}]),this._performSound&&(this._performSound.volume=.5))},_getSound:function(e,t){var n="/static/s/",r=document.createElement("audio");if(!r||!r.canPlayType)return null;for(var i=0,s=e.length;i<s;i++){var o=e[i];if(r.canPlayType(o.type).replace(/no/,"")){r.type=o.type,r.src=n+o.src;break}}return r.src?(t!==!1&&r.load(),r):null},playPerformSound:function(){this._performSound&&this._performSound.play()}});return p}),define("dashboard/module/feed/progressbar",["jquery","underscore","tictail/core","../../view","i18n!../../nls/feed"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.Module=s.Dashboard.Module||{},s.Dashboard.Module.Feed=s.Dashboard.Module.Feed||{};var o=s.Dashboard.Module.Feed.ProgressBar=r.extend({id:"feed-progress-bar",template:"feed/progressbar",events:{"click .tooltip":"show"},initialize:function(){o.__super__.initialize.apply(this,arguments),this.isExpanded=!1,this.goal=this.options.goal!==void 0?this.options.goal:"",this.left=this.options.left!==void 0?this.options.left:0,this.total=this.options.total!==void 0?this.options.total:0},setGoal:function(e){this.goal=e,this.updateGoal()},setProgress:function(e,t){e<0&&(e=0);if(e===this.left&&t===this.total)return;this.left=e,this.total=t,this.updateProgress()},onKeydown:function(e){e.keyCode==27&&this.toggleExpanded()},onDocumentClick:function(){this.toggleExpanded()},setExpandedEventListeners:function(){this._onKeydownCallback=t.bind(this.onKeydown,this),this._onDocumentClickCallback=t.bind(this.onDocumentClick,this);var n=e(document);n.on("keydown",this._onKeydownCallback),n.on("click",this._onDocumentClickCallback)},removeExpandedEventListeners:function(){var t=e(document);t.off("keydown",this._onKeydownCallback),t.off("click",this._onDocumentClickCallback)},show:function(e){e.stopPropagation(),this.isExpanded||this.toggleExpanded()},toggleExpanded:function(){var e=this.$el.hasClass("expanded");e?(this.removeExpandedEventListeners(),this.$el.removeClass("expanded"),this.isExpanded=!1):(this.setExpandedEventListeners(),this.$el.addClass("expanded"),this.isExpanded=!0)},updateGoal:function(){this.$(".goal").text(this.goal)},updateProgress:function(r){var s=this,o=i.index.progress_bar,u=Math.min(Math.max(1-this.left/this.total,0),1),a=n.lang(this.left===1?o.tasks_left.singular:o.tasks_left.plural,{num:this.left}),f=n.lang(o.percentage_done,{num:Math.round(u*100)}),l=function(e){e.find(".tooltip").toggleClass("left-aligned",e.width()<240)};u>0&&u<1&&this.$el.show().removeClass("expanded"),this.$(".progress").html(f);if(r!==!1)this.$(".bar").addClass("animating").animate({width:u*100+"%"},400,"easeInOutCubic",function(){l(e(this).removeClass("animating")),u<=0?s.$el.hide():u>=1&&s.$el.delay(1e3).fadeOut(150)}).css("overflow","");else{var c=this.$(".bar").css("width",u*100+"%");t.defer(function(){l(c)}),u>=1&&this.$el.hide()}this.$(".data-box.tasks-left").html(a),this.$(".data-box.percentage").html(f)},didRender:function(){return this.$el.hide(),this.updateGoal(),this.updateProgress(!1),this},hasCompleted:function(){return this.left==0}});return o}),define("tictail/component/actionbar",["jquery","underscore","../core","../view"],function(e,t,n,r){var i=this;i.TT=i.TT||{};var s=i.TT.Actionbar=r.extend({attributes:{"class":"actions"},template:"module/actionbar",paramsCacheKey:"actionbarParams",dataCacheKey:"actionbarData",delegateEventPrefix:"actionbar",initialize:function(e,t){this.delegate=t},events:function(){return{"click a":"didClickLink","click button":"didClickButton"}},getParams:function(){var e=this;return n.getLazy(this,this.paramsCacheKey,function(){return e.callDelegate("GetParams")})},getTemplateData:function(){var e=this,t=n.getLazy(this,this.dataCacheKey,function(){var t={link:[],button:[]},n,r,i,s,o=e.getParams();for(n in o)r=o[n],i=r.isButton?t.button:t.link,s={name:n,label:r.label,tabIndex:r.tabIndex||999},r.isButton&&(s.type=r.type||"button"),i.push(s);return t});return t},getEventParams:function(t){var n=e(t.currentTarget),r=n.attr("id").split("-");return r=r.slice(1).join("-"),{node:n,name:r,data:this.getParamsByName(r)}},getParamsByName:function(e){return this.getParams()[e]},didClickLink:function(e){this.didClickItem(e)},didClickButton:function(e){this.didClickItem(e)},didClickItem:function(e){e.preventDefault();var t=this.getEventParams(e);if(t.node.prop("disabled")||t.node.hasClass("disabled"))return;var n=t.data.callback;return n!==undefined&&n.call(this.delegate,e,t.data),this.callDelegate("DidClickItem",e,t.name,t.data),!1},callDelegate:function(e){e=this.delegateEventPrefix+e;var t=this.delegate[e];if(t===undefined)return;var n=Array.prototype.slice.call(arguments);return t.apply(this.delegate,n.slice(1))}});return s}),define("tictail/form/core",["jquery","underscore","../view","../utility","../component/api","../component/log","../component/actionbar"],function(e,t,n,r,i,s,o){var u=this;u.TT=u.TT||{};var a=u.TT.Form=n.extend({tagName:"form",buttonLabel:"Save",attributes:{novalidate:!0},model:undefined,allFields:[],requiredFields:[],initialize:function(e){e=e||{};var n=e.model||this.model;return t.isFunction(n)&&(n=new n),this.model=n,this.buttonLabel=e.buttonLabel||this.buttonLabel,this._initFields(e.include),e.hasActionbar!==!1&&(this.actionbar=new o({},this)),this.$el.submit(t.bind(this.onSubmit,this)),this},actionbarGetParams:function(){var e=this;return{save:{label:this.buttonLabel,isButton:!0,type:"submit",callback:function(){e.save()}}}},actionbarDidClickItem:function(){},save:function(e){var t=this,n=arguments;this.setLoadingSaveButton(!0,!0),this.validate({refreshValue:!0}).then(function(){t._performSave.apply(t,n)},function(){t.setLoadingSaveButton(!1)})},_performSave:function(e){if(this.hasModel()!==!0){this.setLoadingSaveButton(!1);return}var n=t.isArray(e),r=this.model.save(this.model.attributes,{wait:!0,success:t.bind(this.onSuccessfulSave,this),error:t.bind(this.onSaveError,this),getRequest:n});if(n){var s=new i.Batch;s.appendRequest(r),t.each(e,function(e){s.appendRequest(e)}),s.send()}this.onSaving(this.model)},onSaving:function(e){this.trigger("onSaving",e,this)},onSuccessfulSave:function(e,t){s.debug("Did save form model successfully",t),this.setLoadingSaveButton(!1),this.trigger("onSave",e,t,this)},onSaveError:function(e,t){s.debug("Caught error on form model save",arguments),this.setLoadingSaveButton(!1),this.trigger("onSaveError",e,t,this)},createField:function(e){return null},getValues:function(e){var n={},r;return t.each(this.getSortedFields(e),function(e){r=e.value,n[e.name]=r.getValue()}),n},getSortedFields:function(e){return this._fields.getSorted(e)},isIncluded:function(e,n){if(t.isString(e))return t.indexOf(this.included,e)!==-1;var r=t.difference(e,this.included);return n===!0?r.length>0:r.length===0},getField:function(e){return this._fields.get(e)},getFields:function(e){e=e||[];var n=[],r=t.isEmpty(e)?this.included:t.intersection(e,this.included);return t.each(this.getSortedFields(r),function(e){n.push(e.value)}),n},getAllFields:function(){return this._fields.getAll()},addField:function(e,t,n){this._fields.add(e,t),n!==!1&&this.addChildView(t)},removeField:function(e,t){if(t!==!1){var n=this.getField(e);this.removeChildView(n)}this._fields.remove(e)},getSaveButton:function(){var e=this.actionbar;return e||(e=this),e.$("button[type=submit]")},setLoadingSaveButton:function(e,t){var n=this.getSaveButton();n&&n.length!==0&&n.ui("setLoading",e,t)},setFocus:function(){var e=this._fields.first();e!==null&&e.setFocus()},render:function(){return this.empty(),this.addChildView(this.getFields()),this.actionbar&&this.addChildView(this.actionbar),this.didRender()},validate:function(n){n=n||{};var r,i=[],s,o=n.bailEarly!==!1,u;return t.any(this.getAllFields(),function(e){u=e.validate;if(t.isUndefined(u)!==!0){r=e.validate(n),i.push(r);if(o&&r.state()==="rejected")return!0}}),s=e.when.apply(e,i),n.outputError!==!1&&s.fail(function(e,t){t&&t.setFocus()}),s},hasModel:function(){return t.isUndefined(this.model)!==!0},_initFields:function(e){this.included=[],this._fields=new r.OrderedHash;var n=e!==void 0;if(n&&e.length===0)return;var i=this.allFields,s=this.requiredFields;t.isFunction(i)&&(i=i.call(this)),t.isFunction(s)&&(s=s.call(this)),n||(e=i);var o=t.difference(s,e);if(o.length>0)throw new Error("Missing required fields in form: "+o);var u={};t.each(i,function(e){u[e]=!0});var a,f;for(var l=0,c=e.length;l<c;l++)a=e[l],this.included.push(a),u[a]===!0&&(f=this.createField(a),f!==null&&this.addField(a,f,!1))},onSubmit:function(e){e.preventDefault(),this.save()}});return a}),define("tictail/form/fieldset",["../component/grid"],function(e){var t=this;t.TT=t.TT||{},t.TT.Form=t.TT.Form||{};var n=t.TT.Form.Fieldset=e.extend({tagName:"fieldset",initialize:function(e){return n.__super__.initialize.call(this,e),this.addColumn("inner-left-column",this.getTitle(),{tagName:"h4",gutterClass:"no-gutter-l"}),this.addColumn("inner-right-column",e.rightColumnContent,{gutterClass:"no-gutter"}),this},getTitle:function(){var e=this.options.title,t=this.options.description;return t===undefined?e:e+"<span>"+t+"</span>"},addContent:function(e){this.columns[1].$el.append(e)}});return n}),function(e){typeof define=="function"&&define.amd?define("thirdparty/jquery/placeholder",["jquery"],function(t){e(window,document,t)}):e(window,document,jQuery)}(function(e,t,n){function l(e){var t={},r=/^jQuery\d+$/;return n.each(e.attributes,function(e,n){n.specified&&!r.test(n.name)&&(t[n.name]=n.value)}),t}function c(e,t){var r=this,i=n(r);if(r.value==i.attr("placeholder")&&i.hasClass("placeholder"))if(i.data("placeholder-password")){i=i.hide().next().show().attr("id",i.removeAttr("id").data("placeholder-id"));if(e===!0)return i[0].value=t;i.focus()}else r.value="",i.removeClass("placeholder"),r==p()&&r.select()}function h(){var e,t=this,r=n(t),i=this.id;if(t.value==""){if(t.type=="password"){if(!r.data("placeholder-textinput")){try{e=r.clone().attr({type:"text"})}catch(s){e=n("<input>").attr(n.extend(l(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":r,"placeholder-id":i}).bind("focus.placeholder",c),r.data({"placeholder-textinput":e,"placeholder-id":i}).before(e)}r=r.removeAttr("id").hide().prev().attr("id",i).show()}r.addClass("placeholder"),r[0].value=r.attr("placeholder")}else r.removeClass("placeholder")}function p(){try{return t.activeElement}catch(e){}}var r="placeholder"in t.createElement("input"),i="placeholder"in t.createElement("textarea"),s=n.fn,o=n.valHooks,u=n.propHooks,a,f;r&&i?(f=s.placeholder=function(){return this},f.input=f.textarea=!0):(f=s.placeholder=function(){var e=this;return e.filter((r?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":c,"blur.placeholder":h}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},f.input=r,f.textarea=i,a={get:function(e){var t=n(e),r=t.data("placeholder-password");return r?r[0].value:t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,t){var r=n(e),i=r.data("placeholder-password");return i?i[0].value=t:r.data("placeholder-enabled")?(t==""?(e.value=t,e!=p()&&h.call(e)):r.hasClass("placeholder")?c.call(e,!0,t)||(e.value=t):e.value=t,r):e.value=t}},r||(o.input=a,u.value=a),i||(o.textarea=a,u.value=a),n(function(){n(t).delegate("form","submit.placeholder",function(){var e=n(".placeholder",this).each(c);setTimeout(function(){e.each(h)},10)})}),n(e).bind("beforeunload.placeholder",function(){n(".placeholder").each(function(){this.value=""})}))}),define("tictail/form/field/core",["jquery","underscore","../../view","../../component/log","thirdparty/jquery/placeholder"],function(e,t,n,r){var i=this;i.TT=i.TT||{},i.TT.Form=i.TT.Form||{};var s=i.TT.Form.Field=n.extend({tagName:"div",attributes:{"class":"field"},tabIndex:999,initialize:function(e){s.__super__.initialize.apply(this,arguments),e=e||{};var n=e.attributes||{};this.attributes=t.extend({},this.attributes,n);var r=e.key;if(r===undefined)throw new Error("No field key given!");this.key=r,this.id===undefined&&(this.id="field-"+r),this.required=!!e.required,t.isObject(e.model)&&this.initModelRelationship(e.model),e.tabIndex!==undefined&&(this.tabIndex=e.tabIndex)},didAppend:function(){t.isUndefined(this.model)!==!0&&this.addModelListeners()},willRemove:function(){t.isUndefined(this.model)!==!0&&this.removeModelListeners()},initModelRelationship:function(e){if(!e||!e.instance)throw new Error("A field must be bound to a model");this.model=e.instance,this.modelAttributeName=e.attribute,this.modelGetter=e.getter,this.modelSetter=e.setter,this.synchronizeModel=e.synchronize!==!1;var n=this.attributes.value;t.isUndefined(n)===!0&&(n=this.getValueFromModel()),this.setInitValue(n),r.debug("Field",this,"was bound to model",this.model,"with value",n)},addModelListeners:function(){},removeModelListeners:function(){},getModelAttributeName:function(){return this.modelAttributeName},getValueFromModel:function(){return this.modelGetter?this.model[this.modelGetter]():this.modelAttributeName?this.model.get(this.modelAttributeName):null},setValueOnModel:function(e){this.modelSetter?this.model[this.modelSetter](e):this.modelAttributeName&&this.model.set(this.modelAttributeName,e)},setInitValue:function(e){this.initValue=e,this.setValue(e,!1,!1,!1)},setNodeValue:function(e){},getValue:function(e,t){if(e===!0&&!this._isValid(t))throw new Error("The value for this field is invalid");return this.value},setValue:function(e,t,n,i){e=this._sanitize(e),t=t===undefined?!0:t,i=i===undefined?!0:i;var s=!1,o=this.valueHasChanged(e);this.value=e,r.debug("Did set field",this,"internal value to",e),this.trigger("onSet",this);if(o){if(t&&!this._isValid(n))return r.info("Value for",this,"did not validate"),!1;s=!0}return i&&s&&this.triggerChange(),!0},valueHasChanged:function(e){return this.value!==e},triggerChange:function(){r.info("Did change field value: ",this.key),this.trigger("onChange",this)},setRequired:function(e){e=t.isUndefined(e)?!0:e,this.required=e,e?this.$el.addClass("required"):this.$el.removeClass("required")},setOptional:function(){return this.setRequired(!1)},validate:function(n){n=n||{};var r=this,i=this.value,s=e.Deferred(),o;return this.unsetError(),n.outputError!==!1&&s.fail(function(e){r.setError(e)}),(!i||t.isArray(i)&&!i.length)&&i!="0"?this.required&&(o=[gettext("This field is required")]):o=this._validate(i),o&&o.length!==0?s.reject(o,this):n.localOnly===!0?s.resolve(this):this._validateRemote(i,s),s.promise()},_sanitize:function(e){return e},_isValid:function(e){var t=!0;return this.validate({outputError:e,localOnly:!0}).fail(function(){t=!1}),t},_validate:function(e){return[]},_validateRemote:function(e,t){t.resolve(this)},getLabel:function(){var n=this.options;if(!n.label)return null;var r=n.label;t.isFunction(r)&&(r=r.call(this));var i=e(this.make("label",{"for":this.id},r));if(n.labelDescription){var s=n.labelDescription;t.isFunction(s)&&(s=s.call(this)),i.append(e(this.make("span",{"class":"description"},s)))}return i},generateInfoLink:function(){var t=this,n=gettext("Help");return e('<a href="#" class="info-link manual">'+n+"</a>").click(function(e){e.preventDefault(),e.stopPropagation(),t.showInfo()})},showInfo:function(n){var r=this,i=this.options.information,s,o,u,a,f;n===undefined&&(n=!this.$el.hasClass("showing-info")),n?(t.isFunction(i)&&(i=i()),s=this.generateInfoNode(i),this.$el.addClass("showing-info").find(".info-link").text("Close").end().append(s),o=s.outerWidth(!0),u=e(window).width(),s.offset().left+o>=u&&(a=s.offsetParent(),f=Math.max(u-s.offsetParent().offset().left-o,a.width()-o+20),s.addClass("below").css("left",f).find(".arrow").css("left",a.width()-f-30)),s.delay(50).queue(function(){s.addClass("animate")}),e("html").one("click",function(){r.showInfo(!1)})):this.$el.removeClass("showing-info").find(".info-link").text("Help").end().find(".information").remove()},generateInfoNode:function(t){return e('<div class="information"/>').append(e('<div class="arrow"/>')).append(t)},generateErrorNode:function(n){var r=this,i=e("<ul/>").addClass("errors");return t.each(n,function(e){i.append(r.make("li",{},e))}),i},setError:function(e){this.unsetError(),e&&e.length!==0&&this.generateErrorNode(e).appendTo(this.el)},unsetError:function(){this.$(".errors").remove()},setFocus:function(){},prepareClasses:function(){var e=[];this.required&&e.push("required"),this.options.labelDescription&&e.push("has-description");if(t.isEmpty(e))return 0;var n=e.length;return e=e.join(" "),this.$el.addClass(e),n},render:function(){this.empty();var e=this.$el;return e.append(this.getLabel()),this.prepareClasses(),this.renderField(),this.setNodeValue(this.value),this.options.information&&e.append(this.generateInfoLink()),this.prepareContent(e),this.$("input, textarea").placeholder(),this.didRender()},renderField:function(){}});return s}),define("tictail/form/field/input",["jquery","underscore","../../component/log","./core"],function(e,t,n,r){var i=this;i.TT=i.TT||{},i.TT.Form=i.TT.Form||{},i.TT.Form.Field=i.TT.Form.Field||{};var s=i.TT.Form.Field.Input=r.extend({fieldTagName:undefined,fieldAttributes:{},disabled:!1,getEventKey:function(e){return e+" #"+this.id},events:function(){var e={};return e[this.getEventKey("focus")]="onFocus",e[this.getEventKey("blur")]="onBlur",e[this.getEventKey("change")]="onChange",e[this.getEventKey("keyup")]="onKeyUp",e},initialize:function(e){e=e||{};var n=e.fieldAttributes||{};this.fieldAttributes=t.extend({},this.fieldAttributes,n);if(this.fieldTagName===undefined)throw new Error("Field tag name is not specified");this.fieldTagName=e.fieldTagName||this.fieldTagName,t.isUndefined(this.fieldAttributes.name)&&(this.fieldAttributes.name=e.key),t.isUndefined(e.disabled)===!1&&(this.disabled=e.disabled),s.__super__.initialize.call(this,e)},addModelListeners:function(){this.model.on("change:"+this.modelAttributeName,this.onModelAttributeChange,this)},removeModelListeners:function(){this.model.off("change:"+this.modelAttributeName,this.onModelAttributeChange,this)},onModelAttributeChange:function(e,t,n){if(this._isOurModelChangeEvent)return;t=this.getValueFromModel(),this.value=t,this.setNodeValue(t)},setNodeValue:function(e){this._setFieldValue(e)},_getFieldValue:function(){var e=this._getFieldNode();return e?e.val():null},_setFieldValue:function(e){var t=this._getFieldNode();t&&t.val(e)},_valueChanged:function(e,t,n){if(!this.setValue(e,t,!0,n))return;this.synchronizeModel&&(this._isOurModelChangeEvent=!0,this.setValueOnModel(this.value),delete this._isOurModelChangeEvent)},_refreshValue:function(e){var t=this._getFieldValue();this.valueHasChanged(t)&&this._valueChanged(t,!1,!e)},validate:function(e){return e&&e.refreshValue&&this._refreshValue(),s.__super__.validate.call(this,e)},_getFieldNode:function(){var n=this;return TT.getLazy(this,"_ctrl",function(){var r=t.extend({id:n.id,tabindex:n.tabIndex,disabled:n.disabled},n.fieldAttributes);return e(n.make(n.fieldTagName,r),n.value)})},disable:function(e){e=t.isUndefined(e)?!0:e,this._getFieldNode().attr("disabled",e),this.disabled=e},setError:function(e){s.__super__.setError.call(this,e);var t=this._getFieldNode();t&&t.ui("setError",!0)},unsetError:function(){s.__super__.unsetError.call(this);var e=this._getFieldNode();e&&e.ui("setError",!1)},setFocus:function(){var e=this._getFieldNode();e&&e.focus()},renderField:function(){this.$el.append(this._getFieldNode())},onFocus:function(e){n.debug("Triggered field callback onFocus",this.key),this.trigger("onFocus",this,e)},onBlur:function(e){n.debug("Fudged field callback onBlur",this.key),this.trigger("onBlur",this,e);var t=this.options.validateOnSet!==!1;this._valueChanged(this._getFieldValue(),t)},onChange:function(e){n.debug("Triggered field callback onChange",this.key);var t=this.options.validateOnSet!==!1;this._valueChanged(this._getFieldValue(),t)},onKeyUp:function(e){}});return s}),define("tictail/form/field/textarea",["jquery","underscore","./input"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{},r.TT.Form.Field=r.TT.Form.Field||{};var i=r.TT.Form.Field.Textarea=n.extend({fieldTagName:"textarea",setNodeValue:function(e){i.__super__.setNodeValue.call(this,e),e&&this.setExpanded()},_sanitize:function(t){return this.options.trim===!0&&(t=e.trim(t)),t},_validate:function(e){var n=[],r=this.options;return t.isNumber(r.maxLength)&&e.length>r.maxLength?n.push("Cannot be longer than "+r.maxLength+" characters (currently it's "+e.length+")"):t.isNumber(r.minLength)&&e.length<r.minLength&&n.push("Cannot be shorter than "+r.minLength+" characters"),n},setExpanded:function(){this._getFieldNode().addClass("expanded")},insertAtCursor:function(e){var t=this._getFieldNode().get(0);if(document.selection)this.setNodeValue(t.value+e);else if(t.selectionStart||t.selectionStart===0){var n=t.selectionStart,r=t.selectionEnd,i=t.value.substring(0,n)+e+t.value.substring(r,t.value.length);this.setNodeValue(i),t.selectionStart=r+e.length}else this.setNodeValue(t.value+e);return this.$el.change(),t.focus(),t.value},unsetExpanded:function(){if(this.getValue(!1))return;this._getFieldNode().removeClass("expanded")},onFocus:function(e){i.__super__.onFocus.call(this,e),this.setExpanded()}});return i}),define("tictail/form/field/select",["underscore","tictail/utility","tictail/form/field/input","../../component/ui"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{},r.TT.Form.Field=r.TT.Form.Field||{};var i=r.TT.Form.Field.Select=n.extend({fieldTagName:"select",fieldAttributes:{"class":"ui"},initialize:function(){i.__super__.initialize.apply(this,arguments);var t=this.options.choices||[];e.isFunction(t)&&(t=t.call(this)),this.choices=t},setChoices:function(e,t){var n=this._getFieldNode(),r=n.val();this.choices=e||[],this.renderChoices(),n.triggerHandler("changeOptions"),t!==!1&&n.val()!==r&&n.change()},_getFieldValue:function(){var e=i.__super__._getFieldValue.apply(this,arguments);return e===""&&(e=null),e},_setFieldValue:function(t){var n=this._getFieldNode();n&&!e.isUndefined(t)&&(t===null&&(t=""),n.val(t).change())},renderField:function(){this.renderChoices(),this.$el.append(this._getFieldNode())},renderChoices:function(){var t=this._getFieldNode().get(0),n=t.options;n.length=0;if(this.options.placeholder){var r=new Option(this.options.placeholder,"");r.className="placeholder",n[0]=r}e.each(this.choices,function(t){var r=n.length,i=t.label,s=!!t.isSelected,o;e.contains(this.chosen,t.value)&&(s=!0),o=new Option(i,t.value,s,s),o.icon=t.icon,e.isUndefined(t.className)||(o.className=t.className),n[r]=o,$(o).data("alt",t.alt)},this)}});return i}),define("tictail/nls/field",{root:{multiselect:{no_left:"There's nothing left in the list",no_match:"Sorry! No items matched your search",remove_item:"Remove"},search:{no_match:"Sorry! No products matched your search"}}}),define("tictail/form/field/search",["jquery","underscore","./select","i18n!../../nls/field"],function(e,t,n,r){var i=this;i.TT=i.TT||{},i.TT.Form=i.TT.Form||{},i.TT.Form.Field=i.TT.Form.Field||{};var s=9,o=13,u=27,a=8,f=38,l=40,c=i.TT.Form.Field.SearchSelect=n.extend({attributes:{"class":"field search-select-field"},fieldAttributes:{multiple:"multiple"},events:function(){var e=c.__super__.events.call(this);return e["click .search-container"]="onClickContainer",e["focusin .search-field"]="onFocusIn",e["keydown .search-field"]="onKeyDown",e["keyup .search-field"]="onKeyUp",e},initialize:function(e){e=e||{},this.fieldAttributes=t.extend({},this.fieldAttributes,e.fieldAttributes||{}),c.__super__.initialize.call(this,e),this.fieldNode=this._getFieldNode(),this.collection=TT.session.getCurrentStore().getInitiatedForeignAttribute("products"),this.collection.reset(),this.itemLimit=4,this.previousQuery=null,this.searchTimeout=null,this.searchDelay=500},getProducts:function(t){var n=this;if(t!==this.previousQuery){var r=this.collection.length,i=t?this.searchDelay:0;this.previousQuery=t,clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(function(){n.collection.fetch({add:!0,data:{query:t,offset:0,limit:n.itemLimit,order_by:"modified_at",descending:!0},success:function(i){var s=[];e.each(i.models,function(e,t){var n=null;try{n=t.images.models[0].get("sizes")[30]}catch(r){}s.push({value:TT.session.getCurrentStore().get("url")+t.get("url"),label:t.get("title"),icon:n})}),n.setChoices(s),n.collection.length>r&&n.renderOptions(t)},error:function(){}})},i)}this.collection.length>0&&n.renderOptions(t)},renderField:function(){this.renderChoices(),this.resultContainer=e('<div class="result-container"/>'),this.searchContainer=e('<div class="search-container"/>');var t=e("<ul/>").addClass("result-list"),n=e("<ul/>").addClass("search-list"),r=e("<input/>").addClass("search-field").attr("placeholder",this.fieldAttributes.placeholder);n.append(r),this.$el.append(this.fieldNode),this.$el.append(this.searchContainer.append(n)),this.$el.append(this.resultContainer.append(t)),r.attr("tabindex",this.fieldNode.attr("tabindex"))},renderOptions:function(t){var n=this,i=[],s=0,o=this.itemLimit,u=this.$(".result-list"),a=this.fieldNode[0].options,f;try{f=new RegExp(t,"ig")}catch(l){f=new RegExp("","ig")}t?(this.resultContainer.show(),e.each(a,function(e,t){t.text.match(f)&&i.push(t)})):i=a,u.empty(),e.each(i,function(t,r){s++;if(s>o)return!1;var i,a=e('<li class="result-option"/>').click(function(t){n.onClickOption(e(this))}).data("index",r.value).addClass(function(){return t%2?"odd":"even"});if(r.icon!==null){var f=e('<span class="icon">').css("background-image","url("+r.icon+")");a.append(f)}a.append(e("<span>").text(r.text)).appendTo(u)});if(!s){var c=r.search.no_match;e("<li/>").text(c).addClass("sorry").appendTo(u)}else this.selectOption(this.$(".result-option").first())},selectNext:function(){this.navigateList("next")},selectPrevious:function(){this.navigateList("prev")},navigateList:function(e){var t=this.$(".result-list").find(".selected"),n=t[e](".result-option");n.length||(n=t[e]()[e](".result-option")),n.length&&(this.selectOption(n),this.ensureItemIsVisible(n))},selectOption:function(e){this.$(".result-list li").removeClass("selected"),e.addClass("selected")},deselectOption:function(){var e=this.$(".result-list").find(".selected");e.removeClass("selected")},ensureItemIsVisible:function(e){var t=this.resultContainer,n=t.offset(),r=t.height(),i=e.offset(),s=e.outerHeight();n.top>i.top?t.scrollTop(i.top-n.top+t.scrollTop()):n.top+r<i.top+s&&t.scrollTop(i.top+s-(n.top+r)+t.scrollTop())},onEnterOption:function(e){this.addOption(e)},onClickOption:function(e){this.addOption(e)},addOption:function(e){if(!e.length)return!1;var t=e.data("index"),n=this.fieldNode.val()||[];n.push(t),this.fieldNode.val(n).change(),this.trigger("onSelect",e.text(),t),this.$("input").val(""),this.closeResult()},setError:function(e){c.__super__.setError.call(this,e),this.searchContainer.addClass("error")},unsetError:function(){c.__super__.unsetError.call(this),this.searchContainer.removeClass("error")},onClickContainer:function(){var e=this.$("input");e.is(":focus")||e.focus()},onFocusIn:function(){this.openResult()},openResult:function(){var t=this.$("input");this.onClickOutside=this.onClickOutside||function(t){e(t.target).parents().add(t.target).is(t.data.$el)||t.data.closeResult()},this.resultContainer.show(),this.getProducts(t.val()),e("html").bind("click",this,this.onClickOutside)},closeResult:function(){clearTimeout(this.searchTimeout),this.resultContainer.hide(),this.deselectOption(),e("html").unbind("click",this.onClickOutside)},onKeyDown:function(e){var t=this.$(".search-list").find("li").last().prev();switch(e.which){case a:if(this.$("input").val())break;t.hasClass("selected")?this.removeOption(t):t.addClass("selected");return;case o:e.preventDefault();var n=this.$(".result-list").find(".selected");this.onEnterOption(n);break;case u:var r=this.$("input");this.closeResult(),r.val()||r.blur(),r.val("");break;case s:this.closeResult();break;case f:this.selectPrevious();break;case l:this.selectNext()}t.removeClass("selected")},onKeyUp:function(e){switch(e.which){case o:case f:case l:return}var t=this.$("input").val();this.getProducts(t)}});return c}),define("dashboard/form/field/user/textarea_share",["jquery","underscore","tictail/form/field/textarea","tictail/form/field/search"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Form=i.Dashboard.Form||{},i.Dashboard.Form.Field=i.Dashboard.Form.Field={},i.Dashboard.Form.Field.Store=i.Dashboard.Form.Field.Store||{};var s=i.Dashboard.Form.Field.Store.TextareaShareField=n.extend({attributes:{"class":"field social-share-field"},urlPattern:/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/g,events:function(){var e=s.__super__.events.call(this);return e[this.getEventKey("keypress")]="onKeyAction",e[this.getEventKey("keyup")]="onKeyAction",e.change=t.bind(this.onChange,this),e},initialize:function(e){s.__super__.initialize.call(this,e)},setFocus:function(){var e=this._getFieldNode().data("editor");e&&e.focus()},_validate:function(e){var n=[],r=this.options,i;return this.updateCharacterCounter(),i=r.maxLength-this.charLeft,t.isNumber(r.maxLength)&&this.charLeft<0?n.push("Cannot be longer than "+r.maxLength+" characters (currently it's "+i+")"):t.isNumber(r.minLength)&&i<r.minLength&&n.push("Cannot be shorter than "+r.minLength+" characters"),n},renderField:function(){s.__super__.renderField.apply(this,arguments);var t=e('<div class="product-box"/>').appendTo(this.$el);this.counter=e('<span class="character-counter"/>'),t.append(this.counter),this.addChildView(this.getAddProductField(),t)},updateCharacterCounter:function(){var e=this._getFieldValue();e=e.replace(this.urlPattern,"********************"),this.charLeft=this.options.maxLength-e.length,this.counter.text(this.charLeft)},onChange:function(e){s.__super__.onChange.call(this),this.updateCharacterCounter()},onKeyAction:function(e){this.updateCharacterCounter()},getAddProductField:function(){var e=this;return TT.getLazy(this,"_addProductField",function(){var t=new r({key:"add-product-search-"+e.model.cid,fieldAttributes:{placeholder:"Mention product"},required:!1});return t.on("onSelect",function(t,n){e.insertAtCursor(n+" ")}),t})},didRender:function(){this.updateCharacterCounter()}});return s}),define("tictail/form/field/switch",["./input"],function(e){var t=this;t.TT=t.TT||{},t.TT.Form=t.TT.Form||{},t.TT.Form.Field=t.TT.Form.Field||{};var n=t.TT.Form.Field.Switch=e.extend({fieldTagName:"input",fieldAttributes:{type:"checkbox","class":"ui switch"},initialize:function(e){var t=this.fieldAttributes;e.yesLabel!==undefined&&(t["data-yes-label"]=e.yesLabel),e.noLabel!==undefined&&(t["data-no-label"]=e.noLabel),n.__super__.initialize.call(this,e)},events:function(){var e=n.__super__.events.call(this);return e["keydown .checkbox"]="onKeyDown",e},_sanitize:function(e){return!!e},_getFieldValue:function(){return this._getFieldNode().prop("checked")},_setFieldValue:function(e){this._getFieldNode().prop("checked",!!e).change()},onKeyDown:function(e){e.which===32&&e.preventDefault()}});return n}),define("tictail/form/field/compound",["jquery","underscore","./core"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{},r.TT.Form.Field=r.TT.Form.Field||{};var i=r.TT.Form.Field.Compound=n.extend({initModelRelationship:function(e){i.__super__.initModelRelationship.call(this,e),this._subfields=[]},registerSubfield:function(e){t.has(e,"tabIndex")||(e.tabIndex=this.tabIndex),this._subfields.push(e)},unregisterSubfield:function(e){var n=t.indexOf(this._subfields,e);n!==-1&&this._subfields.splice(n,1)},unregisterAllSubfields:function(){this._subfields.length=0},getValueFromModel:function(){return null},setValueOnModel:function(e){},getValue:function(){return this.model},setValue:function(){},validate:function(n){n=n||{};var r,i=[],s=e.Deferred(),o,u=this;this.unsetError(),n.outputError!==!1&&s.fail(function(e){u.setError(e)}),i.push(s),t.each(this._subfields,function(e){r=e.validate(n),i.push(r)});var a=this._validate();return a&&a.length!==0?s.reject(a,this):s.resolve(this),o=e.when.apply(e,i),o},setFocus:function(){var e=this._subfields[0];e&&e.setFocus()}});return i}),define("tictail/form/field/button",["jquery","./core"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{};var r=n.TT.Form.Button=t.extend({tagName:"div",attributes:{"class":"button"},buttonTagName:"button",buttonAttributes:{type:"button"},getEventKey:function(e){return e+" "+this.buttonTagName},events:function(){var e={};return e[this.getEventKey("click")]="onClick",e},initialize:function(e){r.__super__.initialize.apply(this,arguments);var t=e.buttonAttributes||this.buttonAttributes;this.buttonAttributes=t;var n=e.key;this.key=n,this.id===undefined&&(this.id="button-"+n,t.id=this.id);var i=e.value;return i!==undefined&&this.setValue(i),this.onClickCallback=e.onClick,this},render:function(){var t=e("<div/>"),n=this.$el;return t.addClass(this.key).attr("id",this.key),_.isUndefined(this.options.fieldClass)===!1&&t.addClass(this.options.fieldClass),t.append(this._getButton()),n.append(this.getLabel()),n.append(t),this.didRender()},getModelAttributeName:function(){return},getLabel:function(){if(_.isUndefined(this.options.label))return;return e(this.make("label",{"for":this.key},this.options.label))},setValue:function(e){this._getButton().html(e)},onClick:function(e){this.onClickCallback&&this.onClickCallback(e)},_getButton:function(){var t=this;return TT.getLazy(this,"_ctrl",function(){return e(t.make(t.buttonTagName,t.buttonAttributes),t.value)})}});return r}),define("tictail/form/field/iconbutton",["jquery","./button"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{};var r=n.TT.Form.IconButton=t.extend({attributes:{"class":"button icon-button"},iconTagName:"span",iconAttributes:{"class":"icon"},valueTagName:"span",valueAttributes:{"class":"value"},_getValueNode:function(){var t=this;return TT.getLazy(this,"_value",function(){return e(t.make(t.valueTagName,t.valueAttributes))})},_getIcon:function(){var t=this;return TT.getLazy(this,"_icon",function(){return e(t.make(t.iconTagName,t.iconAttributes))})},_getButton:function(){var t=this;return TT.getLazy(this,"_ctrl",function(){var n=r.__super__._getButton.apply(t,arguments);if(n===null)return null;var i=e("<span/>").addClass("separator");return n.prepend(t._getValueNode()),n.prepend(i),n.prepend(t._getIcon()),n})},setValue:function(e){this._getValueNode().html(e)}});return r}),define("tictail/form/field/connect",["underscore","jquery","./iconbutton"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{};var i=r.TT.Form.ConnectButton=n.extend({avatarURL:"https://graph.facebook.com/{{facebook_id}}/picture",alias:undefined,events:{"click .remove":"disconnect"},click:function(e){},connect:function(){},disconnect:function(){},isConnected:function(){return this.social[this.alias].get("connected")===!0},getScreenname:function(){return"screenname"},getAvatarURL:function(){return"avatarurl"},initialize:function(e){i.__super__.initialize.apply(this,arguments),this.social=TT.session.social;if(this.social[this.alias].get("connected")===!0)return this.connected()},render:function(){return i.__super__.render.apply(this,arguments),this._getButton().after(this._getUserNode()),this},_getUserNode:function(){var e=this;return TT.getLazy(this,"_userNode",function(){var e=t('<div class="connect-social-user hide"/>'),n=t('<img class="avatar"/>'),r=t('<div class="ui remove"/>'),i=t('<span class="screenname"/>');return e.append(n).append(i).append(r)})},disconnected:function(){if(this.social[this.alias].get("connected")!==!1)return;this.trigger("disconnected",this),this._getUserNode().addClass("hide"),this._getButton().removeClass("hide")},connected:function(){if(this.social[this.alias].get("connected")!==!0)return;this.trigger("connected",this),this.renderScreenname(),this._getUserNode().removeClass("hide"),this._getButton().addClass("hide")},renderScreenname:function(){var e=this.getScreenname(),t=this.getAvatarURL();this._getUserNode().find(".screenname").text(e),this._getUserNode().find(".avatar").attr("src",t)},_getButton:function(){var t=this;return TT.getLazy(this,"_ctrl",function(){var n=i.__super__._getButton.apply(t,arguments);return n.click(e.bind(t.click,t)),n})}});return i}),define("dashboard/nls/user_settings",{root:{page_title:"Account",account:{section:{info:{title:"Account info"},social:{title:"Social"}},field:{email:{label:"E-mail",labelDescription:"Needs to be valid to be able to use Tictail",error:{"-32312":"Sorry, this email is already taken by another user"}},current_password:{label:"Current password",labelDescription:"Required to change your account settings",error:{"-32310":"Current password did not match"}},password:{label:"Password"},new_password:{label:"New password"},confirm_password:{label:"Confirm new password"},twitter:{button:{label:"Twitter Account",value:"Twitter Connect",link:"Get Twitter"},popup:{title:"Connect to Twitter"}},facebook:{button:{label:"Facebook Account",value:"Facebook Connect",link:"Get Facebook"}}}}}}),define("dashboard/form/field/user/twitterconnect",["underscore","jquery","tictail/core","tictail/component/api","tictail/form/field/connect","tictail/model/user/twitter","../../../model/store/base","i18n!../../../nls/user_settings"],function(e,t,n,r,i,s,o,u){var a=this;a.TT=a.TT||{},a.TT.Form=a.TT.Form||{},a.TT.Form.ConnectButton=a.TT.Form.ConnectButtmn||i;var f=a.TT.Form.ConnectButton.TwitterConnect=i.extend({connectURL:"/social/twitter/connect",alias:"twitter",getScreenname:function(){return"@"+this.social[this.alias].get("screen_name")},getAvatarURL:function(){return this.social[this.alias].get("avatar_url")},setAvatarURL:function(e){this.social[this.alias].set("avatar_url",e)},clearAvatarURL:function(){this.social[this.alias].unset("avatar_url")},renderAvatar:function(){e.isEmpty(this.getAvatarURL())||this._getUserNode().find(".avatar").attr("src",this.getAvatarURL())},renderScreenname:function(){this._getUserNode().find(".screenname").text(this.getScreenname());if(e.isUndefined(this.getAvatarURL())){var t=this,n=new r.Request("social.twitter.user.avatar",{},"GET");n.setOnSuccess(function(e){t.setAvatarURL(e.url),t.renderAvatar()}),n.send()}else this.renderAvatar()},click:function(e){var t=this,n=o.generateCurrentBaseUrl(this.connectURL),r=window.open(n,u.account.field.twitter.popup.title,"height=600,width=800"),i=setInterval(function(){r.closed&&(clearInterval(i),t.connect())},500)},connect:function(){var t=this,n=new r.Request("social.twitter.user.get",{},"GET");n.setOnSuccess(function(e){t.social[t.alias]=new s(e),t.connected()}),n.setOnError(e.bind(t.disconnected,t)),n.send()},disconnect:function(){var e=this,t=new r.Request("social.twitter.user.disconnect",{},"POST");t.setOnSuccess(function(t){e.social[e.alias]=new s(t),e.disconnected()}),t.send()},disconnected:function(){f.__super__.disconnected.apply(this,arguments),this.clearAvatarURL()}});return f});try{window.FB||function(e){function o(){}var t=e,n=e.document,r=e.setTimeout,i=e.setInterval,s=0,u,a;a=function(e){return e[0]},u=function(e){return e};var f,l;(function(e){var t={},n={},r=["global","require","requireDynamic","requireLazy","module","exports"];f=function(r,i){if(n.hasOwnProperty(r))return n[r];if(!t.hasOwnProperty(r)){if(i)return null;throw new Error("Module "+r+" has not been defined")}var s=t[r],o=s.deps,u=o.length,a,l=[];for(var c=0;c<u;c++){switch(o[c]){case"module":a=s;break;case"exports":a=s.exports;break;case"global":a=e;break;case"require":a=f;break;case"requireDynamic":a=f;break;case"requireLazy":a=null;break;default:a=f.call(null,o[c])}l.push(a)}return s.factory.apply(e,l),n[r]=s.exports,s.exports},l=function(e,i,s,o){typeof s=="function"?(t[e]={factory:s,deps:r.concat(i),exports:{}},o===3&&f.call(null,e)):n[e]=s}})(this);var c=function(){return l("ES5ArrayPrototype",[],function(e,t,n,r,i,s){var o={};o.map=function(e,t){if(typeof e!="function")throw new TypeError;var n,r=this.length,i=new Array(r);for(n=0;n<r;++n)n in this&&(i[n]=e.call(t,this[n],n,this));return i},o.forEach=function(e,t){o.map.call(this,e,t)},o.filter=function(e,t){if(typeof e!="function")throw new TypeError;var n,r,i=this.length,s=[];for(n=0;n<i;++n)n in this&&(r=this[n],e.call(t,r,n,this)&&s.push(r));return s},o.every=function(e,t){if(typeof e!="function")throw new TypeError;var n=new Object(this),r=n.length;for(var i=0;i<r;i++)if(i in n&&!e.call(t,n[i],i,n))return!1;return!0},o.some=function(e,t){if(typeof e!="function")throw new TypeError;var n=new Object(this),r=n.length;for(var i=0;i<r;i++)if(i in n&&e.call(t,n[i],i,n))return!0;return!1},o.indexOf=function(e,t){var n=this.length;t|=0,t<0&&(t+=n);for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},i.exports=o}),l("ES5FunctionPrototype",[],function(e,t,n,r,i,s){var o={};o.bind=function(e){function r(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}if(typeof this!="function")throw new TypeError("Bind must be called on a function");var t=this,n=Array.prototype.slice.call(arguments,1);return r.displayName="bound:"+(t.displayName||t.name||"(?)"),r.toString=function(){return"bound: "+t},r},i.exports=o}),l("ES5StringPrototype",[],function(e,t,n,r,i,s){var o={};o.trim=function(){if(this==null)throw new TypeError("String.prototype.trim called on null or undefined");return String.prototype.replace.call(this,/^\s+|\s+$/g,"")},i.exports=o}),l("ES5Array",[],function(e,t,n,r,i,s){var o={};o.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"},i.exports=o}),l("ES5Object",[],function(e,t,n,r,i,s){var o={};o.create=function(e){var t=typeof e;if(t!="object"&&t!="function")throw new TypeError("Object prototype may only be a Object or null");var n=new Function;return n.prototype=e,new n},o.keys=function(e){var t=typeof e;if(t!="object"&&t!="function"||e===null)throw new TypeError("Object.keys called on non-object");var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(r);var i=!{toString:!0}.propertyIsEnumerable("toString"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","prototypeIsEnumerable","constructor"];if(i)for(var o=0;o<s.length;o++){var u=s[o];Object.prototype.hasOwnProperty.call(e,u)&&n.push(u)}return n},i.exports=o}),l("ES5Date",[],function(e,t,n,r,i,s){var o={};o.now=function(){return(new Date).getTime()},i.exports=o}),l("JSON3",[],function(e,t,n,r,i,s){(function(){var e={}.toString,t,n,r,s=i.exports={},o='{"A":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=new Date(-0xc782b5b800cec),x,T,N;try{S=S.getUTCFullYear()==-109252&&S.getUTCMonth()===0&&S.getUTCDate()==1&&S.getUTCHours()==10&&S.getUTCMinutes()==37&&S.getUTCSeconds()==6&&S.getUTCMilliseconds()==708}catch(C){}S||(x=Math.floor,T=[0,31,59,90,120,151,181,212,243,273,304,334],N=function(e,t){return T[t]+365*(e-1970)+x((e-1969+(t=+(t>1)))/4)-x((e-1901+t)/100)+x((e-1601+t)/400)}),typeof JSON=="object"&&JSON&&(s.stringify=JSON.stringify,s.parse=JSON.parse);if(u=typeof s.stringify=="function"&&!N){(S=function(){return 1}).toJSON=S;try{u=s.stringify(0)==="0"&&s.stringify(new Number)==="0"&&s.stringify(new String)=='""'&&s.stringify(e)===r&&s.stringify(r)===r&&s.stringify()===r&&s.stringify(S)==="1"&&s.stringify([S])=="[1]"&&s.stringify([r])=="[null]"&&s.stringify(null)=="null"&&s.stringify([r,e,null])=="[null,null,null]"&&s.stringify({result:[S,true,false,null,"\0\b\n\f\r	"]})==o&&s.stringify(null,S)==="1"&&s.stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&s.stringify(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&s.stringify(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&s.stringify(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&s.stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(C){u=!1}}if(typeof s.parse=="function")try{if(s.parse("0")===0&&!s.parse(!1)){S=s.parse(o);if(h=S.A.length==5&&S.A[0]==1){try{h=!s.parse('"	"')}catch(C){}if(h)try{h=s.parse("01")!=1}catch(C){}}}}catch(C){h=!1}S=o=null;if(!u||!h)(t={}.hasOwnProperty)||(t=function(n){var r={},i;return(r.__proto__=null,r.__proto__={toString:1},r).toString!=e?t=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(i=r.constructor,t=function(e){var t=(this.constructor||i).prototype;return e in this&&!(e in t&&this[e]===t[e])}),r=null,t.call(this,n)}),n=function(n,r){var i=0,s,o,u,a;(s=function(){this.valueOf=0}).prototype.valueOf=0,o=new s;for(u in o)t.call(o,u)&&i++;return s=o=null,i?i==2?a=function(n,r){var i={},s=e.call(n)=="[object Function]",o;for(o in n)(!s||o!="prototype")&&!t.call(i,o)&&(i[o]=1)&&t.call(n,o)&&r(o)}:a=function(n,r){var i=e.call(n)=="[object Function]",s,o;for(s in n)(!i||s!="prototype")&&t.call(n,s)&&!(o=s==="constructor")&&r(s);(o||t.call(n,s="constructor"))&&r(s)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],a=function(n,r){var i=e.call(n)=="[object Function]",s,u;for(s in n)(!i||s!="prototype")&&t.call(n,s)&&r(s);for(u=o.length;s=o[--u];t.call(n,s)&&r(s));}),a(n,r)},u||(a={"\\":"\\\\",'"':'\\"',"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},f=function(e,t){return("000000"+(t||0)).slice(-e)},l=function(e){var t='"',n=0,r;for(;r=e.charAt(n);n++)t+='\\"\b\f\n\r	'.indexOf(r)>-1?a[r]:r<" "?"\\u00"+f(2,r.charCodeAt(0).toString(16)):r;return t+'"'},c=function(i,s,o,u,a,h,p){var d=s[i],v,m,g,y,b,w,E,S,T,C,k,L,A,O,M;if(typeof d=="object"&&d){v=e.call(d);if(v=="[object Date]"&&!t.call(d,"toJSON"))if(d>-1/0&&d<1/0){if(N){y=x(d/864e5);for(m=x(y/365.2425)+1970-1;N(m+1,0)<=y;m++);for(g=x((y-N(m,0))/30.42);N(m,g+1)<=y;g++);y=1+y-N(m,g),b=(d%864e5+864e5)%864e5,w=x(b/36e5)%24,E=x(b/6e4)%60,S=x(b/1e3)%60,T=b%1e3}else m=d.getUTCFullYear(),g=d.getUTCMonth(),y=d.getUTCDate(),w=d.getUTCHours(),E=d.getUTCMinutes(),S=d.getUTCSeconds(),T=d.getUTCMilliseconds();d=(m<=0||m>=1e4?(m<0?"-":"+")+f(6,m<0?-m:m):f(4,m))+"-"+f(2,g+1)+"-"+f(2,y)+"T"+f(2,w)+":"+f(2,E)+":"+f(2,S)+"."+f(3,T)+"Z"}else d=null;else typeof d.toJSON=="function"&&(v!="[object Number]"&&v!="[object String]"&&v!="[object Array]"||t.call(d,"toJSON"))&&(d=d.toJSON(i))}o&&(d=o.call(s,i,d));if(d===null)return"null";v=e.call(d);if(v=="[object Boolean]")return""+d;if(v=="[object Number]")return d>-1/0&&d<1/0?""+d:"null";if(v=="[object String]")return l(d);if(typeof d=="object"){for(A=p.length;A--;)if(p[A]===d)throw TypeError();p.push(d),C=[],O=h,h+=a;if(v=="[object Array]"){for(L=0,A=d.length;L<A;M||(M=!0),L++)k=c(L,d,o,u,a,h,p),C.push(k===r?"null":k);return M?a?"[\n"+h+C.join(",\n"+h)+"\n"+O+"]":"["+C.join(",")+"]":"[]"}return n(u||d,function(e){var t=c(e,d,o,u,a,h,p);t!==r&&C.push(l(e)+":"+(a?" ":"")+t),M||(M=!0)}),M?a?"{\n"+h+C.join(",\n"+h)+"\n"+O+"}":"{"+C.join(",")+"}":"{}"}},s.stringify=function(t,n,r){var i,s,o,u,a,f;if(typeof n=="function"||typeof n=="object"&&n)if(e.call(n)=="[object Function]")s=n;else if(e.call(n)=="[object Array]"){o={};for(u=0,a=n.length;u<a;f=n[u++],(e.call(f)=="[object String]"||e.call(f)=="[object Number]")&&(o[f]=1));}if(r)if(e.call(r)=="[object Number]"){if((r-=r%1)>0)for(i="",r>10&&(r=10);i.length<r;i+=" ");}else e.call(r)=="[object String]"&&(i=r.length<=10?r:r.slice(0,10));return c("",(f={},f[""]=t,f),s,o,i,"",[])}),h||(p=String.fromCharCode,d={"\\":"\\",'"':'"',"/":"/",b:"\b",t:"	",n:"\n",f:"\f",r:"\r"},v=function(){throw w=E=null,SyntaxError()},m=function(){var e=E,t=e.length,n,r,i,s,o;while(w<t){n=e.charAt(w);if("	\r\n ".indexOf(n)>-1)w++;else{if("{}[]:,".indexOf(n)>-1)return w++,n;if(n=='"'){for(r="@",w++;w<t;){n=e.charAt(w);if(n<" ")v();else if(n=="\\"){n=e.charAt(++w);if('\\"/btnfr'.indexOf(n)>-1)r+=d[n],w++;else if(n=="u"){i=++w;for(s=w+4;w<s;w++)n=e.charAt(w),n>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F"||v();r+=p("0x"+e.slice(i,w))}else v()}else{if(n=='"')break;r+=n,w++}}if(e.charAt(w)=='"')return w++,r;v()}else{i=w,n=="-"&&(o=!0,n=e.charAt(++w));if(n>="0"&&n<="9"){n=="0"&&(n=e.charAt(w+1),n>="0"&&n<="9")&&v(),o=!1;for(;w<t&&(n=e.charAt(w),n>="0"&&n<="9");w++);if(e.charAt(w)=="."){s=++w;for(;s<t&&(n=e.charAt(s),n>="0"&&n<="9");s++);s==w&&v(),w=s}n=e.charAt(w);if(n=="e"||n=="E"){n=e.charAt(++w),(n=="+"||n=="-")&&w++;for(s=w;s<t&&(n=e.charAt(s),n>="0"&&n<="9");s++);s==w&&v(),w=s}return+e.slice(i,w)}o&&v();if(e.slice(w,w+4)=="true")return w+=4,!0;if(e.slice(w,w+5)=="false")return w+=5,!1;if(e.slice(w,w+4)=="null")return w+=4,null;v()}}}return"$"},g=function(e){var t,n,r;e=="$"&&v();if(typeof e=="string"){if(e.charAt(0)=="@")return e.slice(1);if(e=="["){t=[];for(;;n||(n=!0)){e=m();if(e=="]")break;n&&(e==","?(e=m(),e=="]"&&v()):v()),e==","&&v(),t.push(g(e))}return t}if(e=="{"){t={};for(;;n||(n=!0)){e=m();if(e=="}")break;n&&(e==","?(e=m(),e=="}"&&v()):v()),(e==","||typeof e!="string"||e.charAt(0)!="@"||m()!=":")&&v(),t[e.slice(1)]=g(m())}return t}v()}return e},b=function(e,t,n){var i=y(e,t,n);i===r?delete e[t]:e[t]=i},y=function(t,r,i){var s=t[r],o;if(typeof s=="object"&&s)if(e.call(s)=="[object Array]")for(o=s.length;o--;)b(s,o,i);else n(s,function(e){b(s,e,i)});return i.call(t,r,s)},s.parse=function(t,n){w=0,E=t;var r=g(m());return m()!="$"&&v(),w=E=null,n&&e.call(n)=="[object Function]"?y((S={},S[""]=r,S),"",n):r})}).call(this)}),l("ES5",["ES5ArrayPrototype","ES5FunctionPrototype","ES5StringPrototype","ES5Array","ES5Object","ES5Date","JSON3"],function(t,n,r,i,s,o,u,a,f,l,c,h,p){function x(e,t,n){var r=d.call(arguments,3),i=n?/\s(.*)\]/.exec(v.call(e).toLowerCase())[1]:e,s=m[i+"."+t]||e[t];if(typeof s=="function")return s.apply(e,r)}var d=Array.prototype.slice,v=Object.prototype.toString,m={"JSON.stringify":p.stringify,"JSON.parse":p.parse},g={array:u,"function":a,string:f,Object:c,Array:l,Date:h};for(var y in g){if(!g.hasOwnProperty(y))continue;var b=g[y],w=y===y.toLowerCase()?e[y.replace(/^\w/,function(e){return e.toUpperCase()})].prototype:e[y];for(var E in b){if(!b.hasOwnProperty(E))continue;var S=w[E];m[y+"."+E]=S&&/\{\s+\[native code\]\s\}/.test(S)?S:b[E]}}s.exports=x}),c=f("ES5"),c.apply(null,arguments)};l("sdk.RuntimeConfig",[],{locale:"en_US",rtl:!1,revision:"1129623"}),l("SDKConfig",[],{bustCache:!0,tagCountLogRate:.01,errorHandling:{rate:4},usePluginPipe:!0,features:{kill_fragment:!0,xfbml_profile_pic_server:!0,error_handling:{rate:4},e2e_ping_tracking:{rate:1e-6},xd_timeout:{rate:4,value:2e4}},api:{mode:"warn",whitelist:["Canvas","Canvas.Prefetcher","Canvas.Prefetcher.addStaticResource","Canvas.Prefetcher.setCollectionMode","Canvas.getPageInfo","Canvas.hideFlashElement","Canvas.scrollTo","Canvas.setAutoGrow","Canvas.setDoneLoading","Canvas.setSize","Canvas.setUrlHandler","Canvas.showFlashElement","Canvas.startTimer","Canvas.stopTimer","Data","Data.process","Data.query","Data.query:wait","Data.waitOn","Data.waitOn:wait","Event","Event.subscribe","Event.unsubscribe","Music.flashCallback","Music.init","Music.send","Payment","Payment.cancelFlow","Payment.continueFlow","Payment.init","Payment.lockForProcessing","Payment.unlockForProcessing","Payment.parse","Payment.setSize","ThirdPartyProvider","ThirdPartyProvider.init","ThirdPartyProvider.sendData","UA","UA.nativeApp","XFBML","XFBML.RecommendationsBar","XFBML.RecommendationsBar.markRead","XFBML.parse","addFriend","api","getAccessToken","getAuthResponse","getLoginStatus","getUserID","init","login","logout","publish","share","ui","ui:subscribe"]},initSitevars:{enableMobileComments:1,iframePermissions:{read_stream:!1,manage_mailbox:!1,manage_friendlists:!1,read_mailbox:!1,publish_checkins:!0,status_update:!0,photo_upload:!0,video_upload:!0,sms:!1,create_event:!0,rsvp_event:!0,offline_access:!0,email:!0,xmpp_login:!1,create_note:!0,share_item:!0,export_stream:!1,publish_stream:!0,publish_likes:!0,ads_management:!1,contact_email:!0,access_private_data:!1,read_insights:!1,read_requests:!1,read_friendlists:!0,manage_pages:!1,physical_login:!1,manage_groups:!1,read_deals:!1}}}),l("UrlMapConfig",[],{www:"www.facebook.com",m:"m.facebook.com",connect:"connect.facebook.net",business:"business.facebook.com",api_https:"api.facebook.com",api_read_https:"api-read.facebook.com",graph_https:"graph.facebook.com",fbcdn_http:"static.ak.fbcdn.net",fbcdn_https:"fbstatic-a.akamaihd.net",cdn_http:"static.ak.facebook.com",cdn_https:"s-static.ak.facebook.com"}),l("XDConfig",[],{XdUrl:"/connect/xd_arbiter.php?version=40",Flash:{path:"https://connect.facebook.net/rsrc.php/v1/yR/r/ks_9ZXiQ0GL.swf"},useCdn:!0}),l("CssConfig",[],{rules:'.fb_hidden{position:absolute;top:-10000px;z-index:10001}\n.fb_invisible{display:none}\n.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}\n.fb_reset > div{overflow:hidden}\n.fb_link img{border:none}\n.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}\n.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}\n.fb_dialog_content{background:#fff;color:#333}\n.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\\9;right:7px\\9}\n.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}\n.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}\n.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}\n.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}\n.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}\n.fb_dialog_top_left,\n.fb_dialog_top_right,\n.fb_dialog_bottom_left,\n.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}\n.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}\n.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}\n.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}\n.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}\n.fb_dialog_vert_left,\n.fb_dialog_vert_right,\n.fb_dialog_horiz_top,\n.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}\n.fb_dialog_vert_left,\n.fb_dialog_vert_right{width:10px;height:100%}\n.fb_dialog_vert_left{margin-left:-10px}\n.fb_dialog_vert_right{right:0;margin-right:-10px}\n.fb_dialog_horiz_top,\n.fb_dialog_horiz_bottom{width:100%;height:10px}\n.fb_dialog_horiz_top{margin-top:-10px}\n.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}\n.fb_dialog_iframe{line-height:0}\n.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}\n.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)\nno-repeat 5px 50%;float:left;padding:5px 0 7px 26px}\nbody.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}\n.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)\nwhite no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}\n.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}\n#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}\n#fb-root #fb_dialog_ipad_overlay.hidden{display:none}\n.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}\n.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}\n.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%\n}\n.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px\n}\n.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px\n}\n.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6),\ncolor-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,\nrgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}\n.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}\n.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}\n.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}\n.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}\n#fb_dialog_loader_close{float:left}\n.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}\n.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}\n.fb_iframe_widget{display:inline-block;position:relative}\n.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}\n.fb_iframe_widget iframe{position:absolute}\n.fb_iframe_widget_lift{z-index:1}\n.fb_hide_iframes iframe{position:relative;left:-10000px}\n.fb_iframe_widget_loader{position:relative;display:inline-block}\n.fb_iframe_widget_fluid{display:inline}\n.fb_iframe_widget_fluid span{width:100%}\n.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}\n.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}\n.fb_connect_bar_container div,\n.fb_connect_bar_container span,\n.fb_connect_bar_container a,\n.fb_connect_bar_container img,\n.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}\n.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}\n.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}\n.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}\n.fb_connect_bar a:hover{color:#fff}\n.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}\n.fb_connect_bar div a,\n.fb_connect_bar span,\n.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}\n.fb_connect_bar .fb_buttons{float:right;margin-top:7px}\n.fbpluginrecommendationsbarleft,\n.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}\n.fbpluginrecommendationsbarleft{left:10px}\n.fbpluginrecommendationsbarright{right:10px}',components:["css:fb.css.base","css:fb.css.dialog","css:fb.css.iframewidget","css:fb.css.connectbarwidget","css:fb.css.plugin.recommendationsbar"]}),l("CanvasPrefetcherConfig",[],{blacklist:[0x83d70a64a992],sampleRate:500}),l("PluginPipeConfig",[],{threshold:0,enabledApps:{0xbec51e4718e7:1,0xaa568c1d5c06:1}}),l("ConnectBarConfig",[],{imgs:{buttonUrl:"rsrc.php/v2/yY/r/h_Y6u1wrZPW.png",missingProfileUrl:"rsrc.php/v2/yo/r/UlIqmHJn-SK.gif"}}),l("ApiClientConfig",[],{FlashRequest:{swfUrl:"https://connect.facebook.net/rsrc.php/v1/yW/r/PvklbuW2Ycn.swf"}}),l("QueryString",[],function(e,t,n,r,i,s){function o(e){var t=[];return c(c("Object","keys",!1,e).sort(),"forEach",!0,function(n){var r=e[n];if(typeof r=="undefined")return;if(r===null){t.push(n);return}t.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}),t.join("&")}function u(e,t){var n={};if(e==="")return n;var r=e.split("&");for(var i=0;i<r.length;i++){var s=r[i].split("=",2),o=decodeURIComponent(s[0]);if(t&&n.hasOwnProperty(o))throw new URIError("Duplicate key: "+o);n[o]=s.length===2?decodeURIComponent(s[1]):null}return n}function a(e,t){return e+(~c(e,"indexOf",!0,"?")?"&":"?")+(typeof t=="string"?t:f.encode(t))}var f={encode:o,decode:u,appendToUrl:a};i.exports=f}),l("copyProperties",[],function(e,t,n,r,i,s){function o(e,t,n,r,i,s,o){e=e||{};var u=[t,n,r,i,s],a=0,f;while(u[a]){f=u[a++];for(var l in f)e[l]=f[l];f.hasOwnProperty&&f.hasOwnProperty("toString")&&typeof f.toString!="undefined"&&e.toString!==f.toString&&(e.toString=f.toString)}return e}i.exports=o}),l("ManagedError",[],function(e,t,n,r,i,s){function o(e,t){Error.prototype.constructor.call(this,e),this.message=e,this.innerError=t}o.prototype=new Error,o.prototype.constructor=o,i.exports=o}),l("AssertionError",["ManagedError"],function(e,t,n,r,i,s,o){function u(e){o.prototype.constructor.apply(this,arguments)}u.prototype=new o,u.prototype.constructor=u,i.exports=u}),l("sprintf",[],function(e,t,n,r,i,s){function o(e){var t=Array.prototype.slice.call(arguments,1),n=0;return e.replace(/%s/g,function(e){return t[n++]})}i.exports=o}),l("Assert",["AssertionError","sprintf"],function(e,t,n,r,i,s,o,u){function a(e,t){if(typeof e!="boolean"||!e)throw new o(t);return e}function f(e,t,n){var r;if(t===undefined)r="undefined";else if(t===null)r="null";else{var i=Object.prototype.toString.call(t);r=/\s(\w*)/.exec(i)[1].toLowerCase()}return a(c(e,"indexOf",!0,r)!==-1,n||u("Expression is of type %s, not %s",r,e)),t}function l(e,t,n){return a(t instanceof e,n||"Expression not instance of type"),t}function h(e,t){p["is"+e]=t,p["maybe"+e]=function(e,n){e!=null&&t(e,n)}}var p={isInstanceOf:l,isTrue:a,isTruthy:function(e,t){return a(!!e,t)},type:f,define:function(e,t){e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),h(e,function(e,n){a(t(e),n)})}};c(["Array","Boolean","Date","Function","Null","Number","Object","Regexp","String","Undefined"],"forEach",!0,function(e){h(e,c(f,"bind",!0,null,e.toLowerCase()))}),i.exports=p}),l("Type",["copyProperties","Assert"],function(e,t,n,r,i,s,o,u){function a(){var e=this.__mixins;if(e)for(var t=0;t<e.length;t++)e[t].apply(this,arguments)}function f(e,t){if(t instanceof e)return!0;if(t instanceof a)for(var n=0;n<t.__mixins.length;n++)if(t.__mixins[n]==e)return!0;return!1}function l(e,t){var n=e.prototype;c("Array","isArray",!1,t)||(t=[t]);for(var r=0;r<t.length;r++){var i=t[r];typeof i=="function"&&(n.__mixins.push(i),i=i.prototype),c(c("Object","keys",!1,i),"forEach",!0,function(e){n[e]=i[e]})}}function h(e,t,n){var r=t&&t.hasOwnProperty("constructor")?t.constructor:function(){this.parent.apply(this,arguments)};u.isFunction(r);if(e&&e.prototype instanceof a==0)throw new Error("parent type does not inherit from Type");e=e||a;var i=new Function;return i.prototype=e.prototype,r.prototype=new i,o(r.prototype,t),r.prototype.constructor=r,r.parent=e,r.prototype.__mixins=e.prototype.__mixins?Array.prototype.slice.call(e.prototype.__mixins):[],n&&l(r,n),r.prototype.parent=function(){this.parent=e.prototype.parent,e.apply(this,arguments)},r.prototype.parentCall=function(t){return e.prototype[t].apply(this,Array.prototype.slice.call(arguments,1))},r.extend=function(e,t){return h(this,e,t)},r}o(a.prototype,{instanceOf:function(e){return f(e,this)}}),o(a,{extend:function(e,t){return typeof e=="function"?h.apply(null,arguments):h(null,e,t)},instanceOf:f}),i.exports=a}),l("ObservableMixin",[],function(e,t,n,i,s,o){function u(){this.__observableEvents={}}u.prototype={inform:function(e){var t=Array.prototype.slice.call(arguments,1),n=Array.prototype.slice.call(this.getSubscribers(e));for(var i=0;i<n.length;i++){if(n[i]===null)continue;try{n[i].apply(this,t)}catch(s){r(function(){throw s},0)}}return this},getSubscribers:function(e){return this.__observableEvents[e]||(this.__observableEvents[e]=[])},clearSubscribers:function(e){return e&&(this.__observableEvents[e]=[]),this},clearAllSubscribers:function(){return this.__observableEvents={},this},subscribe:function(e,t){var n=this.getSubscribers(e);return n.push(t),this},unsubscribe:function(e,t){var n=this.getSubscribers(e);for(var r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1);break}return this},monitor:function(e,t){if(!t()){var n=c(function(r){t.apply(t,arguments)&&this.unsubscribe(e,n)},"bind",!0,this);this.subscribe(e,n)}return this}},s.exports=u}),l("sdk.Model",["Type","ObservableMixin"],function(e,t,n,r,i,s,o,u){var a=o.extend({constructor:function(e){this.parent();var t={},n=this;c(c("Object","keys",!1,e),"forEach",!0,function(r){t[r]=e[r],n["set"+r]=function(e){return e===t[r]?this:(t[r]=e,n.inform(r+".change",e),n)},n["get"+r]=function(){return t[r]}})}},u);i.exports=a}),l("sdk.Runtime",["sdk.Model","sdk.RuntimeConfig","copyProperties"],function(t,n,r,i,s,o,u,a,f){var l={UNKNOWN:0,PAGETAB:1,CANVAS:2,PLATFORM:4},c=new u({AccessToken:"",ClientID:"",CookieUserID:"",Environment:l.UNKNOWN,Initialized:!1,KidDirectedSite:undefined,Locale:a.locale,LoginStatus:undefined,Revision:a.revision,Rtl:a.rtl,Scope:undefined,Secure:undefined,UseCookie:!1,UserID:""});f(c,{ENVIRONMENTS:l,isEnvironment:function(e){var t=this.getEnvironment();return(e|t)===t}}),function(){var t=/app_runner/.test(e.name)?l.PAGETAB:/iframe_canvas/.test(e.name)?l.CANVAS:l.UNKNOWN;(t|l.PAGETAB)===t&&(t|=l.CANVAS),c.setEnvironment(t)}(),s.exports=c}),l("sdk.Cookie",["QueryString","sdk.Runtime"],function(e,t,r,i,s,o,u,a){function l(e,t,r){e+=a.getClientID();var i=f&&f!==".";i&&(n.cookie=e+"=; expires=Wed, 04 Feb 2004 08:00:00 GMT;",n.cookie=e+"=; expires=Wed, 04 Feb 2004 08:00:00 GMT;"+"domain="+location.hostname+";");var s=(new Date(r)).toGMTString();n.cookie=e+"="+t+(t&&r===0?"":"; expires="+s)+"; path=/"+(i?"; domain="+f:"")}function c(e){e+=a.getClientID();var t=new RegExp("\\b"+e+"=([^;]*)\\b");return t.test(n.cookie)?RegExp.$1:null}var f=null,h={setDomain:function(e){f=e;var t=u.encode({base_domain:f&&f!=="."?f:""}),n=new Date;n.setFullYear(n.getFullYear()+1),l("fbm_",t,n.getTime())},getDomain:function(){return f},loadMeta:function(){var e=c("fbm_");if(e){var t=u.decode(e);return f||(f=t.base_domain),t}},loadSignedRequest:function(){return c("fbsr_")},setSignedRequestCookie:function(e,t){if(!e)throw new Error("Value passed to Cookie.setSignedRequestCookie was empty.");l("fbsr_",e,t)},clearSignedRequestCookie:function(){l("fbsr_","",0)},setRaw:l};s.exports=h}),l("guid",[],function(e,t,n,r,i,s){function o(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")}i.exports=o}),l("hasNamePropertyBug",["guid"],function(e,t,r,i,s,o,u){function f(){var e=n.createElement("form"),t=e.appendChild(n.createElement("input"));return t.name=u(),a=t!==e.elements[t.name],e=t=null,a}function l(){return typeof a=="undefined"?f():a}var a;s.exports=l}),l("wrapFunction",[],function(e,t,n,r,i,s){function u(e,t,n){return t=t||"default",function(){var r=t in o?o[t](e,n):e;return r.apply(this,arguments)}}var o={};u.setWrapper=function(e,t){t=t||"default",o[t]=e},i.exports=u}),l("DOMEventListener",["wrapFunction"],function(t,n,r,i,s,o,u){var a,f;e.addEventListener?(a=function(e,t,n){n.wrapper=u(n,"entry","DOMEventListener.add "+t),e.addEventListener(t,n.wrapper,!1)},f=function(e,t,n){e.removeEventListener(t,n.wrapper,!1)}):e.attachEvent?(a=function(e,t,n){n.wrapper=u(n,"entry","DOMEventListener.add "+t),e.attachEvent("on"+t,n.wrapper)},f=function(e,t,n){e.detachEvent("on"+t,n.wrapper)}):f=a=function(){};var l={add:function(e,t,n){return a(e,t,n),{remove:function(){f(e,t,n),e=null}}},remove:f};s.exports=l}),l("sdk.createIframe",["copyProperties","guid","hasNamePropertyBug","DOMEventListener"],function(e,t,r,i,s,o,u,a,f,l){function c(e){e=u({},e);var t,r=e.name||a(),i=e.root,s=e.style||{border:"none"},o=e.url,c=e.onload;f()?t=n.createElement('<iframe name="'+r+'"/>'):(t=n.createElement("iframe"),t.name=r),delete e.style,delete e.name,delete e.url,delete e.root,delete e.onload;var p=u({frameBorder:0,allowTransparency:!0,scrolling:"no"},e);p.width&&(t.width=p.width+"px"),p.height&&(t.height=p.height+"px"),delete p.height,delete p.width;for(var d in p)p.hasOwnProperty(d)&&t.setAttribute(d,p[d]);u(t.style,s),t.src="javascript:false",i.appendChild(t);if(c)var v=l.add(t,"load",function(){v.remove(),c()});return t.src=o,t}s.exports=c}),l("DOMWrapper",[],function(e,r,i,s,o,u){var a,f,l={setRoot:function(e){a=e},getRoot:function(){return a||n.body},setWindow:function(e){f=e},getWindow:function(){return f||t}};o.exports=l}),l("sdk.feature",["SDKConfig"],function(e,t,n,r,i,s,o){function u(e,t){if(o.features&&e in o.features){var n=o.features[e];return typeof n=="object"&&typeof n.rate=="number"?n.rate&&Math.random()*100<=n.rate?n.value||!0:n.value?null:!1:n}return typeof t!="undefined"?t:null}i.exports=u}),l("UserAgent",[],function(e,t,r,i,s,o){function x(){if(u)return;u=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),r=/(Mac OS X)|(Windows)|(Linux)/.exec(e);b=/\b(iPhone|iP[ao]d)/.exec(e),w=/\b(iP[ao]d)/.exec(e),g=/Android/i.exec(e),E=/FBAN\/\w+;/i.exec(e),S=/Mobile/i.exec(e),y=!!/Win64/.exec(e);if(t){a=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN,a&&n&&n.documentMode&&(a=n.documentMode);var i=/(?:Trident\/(\d+.\d+))/.exec(e);p=i?parseFloat(i[1])+4:a,f=t[2]?parseFloat(t[2]):NaN,l=t[3]?parseFloat(t[3]):NaN,c=t[4]?parseFloat(t[4]):NaN,c?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),h=t&&t[1]?parseFloat(t[1]):NaN):h=NaN}else a=f=l=h=c=NaN;if(r){if(r[1]){var s=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);d=s?parseFloat(s[1].replace("_",".")):!0}else d=!1;v=!!r[2],m=!!r[3]}else d=v=m=!1}var u=!1,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,T={ie:function(){return x()||a},ieCompatibilityMode:function(){return x()||p>a},ie64:function(){return T.ie()&&y},firefox:function(){return x()||f},opera:function(){return x()||l},webkit:function(){return x()||c},safari:function(){return T.webkit()},chrome:function(){return x()||h},windows:function(){return x()||v},osx:function(){return x()||d},linux:function(){return x()||m},iphone:function(){return x()||b},mobile:function(){return x()||b||w||g||S},nativeApp:function(){return x()||E},android:function(){return x()||g},ipad:function(){return x()||w}};s.exports=T}),l("sdk.getContextType",["UserAgent","sdk.Runtime"],function(e,t,n,r,i,s,o,u){function a(){return o.nativeApp()?3:o.mobile()?2:u.isEnvironment(u.ENVIRONMENTS.CANVAS)?5:1}i.exports=a}),l("UrlMap",["UrlMapConfig"],function(e,t,n,r,i,s,o){var u={resolve:function(e,t){var n=typeof t=="undefined"?location.protocol.replace(":",""):t?"https":"http";if(e in o)return n+"://"+o[e];if(typeof t=="undefined"&&e+"_"+n in o)return n+"://"+o[e+"_"+n];if(t!==!0&&e+"_http"in o)return"http://"+o[e+"_http"];if(t!==!1&&e+"_https"in o)return"https://"+o[e+"_https"]}};i.exports=u}),l("sdk.Impressions",["guid","QueryString","sdk.Runtime","UrlMap"],function(e,t,n,r,i,s,o,u,a,f){function l(e){var t=a.getClientID();!e.api_key&&t&&(e.api_key=t),e.kid_directed_site=a.getKidDirectedSite();var n=new Image;n.src=u.appendToUrl(f.resolve("www",!0)+"/impression.php/"+o()+"/",e)}var h={log:function(e,t){t.source||(t.source="jssdk"),l({lid:e,payload:c("JSON","stringify",!1,t)})},impression:l};i.exports=h}),l("Log",["sprintf"],function(t,n,r,i,s,o,u){function f(t,n){var r=Array.prototype.slice.call(arguments,2),i=u.apply(null,r),s=e.console;s&&l.level>=n&&s[t in s?t:"log"](i)}var a={DEBUG:3,INFO:2,WARNING:1,ERROR:0},l={level:-1,Level:a,debug:c(f,"bind",!0,null,"debug",a.DEBUG),info:c(f,"bind",!0,null,"info",a.INFO),warn:c(f,"bind",!0,null,"warn",a.WARNING),error:c(f,"bind",!0,null,"error",a.ERROR)};s.exports=l}),l("Base64",[],function(e,t,n,r,i,s){function u(e){return e=e.charCodeAt(0)<<16|e.charCodeAt(1)<<8|e.charCodeAt(2),String.fromCharCode(o.charCodeAt(e>>>18),o.charCodeAt(e>>>12&63),o.charCodeAt(e>>>6&63),o.charCodeAt(e&63))}function f(e){return e=a.charCodeAt(e.charCodeAt(0)-43)<<18|a.charCodeAt(e.charCodeAt(1)-43)<<12|a.charCodeAt(e.charCodeAt(2)-43)<<6|a.charCodeAt(e.charCodeAt(3)-43),String.fromCharCode(e>>>16,e>>>8&255,e&255)}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=">___?456789:;<=_______\0\b	\n\f\r______ !\"#$%&'()*+,-./0123",l={encode:function(e){e=unescape(encodeURI(e));var t=(e.length+2)%3;return e=(e+"\0\0".slice(t)).replace(/[\s\S]{3}/g,u),e.slice(0,e.length+t-2)+"==".slice(t)},decode:function(e){e=e.replace(/[^A-Za-z0-9+\/]/g,"");var t=e.length+3&3;e=(e+"AAA".slice(t)).replace(/..../g,f),e=e.slice(0,e.length+t-3);try{return decodeURIComponent(escape(e))}catch(n){throw new Error("Not valid UTF-8")}},encodeObject:function(e){return l.encode(c("JSON","stringify",!1,e))},decodeObject:function(e){return c("JSON","parse",!1,l.decode(e))},encodeNums:function(e){return String.fromCharCode.apply(String,c(e,"map",!0,function(e){return o.charCodeAt((e|-(e>63))&-(e>0)&63)}))}};i.exports=l}),l("sdk.SignedRequest",["Base64"],function(e,t,n,r,i,s,o){function u(e){if(!e)return null;var t=e.split(".",2)[1].replace(/\-/g,"+").replace(/\_/g,"/");return o.decodeObject(t)}var a={parse:u};i.exports=a}),l("URL",["Assert","copyProperties","QueryString","Log"],function(e,t,r,i,s,o,u,a,f,l){function m(e){u.isString(e,"The passed argument was of invalid type.");if(h.test(e))throw new URIError("The passed argument could not be parsed as a url.");if(this instanceof m==0)return new m(e);var t=e.replace(p,function(t){return l.warn('Escaping unescaped character \\x%s from "%s"',t.charCodeAt(0).toString(16),e),encodeURIComponent(t)}).match(c);if(!e||!t)throw new URIError("The passed argument could not be parsed as a url.");var n=!!location.hostname;this.setProtocol(t[4]||(n?location.protocol.replace(/:/,""):"")),this.setDomain(t[6]||location.hostname),this.setPort(t[8]||(n&&!t[6]?location.port:"")),this.setPath(t[9]||""),this.setSearch(t[11]||""),this.setFragment(t[13]||""),this._path.substring(0,1)!="/"&&(this._path="/"+this._path);if(this._domain&&!d.test(decodeURIComponent(this._domain.toLowerCase())))throw l.error("Invalid characters found in domain name: %s",this._domain),new URIError("Domain contained invalid characters.")}var c=new RegExp("((((\\w+):)?//)(.*?@)?([^~/?#:]+)(:(\\d+))?)?([^\\?$#]+)?(\\?([^$#]+))?(#([^$]+))?"),h=/[\0\\]/,p=/[^\w\-\.,;\/?:@=&%#$~+!*'\[\]()]+/g,d=/^[a-z0-9.][a-z0-9\-\.]+[a-z0-9.]$/,v=/\.facebook\.com$/;a(m.prototype,{constructor:m,getProtocol:function(){return this._protocol},setProtocol:function(e){return this._protocol=e,this},getDomain:function(){return this._domain},setDomain:function(e){return this._domain=e,this},getPort:function(){return this._port},setPort:function(e){return this._port=e,this},getPath:function(){return this._path},setPath:function(e){return this._path=e,this},getSearch:function(){return this._search},setSearch:function(e){return this._search=e,this},getFragment:function(){return this._fragment},setFragment:function(e){return this._fragment=e,this},getParsedSearch:function(){return f.decode(this._search)},getParsedFragment:function(){return f.decode(this._fragment)},isFacebookURL:function(){return v.test(this._domain)},toString:function(){return(this._protocol?this._protocol+":":"")+(this._domain?"//"+this._domain:"")+(this._port?":"+this._port:"")+this._path+(this._search?"?"+this._search:"")+(this._fragment?"#"+this._fragment:"")},valueOf:function(){return this.toString()}}),a(m,{getCurrent:function(){return new m(location.href)},getReferrer:function(){return n.referrer?new m(n.referrer):null}}),s.exports=m}),l("sdk.domReady",[],function(t,i,s,o,u,a){function c(){if(!f)return;var e;while(e=f.shift())e();f=null}function h(e){if(f){f.push(e);return}e()}var f,l="readyState"in n?/loaded|complete/.test(n.readyState):!!n.body;if(!l){f=[],n.addEventListener?(n.addEventListener("DOMContentLoaded",c,!1),e.addEventListener("load",c,!1)):n.attachEvent&&(n.attachEvent("onreadystatechange",c),e.attachEvent("onload",c));if(n.documentElement.doScroll&&e==e.top){var p=function(){try{n.documentElement.doScroll("left")}catch(e){r(p,0);return}c()};p()}}u.exports=h},3),l("sdk.Content",["sdk.domReady","Log","UserAgent"],function(e,t,r,i,s,o,u,a,f){var l,c,h={append:function(e,t){t||(l?t=l:(l=t=n.getElementById("fb-root"),t||(a.warn('The "fb-root" div has not been created, auto-creating'),l=t=n.createElement("div"),t.id="fb-root",f.ie()||!n.body?u(function(){n.body.appendChild(t)}):n.body.appendChild(t)),t.className+=" fb_reset"));if(typeof e=="string"){var r=n.createElement("div");return t.appendChild(r).innerHTML=e,r}return t.appendChild(e)},appendHidden:function(e){if(!t){var t=n.createElement("div"),r=t.style;r.position="absolute",r.top="-10000px",r.width=r.height=0,t=h.append(t)}return h.append(e,t)},submitToTarget:function(e,t){var r=n.createElement("form");r.action=e.url,r.target=e.target,r.method=t?"GET":"POST",h.appendHidden(r);for(var i in e.params)if(e.params.hasOwnProperty(i)){var s=e.params[i];if(s!==null&&s!==undefined){var o=n.createElement("input");o.name=i,o.value=s,r.appendChild(o)}}r.submit(),r.parentNode.removeChild(r)}};s.exports=h}),l("sdk.Event",[],function(e,t,n,r,i,s){var o={subscribers:function(){return this._subscribersMap||(this._subscribersMap={}),this._subscribersMap},subscribe:function(e,t){var n=this.subscribers();n[e]?n[e].push(t):n[e]=[t]},unsubscribe:function(e,t){var n=this.subscribers()[e];n&&c(n,"forEach",!0,function(e,r){e==t&&(n[r]=null)})},monitor:function(e,t){if(!t()){var n=this,r=function(){t.apply(t,arguments)&&n.unsubscribe(e,r)};this.subscribe(e,r)}},clear:function(e){delete this.subscribers()[e]},fire:function(e){var t=Array.prototype.slice.call(arguments,1),n=this.subscribers()[e];n&&c(n,"forEach",!0,function(e){e&&e.apply(this,t)})}};i.exports=o}),l("Queue",["copyProperties"],function(e,t,n,i,s,o,u){function f(e){"use strict";this._opts=u({interval:0,processor:null},e),this._queue=[],this._stopped=!0}var a={};f.prototype._dispatch=function(e){"use strict";if(this._stopped||this._queue.length===0)return;if(!this._opts.processor)throw this._stopped=!0,new Error("No processor available");if(this._opts.interval)this._opts.processor.call(this,this._queue.shift()),this._timeout=r(c(this._dispatch,"bind",!0,this),this._opts.interval);else while(this._queue.length)this._opts.processor.call(this,this._queue.shift())},f.prototype.enqueue=function(e){"use strict";return this._opts.processor&&!this._stopped?this._opts.processor.call(this,e):this._queue.push(e),this},f.prototype.start=function(e){"use strict";return e&&(this._opts.processor=e),this._stopped=!1,this._dispatch(),this},f.prototype.isStarted=function(){"use strict";return!this._stopped},f.prototype.dispatch=function(){"use strict";this._dispatch(!0)},f.prototype.stop=function(e){"use strict";return this._stopped=!0,e&&clearTimeout(this._timeout),this},f.prototype.merge=function(e,t){"use strict";return this._queue[t?"unshift":"push"].apply(this._queue,e._queue),e._queue=[],this._dispatch(),this},f.prototype.getLength=function(){"use strict";return this._queue.length},f.get=function(e,t){"use strict";var n;return e in a?n=a[e]:n=a[e]=new f(t),n},f.exists=function(e){"use strict";return e in a},f.remove=function(e){"use strict";return delete a[e]},s.exports=f}),l("JSONRPC",["copyProperties","Log"],function(e,t,n,i,s,o,u,a){function f(e){this._counter=0,this._callbacks={},this.remote=c(function(e){return this._context=e,this.remote},"bind",!0,this),this.local={},this._write=e}u(f.prototype,{stub:function(e){this.remote[e]=c(function(){var t=Array.prototype.slice.call(arguments),n={jsonrpc:"2.0",method:e};typeof t[t.length-1]=="function"&&(n.id=++this._counter,this._callbacks[n.id]=t.pop()),n.params=t,this._write(c("JSON","stringify",!1,n),this._context||{method:e})},"bind",!0,this)},read:function(e,t){var n=c("JSON","parse",!1,e),i=n.id;if(!n.method){if(!this._callbacks[i]){a.warn("Could not find callback %s",i);return}var s=this._callbacks[i];delete this._callbacks[i],delete n.id,delete n.jsonrpc,s(n);return}var o=this,u=this.local[n.method],f;i?f=function(e,n){var s={jsonrpc:"2.0",id:i};s[e]=n,r(function(){o._write(c("JSON","stringify",!1,s),t)},0)}:f=function(){};if(!u){a.error('Method "%s" has not been defined',n.method),f("error",{code:-32601,message:"Method not found",data:n.method});return}n.params.push(c(f,"bind",!0,null,"result")),n.params.push(c(f,"bind",!0,null,"error"));try{var l=u.apply(t||null,n.params);typeof l!="undefined"&&f("result",l)}catch(p){a.error("Invokation of RPC method %s resulted in the error: %s",n.method,p.message),f("error",{code:-32603,message:"Internal error",data:p.message})}}}),s.exports=f}),l("sdk.RPC",["Assert","JSONRPC","Queue"],function(e,t,n,r,i,s,o,u,a){var f=new a,l=new u(function(e){f.enqueue(e)}),h={local:l.local,remote:l.remote,stub:c(l.stub,"bind",!0,l),setInQueue:function(e){o.isInstanceOf(a,e),e.start(function(e){l.read(e)})},getOutQueue:function(){return f}};i.exports=h}),l("sdk.Scribe",["QueryString","sdk.Runtime","UrlMap"],function(e,t,n,r,i,s,o,u,a){function f(e,t){typeof t.extra=="object"&&(t.extra.revision=u.getRevision()),(new Image).src=o.appendToUrl(a.resolve("www",!0)+"/common/scribe_endpoint.php",{c:e,m:c("JSON","stringify",!1,t)})}var l={log:f};i.exports=l}),l("emptyFunction",["copyProperties"],function(e,t,n,r,i,s,o){function u(e){return function(){return e}}function a(){}o(a,{thatReturns:u,thatReturnsFalse:u(!1),thatReturnsTrue:u(!0),thatReturnsNull:u(null),thatReturnsThis:function(){return this},thatReturnsArgument:function(e){return e}}),i.exports=a}),l("htmlSpecialChars",[],function(e,t,n,r,i,s){function c(e){return typeof e=="undefined"||e===null||!e.toString?"":e===!1?"0":e===!0?"1":e.toString().replace(o,"&amp;").replace(f,"&quot;").replace(l,"&#039;").replace(u,"&lt;").replace(a,"&gt;")}var o=/&/g,u=/</g,a=/>/g,f=/"/g,l=/'/g;i.exports=c}),l("Flash",["DOMEventListener","DOMWrapper","QueryString","UserAgent","copyProperties","guid","htmlSpecialChars"],function(t,n,r,i,s,o,u,a,f,l,c,h,p){function g(e){var t=m.getElementById(e);t&&t.parentNode.removeChild(t),delete d[e]}function y(){for(var e in d)d.hasOwnProperty(e)&&g(e)}function b(e){return e.replace(/\d+/g,function(e){return"000".substring(e.length)+e})}function w(t){v||(l.ie()>=9&&u.add(e,"unload",y),v=!0),d[t]=t}var d={},v,m=a.getWindow().document,E={embed:function(e,t,n,r){var i=h();e=p(e).replace(/&amp;/g,"&"),n=c({allowscriptaccess:"always",flashvars:r,movie:e},n||{}),typeof n.flashvars=="object"&&(n.flashvars=f.encode(n.flashvars));var s=[];for(var o in n)n.hasOwnProperty(o)&&n[o]&&s.push('<param name="'+p(o)+'" value="'+p(n[o])+'">');var u=t.appendChild(m.createElement("span")),a="<object "+(l.ie()?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ':'type="application/x-shockwave-flash"')+'data="'+e+'" '+(n.height?'height="'+n.height+'" ':"")+(n.width?'width="'+n.width+'" ':"")+'id="'+i+'">'+s.join("")+"</object>";u.innerHTML=a;var d=u.firstChild;return w(i),d},remove:g,getVersion:function(){var e="Shockwave Flash",t="application/x-shockwave-flash",n="ShockwaveFlash.ShockwaveFlash",r;if(navigator.plugins&&typeof navigator.plugins[e]=="object"){var i=navigator.plugins[e].description;i&&navigator.mimeTypes&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(r=i.match(/\d+/g))}if(!r)try{r=(new ActiveXObject(n)).GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),r=Array.prototype.slice.call(r,1)}catch(s){}return r},checkMinVersion:function(e){var t=E.getVersion();return t?b(t.join("."))>=b(e):!1},isAvailable:function(){return!!E.getVersion()}};s.exports=E}),l("dotAccess",[],function(e,t,n,r,i,s){function o(e,t,n){var r=t.split(".");do{var i=r.shift();e=e[i]||n&&(e[i]={})}while(r.length&&e);return e}i.exports=o}),l("GlobalCallback",["DOMWrapper","dotAccess","guid","wrapFunction"],function(e,t,n,r,i,s,o,u,a,f){var l,c,h={setPrefix:function(e){l=u(o.getWindow(),e,!0),c=e},create:function(e,t){l||this.setPrefix("__globalCallbacks");var n=a();return l[n]=f(e,"entry",t||"GlobalCallback"),c+"."+n},remove:function(e){var t=e.substring(c.length+1);delete l[t]}};i.exports=h}),l("XDM",["DOMEventListener","DOMWrapper","emptyFunction","Flash","GlobalCallback","guid","Log","UserAgent","wrapFunction"],function(e,t,n,i,s,o,u,a,f,l,c,h,p,d,v){function b(e){var t={},n=e.length,r=g.transports;while(n--)t[e[n]]=1;n=r.length;while(n--){var i=r[n],s=m[i];if(!t[i]&&s.isAvailable())return i}}var m={},g={transports:[]},y=a.getWindow(),w={register:function(e,t){p.debug("Registering %s as XDM provider",e),g.transports.push(e),m[e]=t},create:function(e){if(!e.whenReady&&!e.onMessage)throw p.error("An instance without whenReady or onMessage makes no sense"),new Error("An instance without whenReady or onMessage makes no sense");e.channel||(p.warn("Missing channel name, selecting at random"),e.channel=h()),e.whenReady||(e.whenReady=f),e.onMessage||(e.onMessage=f);var t=e.transport||b(e.blacklist||[]),n=m[t];if(n&&n.isAvailable())return p.debug("%s is available",t),n.init(e),t}};w.register("flash",function(){var e=!1,t,n=!1,i=15e3,s;return{isAvailable:function(){return l.checkMinVersion("8.0.24")},init:function(o){p.debug("init flash: "+o.channel);var u={send:function(e,n,r,i){p.debug("sending to: %s (%s)",n,i),t.postMessage(e,n,i)}};if(e){o.whenReady(u);return}var a=o.root.appendChild(y.document.createElement("div")),f=c.create(function(){c.remove(f),clearTimeout(s),p.info("xdm.swf called the callback");var e=c.create(function(e,t){e=decodeURIComponent(e),t=decodeURIComponent(t),p.debug("received message %s from %s",e,t),o.onMessage(e,t)},"xdm.swf:onMessage");t.init(o.channel,e),o.whenReady(u)},"xdm.swf:load");t=l.embed(o.flashUrl,a,null,{protocol:location.protocol.replace(":",""),host:location.host,callback:f,log:n}),s=r(function(){p.warn("The Flash component did not load within %s ms - verify that the container is not set to hidden or invisible using CSS as this will cause some browsers to not load the components",i)},i),e=!0}}}()),w.register("postmessage",function(){var e=!1;return{isAvailable:function(){return!!y.postMessage},init:function(t){p.debug("init postMessage: "+t.channel);var n="_FB_"+t.channel,i={send:function(e,t,n,i){if(y===n)throw p.error("Invalid windowref, equal to window (self)"),new Error;p.debug("sending to: %s (%s)",t,i);var s=function(){n.postMessage("_FB_"+i+e,t)};d.ie()==8||d.ieCompatibilityMode()?r(s,0):s()}};if(e){t.whenReady(i);return}u.add(y,"message",v(function(e){var r=e.data,i=e.origin||"native";if(typeof r!="string"){p.warn("Received message of type %s from %s, expected a string",typeof r,i);return}p.debug("received message %s from %s",r,i),r.substring(0,n.length)==n&&(r=r.substring(n.length)),t.onMessage(r,i)},"entry","onMessage")),t.whenReady(i),e=!0}}}()),s.exports=w}),l("sdk.XD",["sdk.Content","sdk.Event","Log","QueryString","Queue","sdk.RPC","sdk.Runtime","sdk.Scribe","URL","UrlMap","XDConfig","XDM","sdk.createIframe","sdk.feature","guid"],function(e,t,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x){function j(e){l.info("Remote XD can talk to facebook.com (%s)",e),v.setEnvironment(e==="canvas"?v.ENVIRONMENTS.CANVAS:v.ENVIRONMENTS.PAGETAB)}function F(e,t){if(!t)throw l.error("No senderOrigin"),new Error;var n=/^https?/.exec(t)[0];switch(e.xd_action){case"proxy_ready":var r,i;n=="https"?(r=C,i=L):(r=N,i=k),e.registered&&(j(e.registered),T=r.merge(T)),l.info("Proxy ready, starting queue %s containing %s messages",n+"ProxyQueue",r.getLength()),r.start(function(e){_.send(typeof e=="string"?e:h.encode(e),t,i.contentWindow,O+"_"+n)});break;case"plugin_ready":l.info("Plugin %s ready, protocol: %s",e.name,n),H[e.name]={protocol:n};if(p.exists(e.name)){var s=p.get(e.name);l.debug("Enqueuing %s messages for %s in %s",s.getLength(),e.name,n+"ProxyQueue"),(n=="https"?C:N).merge(s)}}e.data&&I(e.data,t)}function I(e,t){if(t&&t!=="native"&&!g(t).isFacebookURL())return;if(typeof e=="string"){if(/^FB_RPC:/.test(e)){B.enqueue(e.substring(7));return}if(e.substring(0,1)=="{")try{e=c("JSON","parse",!1,e)}catch(n){l.warn("Failed to decode %s as JSON",e);return}else e=h.decode(e)}t||e.xd_sig==A&&(t=e.xd_origin);if(e.xd_action){F(e,t);return}e.access_token&&v.setSecure(/^https/.test(M));if(e.cb){var r=U._callbacks[e.cb];U._forever[e.cb]||delete U._callbacks[e.cb],r&&r(e)}}function q(e,t){if(e=="facebook")t.relation="parent.parent",T.enqueue(t);else{t.relation='parent.frames["'+e+'"]';var n=H[e];n?(l.debug("Enqueuing message for plugin %s in %s",e,n.protocol+"ProxyQueue"),(n.protocol=="https"?C:N).enqueue(t)):(l.debug("Buffering message for plugin %s",e),p.get(e).enqueue(t))}}function R(e){if(D)return;var t=a.appendHidden(n.createElement("div")),r=w.create({blacklist:null,root:t,channel:O,flashUrl:b.Flash.path,whenReady:function(n){_=n;var i={channel:O,origin:location.protocol+"//"+location.host,transport:r,xd_name:e},s=b.XdUrl+"#"+h.encode(i),o=b.useCdn?"cdn":"www",u=y.resolve(o,!1),a=y.resolve(o,!0);v.getSecure()!==!0&&(k=E({url:u+s,name:"fb_xdm_frame_http",id:"fb_xdm_frame_http",root:t,"aria-hidden":!0,title:P,"tab-index":-1})),L=E({url:a+s,name:"fb_xdm_frame_https",id:"fb_xdm_frame_https",root:t,"aria-hidden":!0,title:P,"tab-index":-1})},onMessage:I});D=!0}var T=new p,N=new p,C=new p,k,L,A=x(),O=x(),M=location.protocol+"//"+location.host,_,D=!1,P="Facebook Cross Domain Communication Frame",H={},B=new p;d.setInQueue(B),d.getOutQueue().start(function(e){q("facebook","FB_RPC:"+e)});var U={rpc:d,_callbacks:{},_forever:{},_channel:O,_origin:M,onMessage:I,recv:I,init:R,sendToFacebook:q,inform:function(e,t,n,r){q("facebook",{method:e,params:c("JSON","stringify",!1,t||{}),behavior:r||"p",relation:n})},handler:function(e,t,n,r){var i=location.protocol=="https:",s=b.useCdn?"cdn":"www",o=y.resolve(s,i);return o+b.XdUrl+"#"+h.encode({cb:this.registerCallback(e,n,r),origin:M+"/"+O,domain:location.hostname,relation:t||"opener"})},registerCallback:function(e,t,n){return n=n||x(),t&&(U._forever[n]=!0),U._callbacks[n]=e,n}};f.subscribe("init:post",function(e){R(e.xdProxyName);var t=S("xd_timeout");t&&r(function(){var e=L&&!!k==N.isStarted()&&!!L==C.isStarted();e||m.log("jssdk_error",{appId:v.getClientID(),error:"XD_INITIALIZATION",extra:{message:"Failed to initialize in "+t+"ms"}})},t)}),o.exports=U}),l("sdk.Auth",["sdk.Cookie","copyProperties","sdk.createIframe","DOMWrapper","sdk.feature","sdk.getContextType","guid","sdk.Impressions","Log","ObservableMixin","QueryString","sdk.Runtime","sdk.SignedRequest","UrlMap","URL","sdk.XD"],function(e,t,n,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x){function k(e,t){var n=b.getUserID(),r="";if(e)if(e.userID)r=e.userID;else if(e.signedRequest){var i=w.parse(e.signedRequest);i&&i.user_id&&(r=i.user_id)}var s=b.getLoginStatus(),o=s==="unknown"&&e||b.getUseCookie()&&b.getCookieUserID()!==r,u=n&&!e,a=e&&n&&n!=r,f=e!=T,l=t!=(s||"unknown");b.setLoginStatus(t),b.setAccessToken(e&&e.accessToken||null),b.setUserID(r),T=e;var c={authResponse:e,status:t};return(u||a)&&C.inform("logout",c),(o||a)&&C.inform("login",c),f&&C.inform("authresponse.change",c),l&&C.inform("status.change",c),c}function L(){return T}function A(e,t,n){return function(r){var i;if(r&&r.access_token){var s=w.parse(r.signed_request);t={accessToken:r.access_token,userID:s.user_id,expiresIn:parseInt(r.expires_in,10),signedRequest:r.signed_request},r.granted_scopes&&(t.grantedScopes=r.granted_scopes);if(b.getUseCookie()){var o=t.expiresIn===0?0:c("Date","now",!1)+t.expiresIn*1e3,a=u.getDomain();!a&&r.base_domain&&u.setDomain("."+r.base_domain),u.setSignedRequestCookie(r.signed_request,o)}i="connected",k(t,i)}else if(n==="logout"||n==="login_status")r.error&&r.error==="not_authorized"?i="not_authorized":i="unknown",k(null,i),b.getUseCookie()&&u.clearSignedRequestCookie();return r&&r.https==1&&b.setSecure(!0),e&&e({authResponse:t,status:b.getLoginStatus()}),t}}function O(e){var t,n=c("Date","now",!1);N&&(clearTimeout(N),N=null);var i=A(e,T,"login_status"),s=S(E.resolve("www",!0)+"/connect/ping").setSearch(y.encode({client_id:b.getClientID(),response_type:"token,signed_request,code",domain:location.hostname,origin:p(),redirect_uri:x.handler(function(e){if(h("e2e_ping_tracking",!0)){var s={init:n,close:c("Date","now",!1),method:"ping"};m.debug("e2e: %s",c("JSON","stringify",!1,s)),v.log(114,{payload:s})}t.parentNode.removeChild(t),i(e)&&(N=r(function(){O(function(){})},12e5))},"parent"),sdk:"joey",kid_directed_site:b.getKidDirectedSite()}));t=f({root:l.getRoot(),name:d(),url:s.toString(),style:{display:"none"}})}function _(e,t){if(!b.getClientID()){m.warn("FB.getLoginStatus() called before calling FB.init().");return}if(e){if(!t&&M=="loaded"){e({status:b.getLoginStatus(),authResponse:L()});return}C.subscribe("FB.loginStatus",e)}if(!t&&M=="loading")return;M="loading";var n=function(e){M="loaded",C.inform("FB.loginStatus",e),C.clearSubscribers("FB.loginStatus")};O(n)}var T,N,C=new g,M;a(C,{getLoginStatus:_,fetchLoginStatus:O,setAuthResponse:k,getAuthResponse:L,parseSignedRequest:w.parse,xdResponseWrapper:A}),s.exports=C}),l("invariant",[],function(e,t,n,r,i,s){function o(e){if(!e){var t=new Error("Minified exception occured, use the non-minified dev environment for the full error message and additional helpful warnings.");throw t.framesToPop=1,t}}i.exports=o}),l("toArray",["invariant"],function(e,t,n,r,i,s,o){function u(e){var t=e.length;o(!c("Array","isArray",!1,e)&&(typeof e=="object"||typeof e=="function")),o(typeof t=="number"),o(t===0||t-1 in e);if(e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(n){}var r=Array(t);for(var i=0;i<t;i++)r[i]=e[i];return r}i.exports=u}),l("createArrayFrom",["toArray"],function(e,t,n,r,i,s,o){function u(e){return!!e&&(typeof e=="object"||typeof e=="function")&&"length"in e&&!("setInterval"in e)&&typeof e.nodeType!="number"&&(c("Array","isArray",!1,e)||"callee"in e||"item"in e)}function a(e){return u(e)?c("Array","isArray",!1,e)?e.slice():o(e):[e]}i.exports=a}),l("sdk.DOM",["Assert","createArrayFrom","sdk.domReady","UserAgent"],function(t,r,i,s,o,u,a,f,l,h){function d(e,t){var n=e.getAttribute(t)||e.getAttribute(t.replace(/_/g,"-"))||e.getAttribute(t.replace(/-/g,"_"))||e.getAttribute(t.replace(/-/g,""))||e.getAttribute(t.replace(/_/g,""))||e.getAttribute("data-"+t)||e.getAttribute("data-"+t.replace(/_/g,"-"))||e.getAttribute("data-"+t.replace(/-/g,"_"))||e.getAttribute("data-"+t.replace(/-/g,""))||e.getAttribute("data-"+t.replace(/_/g,""));return n?String(n):null}function v(e,t){var n=d(e,t);return n?/^(true|1|yes|on)$/.test(n):null}function m(e,t){a.isTruthy(e,"element not specified"),a.isString(t);try{return String(e[t])}catch(n){throw new Error("Could not read property "+t+" : "+n.message)}}function g(e,t){a.isTruthy(e,"element not specified"),a.isString(t);try{e.innerHTML=t}catch(n){throw new Error("Could not set innerHTML : "+n.message)}}function y(e,t){a.isTruthy(e,"element not specified"),a.isString(t);var n=" "+m(e,"className")+" ";return c(n,"indexOf",!0," "+t+" ")>=0}function b(e,t){a.isTruthy(e,"element not specified"),a.isString(t),y(e,t)||(e.className=m(e,"className")+" "+t)}function w(e,t){a.isTruthy(e,"element not specified"),a.isString(t);var n=new RegExp("\\s*"+t,"g");e.className=c(m(e,"className").replace(n,""),"trim",!0)}function E(e,t,r){a.isString(e),t=t||n.body,r=r||"*";if(t.querySelectorAll)return f(t.querySelectorAll(r+"."+e));var i=t.getElementsByTagName(r),s=[];for(var o=0,u=i.length;o<u;o++)y(i[o],e)&&(s[s.length]=i[o]);return s}function S(e,t){a.isTruthy(e,"element not specified"),a.isString(t),t=t.replace(/-(\w)/g,function(e,t){return t.toUpperCase()});var r=e.currentStyle||n.defaultView.getComputedStyle(e,null),i=r[t];return/backgroundPosition?/.test(t)&&/top|left/.test(i)&&(i="0%"),i}function x(e,t,n){a.isTruthy(e,"element not specified"),a.isString(t),t=t.replace(/-(\w)/g,function(e,t){return t.toUpperCase()}),e.style[t]=n}function T(e,t){var r=!0;for(var i=0,s;s=t[i++];)s in p||(r=!1,p[s]=!0);if(r)return;if(!h.ie()){var o=n.createElement("style");o.type="text/css",o.textContent=e,n.getElementsByTagName("head")[0].appendChild(o)}else try{n.createStyleSheet().cssText=e}catch(u){n.styleSheets[0]&&(n.styleSheets[0].cssText+=e)}}function N(){var t=n.documentElement&&n.compatMode=="CSS1Compat"?n.documentElement:n.body;return{scrollTop:t.scrollTop||n.body.scrollTop,scrollLeft:t.scrollLeft||n.body.scrollLeft,width:e.innerWidth?e.innerWidth:t.clientWidth,height:e.innerHeight?e.innerHeight:t.clientHeight}}function C(e){a.isTruthy(e,"element not specified");var t=0,n=0;do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}}var p={},k={containsCss:y,addCss:b,removeCss:w,getByClass:E,getStyle:S,setStyle:x,getAttr:d,getBoolAttr:v,getProp:m,html:g,addCssRules:T,getViewportInfo:N,getPosition:C,ready:l};o.exports=k}),l("sdk.ErrorHandling",["sdk.feature","ManagedError","sdk.Runtime","sdk.Scribe","UserAgent","wrapFunction"],function(t,n,s,o,u,a,f,l,h,p,d,v){function y(e){var t=e._originalError;throw delete e._originalError,p.log("jssdk_error",{appId:h.getClientID(),error:e.name||e.message,extra:e}),t}function b(e){var t={line:e.lineNumber||e.line,message:e.message,name:e.name,script:e.fileName||e.sourceURL||e.script,stack:e.stackTrace||e.stack};t._originalError=e,d.chrome()&&/([\w:\.\/]+\.js):(\d+)/.test(e.stack)&&(t.script=RegExp.$1,t.line=parseInt(RegExp.$2,10));for(var n in t)t[n]==null&&delete t[n];return t}function w(e,t){return function(){if(!m)return e.apply(this,arguments);try{return g=t,e.apply(this,arguments)}catch(n){if(n instanceof l)throw n;var r=b(n);r.entry=t;var i=c(Array.prototype.slice.call(arguments),"map",!0,function(e){var t=Object.prototype.toString.call(e);return/^\[object (String|Number|Boolean|Object|Date)\]$/.test(t)?e:e.toString()});r.args=c("JSON","stringify",!1,i).substring(0,200),y(r)}finally{g=""}}}function E(t){return t.__wrapper||(t.__wrapper=function(){try{return t.apply(this,arguments)}catch(n){return e.setTimeout(function(){throw n},0),!1}}),t.__wrapper}function S(e,t){return function(n,r){var i=t+":"+(g||"[global]")+":"+(n.name||"[anonymous]"+(arguments.callee.caller.name?"("+arguments.callee.caller.name+")":""));return e(v(n,"entry",i),r)}}var m=f("error_handling",!1),g="";m&&(r=S(r,"setTimeout"),i=S(i,"setInterval"),v.setWrapper(w,"entry"));var x={guard:w,unguard:E};u.exports=x}),l("sdk.Insights",["sdk.Impressions"],function(e,t,n,r,i,s,o){var u={TYPE:{NOTICE:"notice",WARNING:"warn",ERROR:"error"},CATEGORY:{DEPRECATED:"deprecated",APIERROR:"apierror"},log:function(e,t,n){var r={source:"jssdk",type:e,category:t,payload:n};o.log(113,r)},impression:o.impression};i.exports=u}),l("FB",["sdk.Auth","copyProperties","CssConfig","dotAccess","sdk.domReady","sdk.DOM","sdk.ErrorHandling","sdk.Content","DOMWrapper","GlobalCallback","sdk.Insights","Log","sdk.Runtime","sdk.Scribe","SDKConfig"],function(t,r,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x){function O(e,t,n,r){var i;/^_/.test(n)?i="hide":N&&!N[t]&&(i=C);switch(i){case"hide":return;case"stub":return function(){w.warn("The method FB.%s has been removed from the JS SDK.",t)};default:return v.guard(function(){function n(e){return c("Array","isArray",!1,e)?c(e,"map",!0,n):e&&typeof e=="object"&&e.__wrapped?e.__wrapped:typeof e=="function"&&/^function/.test(e.toString())?v.unguard(e):e}i==="warn"&&(w.warn("The method FB.%s is not officially supported by Facebook and access to it will soon be removed.",t),k.hasOwnProperty(t)||(b.log(b.TYPE.WARNING,b.CATEGORY.DEPRECATED,"FB."+t),S.log("jssdk_error",{appId:E.getClientID(),error:"Private method used",extra:{args:t}}),k[t]=!0));var s=c(Array.prototype.slice.call(arguments),"map",!0,n),o=e.apply(r,s),u,a=!0;if(o&&typeof o=="object"){var f=Function();f.prototype=o,u=new f,u.__wrapped=o;for(var l in o){var h=o[l];if(typeof h!="function"||l==="constructor")continue;a=!1,u[l]=O(h,t+":"+l,l,o)}}return a?a?o:u:u},t)}}function M(e,t){var n=e?h(T,e,!0):T;c(c("Object","keys",!1,t),"forEach",!0,function(r){var i=t[r];if(typeof i=="function"){var s=(e?e+".":"")+r,o=O(i,s,r,t);o&&(n[r]=o)}})}var T,N,C=h(x,"api.mode"),k={};T=e.FB={};var L={};w.level=1,y.setPrefix("FB.__globalCallbacks");var A=n.createElement("div");g.setRoot(A),p(function(){w.info("domReady"),m.appendHidden(A),l.rules&&d.addCssRules(l.rules,l.components)}),E.subscribe("AccessToken.change",function(e){!e&&E.getLoginStatus()==="connected"&&a.getLoginStatus(null,!0)}),h(x,"api.whitelist.length")&&(N={},c(x.api.whitelist,"forEach",!0,function(e){N[e]=1})),E.setSecure(function(){var t=/iframe_canvas|app_runner/.test(e.name),n=/dialog/.test(e.name);if(location.protocol=="https:"&&(e==top||!t&&!n))return!0;if(/_fb_https?/.test(e.name))return c(e.name,"indexOf",true,"_fb_https")!=-1}()),f(L,{provide:M}),o.exports=L}),l("ArgumentError",["ManagedError"],function(e,t,n,r,i,s,o){function u(e,t){o.prototype.constructor.apply(this,arguments)}u.prototype=new o,u.prototype.constructor=u,i.exports=u}),l("CORSRequest",["wrapFunction","QueryString"],function(e,n,r,i,s,o,u,a){function f(e,n){if(!t.XMLHttpRequest)return null;var r=new XMLHttpRequest,i=function(){};if("withCredentials"in r)r.open(e,n,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded");else{if(!t.XDomainRequest)return null;r=new XDomainRequest;try{r.open(e,n),r.onprogress=r.ontimeout=i}catch(s){return null}}var o={send:function(e){r.send(e)}},a=u(function(){a=i,"onload"in o&&o.onload(r)},"entry","XMLHttpRequest:load"),f=u(function(){f=i,"onerror"in o&&o.onerror(r)},"entry","XMLHttpRequest:error");return r.onload=function(){a()},r.onerror=function(){f()},r.onreadystatechange=function(){r.readyState==4&&(r.status==200?a():f())},o}function l(e,t,n,r){n.suppress_http_code=1;var i=a.encode(n);t!="post"&&(e=a.appendToUrl(e,i),i="");var s=f(t,e);return s?(s.onload=function(e){r(c("JSON","parse",!1,e.responseText))},s.onerror=function(e){e.responseText?r(c("JSON","parse",!1,e.responseText)):r({error:{type:"http",message:"unknown error",status:e.status}})},s.send(i),!0):!1}var h={execute:l};s.exports=h}),l("FlashRequest",["DOMWrapper","Flash","GlobalCallback","QueryString","Queue"],function(e,t,n,r,i,s,o,u,a,f,l){function m(){if(!d)throw new Error("swfUrl has not been set");var e=a.create(function(){h.start(function(e){var t=v.execute(e.method,e.url,e.body);if(!t)throw new Error("Could create request");p[t]=e.callback})}),t=a.create(function(e,t,n){var r;try{r=c("JSON","parse",!1,decodeURIComponent(n))}catch(i){r={error:{type:"SyntaxError",message:i.message,status:t,raw:n}}}p[e](r),delete p[e]});v=u.embed(d,o.getRoot(),null,{log:!1,initCallback:e,requestCallback:t})}function g(e,t,n,r){n.suppress_http_code=1,n.method||(n.method=t);var i=f.encode(n);t==="get"&&e.length+i.length<2e3?(e=f.appendToUrl(e,i),i=""):t="post";if(!h){if(!u.isAvailable())return!1;h=new l,m()}return h.enqueue({method:t,url:e,body:i,callback:r}),!0}var h,p={},d,v,y={setSwfUrl:function(e){d=e},execute:g};i.exports=y}),l("flattenObject",[],function(e,t,n,r,i,s){function o(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];if(null===r||undefined===r)continue;typeof r=="string"?t[n]=r:t[n]=c("JSON","stringify",!1,r)}return t}i.exports=o}),l("JSONPRequest",["DOMWrapper","GlobalCallback","QueryString"],function(e,t,i,s,o,u,a,f,l){function c(e,t,i,s){var o=n.createElement("script"),u=function(e){u=function(){},f.remove(i.callback),s(e),o.parentNode.removeChild(o)};i.callback=f.create(u),i.method||(i.method=t),e=l.appendToUrl(e,i);if(e.length>2e3)return f.remove(i.callback),!1;o.onerror=function(){u({error:{type:"http",message:"unknown error"}})};var c=function(){r(function(){u({error:{type:"http",message:"unknown error"}})},0)};return o.addEventListener?o.addEventListener("load",c,!1):o.onreadystatechange=function(){/loaded|complete/.test(this.readyState)&&c()},o.src=e,a.getRoot().appendChild(o),!0}var h={execute:c};o.exports=h}),l("keyMirror",["invariant"],function(e,t,n,r,i,s,o){"use strict";var u=function(e){var t={},n;o(e instanceof Object&&!c("Array","isArray",!1,e));for(n in e){if(!e.hasOwnProperty(n))continue;t[n]=n}return t};i.exports=u}),l("mergeHelpers",["invariant","keyMirror"],function(e,t,n,r,i,s,o,u){"use strict";var a=36,f=function(e){return typeof e!="object"||e===null},l={MAX_MERGE_DEPTH:a,isTerminal:f,normalizeMergeArg:function(e){return e===undefined||e===null?{}:e},checkMergeArrayArgs:function(e,t){o(c("Array","isArray",!1,e)&&c("Array","isArray",!1,t))},checkMergeObjectArgs:function(e,t){l.checkMergeObjectArg(e),l.checkMergeObjectArg(t)},checkMergeObjectArg:function(e){o(!f(e)&&!c("Array","isArray",!1,e))},checkMergeLevel:function(e){o(e<a)},checkArrayStrategy:function(e){o(e===undefined||e in l.ArrayStrategies)},ArrayStrategies:u({Clobber:!0,IndexByIndex:!0})};i.exports=l}),l("mergeInto",["mergeHelpers"],function(e,t,n,r,i,s,o){"use strict";function a(e,t){u(e);if(t!=null){u(t);for(var n in t){if(!t.hasOwnProperty(n))continue;e[n]=t[n]}}}var u=o.checkMergeObjectArg;i.exports=a}),l("merge",["mergeInto"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,t){var n={};return o(n,e),o(n,t),n};i.exports=u}),l("ApiClient",["ArgumentError","Assert","copyProperties","CORSRequest","FlashRequest","flattenObject","JSONPRequest","Log","merge","ObservableMixin","sprintf","URL","UrlMap","ApiClientConfig"],function(e,t,n,r,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w){function C(e,t,n,r){x&&(n=a({},x,n)),n.access_token=n.access_token||E,n.pretty=n.pretty||0,n=h(n);var i={jsonp:p,cors:f,flash:l},s;n.transport?(s=[n.transport],delete n.transport):s=["jsonp","cors","flash"];for(var o=0;o<s.length;o++){var u=i[s[o]],c=a({},n);if(u.execute(e,t,c,r))return}r({error:{type:"no-transport",message:"Could not find a usable transport for request"}})}function k(e,t,n,r,i){O.inform("request.complete",t,n,r,i),e&&e(i)}function L(e){u.isString(e,"Invalid path");var t,n={};try{t=new y(e)}catch(r){throw new o(r.message,r)}c(Array.prototype.slice.call(arguments,1),"forEach",!0,function(e){n[typeof e]=e});var i=(n.string||"get").toLowerCase(),s=v(n.object||{},t.getParsedSearch()),a=n["function"];a||d.warn("No callback passed to the ApiClient");var f=c(k,"bind",!0,null,a,t.getPath(),i,s);u.isTrue(i in T,g("Invalid method passed to ApiClient: %s",i)),s.method=i,t=b.resolve("graph")+t.getPath(),C(t,i=="get"?"get":"post",s,f)}function A(e,t){u.isObject(e),u.isString(e.method,"method missing"),t||d.warn("No callback passed to the ApiClient");var n=e.method.toLowerCase().replace(".","_");e.format="json-strings",e.api_key=S;var r=n in N?"api_read":"api",i=b.resolve(r)+"/restserver.php",s=c(k,"bind",!0,null,t,"/restserver.php","get",e);C(i,"get",e,s)}var E,S,x,T={get:!0,post:!0,"delete":!0,put:!0},N={fql_query:!0,fql_multiquery:!0,friends_get:!0,notifications_get:!0,stream_get:!0,users_getinfo:!0},O=a(new m,{setAccessToken:function(e){E=e},setClientID:function(e){S=e},setDefaultParams:function(e){x=e},rest:A,graph:L});l.setSwfUrl(w.FlashRequest.swfUrl),i.exports=O}),l("sdk.api",["ApiClient","sdk.Runtime"],function(e,t,n,r,i,s,o,u){function f(){typeof arguments[0]=="string"?o.graph.apply(o,arguments):o.rest.apply(o,arguments)}var a;u.subscribe("ClientID.change",function(e){o.setClientID(e)}),u.subscribe("AccessToken.change",function(e){a=e,o.setAccessToken(e)}),o.setDefaultParams({sdk:"joey"}),o.subscribe("request.complete",function(e,t,n,r){var i=!1;if(r&&typeof r=="object")if(r.error){if(r.error=="invalid_token"||r.error.type=="OAuthException"&&r.error.code==190)i=!0}else r.error_code&&r.error_code=="190"&&(i=!0);i&&a===u.getAccessToken()&&u.setAccessToken(null)}),o.subscribe("request.complete",function(e,t,n,r){(e=="/me/permissions"&&t==="delete"||e=="/restserver.php"&&n.method=="Auth.revokeAuthorization")&&r===!0&&u.setAccessToken(null)}),i.exports=f}),l("legacy:fb.api",["FB","sdk.api"],function(e,t,n,r,i,s,o,u){o.provide("",{api:u})},3),l("sdk.Canvas.Environment",["sdk.RPC"],function(e,t,n,r,i,s,o){function u(e){o.remote.getPageInfo(function(t){e(t.result)})}function a(e,t){o.remote.scrollTo({x:e||0,y:t||0})}o.stub("getPageInfo"),o.stub("scrollTo");var f={getPageInfo:u,scrollTo:a};i.exports=f}),l("sdk.Intl",["Log"],function(e,t,n,r,i,s,o){function a(e){return typeof e!="string"?!1:!!e.match(new RegExp(u+"["+')"'+"'"+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+""+"\\s"+"]*$"))}function f(e,t){if(t!==undefined)if(typeof t!="object")o.error("The second arg to FB.Intl.tx() must be an Object for FB.Intl.tx("+e+", ...)");else{var n;for(var r in t)t.hasOwnProperty(r)&&(a(t[r])?n=new RegExp("\\{"+r+"\\}"+u+"*","g"):n=new RegExp("\\{"+r+"\\}","g"),e=e.replace(n,t[r]))}return e}function l(){throw new Error("Placeholder function")}var u="[.!?]";l._=f,i.exports={tx:l}}),l("sdk.Dialog",["sdk.Canvas.Environment","sdk.Content","sdk.DOM","DOMEventListener","sdk.Intl","ObservableMixin","sdk.Runtime","Type","UserAgent","sdk.feature"],function(t,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b){function N(){if(b("dialog_resize_refactor")){var e=h.getViewportInfo();if(e.height&&e.width)return{width:Math.min(e.width,w),height:Math.min(e.height,E)}}return null}var w=590,E=500,S=240,x=575,T=function(){var e;if(b("dialog_resize_refactor")){var t=N();e=t&&(t.height>=w||t.width>=E)}else e=y.ipad();return T=function(){return e},e},C=g.extend({constructor:function(t,n){this.parent(),this.id=t,this.display=n,this._e2e={},k._dialogs||(k._dialogs={},k._addOrientationHandler()),k._dialogs[t]=this,this.trackEvent("init")},trackEvent:function(e,t){return this._e2e[e]?this:(this._e2e[e]=t||c("Date","now",!1),e=="close"&&this.inform("e2e:end",this._e2e),this)},trackEvents:function(e){typeof e=="string"&&(e=c("JSON","parse",!1,e));for(var t in e)e.hasOwnProperty(t)&&this.trackEvent(t,e[t]);return this}},v),k={newInstance:function(e,t){return new C(e,t)},_dialogs:null,_lastYOffset:0,_loaderEl:null,_overlayEl:null,_stack:[],_active:null,get:function(e){return k._dialogs[e]},_findRoot:function(e){while(e){if(h.containsCss(e,"fb_dialog"))return e;e=e.parentNode}},_createWWWLoader:function(e){return e=e?e:460,k.create({content:'<div class="dialog_title">  <a id="fb_dialog_loader_close">    <div class="fb_dialog_close_icon"></div>  </a>  <span>Facebook</span>  <div style="clear:both;"></div></div><div class="dialog_content"></div><div class="dialog_footer"></div>',width:e})},_createMobileLoader:function(){var e=y.nativeApp()?"":'<table>  <tbody>    <tr>      <td class="header_left">        <label class="touchable_button">          <input type="submit" value="'+d.tx._("Cancel")+'"'+'            id="fb_dialog_loader_close"/>'+"        </label>"+"      </td>"+'      <td class="header_center">'+"        <div>"+d.tx._("Loading...")+"</div>"+"      </td>"+'      <td class="header_right">'+"      </td>"+"    </tr>"+"  </tbody>"+"</table>";return k.create({classes:"loading"+(T()?" centered":""),content:'<div class="dialog_header">'+e+"</div>"})},_restoreBodyPosition:function(){if(!T()){var e=n.getElementsByTagName("body")[0];h.removeCss(e,"fb_hidden")}},_showTabletOverlay:function(){if(!T())return;k._overlayEl||(k._overlayEl=n.createElement("div"),k._overlayEl.setAttribute("id","fb_dialog_ipad_overlay"),l.append(k._overlayEl,null)),k._overlayEl.className=""},_hideTabletOverlay:function(){T()&&(k._overlayEl.className="hidden")},showLoader:function(e,t){k._showTabletOverlay(),k._loaderEl||(k._loaderEl=k._findRoot(y.mobile()?k._createMobileLoader():k._createWWWLoader(t))),e||(e=function(){});var r=n.getElementById("fb_dialog_loader_close");h.removeCss(r,"fb_hidden"),r.onclick=function(){k._hideLoader(),k._restoreBodyPosition(),k._hideTabletOverlay(),e()};var i=n.getElementById("fb_dialog_ipad_overlay");i&&(i.ontouchstart=r.onclick),k._makeActive(k._loaderEl)},_hideLoader:function(){k._loaderEl&&k._loaderEl==k._active&&(k._loaderEl.style.top="-10000px")},_makeActive:function(e){k._setDialogSizes(),k._lowerActive(),k._active=e,m.isEnvironment(m.ENVIRONMENTS.CANVAS)&&f.getPageInfo(function(e){k._centerActive(e)}),k._centerActive()},_lowerActive:function(){if(!k._active)return;k._active.style.top="-10000px",k._active=null},_removeStacked:function(e){k._stack=c(k._stack,"filter",!0,function(t){return t!=e})},_centerActive:function(e){var t=k._active;if(!t)return;var r=h.getViewportInfo(),i=parseInt(t.offsetWidth,10),s=parseInt(t.offsetHeight,10),o=r.scrollLeft+(r.width-i)/2,u=(r.height-s)/2.5;o<u&&(u=o);var a=r.height-s-u,f=(r.height-s)/2;e&&(f=e.scrollTop-e.offsetTop+(e.clientHeight-s)/2),f<u?f=u:f>a&&(f=a),f+=r.scrollTop;if(y.mobile()){var l=100;if(T())l+=(r.height-s)/2;else{var c=n.getElementsByTagName("body")[0];h.addCss(c,"fb_hidden"),b("dialog_resize_refactor")&&(c.style.width="auto"),f=1e4}var p=h.getByClass("fb_dialog_padding",t);p.length&&(p[0].style.height=l+"px")}t.style.left=(o>0?o:0)+"px",t.style.top=(f>0?f:0)+"px"},_setDialogSizes:function(){if(!y.mobile()||T())return;for(var e in k._dialogs)if(k._dialogs.hasOwnProperty(e)){var t=n.getElementById(e);t&&(t.style.width=k.getDefaultSize().width+"px",t.style.height=k.getDefaultSize().height+"px")}},getDefaultSize:function(){if(y.mobile()){var t=N();if(t)return t;if(y.ipad())return{width:E,height:w};if(y.android())return{width:screen.availWidth,height:screen.availHeight};var n=e.innerWidth,r=e.innerHeight,i=n/r>1.2;return{width:n,height:Math.max(r,i?screen.width:screen.height)}}return{width:x,height:S}},_handleOrientationChange:function(e){var t=b("dialog_resize_refactor",!1)?h.getViewportInfo().width:screen.availWidth;if(y.android()&&t==k._availScreenWidth){r(k._handleOrientationChange,50);return}k._availScreenWidth=t;if(T())k._centerActive();else{var i=k.getDefaultSize().width;for(var s in k._dialogs)if(k._dialogs.hasOwnProperty(s)){var o=n.getElementById(s);o&&(o.style.width=i+"px")}}},_addOrientationHandler:function(){if(!y.mobile())return;var t="onorientationchange"in e?"orientationchange":"resize";k._availScreenWidth=b("dialog_resize_refactor",!1)?h.getViewportInfo().width:screen.availWidth,p.add(e,t,k._handleOrientationChange)},create:function(e){e=e||{};var t=n.createElement("div"),r=n.createElement("div"),i="fb_dialog";if(e.closeIcon&&e.onClose){var s=n.createElement("a");s.className="fb_dialog_close_icon",s.onclick=e.onClose,t.appendChild(s)}i+=" "+(e.classes||""),y.ie()?(i+=" fb_dialog_legacy",c(["vert_left","vert_right","horiz_top","horiz_bottom","top_left","top_right","bottom_left","bottom_right"],"forEach",!0,function(e){var r=n.createElement("span");r.className="fb_dialog_"+e,t.appendChild(r)})):i+=y.mobile()?" fb_dialog_mobile":" fb_dialog_advanced",e.content&&l.append(e.content,r),t.className=i;var o=parseInt(e.width,10);isNaN(o)||(t.style.width=o+"px"),r.className="fb_dialog_content",t.appendChild(r);if(y.mobile()){var u=n.createElement("div");u.className="fb_dialog_padding",t.appendChild(u)}return l.append(t),e.visible&&k.show(t),r},show:function(e){var t=k._findRoot(e);t&&(k._removeStacked(t),k._hideLoader(),k._makeActive(t),k._stack.push(t),"fbCallID"in e&&k.get(e.fbCallID).inform("iframe_show").trackEvent("show"))},hide:function(e){var t=k._findRoot(e);k._hideLoader(),t==k._active&&(k._lowerActive(),k._restoreBodyPosition(),k._hideTabletOverlay(),"fbCallID"in e&&k.get(e.fbCallID).inform("iframe_hide").trackEvent("hide"))},remove:function(e){e=k._findRoot(e);if(e){var t=k._active==e;k._removeStacked(e),t?(k._hideLoader(),k._stack.length>0?k.show(k._stack.pop()):(k._lowerActive(),k._restoreBodyPosition(),k._hideTabletOverlay())):k._active===null&&k._stack.length>0&&k.show(k._stack.pop()),r(function(){e.parentNode.removeChild(e)},3e3)}},isActive:function(e){var t=k._findRoot(e);return t&&t===k._active}};u.exports=k}),l("sdk.Frictionless",["sdk.Auth","sdk.api","sdk.Event","sdk.Dialog"],function(e,t,n,r,i,s,o,u,a,f){var l={_allowedRecipients:{},_useFrictionless:!1,_updateRecipients:function(){l._allowedRecipients={},u("/me/apprequestformerrecipients",function(e){if(!e||e.error)return;c(e.data,"forEach",!0,function(e){l._allowedRecipients[e.recipient_id]=!0})})},init:function(){l._useFrictionless=!0,o.getLoginStatus(function(e){e.status=="connected"&&l._updateRecipients()}),a.subscribe("auth.login",function(e){e.authResponse&&l._updateRecipients()})},_processRequestResponse:function(e,t){return function(n){var r=n&&n.updated_frictionless;l._useFrictionless&&r&&l._updateRecipients(),n&&(!t&&n.frictionless&&(f._hideLoader(),f._restoreBodyPosition(),f._hideIPadOverlay()),delete n.frictionless,delete n.updated_frictionless),e&&e(n)}},isAllowed:function(e){if(!e)return!1;if(typeof e=="number")return e in l._allowedRecipients;typeof e=="string"&&(e=e.split(",")),e=c(e,"map",!0,function(e){return c(String(e),"trim",!0)});var t=!0,n=!1;return c(e,"forEach",!0,function(e){t=t&&e in l._allowedRecipients,n=!0}),t&&n}};a.subscribe("init:post",function(e){e.frictionlessRequests&&l.init()}),i.exports=l}),l("insertIframe",["guid","GlobalCallback"],function(e,t,i,s,o,u,a,f){function l(e){e.id=e.id||a(),e.name=e.name||a();var t=!1,i=!1,s=function(){t&&!i&&(i=!0,e.onload&&e.onload(e.root.firstChild))},o=f.create(s);if(n.attachEvent){var u='<iframe id="'+e.id+'"'+' name="'+e.name+'"'+(e.title?' title="'+e.title+'"':"")+(e.className?' class="'+e.className+'"':"")+' style="border:none;'+(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"")+'"'+' src="javascript:false;"'+' frameborder="0"'+' scrolling="no"'+' allowtransparency="true"'+' onload="'+o+'()"'+"></iframe>";e.root.innerHTML='<iframe src="javascript:false" frameborder="0" scrolling="no" style="height:1px"></iframe>',t=!0,r(function(){e.root.innerHTML=u,e.root.firstChild.src=e.url,e.onInsert&&e.onInsert(e.root.firstChild)},0)}else{var l=n.createElement("iframe");l.id=e.id,l.name=e.name,l.onload=s,l.scrolling="no",l.style.border="none",l.style.overflow="hidden",e.title&&(l.title=e.title),e.className&&(l.className=e.className),e.height!==undefined&&(l.style.height=e.height+"px"),e.width!==undefined&&(e.width=="100%"?l.style.width=e.width:l.style.width=e.width+"px"),e.root.appendChild(l),t=!0,l.src=e.url,e.onInsert&&e.onInsert(l)}}o.exports=l}),l("sdk.Native",["copyProperties","Log","UserAgent"],function(t,n,r,i,s,o,u,a,f){var l="fbNativeReady",c={onready:function(t){if(!f.nativeApp()){a.error("FB.Native.onready only works when the page is rendered in a WebView of the native Facebook app. Test if this is the case calling FB.UA.nativeApp()");return}e.__fbNative&&!this.nativeReady&&u(this,e.__fbNative);if(this.nativeReady)t();else{var n=function(r){e.removeEventListener(l,n),this.onready(t)};e.addEventListener(l,n,!1)}}};s.exports=c}),l("resolveURI",[],function(t,r,i,s,o,u){function a(t){if(!t)return e.location.href;t=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;");var r=n.createElement("div");return r.innerHTML='<a href="'+t+'"></a>',r.firstChild.href}o.exports=a}),l("sdk.UIServer",["sdk.Auth","sdk.Content","copyProperties","sdk.Dialog","sdk.DOM","sdk.Event","flattenObject","sdk.Frictionless","sdk.getContextType","guid","insertIframe","Log","sdk.Native","QueryString","resolveURI","sdk.RPC","sdk.Runtime","SDKConfig","UrlMap","UserAgent","sdk.XD"],function(t,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M){var _={transform:function(t){return t.params.display==="touch"&&t.params.access_token&&e.postMessage?(t.params.channel=P._xdChannelHandler(t.id,"parent"),O.nativeApp()||(t.params.in_iframe=1),t):P.genericTransform(t)},getXdRelation:function(t){var n=t.display;return n==="touch"&&e.postMessage&&t.in_iframe?"parent":P.getXdRelation(t)}},D={"stream.share":{size:{width:670,height:340},url:"sharer.php",transform:function(t){return t.params.u||(t.params.u=e.location.toString()),t.params.display="popup",t}},apprequests:{transform:function(e){return e=_.transform(e),e.params.frictionless=y&&y._useFrictionless,e.params.frictionless&&(y.isAllowed(e.params.to)&&(e.params.display="iframe",e.params.in_iframe=!0,e.hideLoader=!0),e.cb=y._processRequestResponse(e.cb,e.hideLoader)),e.closeIcon=!1,e},getXdRelation:_.getXdRelation},feed:_,"permissions.oauth":{url:"dialog/oauth",size:{width:O.mobile()?null:475,height:O.mobile()?null:183},transform:function(e){if(!k.getClientID()){S.error("FB.login() called before FB.init().");return}if(l.getAuthResponse()&&!e.params.scope&&!e.params.auth_type){S.error("FB.login() called when user is already connected."),e.cb&&e.cb({status:k.getLoginStatus(),authResponse:l.getAuthResponse()});return}var t=e.cb,n=e.id;return delete e.cb,e.params.display==="async"?(p(e.params,{client_id:k.getClientID(),origin:b(),response_type:"token,signed_request",domain:location.hostname}),e.cb=l.xdResponseWrapper(t,l.getAuthResponse(),"permissions.oauth")):p(e.params,{client_id:k.getClientID(),redirect_uri:N(P.xdHandler(t,n,"opener",l.getAuthResponse(),"permissions.oauth")),origin:b(),response_type:"token,signed_request",domain:location.hostname}),e}},"auth.logout":{url:"logout.php",transform:function(e){if(!k.getClientID())S.error("FB.logout() called before calling FB.init().");else{if(!!l.getAuthResponse())return e.params.next=P.xdHandler(e.cb,e.id,"parent",l.getAuthResponse(),"logout"),e;S.error("FB.logout() called without an access token.")}}},"login.status":{url:"dialog/oauth",transform:function(e){var t=e.cb,n=e.id;return delete e.cb,p(e.params,{client_id:k.getClientID(),redirect_uri:P.xdHandler(t,n,"parent",l.getAuthResponse(),"login_status"),origin:b(),response_type:"token,signed_request,code",domain:location.hostname}),e}}},P={Methods:D,_loadedNodes:{},_defaultCb:{},_resultToken:'"xxRESULTTOKENxx"',genericTransform:function(e){return(e.params.display=="dialog"||e.params.display=="iframe")&&p(e.params,{display:"iframe",channel:P._xdChannelHandler(e.id,"parent.parent")},!0),e},checkOauthDisplay:function(e){var t=e.scope||e.perms||k.getScope();if(!t)return e.display;var n=t.split(/\s|,/g);for(var r=0;r<n.length;r++)if(!L.initSitevars.iframePermissions[c(n[r],"trim",!0)])return"popup";return e.display},prepareCall:function(e,t){var n=e.method.toLowerCase(),r=p({},P.Methods[n]),i=w(),s=k.getSecure()||n!=="auth.status"&&n!="login.status";p(e,{app_id:k.getClientID(),locale:k.getLocale(),sdk:"joey",access_token:s&&k.getAccessToken()||undefined}),e.display=P.getDisplayMode(r,e),r.url||(r.url="dialog/"+n),(r.url=="dialog/oauth"||r.url=="dialog/permissions.request")&&(e.display=="iframe"||e.display=="touch"&&e.in_iframe)&&(e.display=P.checkOauthDisplay(e));var o={cb:t,id:i,size:r.size||P.getDefaultSize(),url:A.resolve(e.display=="touch"?"m":"www",s)+"/"+r.url,params:e,name:n,dialog:d.newInstance(i,e.display)},u=r.transform?r.transform:P.genericTransform;if(u){o=u(o);if(!o)return}var a=r.getXdRelation||P.getXdRelation,f=a(o.params);return!(o.id in P._defaultCb)&&!("next"in o.params)&&!("redirect_uri"in o.params)&&(o.params.next=P._xdResult(o.cb,o.id,f,!0)),f==="parent"&&p(o.params,{channel_url:P._xdChannelHandler(i,"parent.parent")},!0),o=P.prepareParams(o),o},prepareParams:function(e){var t=e.params.method;e.params.display!=="async"&&delete e.params.method,e.params=g(e.params);var n=T.encode(e.params);return!O.nativeApp()&&P.urlTooLongForIE(e.url+"?"+n)?e.post=!0:n&&(e.url+="?"+n),e},urlTooLongForIE:function(e){return e.length>2e3},getDisplayMode:function(e,t){if(t.display==="hidden"||t.display==="none")return t.display;var n=k.isEnvironment(k.ENVIRONMENTS.CANVAS)||k.isEnvironment(k.ENVIRONMENTS.PAGETAB);return n&&!t.display?"async":O.mobile()||t.display==="touch"?"touch":!k.getAccessToken()&&t.display=="dialog"&&!e.loggedOutIframe?(S.error('"dialog" mode can only be used when the user is connected.'),"popup"):e.connectDisplay&&!n?e.connectDisplay:t.display||(k.getAccessToken()?"dialog":"popup")},getXdRelation:function(t){var n=t.display;if(n==="popup"||n==="touch")return"opener";if(n==="dialog"||n==="iframe"||n==="hidden"||n==="none")return"parent";if(n==="async")return"parent.frames["+e.name+"]"},popup:function(t){var r=typeof e.screenX!="undefined"?e.screenX:e.screenLeft,i=typeof e.screenY!="undefined"?e.screenY:e.screenTop,s=typeof e.outerWidth!="undefined"?e.outerWidth:n.documentElement.clientWidth,o=typeof e.outerHeight!="undefined"?e.outerHeight:n.documentElement.clientHeight-22,u=O.mobile()?null:t.size.width,a=O.mobile()?null:t.size.height,f=r<0?e.screen.width+r:r,l=parseInt(f+(s-u)/2,10),c=parseInt(i+(o-a)/2.5,10),p=[];u!==null&&p.push("width="+u),a!==null&&p.push("height="+a),p.push("left="+l),p.push("top="+c),p.push("scrollbars=1"),(t.name=="permissions.request"||t.name=="permissions.oauth")&&p.push("location=1,toolbar=0"),p=p.join(",");var d;t.post?(d=e.open("about:blank",t.id,p),d&&(P.setLoadedNode(t,d,"popup"),h.submitToTarget({url:t.url,target:t.id,params:t.params}))):(d=e.open(t.url,t.id,p),d&&P.setLoadedNode(t,d,"popup"));if(!d)return;t.id in P._defaultCb&&P._popupMonitor()},setLoadedNode:function(e,t,n){e.params&&e.params.display!="popup"&&(t.fbCallID=e.id),t={node:t,type:n,fbCallID:e.id},P._loadedNodes[e.id]=t},getLoadedNode:function(e){var t=typeof e=="object"?e.id:e,n=P._loadedNodes[t];return n?n.node:null},hidden:function(e){e.className="FB_UI_Hidden",e.root=h.appendHidden(""),P._insertIframe(e)},iframe:function(e){e.className="FB_UI_Dialog";var t=function(){P._triggerDefault(e.id)};e.root=d.create({onClose:t,closeIcon:e.closeIcon===undefined?!0:e.closeIcon,classes:O.ipad()?"centered":""}),e.hideLoader||d.showLoader(t,e.size.width),v.addCss(e.root,"fb_dialog_iframe"),P._insertIframe(e)},touch:function(e){e.params&&e.params.in_iframe?e.ui_created?d.showLoader(function(){P._triggerDefault(e.id)},0):P.iframe(e):O.nativeApp()&&!e.ui_created?(e.frame=e.id,x.onready(function(){P.setLoadedNode(e,x.open(e.url+"#cb="+e.frameName),"native")}),P._popupMonitor()):e.ui_created||P.popup(e)},async:function(e){e.params.redirect_uri=location.protocol+"//"+location.host+location.pathname,delete e.params.access_token,C.remote.showDialog(e.params,function(t){var n=t.result;if(n&&n.e2e){var r=d.get(e.id);r.trackEvents(n.e2e),r.trackEvent("close"),delete n.e2e}e.cb(n)})},getDefaultSize:function(){return d.getDefaultSize()},_insertIframe:function(e){P._loadedNodes[e.id]=!1;var t=function(t){e.id in P._loadedNodes&&P.setLoadedNode(e,t,"iframe")};e.post?E({url:"about:blank",root:e.root,className:e.className,width:e.size.width,height:e.size.height,id:e.id,onInsert:t,onload:function(t){h.submitToTarget({url:e.url,target:t.name,params:e.params})}}):E({url:e.url,root:e.root,className:e.className,width:e.size.width,height:e.size.height,id:e.id,name:e.frameName,onInsert:t})},_handleResizeMessage:function(e,t){var n=P.getLoadedNode(e);if(!n)return;t.height&&(n.style.height=t.height+"px"),t.width&&(n.style.width=t.width+"px"),M.inform("resize.ack",t||{},"parent.frames["+n.name+"]"),d.isActive(n)||d.show(n)},_triggerDefault:function(e){P._xdRecv({frame:e},P._defaultCb[e]||function(){})},_popupMonitor:function(){var e;for(var t in P._loadedNodes)if(P._loadedNodes.hasOwnProperty(t)&&t in P._defaultCb){var n=P._loadedNodes[t];if(n.type!="popup"&&n.type!="native")continue;var r=n.node;try{r.closed?P._triggerDefault(t):e=!0}catch(s){}}e&&!P._popupInterval?P._popupInterval=i(P._popupMonitor,100):!e&&P._popupInterval&&(clearInterval(P._popupInterval),P._popupInterval=null)},_xdChannelHandler:function(e,t){return M.handler(function(t){var n=P.getLoadedNode(e);if(!n)return;if(t.type=="resize")P._handleResizeMessage(e,t);else if(t.type=="hide")d.hide(n);else if(t.type=="rendered"){var r=d._findRoot(n);d.show(r)}else t.type=="fireevent"&&m.fire(t.event)},t,!0,null)},_xdNextHandler:function(e,t,n,r){return r&&(P._defaultCb[t]=e),M.handler(function(t){P._xdRecv(t,e)},n)+"&frame="+t},_xdRecv:function(t,n){var i=P.getLoadedNode(t.frame);if(i)if(i.close)try{i.close(),/iPhone.*Version\/(5|6)/.test(navigator.userAgent)&&RegExp.$1!=="5"&&e.focus(),P._popupCount--}catch(s){}else v.containsCss(i,"FB_UI_Hidden")?r(function(){i.parentNode.parentNode.removeChild(i.parentNode)},3e3):v.containsCss(i,"FB_UI_Dialog")&&d.remove(i);delete P._loadedNodes[t.frame],delete P._defaultCb[t.frame];if(t.e2e){var o=d.get(t.frame);o.trackEvents(t.e2e),o.trackEvent("close"),delete t.e2e}n(t)},_xdResult:function(e,t,n,r){return P._xdNextHandler(function(t){e&&e(t.result&&t.result!=P._resultToken&&c("JSON","parse",!1,t.result))},t,n,r)+"&result="+encodeURIComponent(P._resultToken)},xdHandler:function(e,t,n,r,i){return P._xdNextHandler(l.xdResponseWrapper(e,r,i),t,n,!0)}};C.stub("showDialog"),a.exports=P}),l("sdk.ui",["Assert","copyProperties","sdk.feature","sdk.Impressions","Log","sdk.UIServer"],function(e,t,n,r,i,s,o,u,a,f,l,h){function p(e,t){o.isObject(e),o.maybeFunction(t),e=u({},e);if(!e.method)return l.error('"method" is a required parameter for FB.ui().'),null;var n=e.method;e.redirect_uri&&(l.warn("When using FB.ui, you should not specify a redirect_uri."),delete e.redirect_uri),(n=="permissions.request"||n=="permissions.oauth")&&(e.display=="iframe"||e.display=="dialog")&&(e.display=h.checkOauthDisplay(e));var r=a("e2e_tracking",!0);r&&(e.e2e={});var i=h.prepareCall(e,t||function(){});if(!i)return null;var s=i.params.display;s==="dialog"?s="iframe":s==="none"&&(s="hidden");var p=h[s];return p?(r&&i.dialog.subscribe("e2e:end",function(e){e.method=n,e.display=s,l.debug("e2e: %s",c("JSON","stringify",!1,e)),f.log(114,{payload:e})}),p(i),i.dialog):(l.error('"display" must be one of "popup", "dialog", "iframe", "touch", "async", "hidden", or "none"'),null)}i.exports=p}),l("legacy:fb.auth",["sdk.Auth","sdk.Cookie","copyProperties","sdk.Event","FB","Log","sdk.Runtime","sdk.SignedRequest","sdk.ui"],function(e,t,n,r,i,s,o,u,a,f,l,h,p,d,v){l.provide("",{getLoginStatus:function(){return o.getLoginStatus.apply(o,arguments)},getAuthResponse:function(){return o.getAuthResponse()},getAccessToken:function(){return p.getAccessToken()||null},getUserID:function(){return p.getUserID()||p.getCookieUserID()},login:function(e,t){t&&t.perms&&!t.scope&&(t.scope=t.perms,delete t.perms,h.warn("OAuth2 specification states that 'perms' should now be called 'scope'.  Please update."));var n=p.isEnvironment(p.ENVIRONMENTS.CANVAS)||p.isEnvironment(p.ENVIRONMENTS.PAGETAB);v(a({method:"permissions.oauth",display:n?"async":"popup",domain:location.hostname},t||{}),e)},logout:function(e){v({method:"auth.logout",display:"hidden"},e)}}),o.subscribe("logout",c(f.fire,"bind",!0,f,"auth.logout")),o.subscribe("login",c(f.fire,"bind",!0,f,"auth.login")),o.subscribe("authresponse.change",c(f.fire,"bind",!0,f,"auth.authResponseChange")),o.subscribe("status.change",c(f.fire,"bind",!0,f,"auth.statusChange")),f.subscribe("init:post",function(e){e.status&&o.getLoginStatus();if(p.getClientID())if(e.authResponse)o.setAuthResponse(e.authResponse,"connected");else if(p.getUseCookie()){var t=u.loadSignedRequest(),n;if(t){try{n=d.parse(t)}catch(r){u.clearSignedRequestCookie()}n&&n.user_id&&p.setCookieUserID(n.user_id)}u.loadMeta()}})},3),l("sdk.Canvas.Plugin",["sdk.api","sdk.RPC","Log","UserAgent","sdk.Runtime","createArrayFrom"],function(t,n,i,s,o,u,a,f,l,h,p,d){function b(e){e._hideunity_savedstyle={},e._hideunity_savedstyle.left=e.style.left,e._hideunity_savedstyle.position=e.style.position,e._hideunity_savedstyle.width=e.style.width,e._hideunity_savedstyle.height=e.style.height,e.style.left="-10000px",e.style.position="absolute",e.style.width="1px",e.style.height="1px"}function w(e){e._hideunity_savedstyle&&(e.style.left=e._hideunity_savedstyle.left,e.style.position=e._hideunity_savedstyle.position,e.style.width=e._hideunity_savedstyle.width,e.style.height=e._hideunity_savedstyle.height)}function E(e){e._old_visibility=e.style.visibility,e.style.visibility="hidden"}function S(e){e.style.visibility=e._old_visibility||"",delete e._old_visibility}function x(e){var t=e.type?e.type.toLowerCase():null,n=t==="application/x-shockwave-flash"||e.classid&&e.classid.toUpperCase()==v;if(!n)return!1;var r=/opaque|transparent/i;if(r.test(e.getAttribute("wmode")))return!1;for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(/param/i.test(s.nodeName)&&/wmode/i.test(s.name)&&r.test(s.value))return!1}return!0}function T(e){var t=e.type?e.type.toLowerCase():null;return t==="application/vnd.unity"||e.classid&&e.classid.toUpperCase()==m}function N(t){var n=d(e.document.getElementsByTagName("object"));n=n.concat(d(e.document.getElementsByTagName("embed")));var i=!1,s=!1;c(n,"forEach",!0,function(e){var n=x(e),o=y&&T(e);if(!n&&!o)return;i=i||n,s=s||o;var u=function(){t.state==="opened"?n?E(e):b(e):n?S(e):w(e)};if(g){l.info("Calling developer specified callback");var a={state:t.state,elem:e};g(a),r(u,200)}else u()});if(Math.random()<=.001){var o={unity:s,flash:i};a(p.getClientID()+"/occludespopups","post",o)}}function C(){E(),b()}function k(){S(),w()}var v="CLSID:D27CDB6E-AE6D-11CF-96B8-444553540000",m="CLSID:444785F1-DE89-4295-863A-D46C3A781394",g=null,y=!(h.osx()>=10.9&&(h.chrome()>=31||h.webkit()>=537.71||h.firefox()>=25));f.local.hidePluginObjects=function(){l.info("hidePluginObjects called"),N({state:"opened"})},f.local.showPluginObjects=function(){l.info("showPluginObjects called"),N({state:"closed"})},f.local.showFlashObjects=f.local.showPluginObjects,f.local.hideFlashObjects=f.local.hidePluginObjects;var L={_setHidePluginCallback:function(e){g=e},hidePluginElement:C,showPluginElement:k};o.exports=L}),l("sdk.Canvas.IframeHandling",["DOMWrapper","sdk.RPC"],function(t,n,r,s,o,u,a,f){function h(){var e=a.getWindow().document,t=e.body,n=e.documentElement,r=Math.max(t.offsetTop,0),i=Math.max(n.offsetTop,0),s=t.scrollHeight+r,o=t.offsetHeight+r,u=n.scrollHeight+i,f=n.offsetHeight+i;return Math.max(s,o,u,f)}function p(t){typeof t!="object"&&(t={});var n=0,r=0;t.height||(t.height=h(),n=16,r=4),t.frame||(t.frame=e.name||"iframe_canvas");if(c){var i=c.height,s=t.height-i;if(s<=r&&s>=-n)return!1}return c=t,f.remote.setSize(t),!0}function d(e,t){t===undefined&&typeof e=="number"&&(t=e,e=!0),e||e===undefined?(l===null&&(l=i(function(){p()},t||100)),p()):l!==null&&(clearInterval(l),l=null)}var l=null,c;f.stub("setSize");var v={setSize:p,setAutoGrow:d};o.exports=v}),l("sdk.Canvas.Navigation",["sdk.RPC"],function(e,t,n,r,i,s,o){function u(e){o.local.navigate=function(t){e({path:t})},o.remote.setNavigationEnabled(!0)}o.stub("setNavigationEnabled");var a={setUrlHandler:u};i.exports=a}),l("sdk.Canvas.Tti",["sdk.RPC","sdk.Runtime"],function(e,t,n,r,i,s,o,u){function a(e,t){var n={appId:u.getClientID(),time:c("Date","now",!1),name:t},r=[n];e&&r.push(function(t){e(t.result)}),o.remote.logTtiMessage.apply(null,r)}function f(){a(null,"StartIframeAppTtiTimer")}function l(e){a(e,"StopIframeAppTtiTimer")}function h(e){a(e,"RecordIframeAppTti")}o.stub("logTtiMessage");var p={setDoneLoading:h,startTimer:f,stopTimer:l};i.exports=p}),l("legacy:fb.canvas",["Assert","sdk.Canvas.Environment","sdk.Event","FB","sdk.Canvas.Plugin","sdk.Canvas.IframeHandling","Log","sdk.Canvas.Navigation","sdk.Runtime","sdk.Canvas.Tti"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){f.provide("Canvas",{setSize:function(e){return o.maybeObject(e,"Invalid argument"),c.setSize.apply(null,arguments)},setAutoGrow:function(){return c.setAutoGrow.apply(null,arguments)},getPageInfo:function(e){return o.isFunction(e,"Invalid argument"),u.getPageInfo.apply(null,arguments)},scrollTo:function(e,t){return o.maybeNumber(e,"Invalid argument"),o.maybeNumber(t,"Invalid argument"),u.scrollTo.apply(null,arguments)},setDoneLoading:function(e){return o.maybeFunction(e,"Invalid argument"),v.setDoneLoading.apply(null,arguments)},startTimer:function(){return v.startTimer.apply(null,arguments)},stopTimer:function(e){return o.maybeFunction(e,"Invalid argument"),v.stopTimer.apply(null,arguments)},getHash:function(e){return o.isFunction(e,"Invalid argument"),p.getHash.apply(null,arguments)},setHash:function(e){return o.isString(e,"Invalid argument"),p.setHash.apply(null,arguments)},setUrlHandler:function(e){return o.isFunction(e,"Invalid argument"),p.setUrlHandler.apply(null,arguments)}}),f.provide("CanvasInsights",{setDoneLoading:function(e){return h.warn("Deprecated: use FB.Canvas.setDoneLoading"),o.maybeFunction(e,"Invalid argument"),v.setDoneLoading.apply(null,arguments)}}),a.subscribe("init:post",function(e){d.isEnvironment(d.ENVIRONMENTS.CANVAS)&&(o.isTrue(!e.hideFlashCallback||!e.hidePluginCallback,"cannot specify deprecated hideFlashCallback and new hidePluginCallback"),l._setHidePluginCallback(e.hidePluginCallback||e.hideFlashCallback))})},3),l("sdk.Canvas.Prefetcher",["sdk.api","createArrayFrom","CanvasPrefetcherConfig","sdk.Runtime"],function(e,t,i,s,o,u,a,f,l,h){function y(){var e={object:"data",link:"href",script:"src"};m==p.AUTOMATIC&&c(c("Object","keys",!1,e),"forEach",!0,function(t){var r=e[t];c(f(n.getElementsByTagName(t)),"forEach",!0,function(e){e[r]&&g.push(e[r])})});if(g.length===0)return;a(h.getClientID()+"/staticresources","post",{urls:c("JSON","stringify",!1,g),is_https:location.protocol==="https:"}),g=[]}function b(){if(!h.isEnvironment(h.ENVIRONMENTS.CANVAS)||!h.getClientID()||!d)return;if(Math.random()>1/d||v=="*"||~c(v,"indexOf",!0,h.getClientID()))return;r(y,3e4)}function w(e){m=e}function E(e){g.push(e)}var p={AUTOMATIC:0,MANUAL:1},d=l.sampleRate,v=l.blacklist,m=p.AUTOMATIC,g=[],S={COLLECT_AUTOMATIC:p.AUTOMATIC,COLLECT_MANUAL:p.MANUAL,addStaticResource:E,setCollectionMode:w,_maybeSample:b};o.exports=S}),l("legacy:fb.canvas.prefetcher",["FB","sdk.Canvas.Prefetcher","sdk.Event","sdk.Runtime"],function(e,t,n,r,i,s,o,u,a,f){o.provide("Canvas.Prefetcher",u),a.subscribe("init:post",function(e){f.isEnvironment(f.ENVIRONMENTS.CANVAS)&&u._maybeSample()})},3),l("legacy:fb.compat.ui",["copyProperties","FB","Log","sdk.ui","sdk.UIServer"],function(e,t,n,r,i,s,o,u,a,f,l){u.provide("",{share:function(e){a.error("share() has been deprecated. Please use FB.ui() instead."),f({display:"popup",method:"stream.share",u:e})},publish:function(e,t){a.error("publish() has been deprecated. Please use FB.ui() instead."),e=e||{},f(o({display:"popup",method:"stream.publish",preview:1},e||{}),t)},addFriend:function(e,t){a.error("addFriend() has been deprecated. Please use FB.ui() instead."),f({display:"popup",id:e,method:"friend.add"},t)}}),l.Methods["auth.login"]=l.Methods["permissions.request"]},3),l("mergeArrays",[],function(e,t,n,r,i,s){function o(e,t){for(var n=0;n<t.length;n++)c(e,"indexOf",!0,t[n])<0&&e.push(t[n]);return e}i.exports=o}),l("format",[],function(e,t,n,r,i,s){function o(e,t){return t=Array.prototype.slice.call(arguments,1),e.replace(/\{(\d+)\}/g,function(e,n){var r=t[Number(n)];return r===null||r===undefined?"":r.toString()})}i.exports=o}),l("safeEval",[],function(t,n,r,i,s,o){function u(t,n){if(t===null||typeof t=="undefined")return;return typeof t!="string"?t:/^\w+$/.test(t)&&typeof e[t]=="function"?e[t].apply(null,n||[]):Function('return eval("'+t.replace(/"/g,'\\"')+'");').apply(null,n||[])}s.exports=u}),l("sdk.Waitable",["sdk.Model"],function(e,t,n,r,i,s,o){var u=o.extend({constructor:function(){this.parent({Value:undefined})},error:function(e){this.inform("error",e)},wait:function(e,t){t&&this.subscribe("error",t),this.monitor("Value.change",c(function(){var t=this.getValue();if(t!==undefined)return this.value=t,e(t),!0},"bind",!0,this))}});i.exports=u}),l("sdk.Query",["format","safeEval","Type","sdk.Waitable"],function(e,t,n,r,i,s,o,u,a,f){function l(e){return c(e.split(","),"map",!0,function(e){return c(e,"trim",!0)})}function h(e){var t=/^\s*(\w+)\s*=\s*(.*)\s*$/i.exec(e),n,r,i="unknown";return t&&(r=t[2],/^(["'])(?:\\?.)*?\1$/.test(r)?(r=u(r),i="index"):/^\d+\.?\d*$/.test(r)&&(i="index")),i=="index"?n={type:"index",key:t[1],value:r}:n={type:"unknown",value:e},n}function p(e){return typeof e=="string"?c("JSON","stringify",!1,e):e}var d=1,v=f.extend({constructor:function(){this.parent(),this.name="v_"+d++},hasDependency:function(e){return arguments.length&&(this._hasDependency=e),!!this._hasDependency},parse:function(e){var t=o.apply(null,e),n=/^select (.*?) from (\w+)\s+where (.*)$/i.exec(t);this.fields=l(n[1]),this.table=n[2],this.where=h(n[3]);for(var r=1;r<e.length;r++)a.instanceOf(v,e[r])&&e[r].hasDependency(!0);return this},toFql:function(){var e="select "+this.fields.join(",")+" from "+this.table+" where ";switch(this.where.type){case"unknown":e+=this.where.value;break;case"index":e+=this.where.key+"="+p(this.where.value);break;case"in":this.where.value.length==1?e+=this.where.key+"="+p(this.where.value[0]):e+=this.where.key+" in ("+c(this.where.value,"map",!0,p).join(",")+")"}return e},toString:function(){return"#"+this.name}});i.exports=v}),l("sdk.Data",["sdk.api","sdk.ErrorHandling","mergeArrays","sdk.Query","safeEval","sdk.Waitable"],function(e,t,n,i,s,o,u,a,f,l,h,p){var d={query:function(e,t){var n=(new l).parse(Array.prototype.slice.call(arguments));return d.queue.push(n),d._waitToProcess(),n},waitOn:function(e,t){var n=new p,r=e.length;if(typeof t=="string"){var i=t;t=a.unguard(function(){return h(i)})}return c(e,"forEach",!0,function(i){i.monitor("Value.change",function(){var s=!1;d._getValue(i)!==undefined&&(i.value=i.getValue(),r--,s=!0);if(r===0){var o=t(c(e,"map",!0,d._getValue));n.setValue(o!==undefined?o:!0)}return s})}),n},process:function(e){d._process(e)},_getValue:function(e){return e instanceof p?e.getValue():e},_selectByIndex:function(e,t,n,r){var i=new l;return i.fields=e,i.table=t,i.where={type:"index",key:n,value:r},d.queue.push(i),d._waitToProcess(),i},_waitToProcess:function(){d.timer<0&&(d.timer=r(function(){d._process()},10))},_process:function(e){d.timer=-1;var t={},n=d.queue;if(!n.length)return;d.queue=[];for(var r=0;r<n.length;r++){var i=n[r];i.where.type=="index"&&!i.hasDependency()?d._mergeIndexQuery(i,t):t[i.name]=i}var s={q:{}};for(var o in t)t.hasOwnProperty(o)&&(s.q[o]=t[o].toFql());e&&(s.access_token=e),u("/fql","GET",s,function(e){e.error?c(c("Object","keys",!1,t),"forEach",!0,function(n){t[n].error(new Error(e.error.message))}):c(e.data,"forEach",!0,function(e){t[e.name].setValue(e.fql_result_set)})})},_mergeIndexQuery:function(e,t){var n=e.where.key,r=e.where.value,i="index_"+e.table+"_"+n,s=t[i];s||(s=t[i]=new l,s.fields=[n],s.table=e.table,s.where={type:"in",key:n,value:[]}),f(s.fields,e.fields),f(s.where.value,[r]),s.wait(function(t){e.setValue(c(t,"filter",!0,function(e){return e[n]==r}))})},timer:-1,queue:[]};s.exports=d}),l("legacy:fb.data",["FB","sdk.Data"],function(e,t,n,r,i,s,o,u){o.provide("Data",u)},3),l("legacy:fb.event",["FB","sdk.Event"],function(e,t,n,r,i,s,o,u){o.provide("Event",u),o.provide("EventProvider",u)},3),l("legacy:fb.frictionless",["FB","sdk.Frictionless"],function(e,t,n,r,i,s,o,u){o.provide("Frictionless",u)},3),l("sdk.init",["sdk.Cookie","copyProperties","createArrayFrom","sdk.ErrorHandling","sdk.Event","Log","QueryString","sdk.Runtime"],function(t,i,s,o,u,a,f,l,h,p,d,v,m,g){function y(e){var t=typeof e=="number"&&e>0||typeof e=="string"&&/^[0-9a-f]{21,}$|^[0-9]{1,21}$/.test(e);return t?e.toString():(v.warn("Invalid App Id: Must be a number or numeric string representing the application id."),null)}function b(e){g.getInitialized()&&v.warn("FB.init has already been called - this could indicate a problem"),/number|string/.test(typeof e)&&(v.warn("FB.init called with invalid parameters"),e={apiKey:e}),e=l({logging:!0,status:!0},e||{});var t=y(e.appId||e.apiKey);t!==null&&g.setClientID(t),"scope"in e&&g.setScope(e.scope),e.cookie&&(g.setUseCookie(!0),typeof e.cookie=="string"&&f.setDomain(e.cookie)),e.kidDirectedSite&&g.setKidDirectedSite(!0),g.setInitialized(!0),d.fire("init:post",e)}r(function(){var t=/(connect\.facebook\.net|\.facebook\.com\/assets.php).*?#(.*)/;c(h(n.getElementsByTagName("script")),"forEach",!0,function(e){if(e.src){var n=t.exec(e.src);if(n){var r=m.decode(n[2]);for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];s=="0"&&(r[i]=0)}b(r)}}}),e.fbAsyncInit&&!e.fbAsyncInit.hasRun&&(e.fbAsyncInit.hasRun=!0,p.unguard(e.fbAsyncInit)())},0),u.exports=b}),l("legacy:fb.init",["FB","sdk.init"],function(e,t,n,r,i,s,o,u){o.provide("",{init:u})},3),l("legacy:fb.json",["FB","ManagedError"],function(e,t,n,r,i,s,o,u){o.provide("JSON",{stringify:function(e){try{return c("JSON","stringify",!1,e)}catch(t){throw new u(t.message,t)}},parse:function(e){try{return c("JSON","parse",!1,e)}catch(t){throw new u(t.message,t)}}})},3),l("legacy:fb.pay",["copyProperties","sdk.Runtime","sdk.UIServer","sdk.XD","FB"],function(t,n,r,i,s,o,u,a,f,l){n("FB");var h={error_code:1383001,error_message:"An unknown error caused the dialog to be closed"},p=function(e){return function(t){e(t&&t.response?c("JSON","parse",!1,t.response):h)}};u(f.Methods,{"pay.prompt":{transform:function(t){var n=l.handler(p(t.cb),"parent.frames["+(e.name||"iframe_canvas")+"]");t.params.channel=n,l.inform("Pay.Prompt",t.params)}},pay:{size:{width:555,height:120},connectDisplay:"popup",transform:function(t){t.cb=p(t.cb);if(!a.isEnvironment(a.ENVIRONMENTS.CANVAS))return t.params.order_info=c("JSON","stringify",!1,t.params.order_info),t;var n=l.handler(t.cb,"parent.frames["+(e.name||"iframe_canvas")+"]");t.params.channel=n,t.params.uiserver=!0,l.inform("Pay.Prompt",t.params)}}})},3),l("legacy:fb.ua",["FB","UserAgent"],function(e,t,n,r,i,s,o,u){o.provide("UA",{nativeApp:u.nativeApp})},3),l("legacy:fb.ui",["FB","sdk.ui"],function(e,t,n,r,i,s,o,u){o.provide("",{ui:u})},3),l("Miny",[],function(e,t,n,r,i,s){function f(e){for(var t=u.encode.length;t<e;t++){var n=t.toString(32).split("");n[n.length-1]=a[parseInt(n[n.length-1],32)],n=n.join(""),u.encode[t]=n,u.decode[n]=t}return u}function l(e){var t=e.match(/\w+|\W+/g),n={};for(var r=0;r<t.length;r++)n[t[r]]=(n[t[r]]||0)+1;var i=c("Object","keys",!1,n);i.sort(function(e,t){return n[e]<n[t]?1:n[t]<n[e]?-1:0});var s=f(i.length).encode;for(r=0;r<i.length;r++)n[i[r]]=s[r];var u=[];for(r=0;r<t.length;r++)u[r]=n[t[r]];for(r=0;r<i.length;r++)i[r]=i[r].replace(/'~'/g,"\\~");return[o,i.length].concat(i).concat(u.join("")).join("~")}function h(e){var t=e.split("~");if(t.shift()!=o)throw new Error("Not a Miny stream");var n=parseInt(t.shift(),10),r=t.pop();r=r.match(/[0-9a-v]*[\-w-zA-Z_]/g);var i=t,s=f(n).decode,u=[];for(var a=0;a<r.length;a++)u[a]=i[s[r[a]]];return u.join("")}var o="Miny1",u={encode:[],decode:{}},a="wxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_".split(""),p={encode:l,decode:h};i.exports=p}),l("runOnce",[],function(e,t,n,r,i,s){function o(e){var t,n;return function(){return t||(t=!0,n=e()),n}}i.exports=o}),l("XFBML",["Assert","copyProperties","createArrayFrom","sdk.DOM","sdk.feature","sdk.Impressions","Log","ObservableMixin","runOnce","UserAgent"],function(e,t,i,s,o,u,a,f,l,h,p,d,v,m,g,y){function x(e,t){return e[t]+""}function T(e){return e.scopeName?e.scopeName+":"+e.nodeName:""}function N(e){return b[x(e,"nodeName").toLowerCase()]||b[T(e).toLowerCase()]}function C(e){var t=c(c(x(e,"className"),"trim",!0).split(/\s+/),"filter",!0,function(e){return w.hasOwnProperty(e)});if(t.length===0)return undefined;if(e.getAttribute("fb-xfbml-state")||!e.childNodes||e.childNodes.length===0||e.childNodes.length===1&&e.childNodes[0].nodeType===3||e.children.length===1&&x(e.children[0],"className")==="fb-xfbml-parse-ignore")return w[t[0]]}function k(e){var t={};return c(l(e.attributes),"forEach",!0,function(e){t[x(e,"name")]=x(e,"value")}),t}function L(e,t,r){var i=n.createElement("div");return h.addCss(e,t+"-"+r),c(l(e.childNodes),"forEach",!0,function(e){i.appendChild(e)}),c(l(e.attributes),"forEach",!0,function(e){i.setAttribute(e.name,e.value)}),e.parentNode.replaceChild(i,e),i}function A(e,t,n){a.isTrue(e&&e.nodeType&&e.nodeType===1&&!!e.getElementsByTagName,"Invalid DOM node passed to FB.XFBML.parse()"),a.isFunction(t,"Invalid callback passed to FB.XFBML.parse()");var i=++E;v.info("XFBML Parsing Start %s",i);var s=1,o=0,u=function(){s--,s===0&&(v.info("XFBML Parsing Finish %s, %s tags found",i,o),t(),S.inform("render",i,o)),a.isTrue(s>=0,"onrender() has been called too many times")};c(l(e.getElementsByTagName("*")),"forEach",!0,function(e){if(!n&&e.getAttribute("fb-xfbml-state"))return;if(e.nodeType!==1)return;var t=N(e)||C(e);if(!t)return;y.ie()<9&&e.scopeName&&(e=L(e,t.xmlns,t.localName)),s++,o++;var r=new t.ctor(e,t.xmlns,t.localName,k(e));r.subscribe("render",g(function(){e.setAttribute("fb-xfbml-state","rendered"),u()}));var i=function(){e.getAttribute("fb-xfbml-state")=="parsed"?S.subscribe("render.queue",i):(e.setAttribute("fb-xfbml-state","parsed"),r.process())};i()}),S.inform("parse",i,o);var f=3e4;r(function(){s>0&&v.warn("%s tags failed to render in %s ms",s,f)},f),u()}var b={},w={},E=0,S=new m;S.subscribe("render",function(){var e=S.getSubscribers("render.queue");S.clearSubscribers("render.queue"),c(e,"forEach",!0,function(e){e()})}),f(S,{registerTag:function(e){var t=e.xmlns+":"+e.localName;a.isUndefined(b[t],t+" already registered"),b[t]=e,w[e.xmlns+"-"+e.localName]=e},parse:function(e,t){A(e||n.body,t||function(){},!0)},parseNew:function(){A(n.body,function(){},!1)}});if(p("log_tag_count")){var O=function(e,t){S.unsubscribe("parse",O),r(c(d.log,"bind",!0,null,102,{tag_count:t}),5e3)};S.subscribe("parse",O)}o.exports=S}),l("PluginPipe",["sdk.Content","copyProperties","sdk.feature","guid","insertIframe","Miny","ObservableMixin","PluginPipeConfig","sdk.Runtime","UrlMap","UserAgent","XFBML"],function(e,t,r,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b){function x(){return!(!f("plugin_pipe")||m.getSecure()===undefined||!y.chrome()&&!y.firefox()||!v.enabledApps[m.getClientID()])}function T(){function n(){t--,t===0&&N(e)}var e=S;S=[];if(e.length<=E){c(e,"forEach",!0,function(e){h(e.config)});return}var t=e.length+1;c(e,"forEach",!0,function(e){var t={};for(var r in e.config)t[r]=e.config[r];t.url=g.resolve("www",m.getSecure())+"/plugins/plugin_pipe_shell.php",t.onload=n,h(t)}),n()}function N(e){var t=n.createElement("span");u.appendHidden(t);var r={};c(e,"forEach",!0,function(e){r[e.config.name]={plugin:e.tag,params:e.params}});var i=c("JSON","stringify",!1,r),s=p.encode(i);c(e,"forEach",!0,function(e){var t=n.getElementsByName(e.config.name)[0];t.onload=e.config.onload});var o=g.resolve("www",m.getSecure())+"/plugins/pipe.php",a=l();h({url:"about:blank",root:t,name:a,className:"fb_hidden fb_invisible",onload:function(){u.submitToTarget({url:o,target:a,params:{plugins:s.length<i.length?s:i}})}})}var w=new d,E=v.threshold,S=[];b.subscribe("parse",T),a(w,{add:function(e){var t=x();return t&&S.push({config:e._config,tag:e._tag,params:e._params}),t}}),s.exports=w}),l("IframePlugin",["sdk.Auth","sdk.createIframe","copyProperties","sdk.DOM","sdk.Event","guid","Log","ObservableMixin","PluginPipe","QueryString","resolveURI","sdk.Runtime","Type","UrlMap","UserAgent","sdk.XD"],function(t,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x,T,N){function k(e,t,n){if(t||t===0)e.style.width=t+"px";if(n||n===0)e.style.height=n+"px"}function L(e){return function(t){var n={width:t.width,height:t.height,pluginID:e};d.fire("xfbml.resize",n)}}function O(e,t){var n=e[t]||e[t.replace(/_/g,"-")]||e[t.replace(/_/g,"")]||e["data-"+t]||e["data-"+t.replace(/_/g,"-")]||e["data-"+t.replace(/_/g,"")]||undefined;return n}function M(e,t,n,r){c(c("Object","keys",!1,e),"forEach",!0,function(i){e[i]=="text"&&!n[i]&&(n[i]=t.textContent||t.innerText||"",t.setAttribute(i,n[i])),r[i]=A[e[i]](O(n,i))})}function _(e){return e||e==="0"||e===0?parseInt(e,10):undefined}var C={skin:"string",font:"string",width:"px",height:"px",ref:"string",color_scheme:"string"},A={string:function(e){return e},bool:function(e){return e?/^(?:true|1|yes|on)$/i.test(e):undefined},url:function(e){return w(e)},url_maybe:function(e){return e?w(e):e},hostname:function(t){return t||e.location.hostname},px:function(e){return/^(\d+)(?:px)?$/.test(e)?parseInt(RegExp.$1,10):undefined},text:function(e){return e}},D=S.extend({constructor:function(t,r,i,s){this.parent(),i=i.replace(/-/g,"_");var o=O(s,"plugin_id");this.subscribe("xd.resize",L(o)),this.subscribe("xd.resize.flow",L(o)),this.subscribe("xd.resize.flow",c(function(e){this._config.root.style.verticalAlign="bottom",k(this._config.root,_(e.width),_(e.height)),this.updateLift(),clearTimeout(this._timeoutID)},"bind",!0,this)),this.subscribe("xd.resize",c(function(e){this._config.root.style.verticalAlign="bottom",k(this._config.root,_(e.width),_(e.height)),k(this._iframe,_(e.width),_(e.height)),this.updateLift(),clearTimeout(this._timeoutID)},"bind",!0,this)),this.subscribe("xd.resize.iframe",c(function(e){k(this._iframe,_(e.width),_(e.height)),this.updateLift(),clearTimeout(this._timeoutID)},"bind",!0,this)),this.subscribe("xd.sdk_event",function(e){var n=c("JSON","parse",!1,e.data);n.pluginID=o,d.fire(e.event,n,t)});var u=E.getSecure()||e.location.protocol=="https:",a=x.resolve("www",u)+"/plugins/"+i+".php?",l={};M(this.getParams(),t,s,l),M(C,t,s,l),l.app_id=E.getClientID(),l.locale=E.getLocale(),l.sdk="joey",l.kid_directed_site=E.getKidDirectedSite();var h=c(function(e){this.inform("xd."+e.type,e)},"bind",!0,this);l.channel=N.handler(h,"parent.parent",!0),p.addCss(t,"fb_iframe_widget");var m=v();this.subscribe("xd.verify",function(e){N.sendToFacebook(m,{method:"xd/verify",params:c("JSON","stringify",!1,e.token)})}),this.subscribe("xd.refreshLoginStatus",c(f.getLoginStatus,"bind",!0,f,c(this.inform,"bind",!0,this,"login.status"),!0));var g=n.createElement("span");g.style.verticalAlign="top",g.style.width="0px",g.style.height="0px",this._element=t,this._ns=r,this._tag=i,this._params=l,this._config={root:g,url:a+b.encode(l),name:m,width:T.mobile()?undefined:l.width||1e3,height:l.height||1e3,style:{border:"none",visibility:"hidden"},title:this._ns+":"+this._tag+" Facebook Social Plugin",onload:c(function(){this.inform("render")},"bind",!0,this)}},process:function(){var e=h({},this._params);delete e.channel;var t=b.encode(e);if(this._element.getAttribute("fb-iframe-plugin-query")==t){m.info("Skipping render: %s:%s %s",this._ns,this._tag,t),this.inform("render");return}this._element.setAttribute("fb-iframe-plugin-query",t),this.subscribe("render",function(){this._iframe.style.visibility="visible"});while(this._element.firstChild)this._element.removeChild(this._element.firstChild);this._element.appendChild(this._config.root);var n=T.mobile()?120:45;this._timeoutID=r(c(function(){this._iframe&&k(this._iframe,0,0),m.warn("%s:%s failed to resize in %ss",this._ns,this._tag,n)},"bind",!0,this),n*1e3),y.add(this)||(this._iframe=l(this._config)),T.mobile()&&(p.addCss(this._element,"fb_iframe_widget_fluid"),this._element.style.display="block",this._element.style.width="100%",this._element.style.height="auto",this._config.root.style.width="100%",this._config.root.style.height="auto",this._iframe.style.width="100%",this._iframe.style.height="auto",this._iframe.style.position="static")},updateLift:function(){var e=this._iframe.style.width===this._config.root.style.width&&this._iframe.style.height===this._config.root.style.height;p[e?"removeCss":"addCss"](this._iframe,"fb_iframe_widget_lift")}},g);D.getVal=O,D.withParams=function(e){return D.extend({getParams:function(){return e}})},u.exports=D}),l("PluginTags",[],function(e,t,n,r,i,s){var o={activity:{filter:"string",action:"string",max_age:"string",linktarget:"string",header:"bool",recommendations:"bool",site:"hostname"},composer:{action_type:"string",action_properties:"string"},create_event_button:{},degrees:{href:"url"},facepile:{href:"string",action:"string",size:"string",max_rows:"string",show_count:"bool"},follow:{href:"url",layout:"string",show_faces:"bool"},like:{href:"url",layout:"string",show_faces:"bool",share:"bool",action:"string",send:"bool"},like_box:{href:"string",show_faces:"bool",header:"bool",stream:"bool",force_wall:"bool",show_border:"bool",id:"string",connections:"string",profile_id:"string",name:"string"},open_graph:{href:"url",layout:"string",show_faces:"bool",action_type:"string",action_properties:"string"},open_graph_preview:{action_type:"string",action_properties:"string"},page_events:{href:"url"},post:{href:"url",show_border:"bool"},privacy_selector:{},profile_pic:{uid:"string",linked:"bool",href:"string",size:"string",facebook_logo:"bool"},recommendations:{filter:"string",action:"string",max_age:"string",linktarget:"string",header:"bool",site:"hostname"},share_button:{href:"url",type:"string"},shared_activity:{header:"bool"},send:{href:"url"},send_to_mobile:{max_rows:"string",show_faces:"bool",size:"string"},story:{href:"url",show_border:"bool"},topic:{topic_name:"string",topic_id:"string"},want:{href:"url",layout:"string",show_faces:"bool"}},u={subscribe:"follow",fan:"like_box",likebox:"like_box",friendpile:"facepile"};c(c("Object","keys",!1,u),"forEach",!0,function(e){o[e]=o[u[e]]}),i.exports=o}),l("sdk.Arbiter",[],function(e,t,n,r,i,s){var o={BEHAVIOR_EVENT:"e",BEHAVIOR_PERSISTENT:"p",BEHAVIOR_STATE:"s"};i.exports=o}),l("sdk.XFBML.Element",["sdk.DOM","Type","ObservableMixin"],function(e,t,r,i,s,o,u,a,f){var l=a.extend({constructor:function(e){this.parent(),this.dom=e},fire:function(){this.inform.apply(this,arguments)},getAttribute:function(e,t,n){var r=u.getAttr(this.dom,e);return r?n?n(r):r:t},_getBoolAttribute:function(e,t){var n=u.getBoolAttr(this.dom,e);return n===null?t:n},_getPxAttribute:function(e,t){return this.getAttribute(e,t,function(e){var n=parseInt(e.replace("px",""),10);return isNaN(n)?t:n})},_getAttributeFromList:function(e,t,n){return this.getAttribute(e,t,function(e){return e=e.toLowerCase(),c(n,"indexOf",!0,e)>-1?e:t})},isValid:function(){for(var e=this.dom;e;e=e.parentNode)if(e==n.body)return!0},clear:function(){u.html(this.dom,"")}},f);s.exports=l}),l("sdk.XFBML.IframeWidget",["sdk.Arbiter","sdk.Auth","sdk.Content","copyProperties","sdk.DOM","sdk.Event","sdk.XFBML.Element","guid","insertIframe","QueryString","sdk.Runtime","sdk.ui","UrlMap","sdk.XD"],function(e,t,r,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E){function N(){var e={};for(var t in T){var n=T[t];e[t]={widget:n.getUrlBits().name,params:n._getQS()}}return e}var S=d.extend({_iframeName:null,_showLoader:!0,_refreshOnAuthChange:!1,_allowReProcess:!1,_fetchPreCachedLoader:!1,_visibleAfter:"load",_widgetPipeEnabled:!1,_borderReset:!1,_repositioned:!1,getUrlBits:function(){throw new Error("Inheriting class needs to implement getUrlBits().")},setupAndValidate:function(){return!0},oneTimeSetup:function(){},getSize:function(){},getIframeName:function(){return this._iframeName},getIframeTitle:function(){return"Facebook Social Plugin"},getChannelUrl:function(){if(!this._channelUrl){var e=this;this._channelUrl=E.handler(function(t){e.fire("xd."+t.type,t)},"parent.parent",!0)}return this._channelUrl},getIframeNode:function(){return this.dom.getElementsByTagName("iframe")[0]},arbiterInform:function(e,t,n){E.sendToFacebook(this.getIframeName(),{method:e,params:c("JSON","stringify",!1,t||{}),behavior:n||u.BEHAVIOR_PERSISTENT})},_arbiterInform:function(e,t,n){var r='parent.frames["'+this.getIframeNode().name+'"]';E.inform(e,t,r,n)},getDefaultWebDomain:function(){return w.resolve("www")},process:function(e){if(this._done){if(!this._allowReProcess&&!e)return;this.clear()}else this._oneTimeSetup();this._done=!0,this._iframeName=this.getIframeName()||this._iframeName||v();if(!this.setupAndValidate()){this.fire("render");return}this._showLoader&&this._addLoader(),h.addCss(this.dom,"fb_iframe_widget"),this._visibleAfter!="immediate"?h.addCss(this.dom,"fb_hide_iframes"):this.subscribe("iframe.onload",c(this.fire,"bind",!0,this,"render"));var t=this.getSize()||{},r=this.getFullyQualifiedURL();t.width=="100%"&&h.addCss(this.dom,"fb_iframe_widget_fluid"),this.clear(),m({url:r,root:this.dom.appendChild(n.createElement("span")),name:this._iframeName,title:this.getIframeTitle(),className:y.getRtl()?"fb_rtl":"fb_ltr",height:t.height,width:t.width,onload:c(this.fire,"bind",!0,this,"iframe.onload")}),this._resizeFlow(t),this.loaded=!1,this.subscribe("iframe.onload",c(function(){this.loaded=!0},"bind",!0,this))},generateWidgetPipeIframeName:function(){return x++,"fb_iframe_"+x},getFullyQualifiedURL:function(){var e=this._getURL();e+="?"+g.encode(this._getQS());if(e.length>2e3){e="about:blank";var t=c(function(){this._postRequest(),this.unsubscribe("iframe.onload",t)},"bind",!0,this);this.subscribe("iframe.onload",t)}return e},_getWidgetPipeShell:function(){return w.resolve("www")+"/common/widget_pipe_shell.php"},_oneTimeSetup:function(){this.subscribe("xd.resize",c(this._handleResizeMsg,"bind",!0,this)),this.subscribe("xd.resize",c(this._bubbleResizeEvent,"bind",!0,this)),this.subscribe("xd.resize.iframe",c(this._resizeIframe,"bind",!0,this)),this.subscribe("xd.resize.flow",c(this._resizeFlow,"bind",!0,this)),this.subscribe("xd.resize.flow",c(this._bubbleResizeEvent,"bind",!0,this)),this.subscribe("xd.refreshLoginStatus",function(){a.getLoginStatus(function(){},!0)}),this.subscribe("xd.logout",function(){b({method:"auth.logout",display:"hidden"},function(){})}),this._refreshOnAuthChange&&this._setupAuthRefresh(),this._visibleAfter=="load"&&this.subscribe("iframe.onload",c(this._makeVisible,"bind",!0,this)),this.subscribe("xd.verify",c(function(e){this.arbiterInform("xd/verify",e.token)},"bind",!0,this)),this.oneTimeSetup()},_makeVisible:function(){this._removeLoader(),h.removeCss(this.dom,"fb_hide_iframes"),this.fire("render")},_setupAuthRefresh:function(){a.getLoginStatus(c(function(e){var t=e.status;p.subscribe("auth.statusChange",c(function(e){if(!this.isValid())return;(t=="unknown"||e.status=="unknown")&&this.process(!0),t=e.status},"bind",!0,this))},"bind",!0,this))},_handleResizeMsg:function(e){if(!this.isValid())return;this._resizeIframe(e),this._resizeFlow(e),this._borderReset||(this.getIframeNode().style.border="none",this._borderReset=!0),this._makeVisible()},_bubbleResizeEvent:function(e){var t={height:e.height,width:e.width,pluginID:this.getAttribute("plugin-id")};p.fire("xfbml.resize",t)},_resizeIframe:function(e){var t=this.getIframeNode();e.reposition==="true"&&this._repositionIframe(e),e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px"),this._updateIframeZIndex()},_resizeFlow:function(e){var t=this.dom.getElementsByTagName("span")[0];e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px"),this._updateIframeZIndex()},_updateIframeZIndex:function(){var e=this.dom.getElementsByTagName("span")[0],t=this.getIframeNode(),n=t.style.height===e.style.height&&t.style.width===e.style.width,r=n?"removeCss":"addCss";h[r](t,"fb_iframe_widget_lift")},_repositionIframe:function(e){var t=this.getIframeNode(),n=parseInt(h.getStyle(t,"width"),10),r=h.getPosition(t).x,i=h.getViewportInfo().width,s=parseInt(e.width,10);r+s>i&&r>s?(t.style.left=n-s+"px",this.arbiterInform("xd/reposition",{type:"horizontal"}),this._repositioned=!0):this._repositioned&&(t.style.left="0px",this.arbiterInform("xd/reposition",{type:"restore"}),this._repositioned=!1)},_addLoader:function(){this._loaderDiv||(h.addCss(this.dom,"fb_iframe_widget_loader"),this._loaderDiv=n.createElement("div"),this._loaderDiv.className="FB_Loader",this.dom.appendChild(this._loaderDiv))},_removeLoader:function(){this._loaderDiv&&(h.removeCss(this.dom,"fb_iframe_widget_loader"),this._loaderDiv.parentNode&&this._loaderDiv.parentNode.removeChild(this._loaderDiv),this._loaderDiv=null)},_getQS:function(){return l({api_key:y.getClientID(),locale:y.getLocale(),sdk:"joey",kid_directed_site:y.getKidDirectedSite(),ref:this.getAttribute("ref")},this.getUrlBits().params)},_getURL:function(){var e=this.getDefaultWebDomain(),t="";return e+"/plugins/"+t+this.getUrlBits().name+".php"},_postRequest:function(){f.submitToTarget({url:this._getURL(),target:this.getIframeNode().name,params:this._getQS()})}}),x=0,T={};s.exports=S}),l("sdk.XFBML.Comments",["sdk.Event","sdk.XFBML.IframeWidget","QueryString","sdk.Runtime","SDKConfig","UrlMap","UserAgent"],function(t,r,i,s,o,u,a,f,l,h,p,d,v){var m=f.extend({_visibleAfter:"immediate",_refreshOnAuthChange:!0,setupAndValidate:function(){var t={channel_url:this.getChannelUrl(),colorscheme:this.getAttribute("colorscheme"),skin:this.getAttribute("skin"),numposts:this.getAttribute("num-posts",10),width:this._getPxAttribute("width",550),href:this.getAttribute("href"),permalink:this.getAttribute("permalink"),publish_feed:this.getAttribute("publish_feed"),order_by:this.getAttribute("order_by"),mobile:this._getBoolAttribute("mobile")};p.initSitevars.enableMobileComments&&v.mobile()&&t.mobile!==!1&&(t.mobile=!0,delete t.width),t.skin||(t.skin=t.colorscheme);if(!t.href){t.migrated=this.getAttribute("migrated"),t.xid=this.getAttribute("xid"),t.title=this.getAttribute("title",n.title),t.url=this.getAttribute("url",n.URL),t.quiet=this.getAttribute("quiet"),t.reverse=this.getAttribute("reverse"),t.simple=this.getAttribute("simple"),t.css=this.getAttribute("css"),t.notify=this.getAttribute("notify");if(!t.xid){var r=c(n.URL,"indexOf",!0,"#");r>0?t.xid=encodeURIComponent(n.URL.substring(0,r)):t.xid=encodeURIComponent(n.URL)}t.migrated&&(t.href=d.resolve("www")+"/plugins/comments_v1.php?"+"app_id="+h.getClientID()+"&xid="+encodeURIComponent(t.xid)+"&url="+encodeURIComponent(t.url))}else{var i=this.getAttribute("fb_comment_id");i||(i=l.decode(n.URL.substring(c(n.URL,"indexOf",!0,"?")+1)).fb_comment_id,i&&c(i,"indexOf",!0,"#")>0&&(i=i.substring(0,c(i,"indexOf",!0,"#")))),i&&(t.fb_comment_id=i,this.subscribe("render",c(function(){e.location.hash||(e.location.hash=this.getIframeNode().id)},"bind",!0,this)))}return this._attr=t,!0},oneTimeSetup:function(){this.subscribe("xd.addComment",c(this._handleCommentMsg,"bind",!0,this)),this.subscribe("xd.commentCreated",c(this._handleCommentCreatedMsg,"bind",!0,this)),this.subscribe("xd.commentRemoved",c(this._handleCommentRemovedMsg,"bind",!0,this))},getSize:function(){return this._attr.mobile?{width:"100%",height:160}:{width:this._attr.width,height:160}},getUrlBits:function(){return{name:"comments",params:this._attr}},getDefaultWebDomain:function(){return d.resolve(this._attr.mobile?"m":"www",!0)},_handleCommentMsg:function(e){if(!this.isValid())return;a.fire("comments.add",{post:e.post,user:e.user,widget:this})},_handleCommentCreatedMsg:function(e){if(!this.isValid())return;var t={href:e.href,commentID:e.commentID,parentCommentID:e.parentCommentID};a.fire("comment.create",t)},_handleCommentRemovedMsg:function(e){if(!this.isValid())return;var t={href:e.href,commentID:e.commentID};a.fire("comment.remove",t)}});o.exports=m}),l("sdk.XFBML.CommentsCount",["sdk.Data","sdk.DOM","sdk.XFBML.Element","sprintf"],function(t,n,r,i,s,o,u,a,f,l){var h=f.extend({process:function(){a.addCss(this.dom,"fb_comments_count_zero");var t=this.getAttribute("href",e.location.href);u._selectByIndex(["commentsbox_count"],"link_stat","url",t).wait(c(function(e){var t=e[0].commentsbox_count;a.html(this.dom,l('<span class="fb_comments_count">%s</span>',t)),t>0&&a.removeCss(this.dom,"fb_comments_count_zero"),this.fire("render")},"bind",!0,this))}});s.exports=h}),l("sdk.Anim",["sdk.DOM"],function(e,t,n,r,s,o,u){var a={ate:function(e,t,n,r){n=!isNaN(parseFloat(n))&&n>=0?n:750;var s=40,o={},a={},f=null,l=i(c(function(){f||(f=c("Date","now",!1));var i=1;n!=0&&(i=Math.min((c("Date","now",!1)-f)/n,1));for(var s in t)if(t.hasOwnProperty(s)){var h=t[s];if(!o[s]){var d=u.getStyle(e,s);if(d===!1)return;o[s]=this._parseCSS(d+"")}a[s]||(a[s]=this._parseCSS(h.toString()));var v="";c(o[s],"forEach",!0,function(e,t){isNaN(a[s][t].numPart)&&a[s][t].textPart=="?"?v=e.numPart+e.textPart:isNaN(e.numPart)?v=e.textPart:v+=e.numPart+Math.ceil((a[s][t].numPart-e.numPart)*Math.sin(Math.PI/2*i))+a[s][t].textPart+" "}),u.setStyle(e,s,v)}i==1&&(clearInterval(l),r&&r(e))},"bind",!0,this),s)},_parseCSS:function(e){var t=[];return c(e.split(" "),"forEach",!0,function(e){var n=parseInt(e,10);t.push({numPart:n,textPart:e.replace(n,"")})}),t}};s.exports=a}),l("escapeHTML",[],function(e,t,n,r,i,s){function a(e){return e.replace(o,function(e){return u[e]})}var o=/[&<>"'\/]/g,u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","/":"&#x2F;"};i.exports=a}),l("sdk.Helper",["sdk.ErrorHandling","sdk.Event","UrlMap","safeEval","sprintf"],function(t,n,r,i,s,o,u,a,f,l,c){var h={isUser:function(e){return e<22e8||e>=1e14&&e<=0x5b0a58f100ef||e>=89e12&&e<=89999999999999},upperCaseFirstChar:function(e){return e.length>0?e.substr(0,1).toUpperCase()+e.substr(1):e},getProfileLink:function(e,t,n){return!n&&e&&(n=c("%s/profile.php?id=%s",f.resolve("www"),e.uid||e.id)),n&&(t=c('<a class="fb_link" href="%s">%s</a>',n,t)),t},invokeHandler:function(e,t,n){e&&(typeof e=="string"?u.unguard(l)(e,n):e.apply&&u.unguard(e).apply(t,n||[]))},fireEvent:function(e,t){var n=t._attr.href;t.fire(e,n),a.fire(e,n,t)},executeFunctionByName:function(t){var n=Array.prototype.slice.call(arguments,1),r=t.split("."),i=r.pop(),s=e;for(var o=0;o<r.length;o++)s=s[r[o]];return s[i].apply(this,n)}};s.exports=h}),l("sdk.XFBML.ConnectBar",["sdk.Anim","sdk.api","sdk.Auth","createArrayFrom","ConnectBarConfig","sdk.Data","sdk.DOM","sdk.XFBML.Element","escapeHTML","sdk.Event","format","sdk.Helper","sdk.Insights","sdk.Intl","sdk.Runtime","UrlMap","UserAgent"],function(t,r,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x,T,N){var C=m.extend({_initialHeight:null,_initTopMargin:0,_picFieldName:"pic_square",_page:null,_displayed:!1,_notDisplayed:!1,_container:null,_animationSpeed:0,process:function(){l.getLoginStatus(c(function(e){y.monitor("auth.statusChange",c(function(){return this.isValid()&&x.getLoginStatus()=="connected"?(this._uid=x.getUserID(),f({method:"Connect.shouldShowConnectBar"},c(function(e){e!=2?(this._animationSpeed=e==0?750:0,this._showBar()):this._noRender()},"bind",!0,this))):this._noRender(),!1},"bind",!0,this))},"bind",!0,this))},_showBar:function(){var e=d._selectByIndex(["first_name","profile_url",this._picFieldName],"user","uid",this._uid),t=d._selectByIndex(["display_name"],"application","api_key",x.getClientID());d.waitOn([e,t],c(function(e){e[0][0].site_name=e[1][0].display_name,this._displayed||(this._displayed=!0,this._notDisplayed=!1,this._renderConnectBar(e[0][0]),this.fire("render"),E.impression({lid:104,name:"widget_load"}),this.fire("connectbar.ondisplay"),y.fire("connectbar.ondisplay",this),w.invokeHandler(this.getAttribute("on-display"),this))},"bind",!0,this))},_noRender:function(){this._displayed&&(this._displayed=!1,this._closeConnectBar()),this._notDisplayed||(this._notDisplayed=!0,this.fire("render"),this.fire("connectbar.onnotdisplay"),y.fire("connectbar.onnotdisplay",this),w.invokeHandler(this.getAttribute("on-not-display"),this))},_renderConnectBar:function(t){var r=n.createElement("div"),i=n.createElement("div");r.className="fb_connect_bar",i.className="fb_reset fb_connect_bar_container",i.appendChild(r),n.body.appendChild(i),this._container=i,this._initialHeight=Math.round(parseFloat(v.getStyle(i,"height"))+parseFloat(v.getStyle(i,"borderBottomWidth"))),v.html(r,b('<div class="fb_buttons"><a href="#" class="fb_bar_close"><img src="{1}" alt="{2}" title="{2}"/></a></div><a href="{7}" class="fb_profile" target="_blank"><img src="{3}" alt="{4}" title="{4}"/></a>{5} <span><a href="{8}" class="fb_learn_more" target="_blank">{6}</a> &ndash; <a href="#" class="fb_no_thanks">{0}</a></span>',S.tx._("No Thanks"),T.resolve("fbcdn")+"/"+p.imgs.buttonUrl,S.tx._("Close"),t[this._picFieldName]||T.resolve("fbcdn")+"/"+p.imgs.missingProfileUrl,g(t.first_name),S.tx._("Hi {firstName}. <strong>{siteName}</strong> is using Facebook to personalize your experience.",{firstName:g(t.first_name),siteName:g(t.site_name)}),S.tx._("Learn More"),t.profile_url,T.resolve("www")+"/sitetour/connect.php")),c(h(r.getElementsByTagName("a")),"forEach",!0,function(e){e.onclick=c(this._clickHandler,"bind",!0,this)},this),this._page=n.body;var s=0;this._page.parentNode?s=Math.round((parseFloat(v.getStyle(this._page.parentNode,"height"))-parseFloat(v.getStyle(this._page,"height")))/2):s=parseInt(v.getStyle(this._page,"marginTop"),10),s=isNaN(s)?0:s,this._initTopMargin=s,e.XMLHttpRequest?(i.style.top=-1*this._initialHeight+"px",a.ate(i,{top:"0px"},this._animationSpeed)):i.className+=" fb_connect_bar_container_ie6";var o={marginTop:this._initTopMargin+this._initialHeight+"px"};N.ie()?o.backgroundPositionY=this._initialHeight+"px":o.backgroundPosition="? "+this._initialHeight+"px",a.ate(this._page,o,this._animationSpeed)},_clickHandler:function(t){t=t||e.event;var n=t.target||t.srcElement;while(n.nodeName!="A")n=n.parentNode;switch(n.className){case"fb_bar_close":f({method:"Connect.connectBarMarkAcknowledged"}),E.impression({lid:104,name:"widget_user_closed"}),this._closeConnectBar();break;case"fb_learn_more":case"fb_profile":e.open(n.href);break;case"fb_no_thanks":this._closeConnectBar(),f({method:"Connect.connectBarMarkAcknowledged"}),E.impression({lid:104,name:"widget_user_no_thanks"}),f({method:"auth.revokeAuthorization",block:!0},c(function(){this.fire("connectbar.ondeauth"),y.fire("connectbar.ondeauth",this),w.invokeHandler(this.getAttribute("on-deauth"),this),this._getBoolAttribute("auto-refresh",!0)&&e.location.reload()},"bind",!0,this))}return!1},_closeConnectBar:function(){this._notDisplayed=!0;var e={marginTop:this._initTopMargin+"px"};N.ie()?e.backgroundPositionY="0px":e.backgroundPosition="? 0px";var t=this._animationSpeed==0?0:300;a.ate(this._page,e,t),a.ate(this._container,{top:-1*this._initialHeight+"px"},t,function(e){e.parentNode.removeChild(e)}),this.fire("connectbar.onclose"),y.fire("connectbar.onclose",this),w.invokeHandler(this.getAttribute("on-close"),this)}});o.exports=C}),l("sdk.XFBML.LoginButton",["sdk.Helper","IframePlugin"],function(e,t,n,r,i,s,o,u){var a=u.extend({constructor:function(e,t,n,r){this.parent(e,t,n,r);var i=u.getVal(r,"on_login");i&&this.subscribe("login.status",function(e){o.invokeHandler(i,null,[e])})},getParams:function(){return{scope:"string",perms:"string",size:"string",login_text:"text",show_faces:"bool",max_rows:"string",show_login_face:"bool",registration_url:"url_maybe",auto_logout_link:"bool",one_click:"bool",show_banner:"bool"}}});i.exports=a}),l("sdk.XFBML.Name",["copyProperties","sdk.Data","escapeHTML","sdk.Event","sdk.XFBML.Element","sdk.Helper","Log","sdk.Runtime"],function(e,t,n,r,i,s,o,u,a,f,l,h,p,d){var v=l.extend({process:function(){o(this,{_uid:this.getAttribute("uid"),_firstnameonly:this._getBoolAttribute("first-name-only"),_lastnameonly:this._getBoolAttribute("last-name-only"),_possessive:this._getBoolAttribute("possessive"),_reflexive:this._getBoolAttribute("reflexive"),_objective:this._getBoolAttribute("objective"),_linked:this._getBoolAttribute("linked",!0),_subjectId:this.getAttribute("subject-id")});if(!this._uid){p.error('"uid" is a required attribute for <fb:name>'),this.fire("render");return}var e=[];this._firstnameonly?e.push("first_name"):this._lastnameonly?e.push("last_name"):e.push("name"),this._subjectId&&(e.push("sex"),this._subjectId==d.getUserID()&&(this._reflexive=!0));var t;f.monitor("auth.statusChange",c(function(){if(!this.isValid())return this.fire("render"),!0;if(!this._uid||this._uid=="loggedinuser")this._uid=d.getUserID();if(!this._uid)return;h.isUser(this._uid)?t=u._selectByIndex(e,"user","uid",this._uid):t=u._selectByIndex(["name","id"],"profile","id",this._uid),t.wait(c(function(e){this._subjectId==this._uid?this._renderPronoun(e[0]):this._renderOther(e[0]),this.fire("render")},"bind",!0,this))},"bind",!0,this))},_renderPronoun:function(e){var t="",n=this._objective;this._subjectId&&(n=!0,this._subjectId===this._uid&&(this._reflexive=!0));if(this._uid==d.getUserID()&&this._getBoolAttribute("use-you",!0))this._possessive?this._reflexive?t="your own":t="your":this._reflexive?t="yourself":t="you";else switch(e.sex){case"male":this._possessive?t=this._reflexive?"his own":"his":this._reflexive?t="himself":n?t="him":t="he";break;case"female":this._possessive?t=this._reflexive?"her own":"her":this._reflexive?t="herself":n?t="her":t="she";break;default:this._getBoolAttribute("use-they",!0)?this._possessive?this._reflexive?t="their own":t="their":this._reflexive?t="themselves":n?t="them":t="they":this._possessive?this._reflexive?t="his/her own":t="his/her":this._reflexive?t="himself/herself":n?t="him/her":t="he/she"}this._getBoolAttribute("capitalize",!1)&&(t=h.upperCaseFirstChar(t)),this.dom.innerHTML=t},_renderOther:function(e){var t="",n="";this._uid==d.getUserID()&&this._getBoolAttribute("use-you",!0)?this._reflexive?this._possessive?t="your own":t="yourself":this._possessive?t="your":t="you":e&&(null===e.first_name&&(e.first_name=""),null===e.last_name&&(e.last_name=""),this._firstnameonly&&e.first_name!==undefined?t=a(e.first_name):this._lastnameonly&&e.last_name!==undefined&&(t=a(e.last_name)),t||(t=a(e.name)),t!==""&&this._possessive&&(t+="'s")),t||(t=a(this.getAttribute("if-cant-see","Facebook User"))),t&&(this._getBoolAttribute("capitalize",!1)&&(t=h.upperCaseFirstChar(t)),e&&this._linked?n=h.getProfileLink(e,t,this.getAttribute("href",null)):n=t),this.dom.innerHTML=n}});i.exports=v}),l("sdk.XFBML.RecommendationsBar",["sdk.Arbiter","DOMEventListener","sdk.Event","sdk.XFBML.IframeWidget","resolveURI","sdk.Runtime"],function(t,i,s,o,u,a,f,l,h,p,d,v){var m=p.extend({getUrlBits:function(){return{name:"recommendations_bar",params:this._attr}},setupAndValidate:function(){function t(e,t){function s(){t(),i=null,n=c("Date","now",!1)}var n=0,i=null;return function(){if(!i){var t=c("Date","now",!1);t-n<e?i=r(s,e-(t-n)):s()}return!0}}function i(e){if(e.match(/^\d+(?:\.\d+)?%$/)){var t=Math.min(Math.max(parseInt(e,10),0),100);e=t/100}else e!="manual"&&e!="onvisible"&&(e="onvisible");return e}function s(e){return Math.max(parseInt(e,10)||30,10)}function o(e){return e=="left"||e=="right"?e:v.getRtl()?"left":"right"}this._attr={channel:this.getChannelUrl(),api_key:v.getClientID(),font:this.getAttribute("font"),colorscheme:this.getAttribute("colorscheme"),href:d(this.getAttribute("href")),side:o(this.getAttribute("side")),site:this.getAttribute("site"),action:this.getAttribute("action"),ref:this.getAttribute("ref"),max_age:this.getAttribute("max_age"),trigger:i(this.getAttribute("trigger","")),read_time:s(this.getAttribute("read_time")),num_recommendations:parseInt(this.getAttribute("num_recommendations"),10)||2},this._showLoader=!1,this.subscribe("iframe.onload",c(function(){var e=this.dom.children[0];e.className="fbpluginrecommendationsbar"+this._attr.side},"bind",!0,this));var u=c(function(){return l.remove(e,"scroll",u),l.remove(n.documentElement,"click",u),l.remove(n.documentElement,"mousemove",u),r(c(this.arbiterInform,"bind",!0,this,"platform/plugins/recommendations_bar/action",null,f.BEHAVIOR_STATE),this._attr.read_time*1e3),!0},"bind",!0,this);l.add(e,"scroll",u),l.add(n.documentElement,"click",u),l.add(n.documentElement,"mousemove",u);if(this._attr.trigger=="manual"){var a=c(function(e){return e==this._attr.href&&(h.unsubscribe("xfbml.recommendationsbar.read",a),this.arbiterInform("platform/plugins/recommendations_bar/trigger",null,f.BEHAVIOR_STATE)),!0},"bind",!0,this);h.subscribe("xfbml.recommendationsbar.read",a)}else{var p=t(500,c(function(){return this.calculateVisibility()&&(l.remove(e,"scroll",p),l.remove(e,"resize",p),this.arbiterInform("platform/plugins/recommendations_bar/trigger",null,f.BEHAVIOR_STATE)),!0},"bind",!0,this));l.add(e,"scroll",p),l.add(e,"resize",p),p()}this.visible=!1;var m=t(500,c(function(){return!this.visible&&this.calculateVisibility()?(this.visible=!0,this.arbiterInform("platform/plugins/recommendations_bar/visible")):this.visible&&!this.calculateVisibility()&&(this.visible=!1,this.arbiterInform("platform/plugins/recommendations_bar/invisible")),!0},"bind",!0,this));l.add(e,"scroll",m),l.add(e,"resize",m),m(),this.focused=!0;var y=c(function(){return this.focused=!this.focused,!0},"bind",!0,this);return l.add(e,"blur",y),l.add(e,"focus",y),this.resize_running=!1,this.animate=!1,this.subscribe("xd.signal_animation",c(function(){this.animate=!0},"bind",!0,this)),!0},getSize:function(){return{height:25,width:this._attr.action=="recommend"?140:96}},calculateVisibility:function(){var t=n.documentElement.clientHeight;if(!this.focused&&e.console&&e.console.firebug)return this.visible;switch(this._attr.trigger){case"manual":return!1;case"onvisible":var r=this.dom.getBoundingClientRect().top;return r<=t;default:var i=e.pageYOffset||n.body.scrollTop,s=n.documentElement.scrollHeight;return(i+t)/s>=this._attr.trigger}}});u.exports=m}),l("sdk.XFBML.Registration",["sdk.Auth","sdk.Helper","sdk.XFBML.IframeWidget","sdk.Runtime","UrlMap"],function(t,n,r,i,s,o,u,a,f,l,h){var p=f.extend({_visibleAfter:"immediate",_baseHeight:167,_fieldHeight:28,_skinnyWidth:520,_skinnyBaseHeight:173,_skinnyFieldHeight:52,setupAndValidate:function(){return this._attr={action:this.getAttribute("action"),border_color:this.getAttribute("border-color"),channel_url:this.getChannelUrl(),client_id:l.getClientID(),fb_only:this._getBoolAttribute("fb-only",!1),fb_register:this._getBoolAttribute("fb-register",!1),fields:this.getAttribute("fields"),height:this._getPxAttribute("height"),redirect_uri:this.getAttribute("redirect-uri",e.location.href),no_footer:this._getBoolAttribute("no-footer"),no_header:this._getBoolAttribute("no-header"),onvalidate:this.getAttribute("onvalidate"),width:this._getPxAttribute("width",600),target:this.getAttribute("target")},this._attr.onvalidate&&this.subscribe("xd.validate",c(function(e){var t=c("JSON","parse",!1,e.value),n=c(function(t){this.arbiterInform("Registration.Validation",{errors:t,id:e.id})},"bind",!0,this),r=a.executeFunctionByName(this._attr.onvalidate,t,n);r&&n(r)},"bind",!0,this)),this.subscribe("xd.authLogin",c(this._onAuthLogin,"bind",!0,this)),this.subscribe("xd.authLogout",c(this._onAuthLogout,"bind",!0,this)),!0},getSize:function(){return{width:this._attr.width,height:this._getHeight()}},_getHeight:function(){if(this._attr.height)return this._attr.height;var e;if(!this._attr.fields)e=["name"];else try{e=c("JSON","parse",!1,this._attr.fields)}catch(t){e=this._attr.fields.split(/,/)}return this._attr.width<this._skinnyWidth?this._skinnyBaseHeight+e.length*this._skinnyFieldHeight:this._baseHeight+e.length*this._fieldHeight},getUrlBits:function(){return{name:"registration",params:this._attr}},getDefaultWebDomain:function(){return h.resolve("www",!0)},_onAuthLogin:function(){u.getAuthResponse()||u.getLoginStatus(),a.fireEvent("auth.login",this)},_onAuthLogout:function(){u.getAuthResponse()||u.getLoginStatus(),a.fireEvent("auth.logout",this)}});s.exports=p}),l("sdk.XFBML.SocialContext",["sdk.Event","sdk.XFBML.IframeWidget"],function(e,t,n,r,i,s,o,u){var a=u.extend({setupAndValidate:function(){var e=this.getAttribute("size","small");return this._attr={channel:this.getChannelUrl(),width:this._getPxAttribute("width",400),height:this._getPxAttribute("height",100),ref:this.getAttribute("ref"),size:this.getAttribute("size"),keywords:this.getAttribute("keywords"),urls:this.getAttribute("urls"),object_id:this.getAttribute("object_id")},this.subscribe("xd.social_context_stats",c(this._bubbleSocialContextStats,"bind",!0,this)),!0},_bubbleSocialContextStats:function(e){var t={pluginID:this.getAttribute("plugin-id"),socialContextPageIDs:c("JSON","parse",!1,e.social_context_page_ids)};o.fire("xfbml.social_context_stats",t)},getSize:function(){return{width:this._attr.width,height:this._attr.height}},getUrlBits:function(){return{name:"social_context",params:this._attr}}});i.exports=a}),l("legacy:fb.xfbml",["Assert","sdk.domReady","sdk.Event","FB","IframePlugin","PluginTags","wrapFunction","XFBML","sdk.XFBML.Comments","sdk.XFBML.CommentsCount","sdk.XFBML.ConnectBar","sdk.XFBML.LoginButton","sdk.XFBML.Name","sdk.XFBML.RecommendationsBar","sdk.XFBML.Registration","sdk.XFBML.SocialContext"],function(t,i,s,o,u,a,f,l,h,p,d,v,m,g){var y={comments:i("sdk.XFBML.Comments"),comments_count:i("sdk.XFBML.CommentsCount"),connect_bar:i("sdk.XFBML.ConnectBar"),login_button:i("sdk.XFBML.LoginButton"),name:i("sdk.XFBML.Name"),recommendations_bar:i("sdk.XFBML.RecommendationsBar"),registration:i("sdk.XFBML.Registration"),social_context:i("sdk.XFBML.SocialContext")};c(c("Object","keys",!1,v),"forEach",!0,function(e){g.registerTag({xmlns:"fb",localName:e.replace(/_/g,"-"),ctor:d.withParams(v[e])})}),c(c("Object","keys",!1,y),"forEach",!0,function(e){g.registerTag({xmlns:"fb",localName:e.replace(/_/g,"-"),ctor:y[e]})}),p.provide("XFBML",{parse:function(e){return f.maybeXfbml(e,"Invalid argument"),e&&e.nodeType===9&&(e=e.body),g.parse.apply(null,arguments)}}),p.provide("XFBML.RecommendationsBar",{markRead:function(t){h.fire("xfbml.recommendationsbar.read",t||e.location.href)}}),g.subscribe("parse",c(h.fire,"bind",!0,h,"xfbml.parse")),g.subscribe("render",c(h.fire,"bind",!0,h,"xfbml.render")),h.subscribe("init:post",function(e){e.xfbml&&r(m(c(l,"bind",!0,null,g.parse),"entry","init:post:xfbml.parse"),0)}),f.define("Xfbml",function(e){return(e.nodeType===1||e.nodeType===9)&&typeof e.nodeName=="string"});try{n.namespaces&&!n.namespaces.item.fb&&n.namespaces.add("fb")}catch(b){}},3)}.call({},window.inDapIF?parent.window:window)}catch(e){(new Image).src="http://www.facebook.com/common/scribe_endpoint.php?c=jssdk_error&m="+encodeURIComponent('{"error":"LOAD", "extra": {"name":"'+e.name+'","line":"'+(e.lineNumber||e.line)+'","script":"'+(e.fileName||e.sourceURL||e.script)+'","stack":"'+(e.stackTrace||e.stack)+'","revision":"1129623","message":"'+e.message+'"}}')}define("fb",function(e){return function(){return e.FB}}(this)),define("tictail/component/facebook",["fb","tictail/component/log"],function(e,t){var n=this;n.TT=n.TT||{};var r=n.TT.Facebook={};r.initialized=!1,r.permissions=[],r.init=function(){if(r.initialized)return;e.init({appId:window.FacebookAppId,status:!0,cookie:!0,xfbml:!0}),t.log("Facebook initialized."),r.initialized=!0};var i=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);return r.init(),e.apply(this,t)}};return r.getLoginStatus=i(function(t){e.getLoginStatus(function(n){e.api("/me/permissions",function(e){r.permissions=(e.data||[])[0],t(n)})})}),r.getAuthResponse=i(function(){return e.getAuthResponse.apply(this,arguments)}),r.login=i(function(){return e.login.apply(this,arguments)}),r.logout=i(function(){return e.logout.apply(this,arguments)}),r.api=i(function(){return e.api.apply(this,arguments)}),r.ensureWritePermission=function(e){r.permissions.publish_stream?e(r.getAuthResponse()):r.login(function(t){t.authResponse?e(t.authResponse):(alert("To be able to post to Facebook from Tictail, please grant Tictail permissions to post on your behalf"),e(t))},{scope:"publish_stream"})},r}),define("dashboard/form/field/user/facebookconnect",["jquery","tictail/core","tictail/component/api","tictail/component/log","tictail/component/facebook","tictail/form/field/connect","tictail/model/user/facebook"],function(e,t,n,r,i,s,o){var u=this;u.TT=u.TT||{},u.TT.Form=u.TT.Form||{},u.TT.Form.ConnectButton=u.TT.Form.ConnectButtmn||s;var a=u.TT.Form.ConnectButton.TwitterConnect=s.extend({avatarURL:"https://graph.facebook.com/{{facebook_id}}/picture",alias:"facebook",initialize:function(e){var t=this;a.__super__.initialize.apply(this,arguments),i.init();if(!this.social[this.alias].get("connected"))return;i.getLoginStatus(function(e){e.status==="not_authorized"&&t.disconnect()})},getScreenname:function(){var e=this;return i.getLoginStatus(function(t){t.status==="connected"&&i.api("/me",function(t){_.isEmpty(t.name)===!1&&t.name!==e.social[e.alias].get("screen_name")&&(e.social[e.alias].set("screen_name",t.name),e.social[e.alias].save(),e.renderScreenname())})}),this.social[this.alias].get("screen_name")},getAvatarURL:function(){return this.avatarURL.replace("{{facebook_id}}",this.social[this.alias].get("facebook_id"))},click:function(e){var t=this;i.login(function(e){e.authResponse?t.connect(e):t.disconnect(e)},{scope:"publish_stream"})},connect:function(e){var t=this;i.api("/me",function(i){if(_.isEmpty(i.name)){alert("You are logged in to a Facebook Business account. Business accounts can't use Facebook apps, such as Tictail. Please log out from Facebook and try again with your personal account."),t.disconnected();return}var s=e.authResponse,u={screen_name:i.name,facebook_id:s.userID,access_token:s.accessToken},a=new n.Request("social.facebook.user.connect",u,"POST");a.setOnSuccess(function(e,n){t.social[t.alias]=new o(e),t.connected()}),a.setOnError(function(e){r.debug("Failed to save user token"),t.disconnected()}),a.send()})},disconnect:function(){var e=this,t=new n.Request("social.facebook.user.disconnect",{},"POST");t.setOnSuccess(function(t){e.social[e.alias]=new o(t),e.disconnected()}),t.send()}});return a}),define("dashboard/form/field/user/socialservices",["jquery","tictail/form/field/switch","tictail/form/field/compound","./twitterconnect","./facebookconnect","tictail/component/facebook","i18n!../../../nls/user_settings"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.Form=u.Dashboard.Form||{},u.Dashboard.Form.Field=u.Dashboard.Form.Field={},u.Dashboard.Form.Field.Store=u.Dashboard.Form.Field.Store||{};var a=u.Dashboard.Form.Field.Store.SocialServices=n.extend({attributes:{"class":"field social-share-options"},services:["facebook","twitter"],initialize:function(e){e=e||{},this.services=e.services||this.services,this.hideServiceToggles=e.hideServiceToggles||!1,a.__super__.initialize.apply(this,arguments)},isServiceIncluded:function(e){if(_.isString(e))return _.indexOf(this.services,e)!==-1;var t=_.difference(e,this.services);return t.length===0},getSocialServiceField:function(t){var n=t.getScreenname(),r=t.alias,i=r,s=e("<span/>").addClass("icon"),o=e("<span/>").addClass("name").text(n),u=e('<div class="social-share-option '+i+'"/>').append(s).append(o),a=this.getToggleField(i);return a.setValue(!0),this.addChildView(a,u),this.hideServiceToggles&&a.$el.hide(),u},getFacebookShareField:function(){var e=new i({key:"connect-social-facebook",value:o.account.field.facebook.button.value});return e.on("connected",_.bind(this.renderField,this)),e.on("disconnected",_.bind(this.renderField,this)),TT.session.social.facebook.get("connected")===!0?this.getSocialServiceField(e):e},getTwitterShareField:function(){var e=new r({key:"connect-social-twitter",value:o.account.field.twitter.button.value});return e.on("connected",_.bind(this.renderField,this)),e.on("disconnected",_.bind(this.renderField,this)),TT.session.social.twitter.get("connected")===!0?this.getSocialServiceField(e):e},getShareParamsForService:function(t){var n=e.Deferred(),r={};return t=="facebook"?s.ensureWritePermission(function(e){var t=e.accessToken;t?(r.access_token=t,n.resolve(r)):n.reject()}):n.resolve(r),n},getToggleField:function(e){return new t({tagName:"div",attributes:{"class":"status-switch"},key:"set-status-"+e,model:{instance:this.model,attribute:e},yesLabel:"Yes",noLabel:"No"})},renderField:function(){this.$el.find("div:first").remove();var t=e("<div/>").appendTo(this.$el);this.hideServiceToggles===!1&&t.addClass("imprint");if(this.isServiceIncluded("facebook")){var n=this.getFacebookShareField();this.addChildView(n,t)}this.services.length>1&&this.addChildView(e("<hr/>"),t);if(this.isServiceIncluded("twitter")){var r=this.getTwitterShareField();this.addChildView(r,t)}a.__super__.renderField.apply(this,arguments)}});return a}),define("dashboard/nls/social",{root:{social:{field:{share:{message:{label:"Message"}}},section:{share:{button_label:"Share",label:"Share a message"},share_tips:{heading:"Tweet Sheet",tips:["Share all new products on Twitter, and don't forget to include links and images to get people interested!","Current events are always good to tweet about, e.g.. if it's raining, suggest people shop in your store rather than go outside.","People shop a lot based on occasion, for example; they're going out, buying a gift for a birthday or moving house. Tweet about your store and products from an occasion point of view e.g.. Looking for a great gift? Find personal and unique products here","Make news around your store that creates urgency for shoppers. For example, a price drop that's only available for the next 24 hours, or announcing there's only 1 left of your most popular product!","Keep an eye on and retweet when someone mentions your brand. You can do this by daily doing a search for any mentions of your brand. Find them and retweet them, as a thank you and to show your followers who is talking about you.","Why don't you recommend one of your products to someone you think might like it? Tweet them directly and explain why you think it might interest them. The more followers they have the better! (and don't forget to thank them and retweet if they respond.)","Check trends that are happening on Twitter (in left column of Twitter) and see if there's one that you can connect to your store or product. Only do this if it makes sense!"]}}}}}),define("dashboard/view/social/share_tips",["tictail/core","tictail/view","tictail/component/log","i18n!../../nls/social"],function(e,t,n,r){var i=t.extend({id:null,className:"field social-share-tips",template:"social/share_tips",events:{"click .refresh":"onClickRefresh"},initialize:function(e){i.__super__.initialize.apply(this,arguments),this.lang=e.lang||r.social.section.share_tips,this.tips=this.lang.tips,this.tipIndex=Math.floor(Math.random()*this.tips.length)},getTip:function(){return this.tipIndex++,this.tipIndex>=this.tips.length&&(this.tipIndex=0),this.tips[this.tipIndex]},getTemplateData:function(){return{heading:this.lang.heading,tip:this.getTip()}},renderNewTip:function(){this.$tipEl.text(this.getTip())},didRender:function(){this.$tipEl=this.$el.find(".tip")},onClickRefresh:function(e){e.preventDefault(),this.renderNewTip()}});return i}),define("dashboard/form/social/share",["underscore","tictail/core","tictail/component/api","tictail/form/core","tictail/form/fieldset","tictail/utility","../field/user/textarea_share","../field/user/socialservices","../../view/social/share_tips"],function(e,t,n,r,i,s,o,u,a){var f=this;f.Dashboard=f.Dashboard||{},f.Dashboard.Form=f.Dashboard.Form||{},f.Dashboard.Form.Social=f.Dashboard.Form.Social||{};var l=f.Dashboard.Form.Social.Share=r.extend({messageFields:["set-share-message"],servicesFields:["set-share-services"],shareTips:[],allFields:function(){return this.allFields=this.messageFields.concat(this.servicesFields,this.shareTips),this.allFields},initialize:function(e){e=e||{},this.lang=e.lang,this.modal=e.modal||!1,this.buttonLabel=this.lang.share_button_label,this.actionBarExtend=e.actionBarExtend||{},this.hideServiceToggles=e.hideServiceToggles||!1,this.services=e.services||u.prototype.services;if(!e.message){var n=this.lang.status_message;e.message=s.renderTemplateVars(n,{store_url:t.session.getCurrentStore().get("url")})}e.model=new t.Model({store_id:t.session.getCurrentStore().id,message:e.message}),l.__super__.initialize.call(this,e)},didAppend:function(){this.model.on("change",this.onModelChange,this)},willRemove:function(){this.model.off(null,null,this)},createField:function(e){if(e==="set-share-message")return new o({key:e,label:this.lang.message_label,maxLength:140,required:!0,model:{attribute:"message",instance:this.model}});if(e==="set-share-services")return new u({key:e,label:this.lang.services_label,model:{instance:this.model},services:this.services,hideServiceToggles:this.hideServiceToggles});if(e==="share-tips")return new a({key:e,label:this.lang.services_label,model:{instance:this.model}})},render:function(){var e=this;this.empty();var t=this.allFields,n=this.getFields(t);return this.modal===!1&&(n=new i({title:this.lang.section_label,rightColumnContent:n})),this.addChildView(n),this.addChildView(this.actionbar),this.updateSaveButton(),this.didRender()},actionbarGetParams:function(){var t=l.__super__.actionbarGetParams.apply(this,arguments);return e.extend(t,this.actionBarExtend),t},updateSaveButton:function(){var e=this.model.get("facebook")||this.model.get("twitter");this.getSaveButton().prop("disabled",!e)},onModelChange:function(e,t){this.updateSaveButton()},save:function(t){if(!this.hasModel())return;var r=this,i=new n.Batch;this.validate({refreshValue:!0}).then(function(){var t=r.model.get("message"),s=r.services,o=r.getField("set-share-services"),u=[],a=[];return u=e.filter(s,function(e){return r.model.get(e)===!0}),a=e.map(u,function(r){return o.getShareParamsForService(r).then(function(s){var o=new n.Request("social."+r+".user.post",e.extend(s,{message:t}),"POST");i.appendRequest(o)})}),$.when.apply(this,a)}).then(function(){e.isArray(t)&&e.each(t,function(e){i.appendRequest(e)});if(i.getStackLength()===0){r.cancel();return}r.onSaving(r.model),i.on("complete",function(){r.onSuccessfulSave(r.model,null)},this),i.send()})},cancel:function(){this.trigger("onCancel",this)}});return l}),define("dashboard/module/social/share",["underscore","tictail/core","tictail/constants","tictail/component/api","tictail/component/actionbar","tictail/component/tracker","tictail/form/core","../../view","../../form/social/share","../../form/field/user/socialservices"],function(e,t,n,r,i,s,o,u,a,f){var l=this;l.Dashboard=l.Dashboard||{},l.Dashboard.Module=l.Dashboard.Module||{},l.Dashboard.Module.Social=l.Dashboard.Module.Social||{};var c=l.Dashboard.Module.Social.Share=u.extend({id:"social-prompt-view",template:"module/overlay",container:".content",initialize:function(e){c.__super__.initialize.apply(this,arguments),this.model||(this.model=new t.Model),this.lang=e.lang},getTemplateData:function(){return{heading:this.lang.heading,description:this.lang.description}},getContent:function(){return t.getLazy(this,"shareForm",function(){var t={};t.link={label:this.lang.not_now_link_label,callback:e.bind(this.onCancel,this)};var n=new a({model:this.model,actionBarExtend:t,lang:this.lang,modal:!0});return n.on("onSave",this.onSave,this),n.on("onCancel",this.onCancel,this),n})},render:function(){var e;return s.track('Loaded Share View: "'+this.lang.heading+'"'),this.lang.heading=="Start building hype!"?e=n.onboarding.SEEN_SHARE_HYPE_FORM:this.lang.heading=="Share the great news!"&&(e=n.onboarding.SEEN_SHARE_LAUNCH_FORM),e!=null&&s.trackOnboarding(e),c.__super__.render.apply(this,arguments)},onSave:function(){s.track('Shared in View "'+this.lang.heading+'"'),this.trigger("onDone",this,!0)},onCancel:function(){s.track('Cancelled in View: "'+this.lang.heading+'"'),this.trigger("onDone",this,!1)}});return c}),define("dashboard/module/feed/metrics",["underscore","jquery","tictail/component/log","../../view","../../module/social/share","i18n!../../nls/feed"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.Module=o.Dashboard.Module||{},o.Dashboard.Module.Feed=o.Dashboard.Module.Feed||{};var u=o.Dashboard.Module.Feed.Metrics=r.extend({id:"feed-metrics",template:"feed/metrics",events:{"click .metric.followers .button":"onGetMoreFollowers"},onGetMoreFollowers:function(){var e=new i({lang:s.get_followers.share});e.on("onDone",function(e){e.remove()}),e.overlay({parentView:this,closeButton:!1})},initialize:function(){u.__super__.initialize.apply(this,arguments),this.metrics=this.options.metrics||{}},setMetrics:function(e){this.metrics=e,this.updateMetrics()},getTemplateData:function(){var e=s.index.metrics;return{visits_label:e.visits_label,orders_label:e.orders_label,followers_label:e.followers_label,followers_button:e.followers_button}},updateMetrics:function(){var e=this.metrics||{},t=TT.session.getCurrentStore();if(!t.shouldShowMetrics())return;this.updateMetric(this.$(".metric.visits"),e.visits),this.updateMetric(this.$(".metric.orders"),e.orders),this.updateMetric(this.$(".metric.followers"),e.followers),this.$el.show()},updateMetric:function(e,t){var n=e.children(".value"),r=e.children(".diff"),i=t.current.count,s=t.previous.count,o=i-s,u,a;u=parseInt(n.text()||0),a=parseInt(r.text()||0),r.toggleClass("positive",o>0).toggleClass("negative",o<0),e.css("text-indent",0).animate({"text-indent":100},{duration:2e3,easing:"easeInOutCubic",step:function(e){var t=e/100;n.text(Math.round(u+(i-u)*t)),r.text(Math.abs(Math.round(a+(o-a)*t)))}})},didRender:function(){return this.updateMetrics(),this}});return u}),define("dashboard/view/feed/index",["jquery","underscore","tictail/core","tictail/mediator","tictail/component/log","tictail/component/api","tictail/component/tracker","../../module/loadpage","../../module/feed/list","../../module/feed/progressbar","../../module/feed/metrics","i18n!../../nls/feed"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this;h.Dashboard=h.Dashboard||{},h.Dashboard.View=h.Dashboard.View||{},h.Dashboard.View.Feed=h.Dashboard.View.Feed={};var p=h.Dashboard.View.Feed.Index=u.extend({id:"feed-page",className:null,bodyId:"feed",sectionName:"home",load:function(){var e=new s.Batch,t=this.getCurrentStore(),n=t.id,i={},u=this,a=t.getForeignFetchRequest("feed");a.params={store_id:n};var l=this.getProgressRequest(function(e){u.progressBar=new f({goal:e.message,left:e.left,total:e.total})});r.subscribe("feed.on_refresh",function(e){if(u.progressBar.hasCompleted()!==!0){var t=u.getProgressRequest(function(e){u.progressBar.updateGoal(e.message),u.progressBar.setProgress(e.left,e.total),u.progressBar.hasCompleted()&&u.onOnboardingCompleted()});e.appendRequest(t)}else{var t=u.getMetricsRequest(function(e){u.metrics.setMetrics(e)},"POST");t&&e.appendRequest(t)}}),r.subscribe("feed.on_refresh",function(e){Dashboard.experiments.fetch({success:function(e,t,n){o.registerExperiments(e)}})});var c=this.getMetricsRequest(function(e){i.metrics=e});e.appendRequest(a),e.appendRequest(l),c&&e.appendRequest(c),e.on("complete",function(){i.feedItems=t.getForeignAttribute("feed"),this.didLoad(i)},this),e.send()},getTitle:function(){return c.index.page_title},_generateRequest:function(e,t,r){r=r||"GET";var i=new s.Request(e,{store_id:n.session.getCurrentStore().id},r);return i.setOnSuccess(t),i},getProgressRequest:function(e,t){return this._generateRequest("task.progress.get",e,t)},getMetricsRequest:function(e,t){return this._generateRequest("store.metrics.get",e,t)},renderTemplate:function(){return this.templateContainer=e('<div id="page" class="appsize"/>').appendTo(this.$el),p.__super__.renderTemplate.apply(this,arguments)},renderContent:function(){if(!this.data)return;this.progressBar.hasCompleted()?this.onOnboardingCompleted():(this.addChildView(this.progressBar),this.$el.addClass("hasProgressBar"));var e=this.metrics=new l({metrics:this.data.metrics});this.addChildView(e,this.templateContainer);var t=new a({collection:this.data.feedItems,feedItemToOpen:this.options.feedItemToOpen});t.on("onItemPerform",this.onItemPerform,this),this.addChildView(t,this.templateContainer)},onOnboardingCompleted:function(){this.$el.removeClass("hasProgressBar")}});return p}),define("dashboard/nls/welcome",{root:{index:{page_title:"Select a design for your store",subtitle:"Don't worry, you can always change this later",done_button:{label:"Start your store!"},preview_label:"Preview"}}}),define("dashboard/view/welcome/index",["jquery","underscore","tictail/core","tictail/component/api","../../model/store/base","../../module/loadpage","i18n!../../nls/welcome"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.View=u.Dashboard.View||{},u.Dashboard.View.Welcome=u.Dashboard.View.Welcome={};var a=u.Dashboard.View.Welcome.Index=s.extend({id:"welcome-index-page",className:null,template:"welcome/index",bodyId:"welcome-index",storeLoadEventName:"theme.loaded",events:{"click #welcome-theme-list .hit-area":"onClickTheme","click #welcome-done-button":"onClickDone"},load:function(){this.getCurrentStore().loadForeign("theme")},didLoad:function(e){e&&(e.comparator=function(e){return String(e.get("name")).toUpperCase()},e.sort()),a.__super__.didLoad.call(this,e)},getTemplateData:function(){if(!this.data)return null;var e=o.index;return{page_title:e.page_title,subtitle:e.subtitle,done_button_label:e.done_button.label,themes:t.pluck(this.data.models,"attributes"),theme_base_url:i.generateCurrentBaseUrl("/themes/preview"),preview_label:e.preview_label}},setDoneButtonEnabled:function(e){this.$(".flash-container").toggle(e),this.$(".flash").toggleClass("animating",e),this.$("#welcome-done-button").prop("disabled",!e)},didRender:function(){var e=this.$("#welcome-done-button");this.$(".flash-container").mouseenter(function(){e.addClass("hover")}).mouseleave(function(){e.removeClass("hover active")}).mousedown(function(){e.addClass("active")}).mouseup(function(){e.removeClass("active")}).click(function(){e.click()})},onClickTheme:function(t){var n=e(t.currentTarget).parent("li"),r=n.attr("data-theme-id");if(!r)return;this._selectedThemeId=r,this.$("#welcome-theme-list .selected").removeClass("selected"),n.addClass("selected"),this.setDoneButtonEnabled(!0)},onClickDone:function(e){if(!this._selectedThemeId)return;this.setDoneButtonEnabled(!1);var t=this,i={store_id:n.session.getCurrentStore().id,theme_id:this._selectedThemeId},s=new r.Request("store.theme.set",i);s.setOnSuccess(function(e){t.navigate("/home")}),s.send()}});return a}),define("tictail/model/user/base",["../../core"],function(e){var t=e.Model.extend({API_NAMESPACE:"user",API_METHOD_ABORT:{create:!0,"delete":!0}});return t}),define("dashboard/model/user/base",["tictail/model/user/base"],function(e){var t=this;t.Dashboard=t.Dashboard||{},t.Dashboard.Model=t.Dashboard.Model||{};var n=t.Dashboard.Model.User=e.extend({toJSON:function(){var e=n.__super__.toJSON.apply(this,arguments);return this.get("new_password")||delete e.new_password,e}});return n}),define("tictail/form/field/text",["jquery","underscore","tictail/form/field/input"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{},r.TT.Form.Field=r.TT.Form.Field||{};var i=r.TT.Form.Field.Text=n.extend({fieldTagName:"input",fieldAttributes:{type:"text"},_sanitize:function(t){return this.options.trim===!0&&(t=e.trim(t)),t},_validate:function(e){var n=[],r=this.options;return t.isNumber(r.maxLength)&&e.length>r.maxLength?n.push(sprintf(gettext("Cannot be longer than %1$d characters"),r.maxLength)):t.isNumber(r.minLength)&&e.length<r.minLength&&n.push(sprintf(gettext("Cannot be shorter than %1$d characters"),r.minLength)),n}});return i}),define("tictail/form/field/password",["./text"],function(e){var t=this;t.TT=t.TT||{},t.TT.Form=t.TT.Form||{},t.TT.Form.Field=t.TT.Form.Field||{};var n=t.TT.Form.Field.Password=e.extend({fieldAttributes:{type:"password"}});return n}),define("tictail/form/field/email",["tictail/form/field/text"],function(e){var t=this;t.TT=t.TT||{},t.TT.Form=t.TT.Form||{},t.TT.Form.Field=t.TT.Form.Field||{};var n=t.TT.Form.Field.Email=e.extend({fieldAttributes:{type:"email"},_validate:function(e){var t=/^\S+@\S+\.\S+$/,r=n.__super__._validate.call(this,e);return t.test(e)||r.push(gettext("This is not a valid email address")),r}});return n}),define("dashboard/form/field/user/new_password",["jquery","underscore","tictail/core","tictail/form/field/text"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Form=i.Dashboard.Form||{},i.Dashboard.Form.Field=i.Dashboard.Form.Field={},i.Dashboard.Form.Field.User=i.Dashboard.Form.Field.User||{};var s=i.Dashboard.Form.Field.User.NewPassword=r.extend({attributes:{"class":"field new-password-field"},fieldAttributes:{type:"password"},initialize:function(){s.__super__.initialize.apply(this,arguments),this.confirmPasswordId=this.id+"-confirm"},_validate:function(e){var t=s.__super__._validate.call(this,e);return this.inChangeHandler||e!==this._getConfirmFieldNode().val()&&t.push("Passwords don't match!"),t},setError:function(e){s.__super__.setError.call(this,e),this.$(".imprint").addClass("error")},unsetError:function(){s.__super__.unsetError.call(this),this.$(".imprint").removeClass("error")},renderField:function(){var t=this.options,n=e('<div class="field full-width"/>').append(e("<label/>").attr("for",this.id).text(t.newPasswordLabel)).append(this._getFieldNode()),r=e('<div class="field full-width"/>').append(e("<label/>").attr("for",this.confirmPasswordId).text(t.confirmPasswordLabel)).append(this._getConfirmFieldNode());e('<div class="imprint"/>').append(n).append(r).appendTo(this.el)},_valueChanged:function(){this.inChangeHandler=!0,s.__super__._valueChanged.apply(this,arguments),this.inChangeHandler=!1},onChangeConfirm:function(){this.options.validateOnSet!==!1&&this._validate(this._getFieldValue(),!0)},_getConfirmFieldNode:function(){var r=this;return n.getLazy(this,"_confirmCtrl",function(){return e('<input type="password"/>').attr("id",r.confirmPasswordId).attr("tabindex",r.tabIndex).change(t.bind(r.onChangeConfirm,r))})}});return s}),define("dashboard/form/user/settings",["underscore","tictail/component/api","tictail/form/core","tictail/form/fieldset","tictail/form/field/password","tictail/form/field/email","../field/user/new_password","../field/user/twitterconnect","../field/user/facebookconnect","i18n!../../nls/user_settings"],function(e,t,n,r,i,s,o,u,a,f){var l=this;l.Dashboard=l.Dashboard||{},l.Dashboard.Form=l.Dashboard.Form||{},l.Dashboard.Form.User=l.Dashboard.Form.User={};var c=l.Dashboard.Form.User.Settings=n.extend({passwordFields:["current-account-password"],accountFields:["set-account-email","new-account-password"],socialFields:["connect-social-facebook","connect-social-twitter"],requiredFields:function(){return this.requiredFields=this.passwordFields.concat(),this.requiredFields},allFields:function(){return this.allFields=this.passwordFields.concat(this.accountFields,this.socialFields),this.allFields},createField:function(e){switch(e){case"current-account-password":return new i({key:e,label:f.account.field.current_password.label,labelDescription:f.account.field.current_password.labelDescription,model:{instance:this.model,attribute:"password"},required:!0});case"set-account-email":return new s({key:e,label:f.account.field.email.label,labelDescription:f.account.field.email.labelDescription,model:{instance:this.model,attribute:"email"},required:!0,maxLength:128});case"new-account-password":return new o({key:e,label:f.account.field.password.label,newPasswordLabel:f.account.field.new_password.label,confirmPasswordLabel:f.account.field.confirm_password.label,model:{instance:this.model,attribute:"new_password"},minLength:6});case"connect-social-facebook":return new a({key:e,label:f.account.field.facebook.button.label,value:f.account.field.facebook.button.value,fieldClass:"grouped"});case"connect-social-twitter":return new u({key:e,label:f.account.field.twitter.button.label,value:f.account.field.twitter.button.value,fieldClass:"grouped"});default:return null}},renderPasswordField:function(){var t=this.getFields(this.passwordFields);if(e.isEmpty(t))return!1;var n=new r({rightColumnContent:t});return this.addChildView(n),!0},renderAccountFields:function(){var t=this.getFields(this.accountFields);if(e.isEmpty(t))return!1;var n=new r({title:f.account.section.info.title,rightColumnContent:t});return this.addChildView(n),!0},renderSocial:function(){var t=this.getFields(this.socialFields);if(e.isEmpty(t))return!1;var n=new r({title:f.account.section.social.title,description:f.account.section.social.description,rightColumnContent:this.getFields(this.socialFields)});return this.addChildView(n),!0},render:function(){return this.empty(),this.renderSocial(),this.renderAccountFields(),this.renderPasswordField(),this.addChildView(this.actionbar),this.didRender()},onSaveError:function(n,r){var i,s;if(r.code===t.ERROR_CODES.USER_INCORRECT_CREDENTIALS){i=this.getField("current-account-password"),e.isUndefined(i)||(s=f.account.field.current_password.error[String(r.code)],i.setError([s])),this.setLoadingSaveButton(!1);return}if(r.code===t.ERROR_CODES.USER_ALREADY_EXISTS){i=this.getField("set-account-email"),e.isUndefined(i)||(s=f.account.field.email.error[String(r.code)],i.setError([s])),this.setLoadingSaveButton(!1);return}c.__super__.onSaveError.apply(this,arguments)}});return c}),define("dashboard/view/user/settings",["underscore","tictail/core","tictail/component/api","i18n!../../nls/user_settings","../../module/loadpage","../../model/user/base","../../form/user/settings"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.View=u.Dashboard.View||{},u.Dashboard.View.User=u.Dashboard.View.User={};var a=u.Dashboard.View.User.Settings=i.extend({included:["password","account","twitter","facebook"],initialize:function(t){t=t||{},e.isArray(t.include)===!0&&(this.included=t.include),a.__super__.initialize.call(this,t)},isIncluded:function(t){return e.indexOf(this.included,t)!==-1},load:function(){var e=new n.Batch,t=new s;(this.isIncluded("password")||this.isIncluded("account"))&&e.appendRequest(t.fetch({getRequest:!0}));if(e.getStackLength()===0){this.useCachedData(t);return}e.on("complete",function(){this.didLoad(t)},this),e.send()},getTitle:function(){return r.page_title},getForm:function(){return t.getLazy(this,"form",function(){var t,n=o.prototype;this.formInclude!==void 0?t=this.formInclude:(t=[],this.isIncluded("password")&&(t=t.concat(n.passwordFields)),this.isIncluded("account")&&(t=t.concat(n.accountFields)),this.isIncluded("twitter")&&(t=t.concat("connect-social-twitter")),this.isIncluded("facebook")&&(t=t.concat("connect-social-facebook")));var r=e.extend({model:this.data,include:t},this.formOptions),i=new o(r);return i.on("onSave",this.onSave,this),i.on("onSaveError",this.onSaveError,this),i})},onSave:function(){Dashboard.showStatusHud("Saved!")},onSaveError:function(){},getLoadedContent:function(){return this.getForm()},setFocus:function(){this.form!==void 0&&this.form.setFocus()}});return a}),define("tictail/form/field/number",["jquery","underscore","./text"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{},r.TT.Form.Field=r.TT.Form.Field||{};var i=r.TT.Form.Field.Number=n.extend({attributes:{"class":"field number-field"},fieldAttributes:{type:"number"},initialize:function(e){var n=this.fieldAttributes;t.isNumber(e.minValue)&&(n.min=e.minValue),t.isNumber(e.maxValue)&&(n.max=e.maxValue),t.isNumber(e.stepSize)&&(n.step=e.stepSize),i.__super__.initialize.call(this,e)},roundToFieldPrecision:function(n){var r=parseFloat(e.trim(n));if(isNaN(r))return null;var i=this.options.stepSize;if(t.isNumber(i)){var s=i.toString().split(".")[1],o=t.isUndefined(s)?1:s.length;r=Number(r.toFixed(o))}return r},_sanitize:function(e){return this.roundToFieldPrecision(e)},_validate:function(e){var n=i.__super__._validate.call(this,e),r=this.options;return t.isNumber(e)===!1&&n.push("Must be a number"),t.isNumber(r.minValue)&&e<r.minValue?n.push("Cannot be less than "+r.minValue):t.isNumber(r.maxValue)&&e>r.maxValue&&n.push("Cannot be more than "+r.maxValue),n}});return i}),define("tictail/form/field/wysiwyg",["underscore","./textarea","jquery-ui"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{},n.TT.Form.Field=n.TT.Form.Field||{};var r=n.TT.Form.Field.Wysiwyg=t.extend({fieldAttributes:{"class":"wysiwyg"},setNodeValue:function(e){r.__super__.setNodeValue.call(this,e);var t=this._getFieldNode().data("editor");t&&t.composer&&t.composer.sandbox.loaded&&t.setValue(e,!0)},setFocus:function(){var e=this._getFieldNode().data("editor");e&&e.focus()},renderField:function(){r.__super__.renderField.apply(this,arguments),this.$el.ui(),this._getFieldNode().data("editor").on("focus:composer",e.bind(this.onFocus,this)).on("blur:composer",e.bind(this.onBlur,this)).on("change:composer",e.bind(this.onChange,this)).on("keyup:composer",e.bind(this.onKeyUp,this))},setExpanded:function(){var e=this._getFieldNode().data("replacement");e&&e.addClass("expanded")},unsetExpanded:function(){if(this.getValue(!1))return;var e=this._getFieldNode().data("replacement");e&&e.removeClass("expanded")}});return r}),define("dashboard/form/field/product/title",["jquery","tictail/component/api","tictail/form/field/text"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Form=r.Dashboard.Form||{},r.Dashboard.Form.Field=r.Dashboard.Form.Field={},r.Dashboard.Form.Field.Product=r.Dashboard.Form.Field.Product||{};var i=r.Dashboard.Form.Field.Product.Title=n.extend({deferred:undefined,currentSlugValue:undefined,attributes:{"class":"field product-title-field"},events:function(){return events=i.__super__.events.call(this),events["click input#slug-preview-link"]="clickSlugInput",events["keyup input#slug-preview-link"]="keyupSlugInput",events["blur input#slug-preview-link"]="blurSlugInput",events},clickSlugInput:function(t){t.preventDefault(),e(t.currentTarget).addClass("open")},keyupSlugInput:function(e){this.model.set("slug",e.currentTarget.value)},blurSlugInput:function(t){this.slugifyInBackend(t.currentTarget.value),e(t.currentTarget).removeClass("open")},addModelListeners:function(){i.__super__.addModelListeners.call(this),this.model.isNew()&&this.model.on("change:title",this.onChangeTitle,this)},removeModelListeners:function(){i.__super__.removeModelListeners.call(this),this.model.off("change:title",this.onChangeTitle,this)},onChangeTitle:function(e){this.slugifyInBackend(this.model.get("title"))},slugifyInBackend:function(e){var n=this,r={url:e};request=new t.Request("store.title.urlify",r,"POST"),request.setOnSuccess(function(e){n.setSlugPreview(e.url),n.model.set("slug",e.url),_.isUndefined(n.deferred)||(n.deferred.resolve(),delete n.deferred),n.slugifyInProgress=!1}),this.slugifyInProgress=!0,request.send()},_validateRemote:function(e,t){this.slugifyInProgress?this.deferred=t:t.resolve()},setSlugPreview:function(t){e("#slug-preview-link").val(decodeURIComponent(t))},renderField:function(){var t=TT.session.getCurrentStore().get("url").replace("http://",""),n=e('<input id="slug-preview-link" placeholder="your-product-url"/>').val(decodeURIComponent(this.model.get("slug")||"")),r=e('<div id="slug-preview"/>').append(e("<label />").text(t+"/product/").attr("for","slug-preview-link")).append(n);this.$el.append(this._getFieldNode()).append(r)}});return i}),define("dashboard/nls/modules",{root:{imageupload:{button:{single:"Upload Image",multiple:"Upload Images"},help_text:{single:"",multiple:"Tip! You can select multiple images in the dialog by holding down the '{key}' key while clicking on the files."},drop_zone:{label:{single:"No image has been uploaded",multiple:"No images have been uploaded"},drop_label:{single:"Drop an image here to upload it",multiple:"Drop images here to upload them"}}}}}),function(e){"use strict";typeof define=="function"&&define.amd?define("thirdparty/jquery/fileupload/jquery.fileupload",["jquery","jquery-ui"],e):e(window.jQuery)}(function(e){"use strict";e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))")).test(window.navigator.userAgent)&&!e('<input type="file">').prop("disabled"),e.support.xhrFileUpload=!!window.ProgressEvent&&!!window.FileReader,e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n)this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e;return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return e.type(t.formData)==="function"?t.formData(t.form):e.isArray(t.formData)?t.formData:e.type(t.formData)==="object"?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),i;if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=r,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,n._onProgress(e,t)}),t.xhr=function(){return r})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n=this,r,i=t.files[0],s=t.multipart||!e.support.xhrFileUpload,o=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange);if(!s||t.blob||!this._isInstanceOf("File",i))t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(i.name)+'"';s?e.support.xhrFormDataFileUpload&&(t.postMessage?(r=this._getFormData(t),t.blob?r.push({name:o,value:t.blob}):e.each(t.files,function(n,i){r.push({name:e.type(t.paramName)==="array"&&t.paramName[n]||o,value:i})})):(n._isInstanceOf("FormData",t.formData)?r=t.formData:(r=new FormData,e.each(this._getFormData(t),function(e,t){r.append(t.name,t.value)})),t.blob?r.append(o,t.blob,i.name):e.each(t.files,function(i,s){(n._isInstanceOf("File",s)||n._isInstanceOf("Blob",s))&&r.append(e.type(t.paramName)==="array"&&t.paramName[i]||o,s,s.uploadName||s.name)})),t.data=r):(t.contentType=i.type||"application/octet-stream",t.data=t.blob||i),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i)r.push(n),i-=1}),r.length||(r=[n.prop("name")||"files[]"])),r},_initFormSettings:function(t){if(!t.form||!t.form.length)t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")));t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase(),t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();return n=n||this.options.context||s,t===!0?i.resolveWith(n,r):t===!1&&i.rejectWith(n,r),s.abort=i.promise,this._enhancePromise(s)},_addConvenienceMethods:function(t,n){var r=this,i=function(t){return e.Deferred().resolveWith(r,t).promise()};n.process=function(t,s){if(t||s)n._processQueue=this._processQueue=(this._processQueue||i([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(r,[n]).promise():i(arguments)}).pipe(t,s);return this._processQueue||i([this])},n.submit=function(){return this.state()!=="pending"&&(n.jqXHR=this.jqXHR=r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))},n.state=function(){if(this.jqXHR)return r._getDeferredState(this.jqXHR);if(this._processQueue)return r._getDeferredState(this._processQueue)},n.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes,u=t.maxChunkSize||s,a=this._blobSlice,f=e.Deferred(),l=f.promise(),c,h;return!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data?!1:n?!0:o>=s?(i.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",i.error])):(h=function(){var n=e.extend({},t),l=n._progress.loaded;n.blob=a.call(i,o,o+u,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+s,r._initXHRData(n),r._initProgressListener(n),c=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,u,a){o=r._getUploadedBytes(a)||o+n.chunkSize,l+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=o,n.result=i,n.textStatus=u,n.jqXHR=a,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),o<s?h():f.resolveWith(n.context,[i,u,a])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),f.rejectWith(n.context,[e,t,i])})},this._enhancePromise(l),l.abort=function(){return c.abort()},h(),l)},_beforeSend:function(e,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,r,i){var s=i._progress.total,o=i._response;i._progress.loaded<s&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:s,total:s}),i),o.result=i.result=t,o.textStatus=i.textStatus=n,o.jqXHR=i.jqXHR=r,this._trigger("done",null,i)},_onFail:function(e,t,n,r){var i=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),i.jqXHR=r.jqXHR=e,i.textStatus=r.textStatus=t,i.errorThrown=r.errorThrown=n,this._trigger("fail",null,r)},_onAlways:function(e,t,n,r){this._trigger("always",null,r)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var r=this,i,s,o,u,a=r._getAJAXSettings(n),f=function(){return r._sending+=1,a._bitrateTimer=new r._BitrateTimer,i=i||((s||r._trigger("send",e.Event("send",{delegatedEvent:t}),a)===!1)&&r._getXHRPromise(!1,a.context,s)||r._chunkedUpload(a)||e.ajax(a)).done(function(e,t,n){r._onDone(e,t,n,a)}).fail(function(e,t,n){r._onFail(e,t,n,a)}).always(function(e,t,n){r._onAlways(e,t,n,a),r._sending-=1,r._active-=1;if(a.limitConcurrentUploads&&a.limitConcurrentUploads>r._sending){var i=r._slots.shift();while(i){if(r._getDeferredState(i)==="pending"){i.resolve();break}i=r._slots.shift()}}r._active===0&&r._trigger("stop")}),i};return this._beforeSend(t,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),u=o.pipe(f)):(this._sequence=this._sequence.pipe(f,f),u=this._sequence),u.abort=function(){return s=[undefined,"abort","abort"],i?i.abort():(o&&o.rejectWith(a.context,s),f())},this._enhancePromise(u)):f()},_onAdd:function(t,n){var r=this,i=!0,s=e.extend({},this.options,n),o=n.files,u=o.length,a=s.limitMultiFileUploads,f=s.limitMultiFileUploadSize,l=s.limitMultiFileUploadSizeOverhead,c=0,h=this._getParamName(s),p,d,v,m,g=0;f&&(!u||o[0].size===undefined)&&(f=undefined);if(!(s.singleFileUploads||a||f)||!this._isXHRUpload(s))v=[o],p=[h];else if(!s.singleFileUploads&&!f&&a){v=[],p=[];for(m=0;m<u;m+=a)v.push(o.slice(m,m+a)),d=h.slice(m,m+a),d.length||(d=h),p.push(d)}else if(!s.singleFileUploads&&f){v=[],p=[];for(m=0;m<u;m+=1){c+=o[m].size+l;if(m+1===u||c+o[m+1].size+l>f||a&&m+1-g>=a)v.push(o.slice(g,m+1)),d=h.slice(g,m+1),d.length||(d=h),p.push(d),g=m+1,c=0}}else p=h;return n.originalFiles=o,e.each(v||o,function(s,o){var u=e.extend({},n);return u.files=v?o:[o],u.paramName=p[s],r._initResponseObject(u),r._initProgressObject(u),r._addConvenienceMethods(t,u),i=r._trigger("add",e.Event("add",{delegatedEvent:t}),u),i}),i},_replaceFileInput:function(t){var n=t.clone(!0);e("<form></form>").append(n)[0].reset(),t.after(n).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,r){return r===t[0]?n[0]:r}),t[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),i.resolve([e])},o;return n=n||"",t.isFile?t._file?(t._file.relativePath=n,i.resolve(t._file)):t.file(function(e){e.relativePath=n,i.resolve(e)},s):t.isDirectory?(o=t.createReader(),o.readEntries(function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},s)):i.resolve([]),i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length)return this._handleFileTreeEntries(n);r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i)return e.Deferred().resolve([]).promise();r=[{name:i.replace(/^.*\\/,"")}]}else r[0].name===undefined&&r[0].fileName&&e.each(r,function(e,t){t.name=t.fileName,t.size=t.fileSize});return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){return t instanceof e&&t.length!==1?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(i){r.files=i,n.options.replaceFileInput&&n._replaceFileInput(r.fileInput),n._trigger("change",e.Event("change",{delegatedEvent:t}),r)!==!1&&n._onAdd(t,r)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&r.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,r=t.dataTransfer,i={};r&&r.files&&r.files.length&&(t.preventDefault(),this._getDroppedFiles(r).always(function(r){i.files=r,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)}))},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=t.dataTransfer;n&&e.inArray("Files",n.types)!==-1&&this._trigger("dragover",e.Event("dragover",{delegatedEvent:t}))!==!1&&(t.preventDefault(),n.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var r=e.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers(),this._super(t,n),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return t!=="url"&&e.type(n)==="string"&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options;e.each(e(this.element[0].cloneNode(!1)).data(),function(e,r){t._isRegExpOption(e,r)&&(r=t._getRegExp(r)),n[e]=r})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;if(!t||this.options.disabled)return;t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;return i.abort=function(){return o=!0,s?s.abort():(r.reject(null,"abort","abort"),i)},this._getFileInputFiles(t.fileInput).always(function(e){if(o)return;if(!e.length){r.reject();return}t.files=e,s=n._onSend(null,t).then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}),this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";typeof define=="function"&&define.amd?define("thirdparty/jquery/fileupload/jquery.iframe-transport",["jquery"],e):e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var r=n.initialIframeSrc||"javascript:false;",i,s,o;return{send:function(u,a){i=e('<form style="display:none;"></form>'),i.attr("accept-charset",n.formAcceptCharset),o=/\?/.test(n.url)?"&":"?",n.type==="DELETE"?(n.url=n.url+o+"_method=DELETE",n.type="POST"):n.type==="PUT"?(n.url=n.url+o+"_method=PUT",n.type="POST"):n.type==="PATCH"&&(n.url=n.url+o+"_method=PATCH",n.type="POST"),t+=1,s=e('<iframe src="'+r+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(n.paramName)?n.paramName:[n.paramName];s.unbind("load").bind("load",function(){var t;try{t=s.contents();if(!t.length||!t[0].firstChild)throw new Error}catch(n){t=undefined}a(200,"success",{iframe:t}),e('<iframe src="'+r+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",s.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&n.type==="POST"&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",o[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),i.submit(),t&&t.length&&n.fileInput.each(function(n,r){var i=e(t[n]);e(r).prop("name",i.prop("name")).attr("form",i.attr("form")),i.replaceWith(r)})}),i.append(s).appendTo(document.body)},abort:function(){s&&s.unbind("load").prop("src",r),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),define("dashboard/module/imageupload",["jquery","underscore","tictail/core","tictail/component/xsrf","../view","i18n!../nls/modules","jquery-ui","thirdparty/jquery/fileupload/jquery.fileupload","thirdparty/jquery/fileupload/jquery.iframe-transport"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.Module=o.Dashboard.Module||{};var u=[30,40,45,50,75,100,300,500,1e3,2e3],a=o.Dashboard.Module.ImageUpload=i.extend({tagName:"form",attributes:{"class":"imageupload",method:"POST",enctype:"multipart/form-data",action:""},initialize:function(e){a.__super__.initialize.call(this,e),e=this.options=t.extend({imageCollectionClass:n.Collection,imageModelClass:n.Model,enableMultipleUploads:!1,enableDropZone:!1,sortable:!1,thumbnailWidth:100,thumbnailHeight:null},e);if(t.isUndefined(e.url)!==!1)throw new Error("Cannot initialize imageupload module since no URL was given");if(t.isUndefined(e.type)!==!1)throw new Error("Cannot initialize imageupload module since no store image type was given");e.sortable&&!e.enableMultipleUploads&&(e.sortable=!1),e.images&&(this.images=e.images),this.images||(this.images=new e.imageCollectionClass),this._uploadsInProgress=0,this.$el.submit(function(e){e.preventDefault()})},didAppend:function(){this.dragDropIsSupported()&&this.options.enableDropZone&&this.addDragDropEventListeners()},willRemove:function(){this.removeDragDropEventListeners()},getSelectButton:function(){var t=this;return n.getLazy(this,"selectButton",function(){var n=t.options.buttonLabel;return n||(n=s.imageupload.button[t.options.enableMultipleUploads?"multiple":"single"]),e(t.make("button",{"class":"select-button"},n))})},getHelpText:function(){var t=this;return n.getLazy(this,"helpText",function(){var n=t.options.helpText;n||(n=s.imageupload.help_text[t.options.enableMultipleUploads?"multiple":"single"]);if(!n)return null;var r=window.navigator.platform.indexOf("Mac")!==-1;return n=n.replace("{key}",r?"Cmd":"Ctrl"),e(t.make("div",{"class":"help-text"},n))})},getDropZone:function(){var t=this;return n.getLazy(this,"dropZone",function(){if(!t.options.enableDropZone)return null;var n=t.options.dropZoneLabel;if(!n){var r=t.options.enableMultipleUploads?"multiple":"single";t.dragDropIsSupported()?n=s.imageupload.drop_zone.drop_label[r]:n=s.imageupload.drop_zone.label[r]}return e('<div class="drop-zone imprint"/>').css("min-height",t._getThumbnailSize()).append(e('<div class="drop-zone-label"/>').text(n))})},getFilesContainer:function(){var t=this;return n.getLazy(this,"filesContainer",function(){return e(t.make("ul",{"class":"files clear"}))})},render:function(){var t=this,n,r,i=this.getSelectButton(),s=this.getDropZone(),o=this.getFilesContainer();return n=e('<input type="file" name="images" accept="image/*" class="file-input"/>').attr("tabindex",t.tabIndex).attr("multiple",!!t.options.enableMultipleUploads),r=e('<div class="select-button-wrap"/>').mouseenter(function(){i.addClass("hover")}).mouseleave(function(){i.removeClass("hover active")}).mousedown(function(){i.addClass("active")}).mouseup(function(){i.removeClass("active")}).append(i).append(n),this.$el.toggleClass("single-upload",!this.options.enableMultipleUploads).append(this.getHelpText()).append(r),s?s.append(o).appendTo(this.$el):this.$el.append(o),this.images.length!==0&&(this.$el.addClass("has-images"),this.images.each(function(e){var n=t._createFileNode(null,!1);t._displayThumbnail(n,e,null,!1),n.appendTo(o)})),this.attachEventListeners(),this.options.sortable&&this.setupSortable(),this.didRender()},attachEventListeners:function(){var e={url:this.options.url,dataType:"json"};this.$el.fileupload(e).bind("fileuploadsubmit",t.bind(this.onSubmit,this)).bind("fileuploadsend",t.bind(this.onSend,this)).bind("fileuploaddone",t.bind(this.onDone,this)).bind("fileuploadfail",t.bind(this.onFail,this)).bind("fileuploadalways",t.bind(this.onComplete,this))},addDragDropEventListeners:function(){e(document).bind("dragenter",this,this.onDragEnter).bind("dragover",this,this.onDragOver).bind("dragleave",this,this.onDragLeave).bind("drop",this,this.onDrop)},removeDragDropEventListeners:function(){e(document).unbind("dragenter",this.onDragEnter).unbind("dragover",this.onDragOver).unbind("dragleave",this.onDragLeave).unbind("drop",this.onDrop)},setupSortable:function(){var t=this,n=this.getFilesContainer();n.sortable({containment:this.$el,items:".draggable",cursor:"",tolerance:"pointer",placeholder:"file sort-placeholder",revert:75,start:function(n,r){var i=t._getThumbnailSize();r.placeholder.css({width:i,height:i}),r.helper.addClass("dragging"),e("body").addClass("dragging")},beforeStop:function(e,t){t.helper.removeClass("dragging")},stop:function(n,r){e("body").removeClass("dragging"),t.updatePosition(r.item)}})},updatePosition:function(e){var t=e.data("imageCid"),n=this.images.getByCid(t),r=e.index();n&&(this.images.remove(n),this.images.add(n,{at:r}),this.trigger("onImageMove",n,r))},_getThumbnailSize:function(){var e=this.options;return Math.max(e.thumbnailWidth||0,e.thumbnailHeight||0)},_getNearestThumbnailSize:function(e){var t=u.length;for(var n=t-1;n>=0;n--)if(u[n]<e)break;return n+1<t?u[n+1]:u[t-1]},_createFileNode:function(t,n){var r=this._getThumbnailSize(),i=e('<li class="file"/>').css({width:r,height:r}).data("file",t);return n!==!1&&i.spin({top:"",left:""}),i},_getFileNode:function(t){var n=e();return this.$(".file").each(function(r,i){var s=e(i);s.data("file")===t&&(n=n.add(s))}),n},_displayThumbnail:function(t,n,r,i){var s=this;t.removeClass("loading").find(".spinner").remove().end().data("imageCid",n.cid).toggleClass("draggable",this.options.sortable),e('<div class="ui remove"/>').click(function(){s._removeFileNode(t),n&&(s.images.remove(n),s.trigger("onImageRemove",n))}).appendTo(t);var o=null;r&&(o=r.src);if(!o&&n){var u=n.get("sizes"),a=this._getNearestThumbnailSize(this._getThumbnailSize()).toString();u&&u[a]&&(o=u[a])}if(!o)return;var f=e('<span class="thumbnail"/>').css("background-image","url("+o+")").appendTo(t);i!==!1&&f.hide().fadeIn(150)},_removeFileNode:function(e){e.remove(),this.getFilesContainer().children().length===0&&this.$el.removeClass("has-images")},_removeAllImages:function(e){var t=this;this.getFilesContainer().empty(),this.$el.removeClass("has-images"),e!==!0&&this.images.each(function(e){t.trigger("onImageRemove",e)}),this.images.reset()},getUploadsInProgress:function(){return this._uploadsInProgress},_updateUploadsInProgress:function(e){this._uploadsInProgress+=e;var t=this._uploadsInProgress>0;this.$el.toggleClass("loading",t),this.options.sortable&&this.getFilesContainer().sortable(t?"disable":"enable")},dragDropIsSupported:function(){return this._dragDropIsSupported===undefined&&(this._dragDropIsSupported="draggable"in document.createElement("span")),this._dragDropIsSupported},containsFiles:function(e){if(!e)return!1;var t=e.types;if(!t)return!1;for(var n=t.length-1;n>=0;n--)if(t[n]==="Files")return!0;return!1},ensureFileTransfer:function(e){var t=e.originalEvent.dataTransfer;return this.containsFiles(t)?!0:(e.preventDefault(),t&&(t.dropEffect="none"),!1)},onDragEnter:function(t){var n=t.data,r=e("#image-drop-zone"),i=n.options.dropZoneLabel;i||(i=s.imageupload.drop_zone.label[n.options.enableMultipleUploads?"multiple":"single"]);if(!n.ensureFileTransfer(t))return;if(r.length!==0){e(t.target).parents().index(r)!==-1&&(n._dragOverChildOfDropZone=!0);return}e('<div id="image-drop-zone"/>').append(e('<div class="label"/>').text("Drop it like it's hot!")).hide().fadeIn(150).appendTo(e("body"))},onDragOver:function(e){var t=e.data;t.ensureFileTransfer(e)},onDragLeave:function(t){var n=t.data;if(n._dragOverChildOfDropZone){delete n._dragOverChildOfDropZone;return}e(t.target).is("#image-drop-zone")&&e("#image-drop-zone").remove()},onDrop:function(t){var n=t.data;n.ensureFileTransfer(t),e("#image-drop-zone").remove()},onSubmit:function(e,t){var n=this.options;t.formData={_xsrf:r.get(),type:n.type},n.thumbnailWidth&&(t.formData.thumbnail_width=this._getNearestThumbnailSize(n.thumbnailWidth)),n.thumbnailHeight&&(t.formData.thumbnail_height=this._getNearestThumbnailSize(n.thumbnailHeight)),this.trigger("onSubmit",t)},onSend:function(t,n){var r=this;e.each(n.files,function(e,t){r.options.enableMultipleUploads||r._removeAllImages(!0),r._createFileNode(t).appendTo(r.getFilesContainer()),r.$el.addClass("has-images")}),this._updateUploadsInProgress(1),this.trigger("onStart",n)},onDone:function(n,r){var i=this,s=this.options;e.each(r.files,function(n,o){var u=r.result[n],a=u.thumbnail;e.isFunction(s.prepareImageDataCallback)&&(u=s.prepareImageDataCallback(u));var f=new s.imageModelClass(u);t.isUndefined(f.get("filename"))===!1?(i._displayThumbnail(i._getFileNode(o),f,a),i.images.add(f),i.trigger("onImageAdd",f)):(alert("There was an error uploading your image. Please try again."),i._removeFileNode(i._getFileNode(o)))}),this.trigger("onDone",r)},onFail:function(n,r){var i=this;e.each(r.files,function(e,t){i._removeFileNode(i._getFileNode(t))});var s={"-1":"Sorry, we don't support this image format!","-2":"The width or height of this image is too large","-3":"The width or height of this image is too small","-4":"The image ratio is too big, try cropping it!"},o=JSON.parse(r.jqXHR.responseText),u=s[o[0].code];t.isUndefined(u)===!0&&(u="Unknown error, please try again later!"),alert("There was an error uploading your image: "+u),this.trigger("onFail",r)},onComplete:function(e,t){this._updateUploadsInProgress(-1),this.trigger("onComplete",t)}});return a}),define("dashboard/form/field/product/images",["underscore","tictail/core","tictail/form/field/input","tictail/collection/store/product/image","tictail/model/store/product/image","../../../module/imageupload"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.Form=o.Dashboard.Form||{},o.Dashboard.Form.Field=o.Dashboard.Form.Field={},o.Dashboard.Form.Field.Product=o.Dashboard.Form.Field.Product||{};var u=o.Dashboard.Form.Field.Product.Images=n.extend({fieldTagName:"div",attributes:{"class":"field full-width"},initialize:function(){u.__super__.initialize.apply(this,arguments),this._pendingDeferreds=[]},getValueFromModel:function(){return this.model.images},setValueOnModel:function(e){this.model.images=e},getLabel:function(){return null},renderField:function(){this.addChildView(this._getImageUploader())},_getFieldNode:function(){return null},_getFieldValue:function(){return this._getImageUploader().images},_validateRemote:function(e,t){this._getImageUploader().getUploadsInProgress()>0?this._pendingDeferreds.push(t):t.resolve(this)},_getImageUploader:function(){var n=this;return t.getLazy(this,"_imageUploader",function(){var o=t.session.getCurrentStore().get("id"),u=new s({url:"/media/upload/product/"+o,type:"product",enableMultipleUploads:!0,enableDropZone:!0,sortable:!0,thumbnailWidth:96,imageCollectionClass:r,imageModelClass:i,images:n.getValueFromModel(),prepareImageDataCallback:e.bind(n.onPrepareImageData,n)});return u.tabIndex=n.tabIndex,u.on("onDone",n.onUploadDone,n),u.on("onComplete",n.onUploadComplete,n),u.on("onImageRemove",n.onImageRemove,n),u})},onPrepareImageData:function(e){return{filename:e.filename,extension:e.extension,width:e.width,height:e.height}},onUploadDone:function(e){this.onChange()},onUploadComplete:function(e){if(this._getImageUploader().getUploadsInProgress()>0)return;var t=this._pendingDeferreds;if(t.length!==0){for(var n=t.length-1;n>=0;n--)t[n].resolve(this);t.length=0}},onImageRemove:function(e){this.onChange()}});return u}),define("tictail/form/field/collection",["jquery","underscore","./core"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Form=r.TT.Form||{},r.TT.Form.Field=r.TT.Form.Field||{};var i=r.TT.Form.Field.Collection=n.extend({initModelRelationship:function(e){i.__super__.initModelRelationship.call(this,e),this._subfields=[],this.initSubfields()},shouldRenderItem:function(e){return!0},createSubfield:function(e,t){return null},initSubfields:function(){var e=this;this.value&&this.value.each(function(n,r){if(!e.shouldRenderItem(n))return;var i=e.createSubfield(n,r);t.has(i,"tabIndex")||(i.tabIndex=e.tabIndex),e._subfields.push(i)})},addModelListeners:function(){this.modelAttributeName&&this.model.on("change:"+this.modelAttributeName,this.onModelAttributeChange,this),this.value&&(this.value.on("add",this.onCollectionItemAdd,this),this.value.on("remove",this.onCollectionItemRemove,this),this.value.on("reset",this.onCollectionReset,this))},removeModelListeners:function(){this.modelAttributeName&&this.model.off("change:"+this.modelAttributeName,this.onModelAttributeChange,this),this.value&&(this.value.off("add",this.onCollectionItemAdd,this),this.value.off("remove",this.onCollectionItemRemove,this),this.value.off("reset",this.onCollectionReset,this))},onModelAttributeChange:function(){var e=this.getValueFromModel();this.valueHasChanged(e)&&(this.removeAllSubfields(),this.removeModelListeners(),this.value=e,this.initSubfields(),this.renderSubfields(),this.addModelListeners())},onCollectionItemAdd:function(e,t,n){if(!this.shouldRenderItem(e))return;this.addSubfield(e,n.index)},onCollectionItemRemove:function(e,t,n){this.removeSubfield(this.getSubfieldByModel(e))},onCollectionReset:function(){this.removeAllSubfields(),this.initSubfields(),this.renderSubfields()},getSubfields:function(){return this._subfields},getSubfieldByModel:function(e){for(var t=this._subfields.length-1;t>=0;t--)if(this._subfields[t].model===e)return this._subfields[t];return null},addSubfield:function(e,n){var r=this.createSubfield(e,n),i=this.getSubfieldsContainerNode(),s=n!==undefined?i.children().eq(n):null;t.has(r,"tabIndex")||(r.tabIndex=this.tabIndex),this._subfields.splice(n!==undefined?n:this._subfields.length,0,r),this.addChildView(r,null),s&&s.length!==0?r.insertBefore(s):r.appendTo(i),this.$el.removeClass("empty")},removeSubfield:function(e){if(!e)return;var n=t.indexOf(this._subfields,e);if(n===-1)return;this.removeChildView(e),this._subfields.splice(n,1),this._subfields.length===0&&this.$el.addClass("empty")},removeAllSubfields:function(){for(var e=this._subfields.length-1;e>=0;e--)this.removeChildView(this._subfields[e]);this._subfields.length=0,this.$el.addClass("empty")},validate:function(n){var r,i=[],s;return t.each(this._subfields,function(e){r=e.validate(n),i.push(r)}),s=e.when.apply(e,i),s},getSubfieldsContainerNode:function(){return this.$el},setFocus:function(){var e=this._subfields[0];e&&e.setFocus()},renderField:function(){this.renderSubfields()},renderSubfields:function(){var e=0;t.isUndefined(this._subfields)!==!0&&(e=this._subfields.length);for(var n=0;n<e;n++)this.addChildView(this._subfields[n],this.getSubfieldsContainerNode());this.$el.toggleClass("empty",e===0)}});return i}),define("tictail/form/field/signallight",["jquery","./input"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{},n.TT.Form.Field=n.TT.Form.Field||{};var r=n.TT.Form.Field.SignalLight=t.extend({attributes:{"class":"field signal-light-field"},fieldTagName:"input",fieldAttributes:{type:"checkbox","class":"ui checkbox"},_sanitize:function(e){return!!e},_getFieldValue:function(){return this._getFieldNode().prop("checked")},_setFieldValue:function(e){this._getFieldNode().prop("checked",!!e).change()},renderField:function(){e('<label class="ui signal-light"/>').append(this._getFieldNode()).append(this.options.checkboxLabel||"").appendTo(this.$el)}});return r}),define("dashboard/form/field/product/variation",["jquery","tictail/core","tictail/form/field/number","tictail/form/field/compound","tictail/form/field/text","tictail/form/field/signallight"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.Form=o.Dashboard.Form||{},o.Dashboard.Form.Field=o.Dashboard.Form.Field={},o.Dashboard.Form.Field.Product=o.Dashboard.Form.Field.Product||{};var u=o.Dashboard.Form.Field.Product.Variation=n.extend({onModelAttributeChange:function(){var e=this._getFieldNode(),t=!1;if(e){var n=e.prop("disabled"),r=this.getValueFromModel(),i=r===undefined||r===null;!n&&i&&(t=!0)}u.__super__.onModelAttributeChange.apply(this,arguments),t&&this.trigger("onChange")},onFocus:function(){u.__super__.onFocus.apply(this,arguments),this.model.isUnlimited()&&(this.model.setUnlimited(!1),parseInt(this._getFieldValue(),10)===0&&this._setFieldValue(""))},onBlur:function(){u.__super__.onBlur.apply(this,arguments),this._getFieldValue()===""&&this.model.setUnlimited(!0)}}),a=r.extend({attributes:{"class":"field full-width bottom-gap product-variation-field"},initialize:function(){a.__super__.initialize.apply(this,arguments),this.collection=this.options.collection;if(!this.collection)throw new Error("ProductVariationField must be given a collection")},getLabelField:function(){var e=this;return t.getLazy(this,"_labelField",function(){var t=new i({key:"set-label-"+e.model.cid,model:{instance:e.model,attribute:"label"},attributes:{"class":"field variation-label-field"},fieldAttributes:{placeholder:e.options.labelPlaceholder},required:!0,maxLength:255,validateOnSet:!1});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0})}),e.registerSubfield(t),t})},getQuantityField:function(){var e=this;return t.getLazy(this,"_quantityField",function(){var t=new u({key:"set-quantity-"+e.model.cid,model:{instance:e.model,attribute:"quantity"},attributes:{"class":"field number-field variation-quantity-field"},minValue:0,maxValue:32767,stepSize:1,validateOnSet:!1});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0})}),e.registerSubfield(t),t})},getUnlimitedField:function(){var e=this;return t.getLazy(this,"_unlimitedField",function(){var t=new s({key:"set-unlimited-"+e.model.cid,model:{instance:e.model,attribute:"unlimited",getter:"isUnlimited",setter:"setUnlimited"},attributes:{"class":"field signal-light-field variation-unlimited-field"},checkboxLabel:e.options.unlimitedLabel});return e.registerSubfield(t),t})},validate:function(e){e=e||{};var t=this,n=!1;e.outputError!==!1&&(e=_.clone(e),e.outputError=!1,n=!0),this.unsetError(),this.getLabelField().required=this.collection.length>1;var r=a.__super__.validate.call(this,e);return n&&r.fail(function(e,n){n.setError([]),t.setError(e)}),r},renderField:function(){var t=this,n=e('<div class="imprint"/>').appendTo(this.$el);e('<div class="ui remove"/>').click(function(){t.collection.length>1&&t.collection.remove(t.model)}).appendTo(n),e('<div class="drag-handle draggable"/>').appendTo(n),this.addChildView(this.getLabelField(),n),this.addChildView(this.getQuantityField(),n),this.addChildView(this.getUnlimitedField(),n)}});return a}),define("dashboard/form/field/product/variations",["jquery","tictail/form/field/collection","tictail/model/store/product/variation","./variation"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Form=i.Dashboard.Form||{},i.Dashboard.Form.Field=i.Dashboard.Form.Field={},i.Dashboard.Form.Field.Product=i.Dashboard.Form.Field.Product||{};var s=i.Dashboard.Form.Field.Product.Variations=t.extend({attributes:{"class":"field full-width product-variations-field"},events:function(){var e={};return e["click .add-variation"]="onClickAddVariation",e},updateSingleVariation:function(){var e=this._subfields.length===1;this.$el.toggleClass("single-variation",e),this._subfieldsContainerNode.sortable(e?"disable":"enable")},createSubfield:function(e,t){var n=new r({key:"set-variation-"+e.cid,model:{instance:e},collection:this.value,labelPlaceholder:this.options.labelPlaceholder+(t+1),unlimitedLabel:this.options.unlimitedLabel});return n.$el.data("variationCid",e.cid),n},onCollectionItemAdd:function(e,t,n){this._isOurCollectionEvent||s.__super__.onCollectionItemAdd.apply(this,arguments)},onCollectionItemRemove:function(e,t,n){this._isOurCollectionEvent||s.__super__.onCollectionItemRemove.apply(this,arguments)},addSubfield:function(e,t){s.__super__.addSubfield.apply(this,arguments),this.updateSingleVariation()},removeSubfield:function(e){s.__super__.removeSubfield.apply(this,arguments),this.updateSingleVariation()},removeAllSubfields:function(){s.__super__.removeAllSubfields.apply(this,arguments),this.updateSingleVariation()},getLabel:function(){var t=this.options;if(!t.label)return null;var n=e('<label class="variation-label"/>').text(t.label);return t.quantityLabel&&(n=n.add(e('<label class="quantity-label"/>').text(t.quantityLabel))),n},getAddLink:function(){var t=this.options;if(!t.addLinkText)return null;var n=e('<a href="#" class="add-variation action-link manual"/>').text(t.addLinkText);return t.addLinkHelpText&&(n=n.add(e('<span class="add-variation-help"/>').text(t.addLinkHelpText))),n},getSubfieldsContainerNode:function(){return this._subfieldsContainerNode},renderField:function(){this._subfieldsContainerNode=e('<div class="variations bottom-gap"/>').appendTo(this.$el),s.__super__.renderField.apply(this,arguments),this.$el.append(this.getAddLink())},renderSubfields:function(){s.__super__.renderSubfields.apply(this,arguments);var t=this,n=this._subfields.length===1;this.$el.toggleClass("single-variation",n),this._subfieldsContainerNode.sortable({handle:".drag-handle",containment:this.$el,axis:"y",cursor:"",tolerance:"pointer",placeholder:"sort-placeholder",revert:75,disabled:n,start:function(n,r){e("body").addClass("dragging"),t.$(".errors").hide(),r.helper.css("height","")},stop:function(n,r){e("body").removeClass("dragging"),t.$(".errors").show(),t.updatePosition(r.item)}})},updatePosition:function(e){var t=e.data("variationCid"),n=this.value.getByCid(t),r=e.index();n&&(this._isOurCollectionEvent=!0,this.value.remove(n),this.value.add(n,{at:r}),delete this._isOurCollectionEvent)},onClickAddVariation:function(e){e.preventDefault();var t=new n({unlimited:!0});this.value.add(t),this._subfields[this._subfields.length-1].setFocus()}});return s}),define("dashboard/module/productnavigation",["jquery","underscore","tictail/core","tictail/utility","tictail/component/log","tictail/component/api","tictail/model/store/navigation","../view","../templates"],function(e,t,n,r,i,s,o,u){var a=this;a.Dashboard=a.Dashboard||{},a.Dashboard.Module=a.Dashboard.Module||{};var f=a.Dashboard.Module.ProductNavigation=u.extend({id:"product-navigation-view",template:"module/productnavigation/base",initialize:function(e){var t=this;f.__super__.initialize.call(this,e),this._childColumn=ich["module/productnavigation/childcolumn"](),this.product=e.product;if(!this.product)throw new Error("Cannot initiate product navigation since no product was given");this.requiresLoading=!1,e.collection?this.collection=e.collection:(this.collection=this.getCurrentStore().getInitiatedForeignAttribute("navigation"),this.collection.isEmpty()&&(this.requiresLoading=!0,this.collection.fetch({success:function(){t.overlay()},error:function(){}})))},didRender:function(){return this._rootColumn=this.$(".root-column"),e('<div class="translucent-header"/>').append(this.getHelperText()).hide().delay(800).fadeIn(400).appendTo(this.$el),this},getHelperText:function(){var e=this.product.get("title")||"your product";return"Select where in your store's menu that you want your customers to find \""+e+'".'},renderError:function(t){var n=e(".translucent-header");n.text(t).addClass("error"),r.shake(n)},resetError:function(){e(".translucent-header").text(this.getHelperText()).removeClass("error")},didAppend:function(){this.populateColumn(0,this._rootColumn),this.initColumn(0,this._rootColumn),this.collection.on("add",this._itemAdded,this).on("remove",this._itemRemoved,this).on("change",this._itemChanged,this),this.product.on("change:navigation_ids",this._navigationIdsChanged,this)},willRemove:function(){this.collection.off("add",this._itemAdded,this).off("remove",this._itemRemoved,this).off("change",this._itemChanged,this),this.product.off("change:navigation_ids",this._navigationIdsChanged,this)},overlay:function(e){e=t.extend({requiresLoading:this.requiresLoading},e),f.__super__.overlay.call(this,e)},getDragHandle:function(){return n.getLazy(this,"_dragHandle",function(){return e('<span class="drag-handle draggable"/>')})},getItemTools:function(){var t=this;return n.getLazy(this,"_itemTools",function(){var n=ich["module/productnavigation/itemtools"]();return e(".button",n).click(function(){t.toggleItemToolsMenu()}),e("li.rename",n).click(function(){t.toggleItemToolsMenu(!1),t.beginRenameItem(n.parent())}),e("li.delete",n).click(function(){t.toggleItemToolsMenu(!1),t.deleteItem(n.parent())}),n})},getColumnNode:function(e){return this.$(e?".nav-column.item-"+e:".root-column")},populateColumn:function(n,r){var i=this,s=e("ul",r).empty(),o=this.collection.getChildrenForItem(n);t.each(o,function(e){s.append(i.createItemNode(e))})},initColumn:function(t,n){var r=this;n.data("itemId",t),e("ul",n).sortable({axis:"y",items:".item",cursor:"",opacity:.9,revert:75,tolerance:"pointer",containment:"parent",placeholder:"sort-placeholder",handle:this.getDragHandle(),start:function(){r.$el.addClass("dragging"),r.toggleItemToolsMenu(!1),e("body").addClass("dragging"),r.getDragHandle().addClass("dragging")},stop:function(i,s){r.getDragHandle().removeClass("dragging"),e("body").removeClass("dragging"),r.$el.removeClass("dragging"),r.resetHoveredItem(),s.item.css("z-index",""),r.syncPositions(t,n)}}),e(".add-new a",n).click(function(e){e.preventDefault(),r.beginAddNewItem(n)})},showChildColumnForItem:function(t){var n=this,r=t.get("id"),i=this._childColumn.clone().addClass("item-"+r),s;this.hideChildColumn(),e(".parent-item-label",i).text(t.get("label")),this.populateColumn(r,i),i.appendTo(this.$el),s=i.css("left"),i.css("left",this._rootColumn.css("left")).animate({left:s},300),this.initColumn(r,i)},hideChildColumn:function(){this.toggleItemToolsMenu(!1),this.$(".child-column").remove()},getItem:function(e){return this.collection.get(e)},createItemNode:function(n){var r=this,i=n.get("id"),s=n.get("parent_id"),o=!s,u=ich["module/productnavigation/menuitem"](t.extend({is_root:o},n.attributes)).data("itemId",i);return e("input[type=checkbox]",u).prop("checked",this.product.isInNavigationItem(i)).change(function(){var n=[i],u;e(this).prop("checked")?(s&&n.unshift(s),r.product.addToNavigationItems(n)):(o&&(u=r.collection.getChildrenForItem(i),u=t.pluck(u,"id"),u.length!==0&&(n=t.union(n,u))),r.product.removeFromNavigationItems(n))}),o&&u.click(function(t){var i=e(t.target);if(!i.is(u)&&!i.hasClass("arrow"))return;r.selectItem(n)}),u.mouseenter(function(){r._hoveredItem=u;if(r.$el.hasClass("dragging")||r.$el.hasClass("editing")||r.getItemTools().hasClass("open"))return;r.setItemHovered(r._hoveredItem,!0)}).mouseleave(function(){r._hoveredItem=null;if(r.$el.hasClass("dragging")||r.$el.hasClass("editing")||r.getItemTools().hasClass("open"))return;r.setItemHovered(u,!1)}),this.prepareContent(u),u},getItemNode:function(e){return this.$("li.item-"+e)},selectItem:function(e){var t=this.getItemNode(e.get("id"));t.length&&!t.hasClass("selected")&&(t.siblings(".item.selected").removeClass("selected"),t.addClass("selected"),this.showChildColumnForItem(e))},setItemHovered:function(e,t){t?(e.addClass("hover"),this.getDragHandle().appendTo(e),this.getItemTools().appendTo(e)):(e.removeClass("hover"),this.getDragHandle().detach(),this.getItemTools().detach())},resetHoveredItem:function(){var e=this.getItemTools();e.parent().is(this._hoveredItem)||(this.setItemHovered(e.parent(),!1),this._hoveredItem&&this.setItemHovered(this._hoveredItem,!0))},ensureItemIsVisible:function(e){var t=e.parents(".scroll-area").eq(0),n=t.offset(),r=t.height(),i=e.offset(),s=e.outerHeight();n.top>i.top?t.scrollTop(i.top-n.top+t.scrollTop()):n.top+r<i.top+s&&t.scrollTop(i.top+s-(n.top+r)+t.scrollTop())},toggleItemToolsMenu:function(t){var n=this.getItemTools();t===undefined&&(t=!n.hasClass("open")),t?(e("html").bind("click",this,this.clickOutsideHandler),n.addClass("open")):(e("html").unbind("click",this.clickOutsideHandler),n.removeClass("open"),this.resetHoveredItem())},clickOutsideHandler:function(t){var n=t.data;e(t.target).parents().is(n.getItemTools())||n.toggleItemToolsMenu(!1)},beginRenameItem:function(t){var n=this,r=this.getItem(t.data("itemId")),i=r.get("label"),s=this.$("input.edit");if(!r||s.length)return;this.$el.addClass("editing"),this._hoveredItem&&this.setItemHovered(this._hoveredItem,!1),this.ensureItemIsVisible(t),s=e('<input type="text" maxlength="128"/>').addClass("edit").val(i).appendTo(t).focus().select().one("blur",function(){var e=i===s.val().trim();n.endRenameItem(e,!0)}).keyup(function(e){if(e.which===13){e.preventDefault();var t=i===s.val().trim();n.endRenameItem(t,!1)}else e.which===27&&(e.preventDefault(),n.endRenameItem(!0,!1))})},endRenameItem:function(e,n){var r=this,i=this.$("input.edit"),s=i.parent(),o=this.getItem(s.data("itemId")),u=i.val(),a=o.get("label");e===!1&&u?o.save({label:u},{success:t.bind(this.renameCleanup,this),error:function(e,t){r.renderError(t.message),e.set("label",a),n===!1?(i.val(u),r.beginRenameItem(s)):r.renameCleanup()}}):r.renameCleanup()},renameCleanup:function(){this.resetError(),this.$("input.edit").remove(),this.$el.removeClass("editing"),this.resetHoveredItem()},deleteItem:function(e){var t=this,n=this.getItem(e.data("itemId"));n&&n.destroy({success:function(){t.resetError()},error:function(){t.renderError("Failed to delete navigation item")}})},beginAddNewItem:function(t){var n=this,r=this.$("input.edit"),i=e(".add-new",t);if(r.length)return;this.$el.addClass("editing"),this._hoveredItem&&this.setItemHovered(this._hoveredItem,!1),this.ensureItemIsVisible(i),r=e('<input type="text" maxlength="128"/>').addClass("edit").val("Label").appendTo(i).focus().select().one("change",function(){e(this).data("changed",!0)}).one("blur",function(){var t=e(this).data("changed");n.endAddNewItem(!t)}).keyup(function(e){e.which===13?this.blur():e.which===27&&(e.preventDefault(),e.stopPropagation(),n.endAddNewItem(!0))})},endAddNewItem:function(e){var t=this,n=this.$("input.edit"),r=n.parents(".nav-column").eq(0),i=r.hasClass("root-column"),s=r.data("itemId"),u=n.val(),a=0,f,l=function(){n.remove(),t.$el.removeClass("editing"),t.resetHoveredItem()};e===!1&&u?(this.collection.length!==0&&(a=this.collection.last().get("position")+1),f=new o({store_id:this.getCurrentStore().get("id"),parent_id:s,position:a,label:u,used_by:0}),n.prop("disabled",!0),f.save(null,{success:function(){t.resetError(),t.collection.add(f),t.getItemNode(f.id).find("input[type=checkbox]").prop("checked",!0).change(),i&&t.selectItem(f),l()},error:function(){t.renderError("Failed to add navigation item"),l()}})):l()},syncPositions:function(t,n){var r=this.collection,i,s,o={silent:!0},u,a=[];s=r.where({parent_id:t});if(!s)return;i=s[0].get("position"),n.find(".item").each(function(t,n){u=r.get(e(n).data("itemId")),u&&u.set("position",i+t,o)}),r.sort(),r.each(function(e){a.push(e.id)}),this.sendChangeOrderRequest(a)},sendChangeOrderRequest:function(e){var t=this,r=new s.Request("store.navigation.order.set",{store_id:n.session.getCurrentStore().id,order:e},"POST",null);r.setOnSuccess(function(e,t,n,r){}),r.setOnError(function(e,n,r,i){t.renderError("Failed to create new navigation item")}),r.send()},_itemAdded:function(t){var n=this.createItemNode(t),r=this.getColumnNode(t.get("parent_id")||0);n.appendTo(e("ul",r))},_itemRemoved:function(e){var t=this.getItemNode(e.get("id"));if(!t.length)return;t.is(this._hoveredItem)&&(this.setItemHovered(t,!1),this._hoveredItem=null),t.hasClass("selected")&&this.hideChildColumn(),t.remove();var n=[e.id];this.collection.each(function(t){t.get("parent_id")===e.id&&n.push(t.id)}),this.product.removeFromNavigationItems(n)},_itemChanged:function(e,t){var n=t.changes||{},r=e.get("id");if(n.label||n.used_by)this.getItemNode(r).find(".label").text(e.get("label")).end().find(".num").text("("+(e.get("used_by")||0)+")"),this.getColumnNode(r).find(".parent-item-label").text(e.get("label"))},_navigationIdsChanged:function(n,r){this.$(".item").each(function(){var n=e(this),i=n.data("itemId"),s=t.indexOf(r,i)!==-1;n.find("input[type=checkbox]").ui("setChecked",s)})}});return f}),define("dashboard/form/field/product/navigation",["jquery","underscore","tictail/form/field/core","tictail/component/log","../../../module/productnavigation"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.Form=s.Dashboard.Form||{},s.Dashboard.Form.Field=s.Dashboard.Form.Field={},s.Dashboard.Form.Field.Product=s.Dashboard.Form.Field.Product||{};var o=s.Dashboard.Form.Field.Product.Navigation=n.extend({attributes:{"class":"field product-navigation-field full-width"},fieldTagName:"",initialize:function(e){var t=this;o.__super__.initialize.apply(this,arguments),this.loading=!1,this.collection=TT.session.getCurrentStore().getInitiatedForeignAttribute("navigation"),this.collection.isEmpty()&&(this.loading=!0,this.collection.fetch({success:function(){t.loading=!1,t.$("button").prop("disabled",!1),t.renderNavigationItems()},error:function(){r.error("Failed to load product navigation items")}}))},addModelListeners:function(){this.model.on("change:"+this.modelAttributeName,this._navigationIdsChanged,this),this.collection.on("change:label",this._navigationItemLabelChanged,this).on("remove",this._navigationItemRemoved,this)},removeModelListeners:function(){this.model.off("change:"+this.modelAttributeName,this._navigationIdsChanged,this),this.collection.off("change:label",this._navigationItemLabelChanged,this).off("remove",this._navigationItemRemoved,this)},openNavigationDialog:function(){var e=new i({product:this.model,navigationItems:this.collection});this.addChildView(e,null),e.overlay({parentView:this})},renderField:function(){var n=e('<div class="imprint"/>');e('<button type="button"/>').attr("tabindex",this.tabIndex).text("Add Navigation").prop("disabled",this.loading).click(t.bind(this.openNavigationDialog,this)).appendTo(n),e('<ul class="tag-list navigation-items"/>').appendTo(n),this.$el.append(n).append(e('<div class="navigation-help"/>').text("Select where in your store's menu that you want your customers to find your product.")),this.loading||this.renderNavigationItems()},renderNavigationItems:function(){var e=this,n=this.getValueFromModel()||[],r=n.length!==0,i=this.$(".navigation-items");this.$el.toggleClass("with-items",r),i.empty(),r&&t.each(n,function(t){e.createNavigationItemNode(t).appendTo(i)})},createNavigationItemNode:function(n){var r=this,i=e("<li/>").addClass("item-"+n).data("itemId",n),s=this.collection.get(n),o,u,a;return e('<a href="#" class="remove manual"/>').text("Remove").click(function(e){e.preventDefault();var i=[n],s=t.pluck(r.collection.getChildrenForItem(n),"id");s.length!==0&&(i=t.union(i,s)),r.model.removeFromNavigationItems(i)}).appendTo(i),s?(o=s.get("parent_id"),o&&(u=this.collection.get(o),u&&e('<span class="parent"/>').text(u.get("label")+" / ").appendTo(i)),i.append(s.get("label"))):i.append(n.toString()),o&&(i.addClass("parent-"+o),this.$(".item-"+o).hide()),i},_navigationIdsChanged:function(){this.renderNavigationItems()},_navigationItemLabelChanged:function(t){var n=this;this.$(".item-"+t.id).add(this.$(".parent-"+t.id)).each(function(t,r){var i=e(r),s=n.createNavigationItemNode(i.data("itemId"));i.css("display")==="none"&&s.hide(),i.replaceWith(s)})},_navigationItemRemoved:function(e){var t=e.get("parent_id");t&&this.$(".parent-"+t).length<=1&&this.$(".item-"+t).show(),this.$(".item-"+e.id).remove(),this.$(".parent-"+e.id).remove()},_getFieldNode:function(){return e([])},_getFieldValue:function(){return null},_setFieldValue:function(){}});return o}),define("dashboard/nls/products",{root:{manage:{create_page_title:"Create product",edit_page_title:"Edit product",section:{core:{title:"Info"},image:{title:"Images"},details:{title:"Details"},"delete":{title:"Delete"}},field:{title:{label:"Title"},online:{label:"Visible to customers",information:"Want to make this product visible to your customers? Are you ready to sell this product?"},price:{label:"Price",labelDescription:"in "},description:{label:"Description"},variations:{label:{label:"Variation",placeholder:"Variation #"},quantity:{label:"Quantity"},unlimited:{label:"Unlimited"},add_link:"+ Add variation",add_link_help:"If you have a product available in different variations eg sizes or colors."}},"delete":{button:"Delete this product",confirmation:"Are you sure you want to delete this product?"},errors:{deleteModifiedError:"This product has been deleted and can no longer be modified.",saveError:"Something went wrong and the product was not saved."}}}}),define("dashboard/form/product/manage",["underscore","tictail/core","tictail/component/grid","tictail/component/tracker","tictail/form/core","tictail/form/fieldset","tictail/form/field/switch","tictail/form/field/number","tictail/form/field/wysiwyg","../../model/store/base","../field/product/title","../field/product/images","../field/product/variations","../field/product/navigation","i18n!../../nls/core","i18n!../../nls/products"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this;m.Dashboard=m.Dashboard||{},m.Dashboard.Form=m.Dashboard.Form||{},m.Dashboard.Form.Product=m.Dashboard.Form.Product={};var g=m.Dashboard.Form.Product.Manage=i.extend({events:{"click #trigger-delete":"onClickDelete"},infoFields:["set-title","set-online","set-price"],imageFields:["set-images"],detailsFields:["set-description","set-variations"],navigationFields:["set-navigation"],deleteFields:["delete"],allFields:function(){return this.allFields=this.infoFields.concat(this.imageFields,this.detailsFields,this.navigationFields,this.deleteFields),this.allFields},createField:function(e){return e==="set-title"?new l({key:e,model:{instance:this.model,attribute:"title"},label:v.manage.field.title.label,required:!0,maxLength:255,tabIndex:1}):e==="set-online"?new o({key:e,label:v.manage.field.online.label,information:v.manage.field.online.information,model:{instance:this.model,attribute:"status",getter:"isOnline",setter:"setIsOnline"},tabIndex:3}):e==="set-price"?new u({key:e,model:{instance:this.model,attribute:"price"},label:v.manage.field.price.label,labelDescription:v.manage.field.price.labelDescription+t.session.getCurrentStore().get("currency"),minValue:0,maxValue:9999999.99,stepSize:.01,required:!0,tabIndex:2}):e==="set-images"?new c({key:e,model:{instance:this.model,attribute:"images"}}):e==="set-description"?new a({key:e,model:{instance:this.model,attribute:"description"},label:v.manage.field.description.label,maxLength:65535}):e==="set-variations"?new h({key:e,model:{instance:this.model,getter:"getVariations",setter:"setVariations"},label:v.manage.field.variations.label.label,labelPlaceholder:v.manage.field.variations.label.placeholder,quantityLabel:v.manage.field.variations.quantity.label,unlimitedLabel:v.manage.field.variations.unlimited.label,addLinkText:v.manage.field.variations.add_link,addLinkHelpText:v.manage.field.variations.add_link_help}):e==="set-navigation"?new p({key:e,model:{instance:this.model,attribute:"navigation_ids"}}):null},renderInfo:function(){var e=this.getField("set-title"),t=this.getField("set-online"),r=this.getField("set-price"),i=[];if(e&&t){e.$el.addClass("full-width"),t.$el.addClass("full-width");var o=[{size:"7/10",content:e,gutterClass:"no-gutter-l"},{size:"3/10",content:t,gutterClass:"no-gutter-r"}];i.push(new n({columns:o,className:"row field-row with-overflow"}))}else e?i.push(e):t&&i.push(t);r&&i.push(r);if(i.length===0)return!1;var u=new s({title:v.manage.section.core.title,rightColumnContent:i});return this.addChildView(u),!0},renderImage:function(){var t=this.getFields(this.imageFields);if(e.isEmpty(t))return!1;var n=new s({title:v.manage.section.image.title,rightColumnContent:t});return this.addChildView(n),!0},renderDetails:function(){var t=this.getFields(this.detailsFields);if(e.isEmpty(t))return!1;var n=new s({title:v.manage.section.details.title,rightColumnContent:t});return this.addChildView(n),!0},renderNavigation:function(){var e=this.getFields(this.navigationFields);if(!e)return!1;var t=new s({title:"Navigation",rightColumnContent:e});return this.addChildView(t),!0},renderDelete:function(){if(!this.isIncluded(this.deleteFields)||this.model.isNew()===!0)return!1;var e=new s({title:v.manage.section["delete"].title,rightColumnContent:this.make("a",{id:"trigger-delete","class":"action-link delete-link"},v.manage["delete"].button)});return this.addChildView(e),!0},actionbarGetParams:function(){var t=g.__super__.actionbarGetParams.apply(this,arguments);return this.options.showCancelLink!==!1&&(t.link={label:"Cancel and go back to all products",callback:e.bind(this.cancel,this)}),t},cancel:function(){Dashboard.router.navigate(f.generateCurrentStoreUrl("/products"),{trigger:!0})},getTrackingNote:function(){return'"'+this.model.get("title")+'" for '+this.model.get("price")},render:function(){return this.empty(),this.renderInfo(),this.renderImage(),this.renderDetails(),this.renderNavigation(),this.renderDelete(),this.addChildView(this.actionbar),this.model.isNew()?r.track("Opened Product Create"):r.track("Opened Product Edit",this.getTrackingNote()),this.didRender()},onSaving:function(){this.model.isNew()?r.track("Product Create",this.getTrackingNote()):r.track("Product Update",this.getTrackingNote()),g.__super__.onSaving.apply(this,arguments)},onClickDelete:function(t){var n=confirm(v.manage["delete"].confirmation);if(n!==!0)return;r.track("Product Delete",this.getTrackingNote()),this.model.destroy({wait:!0,success:e.bind(this.onDestroy,this),error:e.bind(this.onDestroyError,this)})},onDestroy:function(){this.trigger("onDelete",this)},onDestroyError:function(e,t){this.trigger("onDeleteError",e,t)}});return g}),define("dashboard/view/product/create",["tictail/core","tictail/model/store/product/base","../../module/page","../../form/product/manage"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.View=i.Dashboard.View||{},i.Dashboard.View.Product=i.Dashboard.View.Product={};var s=i.Dashboard.View.Product.Create=n.extend({sectionName:"products",included:["info","image","details","navigation","delete"],initialize:function(n){n=n||{},_.isArray(n.include)===!0&&(this.included=n.include),s.__super__.initialize.call(this,n),n.data?this.data=n.data:this.data=new t({store_id:e.session.getCurrentStore().id,status:1})},isIncluded:function(e){return _.indexOf(this.included,e)!==-1},getTitle:function(){return"Add product"},getForm:function(){return e.getLazy(this,"form",function(){var e,t=r.prototype;this.formInclude!==void 0?e=this.formInclude:(e=[],this.isIncluded("info")&&(e=e.concat(t.infoFields)),this.isIncluded("image")&&(e=e.concat(t.imageFields)),this.isIncluded("details")&&(e=e.concat(t.detailsFields)),this.isIncluded("navigation")&&(e=e.concat(t.navigationFields)),this.isIncluded("delete")&&(e=e.concat(t.deleteFields)));var n=_.extend({model:this.data,include:e},this.formOptions),i=new r(n);return i.on("onSave",this.onSave,this),i})},onSave:function(){this.navigate("/products")},getContent:function(){return this.getForm()},setFocus:function(){this.getForm().setFocus()}});return s}),define("dashboard/view/product/edit",["underscore","tictail/core","tictail/component/api","../../module/loadpage","../../form/product/manage","i18n!../../nls/products"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.View=o.Dashboard.View||{},o.Dashboard.View.Product=o.Dashboard.View.Product={};var u=o.Dashboard.View.Product.Edit=r.extend({sectionName:"products",storeLoadEventName:"product.model.loaded",included:["info","image","details","navigation","delete"],initialize:function(t){t=t||{},e.isArray(t.include)===!0&&(this.included=t.include);if(e.isUndefined(t.slug)!==!1)throw new Error("Cannot initiate product page without the unique product slug");this.slug=t.slug,u.__super__.initialize.call(this,t)},isIncluded:function(t){return e.indexOf(this.included,t)!==-1},load:function(){this.getCurrentStore().loadProduct(this.slug)},getTitle:function(){return"Edit product"},getForm:function(){return t.getLazy(this,"form",function(){var t,n=i.prototype;this.formInclude!==void 0?t=this.formInclude:(t=[],this.isIncluded("info")&&(t=t.concat(n.infoFields)),this.isIncluded("image")&&(t=t.concat(n.imageFields)),this.isIncluded("details")&&(t=t.concat(n.detailsFields)),this.isIncluded("navigation")&&(t=t.concat(n.navigationFields)),this.isIncluded("delete")&&(t=t.concat(n.deleteFields)));var r=e.extend({model:this.data,include:t},this.formOptions),s=new i(r);return s.on("onSave",this.onSave,this),s.on("onDelete",this.onDelete,this),s.on("onSaveError",this.onSaveError,this),s.on("onDeleteError",this.onDeleteError,this),s})},onSave:function(){this.navigate("/products")},onDelete:function(){this.navigate("/products")},onSaveError:function(e,t){t.code===n.ERROR_CODES.PRODUCT_MODIFY_DELETED?(alert(s.manage.errors.deleteModifiedError),this.onDelete()):alert(s.manage.errors.saveError)},onDeleteError:function(){this.onSaveError.apply(this,arguments)},getLoadedContent:function(){return this.getForm()},setFocus:function(){this.form!==void 0&&this.form.setFocus()}});return u}),define("dashboard/module/table",["jquery","underscore","tictail/core","tictail/component/api","../view"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.Module=s.Dashboard.Module||{};var o=s.Dashboard.Module.Table=i.extend({id:undefined,className:"data-table",events:{"click a.sort":"_onClickSort","click #retry-search":"reset"},initialize:function(r){var i=null,s=null,o=null,u=null;if(this.id){var a=n.sessionStorage;i=a.getItem(this.id+"-sort"),s=a.getItem(this.id+"-sortOrder"),o=a.getItem(this.id+"-filter"),u=a.getItem(this.id+"-filter-status")}return this.options=t.extend({itemIdPrefix:(this.id?this.id:"table-"+Math.round(Math.random()*1e5))+"-item",itemContainer:"tbody",threshold:100,delay:100,batchSize:10,sortParamName:"order_by",initialSortOrder:"asc",filterParamName:"filter"},r),this.collection=r.collection,this.offset=r.startOffset||this.collection.length,this.skipAutoLoad=r.skipAutoLoad,this.scrollTarget=e(r.scrollTarget||window),this.sortField=i||r.initialSort||null,this.sortOrder=String(s||r.initialSortOrder).toLowerCase()==="desc"?"desc":"asc",this.filterValue=o||r.initialFilter||null,this.filterStatus=u||r.initialFilterStatus||null,this.setFiltered(),this.setFilteredByStatus(),this},setCollection:function(e,t){if(e===this.collection)return;this._removeCollectionListeners(),this.collection=e,this._addCollectionListeners(),t!==!1&&this._collectionReset()},_addCollectionListeners:function(e){this.collection.on("add",this._itemAdded,this).on("change",this._itemChanged,this).on("remove",this._itemRemoved,this).on("reset",this._collectionReset,this)},_removeCollectionListeners:function(){this.collection.off("add",this._itemAdded,this).off("change",this._itemChanged,this).off("remove",this._itemRemoved,this).off("reset",this._collectionReset,this)},didAppend:function(){this._addCollectionListeners(),this.enable(!this.options.disabled),this.options.loadOnAppend!==!1&&this.loadInitial()},willRemove:function(){this._removeCollectionListeners(),this.enable(!1)},render:function(){return this.$el.html(this.options.template()),this.renderCollection(),this.sortField&&this.$el.find("a.sort."+this.sortField).addClass(this.sortOrder).end().addClass("sorted"),this.didRender()},renderCollection:function(){this.collection.each(function(e,t){this._itemAdded(e,this.collection,{index:t})},this)},_renderItem:function(n){var r=n.attributes,i=this.options.itemPrepareDataCallback;t.isFunction(i)&&(r=t.clone(r),i(n,r));var s=this.options.itemIdPrefix+n.cid,o=e(this.options.itemTemplate(r)).attr("id",s);return this.sortField&&o.find("td."+this.sortField).addClass("sorted"),this.prepareContent(o),this.options.itemCallback&&this.options.itemCallback(o,n,this),o},_getItemContainer:function(){var e=this.options.itemContainer;return e?this.$el.find(e):this.$el},_itemAdded:function(e,t,n){var r=this._getItemContainer(),i=r.children(),s=this._renderItem(e),o=n.index!==undefined?n.index:i.length-1,u=i.eq(o);u.length?(s.insertBefore(u),this.resetEvenOddItems(o)):(s.addClass(o%2===0?"odd":"even"),r.append(s))},_itemChanged:function(e){var t=this.$el.find("#"+this.options.itemIdPrefix+e.cid),n=this._renderItem(e);n.addClass(t.hasClass("even")?"even":"odd"),t.replaceWith(n)},_itemRemoved:function(e,t,n){this.$el.find("#"+this.options.itemIdPrefix+e.cid).remove(),this.resetEvenOddItems(n.index)},_collectionReset:function(){this.offset=this.collection.length,this._setLoading(!1),this.$el.removeClass("all-loaded empty error error_query"),this._getItemContainer().empty(),this.renderCollection(),this.enable(!this.options.disabled),this.options.loadOnReset!==!1&&this.loadInitial()},reset:function(){this.collection.reset();var e=this.options.onResetCallback;return t.isFunction(e)&&e(),this},resetEvenOddItems:function(t){var n=0;return this._getItemContainer().children().slice(t||0).removeClass("even odd").each(function(t,r){var i=e(r);!i.hasClass(".sort-placeholder")&&i.css("display")!=="none"&&i.addClass(++n%2===0?"even":"odd")}),this},enable:function(e){return e!==!1?this.scrollTarget.bind("scroll resize",this,this._onScroll):(this.scrollTarget.unbind("scroll resize",this._onScroll),this._scrollTimeout&&(clearTimeout(this._scrollTimeout),delete this._scrollTimeout)),this},sort:function(t,r,i){this.sortField=t,this.sortOrder=r==="desc"||r==="DESC"?"desc":"asc",e("a.sort",this.el).removeClass("asc desc"),this.sortField&&e("a.sort."+this.sortField,this.el).addClass(this.sortOrder),this.$el.toggleClass("sorted",!!this.sortField),i!==!1?this.reset():this.$el.find("td.sorted").removeClass("sorted").end().find("td."+this.sortField).addClass("sorted");if(this.id){var s=n.sessionStorage,o=this.id+"-sort",u=this.id+"-sortOrder";this.sortField?(s.setItem(o,this.sortField),s.setItem(u,this.sortOrder)):(s.removeItem(o),s.removeItem(u))}return this.options.sortChangedCallback&&this.options.sortChangedCallback(this.sortField,this.sortOrder,this),this},filter:function(e,t){this.filterValue=e,t!==!1&&this.reset();if(this.id){var r=this.id+"-filter";this.filterValue?n.sessionStorage.setItem(r,this.filterValue):n.sessionStorage.removeItem(r)}return this.setFiltered(),this},filterByStatus:function(e,t){this.filterStatus=e,t!==!1&&this.reset();if(this.id){var r=this.id+"-filter-status";this.filterStatus?n.sessionStorage.setItem(r,this.filterStatus):n.sessionStorage.removeItem(r)}return this.setFilteredByStatus(),this},setFilteredByStatus:function(){this.$el.removeClass("inbox archive all").toggleClass(this.filterStatus)},setFiltered:function(e){var t=!!this.filterValue;return this.$el.toggleClass("filtered",e||t),this},_onScroll:function(e){var t=e.data;t._scrollTimeout||(t._scrollTimeout=setTimeout(function(){t._scrollTrigger.call(t)},t.options.delay))},_scrollTrigger:function(){clearTimeout(this._scrollTimeout),delete this._scrollTimeout,this.trigger()},trigger:function(){if(this.loading)return;var e=this.$el.offset().top+this.$el.height(),t=this.scrollTarget.offset(),n=(t?t.top:0)+this.scrollTarget.height()+this.scrollTarget.scrollTop();return e-n<this.options.threshold&&this.loadMore(),this},loadInitial:function(){var e=this.collection.isEmpty();if(e!==!0)return this;if(this.options.itemHeight){var t=this.$el.offset().top+this.$el.height(),n=this.scrollTarget.offset(),r=(n?n.top:0)+this.scrollTarget.height()+this.scrollTarget.scrollTop(),i=r+this.options.threshold-t;t>0&&i>0&&this.loadMore(Math.ceil(i/this.options.itemHeight))}else this.loadMore();return this.$el.addClass("initial-loading"),this},loadMore:function(e){var t=this,n=this.collection.length,r;if(!e){e=this.options.batchSize;if(!e)return}return r={offset:this.offset,limit:e},this.sortField&&(r[this.options.sortParamName]=this.sortField,r.descending=this.sortOrder==="desc"),this.filterValue&&(r[this.options.filterParamName]=this.filterValue),this.filterStatus&&(r.status=this.filterStatus),this.options.dataCallback&&this.options.dataCallback(r,this),this.collection.fetch({add:!0,data:r,success:function(){t.offset+=e,t._setLoading(!1),t.collection.length<n+e?(t.enable(!1),t.$el.addClass("all-loaded"),t.collection.length||t.$el.addClass("empty")):t.skipAutoLoad!==!0&&t.trigger(),t.options.loadSuccess&&t.options.loadSuccess.apply(this,arguments)},error:function(){t.options.loadError&&t.options.loadError.apply(this,arguments)||t.loadError.apply(t,arguments)}}),this._setLoading(!0),this},loadError:function(e,t,n){this._setLoading(!1),this.$el.addClass("empty"),t.code&&t.code===r.ERROR_CODES.SEARCH_BAD_QUERY?this.$el.addClass("error_query"):this.$el.addClass("error")},_setLoading:function(e){if(e===this.loading)return;this.loading=e,this.$el.toggleClass("loading",e).removeClass("initial-loading"),e?this.setLoadingSpinner():this.removeLoadingSpinner(),this.options.loadingCallback&&this.options.loadingCallback(e,this)},_onClickSort:function(n){n.preventDefault();var r=e(n.currentTarget).attr("class").split(/\s+/),i=null,s="asc";t.each(r,function(e){e==="asc"?s="desc":!i&&e!=="sort"&&e!=="desc"&&(i=e)}),this.sort(i,s)}});return o}),define("dashboard/module/tablepage",["underscore","./page","./table"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Module=r.Dashboard.Module||{};var i=r.Dashboard.Module.TablePage=t.extend({initialize:function(e){i.__super__.initialize.call(this,e),this.table=new n(this.getTableOptions())},getTableOptions:function(){var t=this.getTableCollection();t=t||{};if(e.isEmpty(t)!==!1)throw new Error("Cannot initiate table since no collection was given");var n={};return e.extend(n,this.options.tableOptions||{}),e.extend(n,{collection:this.getTableCollection()}),n},getTableCollection:function(){},getContent:function(){return this.table}});return i}),define("dashboard/module/photo",["jquery","underscore","../view"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Module=r.Dashboard.Module||{};var i=r.Dashboard.Module.Photo=n.extend({id:null,className:"photo-view",img:null,initialize:function(t){var n=this,r=e("<img/>",{src:t.url,"class":"photo"}).one("load",function(){n._loadComplete=!0,n.img=this,n.isOverlaid()?n.overlay():n.render()});r.get(0).complete&&r.load()},getContent:function(){return this.img},overlay:function(e){var n=this.img||{};e=t.extend({requiresLoading:!this._loadComplete,animation:"bounceIn",width:n.width,height:n.height},e),i.__super__.overlay.call(this,e)}});return i}),define("dashboard/view/product/index",["jquery","underscore","tictail/core","tictail/component/api","tictail/component/log","../../module/tablepage","../../module/photo","../../templates","jquery-ui"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.View=u.Dashboard.View||{},u.Dashboard.View.Product=u.Dashboard.View.Product={};var a=u.Dashboard.View.Product.Index=s.extend({bodyId:"product-index-view",template:"product/index",sectionName:"products",events:{"keyup #product-search-box":"didChangeSearch","click #add-product-button":"didClickAddProduct","click a.thumb":"didClickThumb"},initialize:function(){a.__super__.initialize.apply(this,arguments),this.productsCollection=this.table.collection},getTableCollection:function(){var e=this.getCurrentStore().getInitiatedForeignAttribute("products");return e.reset(),e},getTableOptions:function(){var e=t.clone(a.__super__.getTableOptions.call(this));return t.extend(e,{id:"product-index-table",template:ich["product/table"],itemTemplate:ich["product/row"],itemCallback:t.bind(this.onRenderItem,this),itemPrepareDataCallback:t.bind(this.onPrepareRowData,this),onResetCallback:t.bind(this.onTableReset,this),dataCallback:t.bind(this.onTableRetrieveData,this),sortChangedCallback:t.bind(this.onSortChanged,this),startOffset:0,batchSize:20,initialSort:"position",filterParamName:"query",itemHeight:56}),e},setupSorting:function(t){var n=this;return e("tbody",this.$el).sortable({handle:"td.position",containment:"#product-index-table",axis:"y",cursor:"",tolerance:"pointer",placeholder:"sort-placeholder",appendTo:"#product-index-table",helper:function(t,n){var r=n.clone().find(".draggable, a, td.quantity").addClass("dragging").end();return e("<table><tbody></tbody></table>").wrapInner(r)},revert:75,disabled:t===!0,start:function(t,n){e("body").addClass("dragging"),n.placeholder.append(e('<td colspan="7"><span></span></td>'))},change:function(){n.table.resetEvenOddItems()},stop:function(t,r){e("body").removeClass("dragging"),n.table.resetEvenOddItems();var i=r.item.data("productId"),s=r.item.context.rowIndex-1;n.sendChangeOrderRequest(i,s)}}),t&&this.$("#product-index-table").addClass("sorting-disabled"),this},sendChangeOrderRequest:function(e,t){var s=this,o=new r.Request("store.product.position.set",{store_id:n.session.getCurrentStore().id,product_id:e,new_position:t},"POST",null);o.setOnSuccess(function(e,t,n,r){}),o.setOnError(function(e,t,n,r){i.error("Failed to change order of products",e,n,r,t)}),o.send()},searchProducts:function(e){var t=this.table;e?(t.setCollection(this._getSearchCollection(),!1),t.sort("_score","desc",!1),t.filter(e)):(t.setCollection(this.productsCollection,!1),t.sort("position","asc",!1),t.filter(null))},_getSearchCollection:function(){var e=this;return n.getLazy(this,"searchCollection",function(){return e.getCurrentStore().getInitiatedForeignAttribute("products_search")})},didRender:function(){this.$("#product-search-box").val(this.table.filterValue||""),this.setupSorting(this.table.sortField!=="position"||this.table.sortOrder!=="asc")},onRenderItem:function(e,t,n){var r=this;e.data("productId",t.id),e.find(".clickable").click(function(e){e.preventDefault(),r.navigate(t.attributes.url)})},onPrepareRowData:function(e,n){var r,i,s=this.getCurrentStore().get("currency"),o=!1,u=0,a=[];t.each(e.variations.models,function(e){r=e.attributes,t.isNull(r.quantity)?(o=!0,r.is_unlimited=!0):(u+=r.quantity,r.is_unlimited=!1),a.push(r)});var f={};e.images.isEmpty()!==!0&&(f=e.images.first().attributes),n.image=f,t.extend(n,{currency:s,is_online:e.isOnline(),show_variations:a.length>=2,variations:a,has_unlimited:o,aggregated_quantity:u}),n.position=n.position?n.position+1:1},onTableRetrieveData:function(e){e.order_by==="time"&&(e.order_by="modified_at")},onTableReset:function(){},onSortChanged:function(e,t){var n=e==="position"&&t==="asc";this.$("tbody").sortable(n?"enable":"disable"),this.$("#product-index-table").toggleClass("sorting-disabled",!n)},didChangeSearch:function(t){var n=this,r=e(t.currentTarget),i=r.val();t.which===27&&(r.val(""),i="");if(i===this._lastQuery)return;this._searchTimeout&&(clearTimeout(this._searchTimeout),this._searchTimeout=null),i?this._searchTimeout=setTimeout(function(){n.searchProducts(i)},300):this.searchProducts(null),this._lastQuery=i},didClickAddProduct:function(){var e=this.getCurrentStore().generateUrl("/product/create");Dashboard.router.navigate(e,{trigger:!0})},didClickThumb:function(t){t.preventDefault();var n=new o({url:e(t.currentTarget).attr("href")});this.addChildView(n,null),n.overlay({parentView:this})}});return a}),define("dashboard/view/order/index",["jquery","underscore","../../model/store/base","../../module/tablepage","../../templates"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.View=i.Dashboard.View||{},i.Dashboard.View.Order=i.Dashboard.View.Order={};var s=i.Dashboard.View.Order.Index=r.extend({bodyId:"order-index-view",template:"order/index",sectionName:"orders",events:{"keyup #order-search-box":"didChangeSearch","change #order-filters":"onFilter","click .export.enabled":"onExportClick","click .export li":"onExportElementClick"},initialize:function(){s.__super__.initialize.apply(this,arguments),this.ordersCollection=this.table.collection},getTableCollection:function(){var e=this.getCurrentStore().getInitiatedForeignAttribute("orders");return e.reset(),e},getTableOptions:function(){var e=t.clone(s.__super__.getTableOptions.call(this));return t.extend(e,{id:"order-index-table",template:ich["order/table"],itemTemplate:ich["order/row"],itemCallback:t.bind(this.onRenderRow,this),loadSuccess:t.bind(this.onSuccess,this),loadError:t.bind(this.onError,this),startOffset:0,batchSize:20,initialSort:"paid_at",initialSortOrder:"desc",initialFilterStatus:"inbox",filterParamName:"query",itemHeight:40}),e},onSuccess:function(e){this.disableExportButton(e.length===0)},onError:function(e){this.disableExportButton(!0)},didRender:function(){this.$("#order-search-box").val(this.table.filterValue||"")},onRenderRow:function(t,r){var i,s=this,o=e(".status p",t);switch(r.get("status")){case r.statusShipped:i="Shipped";break;case r.statusCancelled:i="Cancelled";break;case r.statusRefunded:i="Refunded";break;case r.statusPending:i="Pending";break;case r.statusDenied:i="Denied";break;case r.statusReversed:i="Reversed";break;default:i="Unfinished"}o.attr("class",r.getStatusName()),o.html(i),t.click(function(e){e.preventDefault();var t="/order/"+r.id,i="order-nav-index",o=e.currentTarget.rowIndex-1;TT.sessionStorage.setItem(i,o),e.ctrlKey||e.metaKey?window.open(n.generateCurrentBaseUrl(t)):s.navigate(t)})},onFilter:function(t){var n=e(t.currentTarget),r=n[0].value;this.table.filterByStatus(r),n.siblings("button").removeClass("on").end().addClass("on")},onExportClick:function(){e("html").bind("click",this,this.onClickDocument),e("div .drop .menu").addClass("open")},onClickDocument:function(t){var n=e(t.target),r=e("div .drop .menu");r.parent().is(n)||(r.removeClass("open"),e("html").unbind("click",this,this.onClickDocument))},onExportElementClick:function(e){var t=this.table.filterStatus||"",r=this.table.filterValue||"",i=e.target.getAttribute("value")||"csv",s="/orders/export/"+i+"?query="+r+"&status="+t;location.href=n.generateCurrentBaseUrl(s)},didChangeSearch:function(t){var n=this,r=e(t.currentTarget),i=r.val();t.which===27&&(r.val(""),i="");if(i===this._lastQuery)return;this._searchTimeout&&(clearTimeout(this._searchTimeout),this._searchTimeout=null),i?this._searchTimeout=setTimeout(function(){n.searchProducts(i)},300):this.searchProducts(null),this._lastQuery=i},getTemplateData:function(){var e={};return e[this.table.filterStatus+"_selected"]="selected",e},searchProducts:function(e){var t=this.table;e?(t.setCollection(this._getSearchCollection(),!1),t.sort("_score","desc",!1),t.filter(e)):(t.setCollection(this.ordersCollection,!1),t.sort("paid_at","desc",!1),t.filter(null))},disableExportButton:function(t){t?e("div.export").removeClass("enabled").addClass("disabled"):e("div.export").addClass("enabled").removeClass("disabled")},_getSearchCollection:function(){var e=this;return TT.getLazy(this,"searchCollection",function(){return e.getCurrentStore().getInitiatedForeignAttribute("orders")})}});return s}),define("tictail/component/country",["underscore"],function(e){var t=this;t.TT=t.TT||{};var n=t.TT.Country={countries:window.Countries,orderList:window.CountryOrder,asList:undefined,getByCode:function(e){return this.countries[e]},getNameByCode:function(e){var t=this.getByCode(e);return t?t.name:null},getTaxByCode:function(e){var t=this.getByCode(e);return t?t.tax||0:0},getCountries:function(){return this.countries},getCountryOrder:function(){return this.orderList},getList:function(){var t=this,n=[],r=this.asList;return e.isUndefined(r)!==!0?r:(e.each(this.orderList,function(e){var r=t.countries[e];r.code=e,n.push(r)}),this.asList=n,n)}};return n}),define("dashboard/nls/settings",{root:{page_title:"Settings",general:{page_title:"General",section:{info:{title:"Store info"},logo:{title:"Logo"},contact:{title:"Contact"},social:{title:"Social"},status:{title:"Store status"}},button:{blog:{label:"Link to Your Blog",value:"Link to Your Blog"}},field:{store_name:{label:"Name"},store_description:{label:"Description",information:"What do you sell? Why should customers visit your store and buy your products?"},store_email:{label:"Contact email",information:"Where can your customers reach you? This will be included in payment receipts and other emails sent from Tictail on your behalf."},store_state:{label:"State",placeholder:"-- Select state"},store_country:{label:"Store is located in"},store_language:{label:"Store language"},store_blog_url:{label:"Link to your blog",placeholder:"http://yourblog.example.com/",information:"Do you have a blog you want to link to from your store? Type in its URL and the link will show up in your stores main menu."},store_subdomain:{label:"Store URL",information:"At what URL (eg. thestartupstore.tictail.com) would you like to place your store?"},store_domain:{label:"Domain"},store_online:{label:"Open to customers",information:"Everything setup and ready to sell? Great! Switch to Yes now."}}},billing:{page_title:"Apps & Billing",section:{credit_card:{title:"Credit card on file"},installed_apps:{title:"Your apps"},upcoming:{title:"Upcoming billing"},history:{title:"Billing history"}},field:{credit_card:{button:{update:"Change Credit Card",add:"Add Credit Card"},infoOnInvalidCard:"<p>In order to buy apps, you need to add a credit card.</p>"}}},fulfillment:{page_title:"Payments, Shipping & Legal",default_ship_message_template:"Hi {customer_name}!\n\nThank you so much for your order! Your support means a lot to us.\nWe thought you'd like to know that we shipped your order today.\nHope to see you again soon!\n\n{store_name}",section:{country:{title:"Country & Currency"},tax:{title:"Tax"},payment:{title:"Payment"},shipping:{title:"Shipping"},ship_message_template:{title:"Shipping Message"},legal:{title:"Legal"}},link:{shipping:{add_link:"+ Add a new shipping alternative",show_more_options:"Show more options"}},field:{currency:{label:"Currency"},tax:{label:"Tax",world_label:"Entire World",percentage:{label:"% tax"},region:{label:"Tax applies in"},shipping:{label:"Apply tax to shipping",labelDescription:"Apply the same tax rate on the shipping cost."},pricesIncludeTax:{label:"All my prices include tax",labelDescription:"If 'No', tax will be added on top of your product and shipping prices."},options:{information:'To learn more about how we calculate tax and how it affects your customers, please see this <a href="http://help.tictail.com/customer/portal/articles/1279304-how-can-i-specify-my-tax-rates-" target="_blank">help article.</a>'}},paypal:{label:"PayPal",labelDescription:"All transfers are made to this account",unsetLabelDescription:"Which PayPal account should receive payments?",placeholder:"Your PayPal e-mail address",information:'Credit card and PayPal payments are sent to this account. <a href="https://www.paypal.com/signup" target="_blank">Click here to sign up for PayPal.</a>'},tos:{label:"Terms & conditions",buttonLabel:"Help me write Terms & conditions",exampleText:""},return_policy:{label:"Return policy",buttonLabel:"Help me write my return policy",exampleText:""},shipping:{world_label:"Entire World",title:{label:"Title",placeholder:'Eg "Posten" or "FedEx Express"'},description:{label:"Description"},destination:{label:"This option is eligible for",placeholder:"Write any region and hit enter"},delivery_days:{label:"Delivery time",label_description:"in days",placeholder_min:'"3"',placeholder_max:'"10"'},country:{label:"This option is eligible for",placeholder:'Write any country and hit "enter"'},cost:{label:"Price",label_description:"in "},zero_cost:{label:"Free shipping if order total is over"}},ship_message_template:{label:"Message template",label_description:"We'll use this template to generate the message sent when you ship an order",information:'For more information on the available template placeholders you can use here, please see this <a href="http://help.tictail.com/customer/portal/articles/1441994-how-do-i-change-the-message-to-the-customer-when-i-ship-an-order-" target="_blank">help article</a>.'}}}}}),define("tictail/model/store/ship_message_template",["underscore","../../core","i18n!../../../dashboard/nls/settings"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Model=r.TT.Model||{},r.TT.Model.Store=r.TT.Model.Store||{};var i=r.TT.Model.Store.ShipMessageTemplate=t.Model.extend({API_NAMESPACE:"store.ship_message_template",getTemplate:function(){var t=this.get("template"),r=n.fulfillment.default_ship_message_template;return e.isEmpty(t)&&(t=r),t}});return i}),define("dashboard/module/emailpreview",["underscore","tictail/core","dashboard/view"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Module=r.Dashboard.Module||{};var i=r.Dashboard.Module.EmailPreview=n.extend({id:"email-preview-view",template:"module/overlay",container:".content",initialize:function(e){i.__super__.initialize.apply(this,arguments),this.model=e.model,this.lang=e.lang,this.previewURL=e.previewURL},getTemplateData:function(){return{heading:this.lang.heading,description:this.lang.description}},getIframe:function(e){return $('<iframe src="'+this.previewURL+'"></iframe>')},getContent:function(){return this.getIframe(this.previewURL)}});return i}),define("tictail/form/field/checkbox",["jquery","./input"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{},n.TT.Form.Field=n.TT.Form.Field||{};var r=n.TT.Form.Field.Checkbox=t.extend({attributes:{"class":"field checkbox-field"},fieldTagName:"input",fieldAttributes:{type:"checkbox","class":"ui"},_sanitize:function(e){return!!e},_getFieldValue:function(){return this._getFieldNode().prop("checked")},_setFieldValue:function(e){this._getFieldNode().prop("checked",!!e).change()},getCheckboxLabel:function(){var t=this.options;return t.checkboxLabel?e('<label class="for-checkbox"/>').attr("for",this.id).text(t.checkboxLabel):null},renderField:function(){this.$el.append(this._getFieldNode()).append(this.getCheckboxLabel())}});return r}),define("dashboard/form/order/shipping_email",["underscore","tictail/core","tictail/component/grid","tictail/component/api","tictail/utility","tictail/form/core","tictail/form/field/textarea","tictail/form/field/text","tictail/form/field/button","tictail/form/field/checkbox","dashboard/module/emailpreview"],function(e,t,n,r,i,s,o,u,a,f,l){var c=this;c.Dashboard=c.Dashboard||{},c.Dashboard.Form=c.Dashboard.Form||{},c.Dashboard.Form.Order=c.Dashboard.Order||{};var h=c.Dashboard.Form.Order.Shipping=s.extend({buttonLabel:"uninitialized",buttonId:"name-save",messageFields:["toggle-mail-message","toggle-email-preview","set-mail-message","set-tracking-number","set-shipping-company"],allFields:function(){return this.allFields=this.messageFields,this.allFields},initialize:function(e){this.lang=e.lang,this.buttonLabelWithoutEmail=e.shippingButtonLabel,this.buttonLabel=this.buttonLabelWithoutEmail.replace(" &amp;",",")+" & Email Customer",this.model.get("shipping_company")||(this.model.attributes.shipping_company=this.model.get("shipping").label);if(this.model&&!this.model.get("ship_message")){var n=this.model.messageTemplate.getTemplate(),r=i.renderTemplateVars(n,{store_url:t.session.getCurrentStore().get("url"),store_email:t.session.getCurrentStore().get("email"),store_name:t.session.getCurrentStore().get("name"),customer_name:this.model.get("receiver").name});this.model.set("ship_message",r)}this.model&&!this.model.get("send_message")&&this.model.set("send_message",!0),h.__super__.initialize.apply(this,arguments)},didAppend:function(){this.model&&(this.model.on("change",this.onModelChange,this),this.model.on("change:send_message",this.onToggleMessage,this))},onToggleMessage:function(){var e=!this.model.get("send_message");this.getField("set-mail-message").disable(e),e?(this.getField("set-mail-message").$el.slideUp(150),this.getField("toggle-email-preview").$el.hide()):(this.getField("set-mail-message").$el.slideDown(150),this.getField("toggle-email-preview").$el.show()),this.updateShipButtonLabel()},updateShipButtonLabel:function(){var e=this.$el.find("#"+this.buttonId);this.model.get("send_message")?e.html(this.buttonLabel):e.html(this.buttonLabelWithoutEmail)},willRemove:function(){this.model&&this.model.off(null,null,this)},createField:function(e){var t=this;switch(e){case"toggle-mail-message":return new f({key:e,checkboxLabel:this.lang.toggle_label,model:{attribute:"send_message",instance:this.model}});case"toggle-email-preview":return new a({key:e,value:this.lang.email_preview_label,onClick:function(){t.requestEmailPreview()}});case"set-mail-message":return new o({key:e,maxLength:800,required:!0,label:this.lang.message_label,labelDescription:this.lang.message_label_description,model:{attribute:"ship_message",instance:this.model}});case"set-tracking-number":return new u({key:e,label:this.lang.tracking_number_label,labelDescription:this.lang.optional,model:{instance:this.model,attribute:"tracking_number"},required:!1});case"set-shipping-company":return new u({key:e,label:this.lang.shipping_company_label,labelDescription:this.lang.optional,model:{instance:this.model,attribute:"shipping_company"},required:!1});default:}},requestEmailPreview:function(){var e=this,n=new r.Request("store.order.get_email_preview_url",{store_id:t.session.getCurrentStore().get("id"),id:e.model.get("id"),ship_message:e.model.get("ship_message"),tracking_number:e.model.get("tracking_number"),shipping_company:e.model.get("shipping_company")},"GET");n.setOnSuccess(function(t,n,r,i){e.openEmailPreview(t.url)}),n.send()},openEmailPreview:function(e){var t=this,n=new l({previewURL:e,lang:t.lang.email_preview});n.overlay({parentView:t,closeButton:!0})},renderMessage:function(){var t=this.getFields(this.messageFields);if(e.isEmpty(t))return!1;var r=this.getField("set-tracking-number"),i=this.getField("set-shipping-company"),s=[{size:"1/2",content:this.getField("toggle-mail-message"),gutterClass:"no-gutter-l"},{size:"1/2",content:this.getField("toggle-email-preview"),gutterClass:"no-gutter-r"}],o=[{size:"1/2",content:r,gutterClass:"no-gutter-l"},{size:"1/2",content:i,gutterClass:"no-gutter-r"}];return this.addChildView(new n({columns:s,className:"row field-row with-overflow"})),this.addChildView(this.getField("set-mail-message")),this.addChildView(new n({columns:o,className:"row field-row with-overflow"})),!0},render:function(){return this.empty(),this.renderMessage(),this.addChildView(this.actionbar),this.didRender()},actionbarGetParams:function(){var t=h.__super__.actionbarGetParams.apply(this,arguments);return t.link={label:this.lang.not_now_link_label,callback:e.bind(this.cancel,this)},t},_performSave:function(e){this.trigger("onSave",this)},cancel:function(){this.trigger("onCancel",this)}});return h}),define("dashboard/module/ordershipmail",["underscore","tictail/core","tictail/component/grid","tictail/utility","dashboard/view","dashboard/module/emailpreview","dashboard/form/order/shipping_email"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.Module=u.Dashboard.Module||{};var a=u.Dashboard.Module.OrderShipMail=i.extend({id:"order-ship-mail-view",template:"module/overlay",container:".content",initialize:function(e){a.__super__.initialize.apply(this,arguments),this.model=e.model,this.lang=e.lang,this.shippingButtonLabel=e.shippingButtonLabel},getTemplateData:function(){var e=r.renderTemplateVars(this.lang.heading,{order_id:this.model.get("id")});return{heading:e,description:this.lang.description}},getForm:function(){var e=this;return t.getLazy(e,"orderShipMailForm",function(){var t=new o({model:e.model,lang:e.lang,shippingButtonLabel:e.shippingButtonLabel});return t.on("onSave",e.onSave,e),t.on("onCancel",e.onCancel,e),t})},getContent:function(){return this.getForm()},onSave:function(){this.model.setShippedStatus(!0,this.model),this.trigger("onSave",this),this.trigger("onDone",this)},onCancel:function(){this.trigger("onDone",this)}});return a}),define("dashboard/nls/order",{root:{payment_alternatives:{paypal:{name:"PayPal",url:"http://www.paypal.com/"},klarna:{name:"Klarna",url:"http://www.klarna.com/"}},order_ship_mail:{heading:"Ship Order #{order_id}",toggle_label:"E-mail shipping details to customer",email_preview_label:"Preview Email",message_label:"Message to customer",message_label_description:"Tip! You can change and save this message from your store's shipping settings",optional:"optional",tracking_number_label:"Tracking Number",shipping_company_label:"Shipping Company",not_now_link_label:"Cancel",email_preview:{heading:"Preview",description:"This email will be sent to your customer when you click Send Email:"}},pending:{reasons:{paypal:{unilateral:"You need to register an account.",verify:"You need to verify your account.",address:"The shipping address is not confirmed.",echeck:"Awaiting bank transaction.",intl:"No account setup for withdrawal.","multi-currency":"You need to accept the currency conversion.",multi_currency:"You need to accept the currency conversion.",paymentreview:"We're performing a risk review.",regulatoryreview:"We're performing a regulatory review.",denied:"This payment was denied.",other:"Contact us for more information!"},klarna:"We're reviewing this order manually.",fallback:"Order is pending."},help_link_text:"Learn what you need to do"}}}),define("dashboard/view/order/manage",["jquery","underscore","icanhaz","tictail/core","tictail/component/country","tictail/component/tracker","tictail/utility","tictail/model/store/ship_message_template","../../module/loadpage","../../module/table","../../module/photo","../../module/ordershipmail","i18n!../../nls/order","../../templates"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=this;p.Dashboard=p.Dashboard||{},p.Dashboard.View=p.Dashboard.View||{},p.Dashboard.View.Order=p.Dashboard.View.Order={};var d=p.Dashboard.View.Order.Manage=a.extend({HELP_PENDING_ORDER_ARTICLE:"http://help.tictail.com/customer/portal/articles/1002387-what-it-means-when-your-order-is-pending",sectionName:"orders",storeLoadEventName:"order.model.loaded",showBackLink:!0,events:{"click #order-print-button":"printOrder","mouseover #order-product-images a":"onMouseOverProductImage","mouseout #order-product-images a":"onMouseOutProductImage","click #order-product-images a":"onClickProductImage","click #order-shipped-button":"onClickShipButton","click #order-cancel-button":"onClickCancelButton","click #order-back-link":"onClickBack"},initialize:function(e){if(t.isUndefined(e.orderId)!==!1)throw new Error("Cannot initiate order page without an order identifier");this.hasMessages=!1,this.orderId=parseInt(e.orderId,10),d.__super__.initialize.call(this,e)},willRemove:function(){d.__super__.willRemove.apply(this,arguments),this.model&&this.model.off(null,null,this),this.dropArrows(),this.removePendingCurtain(),e(window).off("resize",this.onWindowResize)},load:function(){this.getCurrentStore().loadOrder(this.orderId)},getTrackingNote:function(){var e=this.model.get("receiver"),t=this.model.get("price")+" "+this.model.get("currency"),n="Order from "+e.name+" for "+t+" ("+this.model.getStatusName()+")";return n},didLoad:function(e){this.model=e;var n=this.model.get("ship_message_template");this.model.messageTemplate=new u(n),d.__super__.didLoad.call(this,e),this.hasMessages=t.isEmpty(e.get("messages"))!==!0,this.model.on("change:status",this.onStatusChange,this),this.model.on("save:status",this.onSave,this),this.model.get("status")===this.model.statusPending&&this.showPendingCurtain(),s.track("Opened Order Details",this.getTrackingNote())},getTemplateData:function(){if(!this.model)return{};var e=this.model.attributes,n=t.clone(e.receiver);n.country=i.getNameByCode(n.country);var r=h.payment_alternatives[e.payment_alternative],s;t.isUndefined(r)!==!0&&(s={name:r.name,url:r.url,ref_id:e.reference_id});var u,a,f=[],l=e.discounts||{},c=l.rows||[],p=c.length;for(var d=0;d<p;d++)a=c[d],u=a.data,u.reduced_price=a.reduced_price,f.push(u);var v={id:e.id,currency:e.currency,item_cost:o.formatPrice(e.item_cost),shipping_cost:o.formatPrice(e.shipping_price),tax:o.formatPrice(e.tax),tax_rate:o.formatPercentage(e.vat,4),grand_total:o.formatPrice(e.price),paid_at:e.paid_at,payment_alternative:s,has_return_policy:t.isNull(e.return_policy)!==!0,return_policy:e.return_policy,is_shipped:e.status===this.model.statusShipped,shipped_at:e.shipped_at,shipping_price:o.formatPrice(e.shipping_price),shipping:e.shipping,receiver:n,items:e.items,note:e.note,messages:e.messages,has_invoice_fee:Number(e.invoice_fee)>0,invoice_fee:o.formatPrice(e.invoice_fee),invoice_fee_vat_rate:e.invoice_fee_vat_rate,has_messages:e.messages.length!==0,shipping_company:e.shipping_company,tracking_number:e.tracking_number,show_back_link:this.showBackLink,discounts:f,has_discounts:f.length>0,is_pending:this.model.get("status")===this.model.statusPending};return v},getPrintTemplateData:function(){var e=[],t;for(var n=0;n<document.styleSheets.length;n++)t=document.styleSheets[n],t.href&&t.href.indexOf("fonts.googleapis.com")!==-1&&e.push(t.href);var i=this.getTemplateData();return i.css_files=e,i.store=r.session.getCurrentStore().attributes,i.paid_at_pretty=i.paid_at?o.getDatetime(i.paid_at):null,i.is_shipped&&(i.shipped_at_pretty=o.getDatetime(i.shipped_at)),i},getLoadedContent:function(){return n["order/manage"](this.getTemplateData())},renderContent:function(t){d.__super__.renderContent.call(this,t);if(!this.model)return;var n=e("#page"),i=300,s="easeOutExpo",o=e(window).width(),u=r.sessionStorage.getItem("order-nav-animate");r.sessionStorage.removeItem("order-nav-animate");switch(u){case"left":n.css("left",-o).animate({left:0},{easing:s,duration:i});break;case"right":n.css("left",o).animate({left:0},{easing:s,duration:i})}this.setStatusBadge(),this.setPaymentButtons(),this.renderArrows(),e(window).on("resize",this.onWindowResize),this.$("#order-products-table tbody tr").removeClass("even odd").each(function(t,n){e(n).addClass(t%2===0?"odd":"even")})},renderArrows:function(){var e="order-nav-index",n=this.getCurrentStore(),i=r.sessionStorage.getItem(e),s=n.getInitiatedForeignAttribute("orders");s.reset();if(!t.isNull(i)){var o=2,u=i-o,a=u>=0?u:0;this.table=new f({startOffset:a,batchSize:4,collection:s,id:"order-index-table",filterParamName:"query",skipAutoLoad:!0,initialFilterStatus:"inbox",loadSuccess:t.bind(this.renderArrowsCallback,this)}),this.table.loadMore()}},updateNavIndex:function(e){var t="order-nav-index",n=r.sessionStorage.getItem(t);e===!0?n++:n--,r.sessionStorage.setItem(t,n)},renderArrowsCallback:function(n){var i=[],s=this,o=n.models.length,u=this.createArrows(),a=u.find(".left"),f=u.find(".right");if(o>=2){t.each(n.models,function(e,t){i.push(e.get("id"))});var l=this.model.get("id"),c=i.indexOf(l),h=c>0,p=c+1<o,d="#page",v=400,m="easeInExpo",g=e(window).width();h?a.show().click(function(){s.removePendingCurtain(),e(d).animate({left:g,opacity:0},{duration:v,easing:m,complete:function(){a.unbind("click"),f.unbind("click"),r.sessionStorage.setItem("order-nav-animate","left"),s.keepArrows=!0,s.updateNavIndex(!1),s.navigate("/order/"+i[c-1])}})}):a.hide(),p?f.show().click(function(){s.removePendingCurtain(),e(d).animate({left:-g,opacity:0},{duration:v,easing:m,complete:function(){a.unbind("click"),f.unbind("click"),r.sessionStorage.setItem("order-nav-animate","right"),s.keepArrows=!0,s.updateNavIndex(!0),s.navigate("/order/"+i[c+1])}})}):f.hide()}else a.hide(),f.hide()},createArrows:function(){var t=e("#order-arrows");if(t.length===0){var n=e('<div class="arrow left" />'),r=e('<div class="arrow right" />');t=e('<div id="order-arrows" />'),t.append(n).append(r),e("#page").parent().append(t)}return t},dropArrows:function(){this.keepArrows||(e("#order-arrows").remove(),r.sessionStorage.removeItem("order-nav-index"),r.sessionStorage.removeItem("order-nav-animate")),this.keepArrows=!1},onWindowResize:function(t){var n=950,r=e(t.currentTarget).width();r<n?e("#order-arrows").hide("slow"):e("#order-arrows").show("slow")},setButtonLabels:function(){var e=this.model.get("status"),t=this.getCancelButton(),n=this.getShippingButton(),r=this.getStatusInfoBox();switch(e){case this.model.statusShipped:case this.model.statusCancelled:t.html("Re-open Order"),n.hide();break;case this.model.statusPending:t.hide(),n.hide();var i=this.getPendingHelpLink(),s=this.getPendingReason();r.html(s+' <a target="_blank" href="'+i+'">Click here to learn more.</a>');break;case this.model.statusDenied:t.hide(),n.hide();break;case this.model.statusReversed:t.hide(),n.hide(),r.html("This order has been reversed.");break;case this.model.statusRefunded:t.hide(),n.hide(),r.html("This order has been refunded.");break;default:t.html("Cancel Order"),n.html("Mark as Shipped"),n.show()}},setKlarnaButtonLabels:function(){var e=this.model.get("status"),t=this.getCancelButton(),n=this.getShippingButton(),r=this.getStatusInfoBox();switch(e){case this.model.statusShipped:n.hide(),t.html("Cancel Order & Refund Invoice");break;case this.model.statusCancelled:t.hide(),n.hide(),r.html("This order is paid with invoice and can not be re-opened as it has been cancelled.");break;case this.model.statusRefunded:t.hide(),n.hide(),r.html("This order is paid with invoice and can not be re-opened as it has been refunded.");break;case this.model.statusPending:t.hide(),n.hide(),r.html("This order is under manual review by Klarna.");break;case this.model.statusDenied:t.hide(),n.hide(),r.html("The customer's purchase was denied by Klarna.");break;default:t.html("Cancel Order & Tear Invoice"),n.html("Mark as Shipped & Send Invoice"),t.show(),n.show(),r.html(null)}},setPaymentButtons:function(){var e=this.model.get("payment_alternative");switch(e){case"klarna":this.setKlarnaButtonLabels();break;default:this.setButtonLabels()}},setStatusBadge:function(){var e,t=this.model.get("status");switch(t){case this.model.statusShipped:e="This order has been shipped";break;case this.model.statusCancelled:e="This order has been cancelled";break;case this.model.statusRefunded:e="This order has been refunded";break;case this.model.statusPending:e="This order is pending manual review";break;case this.model.statusDenied:e="This order's payment was denied";break;default:if(this.model.isOverdue()){var n=Math.floor(this.model.getDaysSincePayment());e="This order has not been shipped for "+n+" days."}else e="This order has not yet been shipped"}var r=this.getStatusBadge();r.attr("class",""),r.addClass(this.model.getStatusName()),r.attr("title",e)},getPendingReason:function(){var e,n=this.model.get("pending_reason"),r=this.model.get("payment_alternative");return n&&r==="paypal"&&(n=n.replace("paypal.",""),e=h.pending.reasons.paypal[n],t.isUndefined(e)&&(e=h.pending.reasons.paypal.other)),n&&r==="klarna"&&(e=h.pending.reasons.klarna),t.isUndefined(e)&&(e=h.pending.reasons.fallback),e},getPendingHelpLink:function(){var e=this.HELP_PENDING_ORDER_ARTICLE,t=this.model.get("payment_alternative");if(t==="klarna")return e;var n=this.model.get("pending_reason");return n?e+"#"+n:e},getPendingCurtain:function(){var t=this;return r.getLazy(this,"_pendingCurtain",function(){var r=t.model.get("payment_alternative"),i=t.$("#receiver-address"),s=n["order/pending_curtain"]({help_link:t.getPendingHelpLink(),help_link_text:h.pending.help_link_text,payment_gateway:r==="paypal"?"PayPal":"Klarna",pending_reason:t.getPendingReason()});s.hide(),e("body").append(s);var o=i.outerHeight(!0),u=this.$el.position().top+i.position().top;return u-=this.$(".dotted-border:first").outerHeight(),s.css({top:u+i.outerHeight(!0)/2-s.outerHeight()/2,"margin-left":-1*(s.outerWidth()/2)}),s})},removePendingCurtain:function(){this.getPendingCurtain().remove(),delete this._pendingCurtain},showPendingCurtain:function(){this.getPendingCurtain().show(),this.$el.addClass("is-pending")},hidePendingCurtain:function(){this.getPendingCurtain().hide(),this.$el.removeClass("is-pending")},printOrder:function(){var e=window.open("","printOrderWindow","menubar=no,location=no,toolbar=no,status=no"),t=e.document;t.open("text/html","replace"),t.write(n["order/print"](this.getPrintTemplateData(),!0)),t.close(),e.focus(),setTimeout(function(){e.print()},500)},getShippingButton:function(){return r.getLazy(this,"shippingButton",function(){return this.$("#order-shipped-button")})},getCancelButton:function(){return r.getLazy(this,"cancelButton",function(){return this.$("#order-cancel-button")})},getStatusInfoBox:function(){return r.getLazy(this,"statusInfoBox",function(){return this.$("#order-status-info")})},getStatusBadge:function(){return r.getLazy(this,"statusBadge",function(){return this.$("#order-status-badge")})},getProductRow:function(e){var t=r.getLazy(this,"productRowNodes",function(){return this.$("#order-products-table tbody tr")});return t.eq(e)},handleProductImageClass:function(t,n){var r=e(t.currentTarget),i=r.parent().index();this.getProductRow(i)[n]("highlighted")},onMouseOverProductImage:function(e){this.handleProductImageClass(e,"addClass")},onMouseOutProductImage:function(e){this.handleProductImageClass(e,"removeClass")},onClickProductImage:function(t){t.preventDefault();var n=new l({url:e(t.currentTarget).attr("href")});this.addChildView(n,null),n.overlay({parentView:this})},onStatusChange:function(e,r){var i="order-nav-index",o=window.sessionStorage.getItem(i);if(!t.isNull(o)){o=parseInt(o,10);var u=this.model.getStatusName()!==this.table.filterStatus?o-1:o+1;window.sessionStorage.setItem(i,u)}this.setStatusBadge(),this.setPaymentButtons(),r===e.statusPending?this.showPendingCurtain():this.hidePendingCurtain();var a=n["order/details"](this.getTemplateData());this.prepareContent(a),this.$("#order-details-container").replaceWith(a),s.track("Changed Order Status","Order is now "+this.model.getStatusName()),this.model.isShipped()&&s.track("Shipped Order",this.getTrackingNote())},onClickShipButton:function(){var e=this,t=new c({lang:h.order_ship_mail,model:this.model,shippingButtonLabel:this.getShippingButton().html()});t.on("onSave",function(e){this.model.get("send_message")&&this.onWroteMessage(this.model.get("ship_message"))},e),t.on("onDone",function(e){e.remove()},e),t.overlay({parentView:e,closeButton:!1})},onClickCancelButton:function(){var e=this.model.get("payment_alternative");switch(e){case"klarna":this.onClickCancelKlarna();break;default:this.onClickCancelPayPal()}},onClickCancelKlarna:function(){var e="Are you sure you want to cancel and refund this order?",t=confirm(e);t===!0&&(this.model.isShipped()?this.model.setRefundStatus(!this.model.isRefunded()):this.model.setCancelStatus(!this.model.isCancelled()))},onClickCancelPayPal:function(){if(this.model.isShipped())this.model.setShippedStatus(!1);else{var e="This order must be manually refunded over at PayPal",t=confirm(e);t===!0&&this.model.setCancelStatus(!this.model.isCancelled())}},onClickBack:function(e){e.preventDefault();var t=r.session.getCurrentStore().generateUrl("/orders");p.Dashboard.router.navigate(t,{trigger:!0})},getMessageContainerNode:function(){var e=this;return r.getLazy(this,"_messageContainer",function(){return e.$("#order-messages")})},onWroteMessage:function(e){var t={body:e};if(!this.hasMessages){var r=n["order/message_container"]({messages:[t]});r.hide(),this.$("#order-details-section").before(r),r.fadeIn()}else{var i=n["order/message"](t);i.hide(),this.getMessageContainerNode().append(i),i.fadeIn()}this.hasMessages=!0},onSave:function(e){}});return d}),define("tictail/model/store/theme",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Theme=e.Model.extend({API_NAMESPACE:"store.theme",API_ACTION_ABORT:{create:!0,update:!0,"delete":!0},getDefaultParams:function(){return{store_id:this.get("store_id")}}});return n}),define("dashboard/nls/themes",{root:{index:{sidebar:{navigation:{start:"Start",edit:"Edit HTML/CSS",dropbox:"Dropbox",lock:"Toggle Columns Mode"},start:{back_button:{label:"Back to Dashboard"},current_theme_heading:"Your current theme",edit_link:{label:"Edit HTML/CSS"},gallery_button:{label:"Change Theme"},mobile:{label:"Use mobile optimized layout",description:"Override your theme on mobile devices with a layout optimized for small screens."}},gallery:{back_button:{label:"Back"},use_theme_button:{label:"Use {theme_name}"},confirm_replace_message:"Are you sure you want to switch to another theme?\nThis action will permanently overwrite any edits you might have made to your current theme.",byline:"by {author_name}"},edit:{preview_button:{label:"Preview"},back_button:{label:"Back to Dashboard"},save_button:{label:"Save"},reattach_button:{label:"Restore Editor"},error_messages:{not_theme_author:"You don't have the required permissions to update this theme.\nContact support@tictail.com for more information.",theme_too_large:"Your theme can't be saved because it's too large.\nCurrently it's {cur_size} bytes and the limit is {limit} bytes.",update_failed:"An error occurred when updating your theme. Please try again or contact support@tictail.com if the problem persists."},confirm_syntax_error_message:"Your template has one or more syntax errors.\nContinue anyway?",confirm_discard_message:"You have made changes to your theme that will be lost if you leave this page. Are you sure you want to leave?",toolbar:{detach:"Open the editor in a new window",wrap_mode:"Toggle soft wrap mode",documentation:"Open the theme documentation"}}}}}}),define("dashboard/module/theme/previewcontainer",["underscore","../../model/store/base","../../view","i18n!../../nls/themes"],function(e,t,n,r){var i=500,s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.Module=s.Dashboard.Module||{},s.Dashboard.Module.Theme=s.Dashboard.Module.Theme={};var o=s.Dashboard.Module.Theme.PreviewContainer=n.extend({className:"theme-preview-container",template:"module/theme/previewcontainer",initialize:function(){o.__super__.initialize.apply(this,arguments),this.currentThemeId=this.model.id},didAppend:function(){this.bindTo(this.model,"preview",this.onPreviewTheme)},getTemplateData:function(){var e={};return this.currentThemeId&&(e.preview_url=t.generateCurrentBaseUrl("/themes/preview/"+this.currentThemeId)),e},didRender:function(){var e=this,t=null;return this.$(".theme-preview").mouseover(function(n){t===null&&(t=setTimeout(function(){t=null,e.trigger("onMouseOverPreview",e)},i))}).mouseout(function(){t!==null&&(clearTimeout(t),t=null)}),this},onPreviewTheme:function(n){this.currentThemeId=n;var r=this.$(".theme-preview");if(r.length!==0){var i=t.generateCurrentBaseUrl("/themes/preview/"),s=String(n);try{var o=r[0],u=o.contentWindow?o.contentWindow.location:o.contentDocument.location;!e.isUndefined(u)&&!e.isUndefined(u.pathname)&&u.pathname.indexOf(i)===0&&(s=u.pathname.substr(i.length),s=s.replace(/^[0-9]+/,String(n)))}catch(a){}r.attr("src",i+s)}else this.render()}});return o}),function(){function o(e){var i=function(e,t){return r("",e,t)},s=t;e&&(t[e]||(t[e]={}),s=t[e]);if(!s.define||!s.define.packaged)n.original=s.define,s.define=n,s.define.packaged=!0;if(!s.require||!s.require.packaged)r.original=s.require,s.require=i,s.require.packaged=!0}var e="",t=function(){return this}();if(!e&&typeof requirejs!="undefined")return;var n=function(e,t,r){if(typeof e!="string"){n.original?n.original.apply(window,arguments):(console.error("dropping module because define wasn't a string."),console.trace());return}arguments.length==2&&(r=t),n.modules||(n.modules={},n.payloads={}),n.payloads[e]=r,n.modules[e]=null},r=function(e,t,n){if(Object.prototype.toString.call(t)==="[object Array]"){var i=[];for(var o=0,u=t.length;o<u;++o){var a=s(e,t[o]);if(!a&&r.original)return r.original.apply(window,arguments);i.push(a)}n&&n.apply(null,i)}else{if(typeof t=="string"){var f=s(e,t);return!f&&r.original?r.original.apply(window,arguments):(n&&n(),f)}if(r.original)return r.original.apply(window,arguments)}},i=function(e,t){if(t.indexOf("!")!==-1){var n=t.split("!");return i(e,n[0])+"!"+i(e,n[1])}if(t.charAt(0)=="."){var r=e.split("/").slice(0,-1).join("/");t=r+"/"+t;while(t.indexOf(".")!==-1&&s!=t){var s=t;t=t.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return t},s=function(e,t){t=i(e,t);var s=n.modules[t];if(!s){s=n.payloads[t];if(typeof s=="function"){var o={},u={id:t,uri:"",exports:o,packaged:!0},a=function(e,n){return r(t,e,n)},f=s(a,o,u);o=f||u.exports,n.modules[t]=o,delete n.payloads[t]}s=n.modules[t]=o||s}return s};o(e)}(),define("ace/ace",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/dom","ace/lib/event","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/multi_select","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config"],function(e,t,n){e("./lib/fixoldbrowsers");var r=e("./lib/dom"),i=e("./lib/event"),s=e("./editor").Editor,o=e("./edit_session").EditSession,u=e("./undomanager").UndoManager,a=e("./virtual_renderer").VirtualRenderer,f=e("./multi_select").MultiSelect;e("./worker/worker_client"),e("./keyboard/hash_handler"),e("./placeholder"),e("./mode/folding/fold_mode"),e("./theme/textmate"),e("./ext/error_marker"),t.config=e("./config"),t.require=e,t.edit=function(e){if(typeof e=="string"){var n=e,e=document.getElementById(n);if(!e)throw new Error("ace.edit can't find div #"+n)}if(e.env&&e.env.editor instanceof s)return e.env.editor;var o=t.createEditSession(r.getInnerText(e));e.innerHTML="";var u=new s(new a(e));new f(u),u.setSession(o);var l={document:o,editor:u,onResize:u.resize.bind(u,null)};return i.addListener(window,"resize",l.onResize),u.on("destroy",function(){i.removeListener(window,"resize",l.onResize)}),e.env=u.env=l,u},t.createEditSession=function(e,t){var n=new o(e,t);return n.setUndoManager(new u),n},t.EditSession=o,t.UndoManager=u}),define("ace/mode/behaviour",["require","exports","module"],function(e,t,n){var r=function(){this.$behaviours={}};(function(){this.add=function(e,t,n){switch(undefined){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][t]=n},this.addBehaviours=function(e){for(var t in e)for(var n in e[t])this.add(t,n,e[t][n])},this.remove=function(e){this.$behaviours&&this.$behaviours[e]&&delete this.$behaviours[e]},this.inherit=function(e,t){if(typeof e=="function")var n=(new e).getBehaviours(t);else var n=e.getBehaviours(t);this.addBehaviours(n)},this.getBehaviours=function(e){if(!e)return this.$behaviours;var t={};for(var n=0;n<e.length;n++)this.$behaviours[e[n]]&&(t[e[n]]=this.$behaviours[e[n]]);return t}}).call(r.prototype),t.Behaviour=r}),define("ace/unicode",["require","exports","module"],function(e,t,n){function r(e){var n=/\w{4}/g;for(var r in e)t.packages[r]=e[r].replace(n,"\\u$&")}t.packages={},r({L:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05250531-055605590561-058705D0-05EA05F0-05F20621-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280904-0939093D09500958-0961097109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510D0-10FA10FC1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209421022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2D00-2D252D30-2D652D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A65FA662-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78BA78CA7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Ll:"0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F0521052305250561-05871D00-1D2B1D62-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7C2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2D00-2D25A641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CFB00-FB06FB13-FB17FF41-FF5A",Lu:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E0520052205240531-055610A0-10C51E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CEDA640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BFF21-FF3A",Lt:"01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",Lm:"02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D611D781D9B-1DBF2071207F2090-20942C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A9CFAA70AADDFF70FF9EFF9F",Lo:"01BB01C0-01C3029405D0-05EA05F0-05F20621-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150904-0939093D09500958-096109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF12135-21382D30-2D652D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",M:"0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DE-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0903093C093E-094E0951-0955096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F90-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135F1712-17141732-1734175217531772177317B6-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAA1C24-1C371CD0-1CD21CD4-1CE81CED1CF21DC0-1DE61DFD-1DFF20D0-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66F-A672A67CA67DA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",Mn:"0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0902093C0941-0948094D0951-095509620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F90-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135F1712-17141732-1734175217531772177317B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1DC0-1DE61DFD-1DFF20D0-20DC20E120E5-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66FA67CA67DA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",Mc:"0903093E-09400949-094C094E0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1C24-1C2B1C341C351CE11CF2A823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BABE3ABE4ABE6ABE7ABE9ABEAABEC",Me:"0488048906DE20DD-20E020E2-20E4A670-A672",N:"0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nd:"0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nl:"16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",No:"00B200B300B900BC-00BE09F4-09F90BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F920702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293251-325F3280-328932B1-32BFA830-A835",P:"0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100AB00B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F3A-0F3D0F850FD0-0FD4104A-104F10FB1361-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2E00-2E2E2E302E313001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",Pd:"002D058A05BE140018062010-20152E172E1A301C303030A0FE31FE32FE58FE63FF0D",Ps:"0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",Pe:"0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",Pi:"00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",Pf:"00BB2019201D203A2E032E052E0A2E0D2E1D2E21",Pc:"005F203F20402054FE33FE34FE4D-FE4FFF3F",Po:"0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F850FD0-0FD4104A-104F10FB1361-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E302E313001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",S:"0024002B003C-003E005E0060007C007E00A2-00A900AC00AE-00B100B400B600B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F604820606-0608060B060E060F06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0CF10CF20D790E3F0F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-139917DB194019E0-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B8210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23E82400-24262440-244A249C-24E92500-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE27C0-27C427C7-27CA27CC27D0-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",Sm:"002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C2140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27CA27CC27D0-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",Sc:"002400A2-00A5060B09F209F309FB0AF10BF90E3F17DB20A0-20B8A838FDFCFE69FF04FFE0FFE1FFE5FFE6",Sk:"005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFF3EFF40FFE3",So:"00A600A700A900AE00B000B60482060E060F06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0CF10CF20D790F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-1399194019E0-19FF1B61-1B6A1B74-1B7C210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23E82400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",Z:"002000A01680180E2000-200A20282029202F205F3000",Zs:"002000A01680180E2000-200A202F205F3000",Zl:"2028",Zp:"2029",C:"0000-001F007F-009F00AD03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-0605061C061D0620065F06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17B417B517DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",Cc:"0000-001F007F-009F",Cf:"00AD0600-060306DD070F17B417B5200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",Co:"E000-F8FF",Cs:"D800-DFFF",Cn:"03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-05FF06040605061C061D0620065F070E074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"})}),define("ace/token_iterator",["require","exports","module"],function(e,t,n){var r=function(e,t,n){this.$session=e,this.$row=t,this.$rowTokens=e.getTokens(t);var r=e.getTokenAt(t,n);this.$tokenIndex=r?r.index:-1};(function(){this.stepBackward=function(){this.$tokenIndex-=1;while(this.$tokenIndex<0){this.$row-=1;if(this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){this.$tokenIndex+=1;var e;while(this.$tokenIndex>=this.$rowTokens.length){this.$row+=1,e||(e=this.$session.getLength());if(this.$row>=e)return this.$row=e-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var e=this.$rowTokens,t=this.$tokenIndex,n=e[t].start;if(n!==undefined)return n;n=0;while(t>0)t-=1,n+=e[t].value.length;return n}}).call(r.prototype),t.TokenIterator=r}),define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],function(e,t,n){var r=e("../lib/lang"),i=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(e,t){if(!t){for(var n in e)this.$rules[n]=e[n];return}for(var n in e){var r=e[n];for(var i=0;i<r.length;i++){var s=r[i];s.next&&(typeof s.next!="string"?s.nextState&&s.nextState.indexOf(t)!==0&&(s.nextState=t+s.nextState):s.next.indexOf(t)!==0&&(s.next=t+s.next))}this.$rules[t+n]=r}},this.getRules=function(){return this.$rules},this.embedRules=function(e,t,n,i,s){var o=typeof e=="function"?(new e).getRules():e;if(i)for(var u=0;u<i.length;u++)i[u]=t+i[u];else{i=[];for(var a in o)i.push(t+a)}this.addRules(o,t);if(n){var f=Array.prototype[s?"push":"unshift"];for(var u=0;u<i.length;u++)f.apply(this.$rules[i[u]],r.deepCopy(n))}this.$embeds||(this.$embeds=[]),this.$embeds.push(t)},this.getEmbeds=function(){return this.$embeds};var e=function(e,t){return(e!="start"||t.length)&&t.unshift(this.nextState,e),this.nextState},t=function(e,t){return t.shift(),t.shift()||"start"};this.normalizeRules=function(){function i(s){var o=r[s];o.processed=!0;for(var u=0;u<o.length;u++){var a=o[u];!a.regex&&a.start&&(a.regex=a.start,a.next||(a.next=[]),a.next.push({defaultToken:a.token},{token:a.token+".end",regex:a.end||a.start,next:"pop"}),a.token=a.token+".start",a.push=!0);var f=a.next||a.push;if(f&&Array.isArray(f)){var l=a.stateName;l||(l=a.token,typeof l!="string"&&(l=l[0]||""),r[l]&&(l+=n++)),r[l]=f,a.next=l,i(l)}else f=="pop"&&(a.next=t);a.push&&(a.nextState=a.next||a.push,a.next=e,delete a.push);if(a.rules)for(var c in a.rules)r[c]?r[c].push&&r[c].push.apply(r[c],a.rules[c]):r[c]=a.rules[c];if(a.include||typeof a=="string")var h=a.include||a,p=r[h];else Array.isArray(a)&&(p=a);if(p){var d=[u,1].concat(p);a.noEscape&&(d=d.filter(function(e){return!e.next})),o.splice.apply(o,d),u--,p=null}a.keywordMap&&(a.token=this.createKeywordMapper(a.keywordMap,a.defaultToken||"text",a.caseInsensitive),delete a.defaultToken)}}var n=0,r=this.$rules;Object.keys(r).forEach(i,this)},this.createKeywordMapper=function(e,t,n,r){var i=Object.create(null);return Object.keys(e).forEach(function(t){var s=e[t];n&&(s=s.toLowerCase());var o=s.split(r||"|");for(var u=o.length;u--;)i[o[u]]=t}),Object.getPrototypeOf(i)&&(i.__proto__=null),this.$keywordList=Object.keys(i),e=null,n?function(e){return i[e.toLowerCase()]||t}:function(e){return i[e]||t}},this.getKeywords=function(){return this.$keywords}}).call(i.prototype),t.TextHighlightRules=i}),define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/event_emitter").EventEmitter,s=t.Anchor=function(e,t,n){this.$onChange=this.onChange.bind(this),this.attach(e),typeof n=="undefined"?this.setPosition(t.row,t.column):this.setPosition(t,n)};(function(){r.implement(this,i),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(e){var t=e.data,n=t.range;if(n.start.row==n.end.row&&n.start.row!=this.row)return;if(n.start.row>this.row)return;if(n.start.row==this.row&&n.start.column>this.column)return;var r=this.row,i=this.column,s=n.start,o=n.end;if(t.action==="insertText")if(s.row===r&&s.column<=i){if(s.column!==i||!this.$insertRight)s.row===o.row?i+=o.column-s.column:(i-=s.column,r+=o.row-s.row)}else s.row!==o.row&&s.row<r&&(r+=o.row-s.row);else t.action==="insertLines"?s.row<=r&&(r+=o.row-s.row):t.action==="removeText"?s.row===r&&s.column<i?o.column>=i?i=s.column:i=Math.max(0,i-(o.column-s.column)):s.row!==o.row&&s.row<r?(o.row===r&&(i=Math.max(0,i-o.column)+s.column),r-=o.row-s.row):o.row===r&&(r-=o.row-s.row,i=Math.max(0,i-o.column)+s.column):t.action=="removeLines"&&s.row<=r&&(o.row<=r?r-=o.row-s.row:(r=s.row,i=0));this.setPosition(r,i,!0)},this.setPosition=function(e,t,n){var r;n?r={row:e,column:t}:r=this.$clipPositionToDocument(e,t);if(this.row==r.row&&this.column==r.column)return;var i={row:this.row,column:this.column};this.row=r.row,this.column=r.column,this._signal("change",{old:i,value:r})},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.attach=function(e){this.document=e||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(e,t){var n={};return e>=this.document.getLength()?(n.row=Math.max(0,this.document.getLength()-1),n.column=this.document.getLine(n.row).length):e<0?(n.row=0,n.column=0):(n.row=e,n.column=Math.min(this.document.getLine(n.row).length,Math.max(0,t))),t<0&&(n.column=0),n}}).call(s.prototype)}),define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/event_emitter").EventEmitter,s=function(e,t){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=e;var n=this;this.$worker=function(){if(!n.running)return;var e=new Date,t=n.currentLine,r=-1,i=n.doc;while(n.lines[t])t++;var s=t,o=i.getLength(),u=0;n.running=!1;while(t<o){n.$tokenizeRow(t),r=t;do t++;while(n.lines[t]);u++;if(u%5==0&&new Date-e>20){n.running=setTimeout(n.$worker,20),n.currentLine=t;return}}n.currentLine=t,s<=r&&n.fireUpdateEvent(s,r)}};(function(){r.implement(this,i),this.setTokenizer=function(e){this.tokenizer=e,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(e){this.doc=e,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(e,t){var n={first:e,last:t};this._signal("update",{data:n})},this.start=function(e){this.currentLine=Math.min(e||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(e){var t=e.range,n=t.start.row,r=t.end.row-n;if(r===0)this.lines[n]=null;else if(e.action=="removeText"||e.action=="removeLines")this.lines.splice(n,r+1,null),this.states.splice(n,r+1,null);else{var i=Array(r+1);i.unshift(n,1),this.lines.splice.apply(this.lines,i),this.states.splice.apply(this.states,i)}this.currentLine=Math.min(n,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(e){return this.lines[e]||this.$tokenizeRow(e)},this.getState=function(e){return this.currentLine==e&&this.$tokenizeRow(e),this.states[e]||"start"},this.$tokenizeRow=function(e){var t=this.doc.getLine(e),n=this.states[e-1],r=this.tokenizer.getLineTokens(t,n,e);return this.states[e]+""!=r.state+""?(this.states[e]=r.state,this.lines[e+1]=null,this.currentLine>e+1&&(this.currentLine=e+1)):this.currentLine==e&&(this.currentLine=e+1),this.lines[e]=r.tokens}}).call(s.prototype),t.BackgroundTokenizer=s}),define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(e,t,n){var r=e("./lib/lang"),i=e("./lib/oop"),s=e("./range").Range,o=function(e,t,n){this.setRegexp(e),this.clazz=t,this.type=n||"text"};(function(){this.MAX_RANGES=500,this.setRegexp=function(e){if(this.regExp+""==e+"")return;this.regExp=e,this.cache=[]},this.update=function(e,t,n,i){if(!this.regExp)return;var o=i.firstRow,u=i.lastRow;for(var a=o;a<=u;a++){var f=this.cache[a];f==null&&(f=r.getMatchOffsets(n.getLine(a),this.regExp),f.length>this.MAX_RANGES&&(f=f.slice(0,this.MAX_RANGES)),f=f.map(function(e){return new s(a,e.offset,a,e.offset+e.length)}),this.cache[a]=f.length?f:"");for(var l=f.length;l--;)t.drawSingleLineMarker(e,f[l].toScreenRange(n),this.clazz,i)}}}).call(o.prototype),t.SearchHighlight=o}),define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"],function(e,t,n){function u(){this.getFoldAt=function(e,t,n){var r=this.getFoldLine(e);if(!r)return null;var i=r.folds;for(var s=0;s<i.length;s++){var o=i[s];if(o.range.contains(e,t)){if(n==1&&o.range.isEnd(e,t))continue;if(n==-1&&o.range.isStart(e,t))continue;return o}}},this.getFoldsInRange=function(e){var t=e.start,n=e.end,r=this.$foldData,i=[];t.column+=1,n.column-=1;for(var s=0;s<r.length;s++){var o=r[s].range.compareRange(e);if(o==2)continue;if(o==-2)break;var u=r[s].folds;for(var a=0;a<u.length;a++){var f=u[a];o=f.range.compareRange(e);if(o==-2)break;if(o==2)continue;if(o==42)break;i.push(f)}}return t.column-=1,n.column+=1,i},this.getFoldsInRangeList=function(e){if(Array.isArray(e)){var t=[];e.forEach(function(e){t=t.concat(this.getFoldsInRange(e))},this)}else var t=this.getFoldsInRange(e);return t},this.getAllFolds=function(){var e=[],t=this.$foldData;for(var n=0;n<t.length;n++)for(var r=0;r<t[n].folds.length;r++)e.push(t[n].folds[r]);return e},this.getFoldStringAt=function(e,t,n,r){r=r||this.getFoldLine(e);if(!r)return null;var i={end:{column:0}},s,o;for(var u=0;u<r.folds.length;u++){o=r.folds[u];var a=o.range.compareEnd(e,t);if(a==-1){s=this.getLine(o.start.row).substring(i.end.column,o.start.column);break}if(a===0)return null;i=o}return s||(s=this.getLine(o.start.row).substring(i.end.column)),n==-1?s.substring(0,t-i.end.column):n==1?s.substring(t-i.end.column):s},this.getFoldLine=function(e,t){var n=this.$foldData,r=0;t&&(r=n.indexOf(t)),r==-1&&(r=0);for(r;r<n.length;r++){var i=n[r];if(i.start.row<=e&&i.end.row>=e)return i;if(i.end.row>e)return null}return null},this.getNextFoldLine=function(e,t){var n=this.$foldData,r=0;t&&(r=n.indexOf(t)),r==-1&&(r=0);for(r;r<n.length;r++){var i=n[r];if(i.end.row>=e)return i}return null},this.getFoldedRowCount=function(e,t){var n=this.$foldData,r=t-e+1;for(var i=0;i<n.length;i++){var s=n[i],o=s.end.row,u=s.start.row;if(o>=t){u<t&&(u>=e?r-=t-u:r=0);break}o>=e&&(u>=e?r-=o-u:r-=o-e+1)}return r},this.$addFoldLine=function(e){return this.$foldData.push(e),this.$foldData.sort(function(e,t){return e.start.row-t.start.row}),e},this.addFold=function(e,t){var n=this.$foldData,r=!1,o;e instanceof s?o=e:(o=new s(t,e),o.collapseChildren=t.collapseChildren),this.$clipRangeToDocument(o.range);var u=o.start.row,a=o.start.column,f=o.end.row,l=o.end.column;if(u<f||u==f&&a<=l-2){var c=this.getFoldAt(u,a,1),h=this.getFoldAt(f,l,-1);if(c&&h==c)return c.addSubFold(o);if(c&&!c.range.isStart(u,a)||h&&!h.range.isEnd(f,l))throw new Error("A fold can't intersect already existing fold"+o.range+c.range);var p=this.getFoldsInRange(o.range);p.length>0&&(this.removeFolds(p),p.forEach(function(e){o.addSubFold(e)}));for(var d=0;d<n.length;d++){var v=n[d];if(f==v.start.row){v.addFold(o),r=!0;break}if(u==v.end.row){v.addFold(o),r=!0;if(!o.sameRow){var m=n[d+1];if(m&&m.start.row==f){v.merge(m);break}}break}if(f<=v.start.row)break}return r||(v=this.$addFoldLine(new i(this.$foldData,o))),this.$useWrapMode?this.$updateWrapData(v.start.row,v.start.row):this.$updateRowLengthCache(v.start.row,v.start.row),this.$modified=!0,this._emit("changeFold",{data:o,action:"add"}),o}throw new Error("The range has to be at least 2 characters width")},this.addFolds=function(e){e.forEach(function(e){this.addFold(e)},this)},this.removeFold=function(e){var t=e.foldLine,n=t.start.row,r=t.end.row,i=this.$foldData,s=t.folds;if(s.length==1)i.splice(i.indexOf(t),1);else if(t.range.isEnd(e.end.row,e.end.column))s.pop(),t.end.row=s[s.length-1].end.row,t.end.column=s[s.length-1].end.column;else if(t.range.isStart(e.start.row,e.start.column))s.shift(),t.start.row=s[0].start.row,t.start.column=s[0].start.column;else if(e.sameRow)s.splice(s.indexOf(e),1);else{var o=t.split(e.start.row,e.start.column);s=o.folds,s.shift(),o.start.row=s[0].start.row,o.start.column=s[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(n,r):this.$updateRowLengthCache(n,r)),this.$modified=!0,this._emit("changeFold",{data:e,action:"remove"})},this.removeFolds=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e[n]);t.forEach(function(e){this.removeFold(e)},this),this.$modified=!0},this.expandFold=function(e){this.removeFold(e),e.subFolds.forEach(function(t){e.restoreRange(t),this.addFold(t)},this),e.collapseChildren>0&&this.foldAll(e.start.row+1,e.end.row,e.collapseChildren-1),e.subFolds=[]},this.expandFolds=function(e){e.forEach(function(e){this.expandFold(e)},this)},this.unfold=function(e,t){var n,i;e==null?(n=new r(0,0,this.getLength(),0),t=!0):typeof e=="number"?n=new r(e,0,e,this.getLine(e).length):"row"in e?n=r.fromPoints(e,e):n=e,i=this.getFoldsInRangeList(n);if(t)this.removeFolds(i);else{var s=i;while(s.length)this.expandFolds(s),s=this.getFoldsInRangeList(n)}if(i.length)return i},this.isRowFolded=function(e,t){return!!this.getFoldLine(e,t)},this.getRowFoldEnd=function(e,t){var n=this.getFoldLine(e,t);return n?n.end.row:e},this.getRowFoldStart=function(e,t){var n=this.getFoldLine(e,t);return n?n.start.row:e},this.getFoldDisplayLine=function(e,t,n,r,i){r==null&&(r=e.start.row,i=0),t==null&&(t=e.end.row,n=this.getLine(t).length);var s=this.doc,o="";return e.walk(function(e,t,n,u){if(t<r)return;if(t==r){if(n<i)return;u=Math.max(i,u)}e!=null?o+=e:o+=s.getLine(t).substring(u,n)},t,n),o},this.getDisplayLine=function(e,t,n,r){var i=this.getFoldLine(e);if(!i){var s;return s=this.doc.getLine(e),s.substring(r||0,t||s.length)}return this.getFoldDisplayLine(i,e,t,n,r)},this.$cloneFoldData=function(){var e=[];return e=this.$foldData.map(function(t){var n=t.folds.map(function(e){return e.clone()});return new i(e,n)}),e},this.toggleFold=function(e){var t=this.selection,n=t.getRange(),r,i;if(n.isEmpty()){var s=n.start;r=this.getFoldAt(s.row,s.column);if(r){this.expandFold(r);return}(i=this.findMatchingBracket(s))?n.comparePoint(i)==1?n.end=i:(n.start=i,n.start.column++,n.end.column--):(i=this.findMatchingBracket({row:s.row,column:s.column+1}))?(n.comparePoint(i)==1?n.end=i:n.start=i,n.start.column++):n=this.getCommentFoldRange(s.row,s.column)||n}else{var o=this.getFoldsInRange(n);if(e&&o.length){this.expandFolds(o);return}o.length==1&&(r=o[0])}r||(r=this.getFoldAt(n.start.row,n.start.column));if(r&&r.range.toString()==n.toString()){this.expandFold(r);return}var u="...";if(!n.isMultiLine()){u=this.getTextRange(n);if(u.length<4)return;u=u.trim().substring(0,2)+".."}this.addFold(u,n)},this.getCommentFoldRange=function(e,t,n){var i=new o(this,e,t),s=i.getCurrentToken();if(s&&/^comment|string/.test(s.type)){var u=new r,a=new RegExp(s.type.replace(/\..*/,"\\."));if(n!=1){do s=i.stepBackward();while(s&&a.test(s.type));i.stepForward()}u.start.row=i.getCurrentTokenRow(),u.start.column=i.getCurrentTokenColumn()+2,i=new o(this,e,t);if(n!=-1){do s=i.stepForward();while(s&&a.test(s.type));s=i.stepBackward()}else s=i.getCurrentToken();return u.end.row=i.getCurrentTokenRow(),u.end.column=i.getCurrentTokenColumn()+s.value.length-2,u}},this.foldAll=function(e,t,n){n==undefined&&(n=1e5);var r=this.foldWidgets;if(!r)return;t=t||this.getLength(),e=e||0;for(var i=e;i<t;i++){r[i]==null&&(r[i]=this.getFoldWidget(i));if(r[i]!="start")continue;var s=this.getFoldWidgetRange(i);if(s&&s.isMultiLine()&&s.end.row<=t&&s.start.row>=e){i=s.end.row;try{var o=this.addFold("...",s);o&&(o.collapseChildren=n)}catch(u){}}}},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(e){if(!this.$foldStyles[e])throw new Error("invalid fold style: "+e+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle==e)return;this.$foldStyle=e,e=="manual"&&this.unfold();var t=this.$foldMode;this.$setFolding(null),this.$setFolding(t)},this.$setFolding=function(e){if(this.$foldMode==e)return;this.$foldMode=e,this.removeListener("change",this.$updateFoldWidgets),this._emit("changeAnnotation");if(!e||this.$foldStyle=="manual"){this.foldWidgets=null;return}this.foldWidgets=[],this.getFoldWidget=e.getFoldWidget.bind(e,this,this.$foldStyle),this.getFoldWidgetRange=e.getFoldWidgetRange.bind(e,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets)},this.getParentFoldRangeData=function(e,t){var n=this.foldWidgets;if(!n||t&&n[e])return{};var r=e-1,i;while(r>=0){var s=n[r];s==null&&(s=n[r]=this.getFoldWidget(r));if(s=="start"){var o=this.getFoldWidgetRange(r);i||(i=o);if(o&&o.end.row>=e)break}r--}return{range:r!==-1&&o,firstRange:i}},this.onFoldWidgetClick=function(e,t){t=t.domEvent;var n={children:t.shiftKey,all:t.ctrlKey||t.metaKey,siblings:t.altKey},r=this.$toggleFoldWidget(e,n);if(!r){var i=t.target||t.srcElement;i&&/ace_fold-widget/.test(i.className)&&(i.className+=" ace_invalid")}},this.$toggleFoldWidget=function(e,t){if(!this.getFoldWidget)return;var n=this.getFoldWidget(e),r=this.getLine(e),i=n==="end"?-1:1,s=this.getFoldAt(e,i===-1?0:r.length,i);if(s){t.children||t.all?this.removeFold(s):this.expandFold(s);return}var o=this.getFoldWidgetRange(e,!0);if(o&&!o.isMultiLine()){s=this.getFoldAt(o.start.row,o.start.column,1);if(s&&o.isEqual(s.range)){this.removeFold(s);return}}if(t.siblings){var u=this.getParentFoldRangeData(e);if(u.range)var a=u.range.start.row+1,f=u.range.end.row;this.foldAll(a,f,t.all?1e4:0)}else t.children?(f=o?o.end.row:this.getLength(),this.foldAll(e+1,o.end.row,t.all?1e4:0)):o&&(t.all&&(o.collapseChildren=1e4),this.addFold("...",o));return o},this.toggleFoldWidget=function(e){var t=this.selection.getCursor().row;t=this.getRowFoldStart(t);var n=this.$toggleFoldWidget(t,{});if(n)return;var r=this.getParentFoldRangeData(t,!0);n=r.range||r.firstRange;if(n){t=n.start.row;var i=this.getFoldAt(t,this.getLine(t).length,1);i?this.removeFold(i):this.addFold("...",n)}},this.updateFoldWidgets=function(e){var t=e.data,n=t.range,r=n.start.row,i=n.end.row-r;if(i===0)this.foldWidgets[r]=null;else if(t.action=="removeText"||t.action=="removeLines")this.foldWidgets.splice(r,i+1,null);else{var s=Array(i+1);s.unshift(r,1),this.foldWidgets.splice.apply(this.foldWidgets,s)}}}var r=e("../range").Range,i=e("./fold_line").FoldLine,s=e("./fold").Fold,o=e("../token_iterator").TokenIterator;t.Folding=u}),define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(e,t,n){function i(e,t){this.foldData=e,Array.isArray(t)?this.folds=t:t=this.folds=[t];var n=t[t.length-1];this.range=new r(t[0].start.row,t[0].start.column,n.end.row,n.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(e){e.setFoldLine(this)},this)}var r=e("../range").Range;(function(){this.shiftRow=function(e){this.start.row+=e,this.end.row+=e,this.folds.forEach(function(t){t.start.row+=e,t.end.row+=e})},this.addFold=function(e){if(e.sameRow){if(e.start.row<this.startRow||e.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(e),this.folds.sort(function(e,t){return-e.range.compareEnd(t.start.row,t.start.column)}),this.range.compareEnd(e.start.row,e.start.column)>0?(this.end.row=e.end.row,this.end.column=e.end.column):this.range.compareStart(e.end.row,e.end.column)<0&&(this.start.row=e.start.row,this.start.column=e.start.column)}else if(e.start.row==this.end.row)this.folds.push(e),this.end.row=e.end.row,this.end.column=e.end.column;else{if(e.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(e),this.start.row=e.start.row,this.start.column=e.start.column}e.foldLine=this},this.containsRow=function(e){return e>=this.start.row&&e<=this.end.row},this.walk=function(e,t,n){var r=0,i=this.folds,s,o,u,a=!0;t==null&&(t=this.end.row,n=this.end.column);for(var f=0;f<i.length;f++){s=i[f],o=s.range.compareStart(t,n);if(o==-1){e(null,t,n,r,a);return}u=e(null,s.start.row,s.start.column,r,a),u=!u&&e(s.placeholder,s.start.row,s.start.column,r);if(u||o==0)return;a=!s.sameRow,r=s.end.column}e(null,t,n,r,a)},this.getNextFoldTo=function(e,t){var n,r;for(var i=0;i<this.folds.length;i++){n=this.folds[i],r=n.range.compareEnd(e,t);if(r==-1)return{fold:n,kind:"after"};if(r==0)return{fold:n,kind:"inside"}}return null},this.addRemoveChars=function(e,t,n){var r=this.getNextFoldTo(e,t),i,s;if(r){i=r.fold;if(r.kind=="inside"&&i.start.column!=t&&i.start.row!=e)window.console&&window.console.log(e,t,i);else if(i.start.row==e){s=this.folds;var o=s.indexOf(i);o==0&&(this.start.column+=n);for(o;o<s.length;o++){i=s[o],i.start.column+=n;if(!i.sameRow)return;i.end.column+=n}this.end.column+=n}}},this.split=function(e,t){var n=this.getNextFoldTo(e,t).fold,r=this.folds,s=this.foldData;if(!n)return null;var o=r.indexOf(n),u=r[o-1];this.end.row=u.end.row,this.end.column=u.end.column,r=r.splice(o,r.length-o);var a=new i(s,r);return s.splice(s.indexOf(this)+1,0,a),a},this.merge=function(e){var t=e.folds;for(var n=0;n<t.length;n++)this.addFold(t[n]);var r=this.foldData;r.splice(r.indexOf(e),1)},this.toString=function(){var e=[this.range.toString()+": ["];return this.folds.forEach(function(t){e.push("  "+t.toString())}),e.push("]"),e.join("\n")},this.idxToPosition=function(e){var t=0,n;for(var r=0;r<this.folds.length;r++){var n=this.folds[r];e-=n.start.column-t;if(e<0)return{row:n.start.row,column:n.start.column+e};e-=n.placeholder.length;if(e<0)return n.start;t=n.end.column}return{row:this.end.row,column:this.end.column+e}}}).call(i.prototype),t.FoldLine=i}),define("ace/tokenizer",["require","exports","module"],function(e,t,n){var r=1e3,i=function(e){this.states=e,this.regExps={},this.matchMappings={};for(var t in this.states){var n=this.states[t],r=[],i=0,s=this.matchMappings[t]={defaultToken:"text"},o="g",u=[];for(var a=0;a<n.length;a++){var f=n[a];f.defaultToken&&(s.defaultToken=f.defaultToken),f.caseInsensitive&&(o="gi");if(f.regex==null)continue;f.regex instanceof RegExp&&(f.regex=f.regex.toString().slice(1,-1));var l=f.regex,c=(new RegExp("(?:("+l+")|(.))")).exec("a").length-2;if(Array.isArray(f.token))if(f.token.length==1||c==1)f.token=f.token[0];else{if(c-1!=f.token.length)throw new Error("number of classes and regexp groups in '"+f.token+"'\n'"+f.regex+"' doesn't match\n"+(c-1)+"!="+f.token.length);f.tokenArray=f.token,f.token=null,f.onMatch=this.$arrayTokens}else typeof f.token=="function"&&!f.onMatch&&(c>1?f.onMatch=this.$applyToken:f.onMatch=f.token);c>1&&(/\\\d/.test(f.regex)?l=f.regex.replace(/\\([0-9]+)/g,function(e,t){return"\\"+(parseInt(t,10)+i+1)}):(c=1,l=this.removeCapturingGroups(f.regex)),!f.splitRegex&&typeof f.token!="string"&&u.push(f)),s[i]=a,i+=c,r.push(l),f.onMatch||(f.onMatch=null),f.__proto__=null}u.forEach(function(e){e.splitRegex=this.createSplitterRegexp(e.regex,o)},this),this.regExps[t]=new RegExp("("+r.join(")|(")+")|($)",o)}};(function(){this.$setMaxTokenCount=function(e){r=e|0},this.$applyToken=function(e){var t=this.splitRegex.exec(e).slice(1),n=this.token.apply(this,t);if(typeof n=="string")return[{type:n,value:e}];var r=[];for(var i=0,s=n.length;i<s;i++)t[i]&&(r[r.length]={type:n[i],value:t[i]});return r},this.$arrayTokens=function(e){if(!e)return[];var t=this.splitRegex.exec(e);if(!t)return"text";var n=[],r=this.tokenArray;for(var i=0,s=r.length;i<s;i++)t[i+1]&&(n[n.length]={type:r[i],value:t[i+1]});return n},this.removeCapturingGroups=function(e){var t=e.replace(/\[(?:\\.|[^\]])*?\]|\\.|\(\?[:=!]|(\()/g,function(e,t){return t?"(?:":e});return t},this.createSplitterRegexp=function(e,t){if(e.indexOf("(?=")!=-1){var n=0,r=!1,i={};e.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(e,t,s,o,u,a){return r?r=u!="]":u?r=!0:o?(n==i.stack&&(i.end=a+1,i.stack=-1),n--):s&&(n++,s.length!=1&&(i.stack=n,i.start=a)),e}),i.end!=null&&/^\)*$/.test(e.substr(i.end))&&(e=e.substring(0,i.start)+e.substr(i.end))}return new RegExp(e,(t||"").replace("g",""))},this.getLineTokens=function(e,t){if(t&&typeof t!="string"){var n=t.slice(0);t=n[0]}else var n=[];var i=t||"start",s=this.states[i];s||(i="start",s=this.states[i]);var o=this.matchMappings[i],u=this.regExps[i];u.lastIndex=0;var a,f=[],l=0,c={type:null,value:""};while(a=u.exec(e)){var h=o.defaultToken,p=null,d=a[0],v=u.lastIndex;if(v-d.length>l){var m=e.substring(l,v-d.length);c.type==h?c.value+=m:(c.type&&f.push(c),c={type:h,value:m})}for(var g=0;g<a.length-2;g++){if(a[g+1]===undefined)continue;p=s[o[g]],p.onMatch?h=p.onMatch(d,i,n):h=p.token,p.next&&(typeof p.next=="string"?i=p.next:i=p.next(i,n),s=this.states[i],s||(window.console&&console.error&&console.error(i,"doesn't exist"),i="start",s=this.states[i]),o=this.matchMappings[i],l=v,u=this.regExps[i],u.lastIndex=v);break}if(d)if(typeof h=="string")!!p&&p.merge===!1||c.type!==h?(c.type&&f.push(c),c={type:h,value:d}):c.value+=d;else if(h){c.type&&f.push(c),c={type:null,value:""};for(var g=0;g<h.length;g++)f.push(h[g])}if(l==e.length)break;l=v;if(f.length>r){while(l<e.length)c.type&&f.push(c),c={value:e.substring(l,l+=2e3),type:"overflow"};i="start",n=[];break}}return c.type&&f.push(c),n.length>1&&n[0]!==i&&n.unshift(i),{tokens:f,state:n.length?n:i}}}).call(i.prototype),t.Tokenizer=i}),define("ace/edit_session/fold",["require","exports","module","ace/range","ace/range_list","ace/lib/oop"],function(e,t,n){function u(e,t){e.row-=t.row,e.row==0&&(e.column-=t.column)}function a(e,t){u(e.start,t),u(e.end,t)}function f(e,t){e.row==0&&(e.column+=t.column),e.row+=t.row}function l(e,t){f(e.start,t),f(e.end,t)}var r=e("../range").Range,i=e("../range_list").RangeList,s=e("../lib/oop"),o=t.Fold=function(e,t){this.foldLine=null,this.placeholder=t,this.range=e,this.start=e.start,this.end=e.end,this.sameRow=e.start.row==e.end.row,this.subFolds=this.ranges=[]};s.inherits(o,i),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(e){this.foldLine=e,this.subFolds.forEach(function(t){t.setFoldLine(e)})},this.clone=function(){var e=this.range.clone(),t=new o(e,this.placeholder);return this.subFolds.forEach(function(e){t.subFolds.push(e.clone())}),t.collapseChildren=this.collapseChildren,t},this.addSubFold=function(e){if(this.range.isEqual(e))return;if(!this.range.containsRange(e))throw new Error("A fold can't intersect already existing fold"+e.range+this.range);a(e,this.start);var t=e.start.row,n=e.start.column;for(var r=0,i=-1;r<this.subFolds.length;r++){i=this.subFolds[r].range.compare(t,n);if(i!=1)break}var s=this.subFolds[r];if(i==0)return s.addSubFold(e);var t=e.range.end.row,n=e.range.end.column;for(var o=r,i=-1;o<this.subFolds.length;o++){i=this.subFolds[o].range.compare(t,n);if(i!=1)break}var u=this.subFolds[o];if(i==0)throw new Error("A fold can't intersect already existing fold"+e.range+this.range);var f=this.subFolds.splice(r,o-r,e);return e.setFoldLine(this.foldLine),e},this.restoreRange=function(e){return l(e,this.start)}}.call(o.prototype)}),define("ace/mode/text",["require","exports","module","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],function(e,t,n){var r=e("../tokenizer").Tokenizer,i=e("./text_highlight_rules").TextHighlightRules,s=e("./behaviour").Behaviour,o=e("../unicode"),u=e("../lib/lang"),a=e("../token_iterator").TokenIterator,f=e("../range").Range,l=function(){this.HighlightRules=i,this.$behaviour=new s};(function(){this.tokenRe=new RegExp("^["+o.packages.L+o.packages.Mn+o.packages.Mc+o.packages.Nd+o.packages.Pc+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+o.packages.L+o.packages.Mn+o.packages.Mc+o.packages.Nd+o.packages.Pc+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=new this.HighlightRules,this.$tokenizer=new r(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(e,t,n,r){function w(e){for(var t=n;t<=r;t++)e(i.getLine(t),t)}var i=t.doc,s=!0,o=!0,a=Infinity,f=t.getTabSize(),l=!1;if(!this.lineCommentStart){if(!this.blockComment)return!1;var c=this.blockComment.start,h=this.blockComment.end,p=new RegExp("^(\\s*)(?:"+u.escapeRegExp(c)+")"),d=new RegExp("(?:"+u.escapeRegExp(h)+")\\s*$"),v=function(e,t){if(g(e,t))return;if(!s||/\S/.test(e))i.insertInLine({row:t,column:e.length},h),i.insertInLine({row:t,column:a},c)},m=function(e,t){var n;(n=e.match(d))&&i.removeInLine(t,e.length-n[0].length,e.length),(n=e.match(p))&&i.removeInLine(t,n[1].length,n[0].length)},g=function(e,n){if(p.test(e))return!0;var r=t.getTokens(n);for(var i=0;i<r.length;i++)if(r[i].type==="comment")return!0}}else{if(Array.isArray(this.lineCommentStart))var p=this.lineCommentStart.map(u.escapeRegExp).join("|"),c=this.lineCommentStart[0];else var p=u.escapeRegExp(this.lineCommentStart),c=this.lineCommentStart;p=new RegExp("^(\\s*)(?:"+p+") ?"),l=t.getUseSoftTabs();var m=function(e,t){var n=e.match(p);if(!n)return;var r=n[1].length,s=n[0].length;!b(e,r,s)&&n[0][s-1]==" "&&s--,i.removeInLine(t,r,s)},y=c+" ",v=function(e,t){if(!s||/\S/.test(e))b(e,a,a)?i.insertInLine({row:t,column:a},y):i.insertInLine({row:t,column:a},c)},g=function(e,t){return p.test(e)},b=function(e,t,n){var r=0;while(t--&&e.charAt(t)==" ")r++;if(r%f!=0)return!1;var r=0;while(e.charAt(n++)==" ")r++;return f>2?r%f!=f-1:r%f==0}}var E=Infinity;w(function(e,t){var n=e.search(/\S/);n!==-1?(n<a&&(a=n),o&&!g(e,t)&&(o=!1)):E>e.length&&(E=e.length)}),a==Infinity&&(a=E,s=!1,o=!1),l&&a%f!=0&&(a=Math.floor(a/f)*f),w(o?m:v)},this.toggleBlockComment=function(e,t,n,r){var i=this.blockComment;if(!i)return;!i.start&&i[0]&&(i=i[0]);var s=new a(t,r.row,r.column),o=s.getCurrentToken(),u=t.selection,l=t.selection.toOrientedRange(),c,h;if(o&&/comment/.test(o.type)){var p,d;while(o&&/comment/.test(o.type)){var v=o.value.indexOf(i.start);if(v!=-1){var m=s.getCurrentTokenRow(),g=s.getCurrentTokenColumn()+v;p=new f(m,g,m,g+i.start.length);break}o=s.stepBackward()}var s=new a(t,r.row,r.column),o=s.getCurrentToken();while(o&&/comment/.test(o.type)){var v=o.value.indexOf(i.end);if(v!=-1){var m=s.getCurrentTokenRow(),g=s.getCurrentTokenColumn()+v;d=new f(m,g,m,g+i.end.length);break}o=s.stepForward()}d&&t.remove(d),p&&(t.remove(p),c=p.start.row,h=-i.start.length)}else h=i.start.length,c=n.start.row,t.insert(n.end,i.end),t.insert(n.start,i.start);l.start.row==c&&(l.start.column+=h),l.end.row==c&&(l.end.column+=h),t.selection.fromOrientedRange(l)},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1},this.autoOutdent=function(e,t,n){},this.$getIndent=function(e){return e.match(/^\s*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){this.$embeds=[],this.$modes={};for(var t in e)e[t]&&(this.$embeds.push(t),this.$modes[t]=new e[t]);var n=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"];for(var t=0;t<n.length;t++)(function(e){var r=n[t],i=e[r];e[n[t]]=function(){return this.$delegator(r,arguments,i)}})(this)},this.$delegator=function(e,t,n){var r=t[0];typeof r!="string"&&(r=r[0]);for(var i=0;i<this.$embeds.length;i++){if(!this.$modes[this.$embeds[i]])continue;var s=r.split(this.$embeds[i]);if(!s[0]&&s[1]){t[0]=s[1];var o=this.$modes[this.$embeds[i]];return o[e].apply(o,t)}}var u=n.apply(this,t);return n?u:undefined},this.transformAction=function(e,t,n,r,i){if(this.$behaviour){var s=this.$behaviour.getBehaviours();for(var o in s)if(s[o][t]){var u=s[o][t].apply(this,arguments);if(u)return u}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,n=[];for(var r in t){var i=t[r];for(var s=0,o=i.length;s<o;s++)if(typeof i[s].token=="string")/keyword|support|storage/.test(i[s].token)&&n.push(i[s].regex);else if(typeof i[s].token=="object")for(var u=0,a=i[s].token.length;u<a;u++)if(/keyword|support|storage/.test(i[s].token[u])){var r=i[s].regex.match(/\(.+?\)/g)[u];n.push(r.substr(1,r.length-2))}}this.completionKeywords=n}return e?n.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,n,r){var i=this.$keywordList||this.$createKeywordList();return i.map(function(e){return{name:e,value:e,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}).call(l.prototype),t.Mode=l}),define("ace/range_list",["require","exports","module","ace/range"],function(e,t,n){var r=e("./range").Range,i=r.comparePoints,s=function(){this.ranges=[]};(function(){this.comparePoints=i,this.pointIndex=function(e,t,n){var r=this.ranges;for(var s=n||0;s<r.length;s++){var o=r[s],u=i(e,o.end);if(u>0)continue;var a=i(e,o.start);return u===0?t&&a!==0?-s-2:s:a>0||a===0&&!t?s:-s-1}return-s-1},this.add=function(e){var t=!e.isEmpty(),n=this.pointIndex(e.start,t);n<0&&(n=-n-1);var r=this.pointIndex(e.end,t,n);return r<0?r=-r-1:r++,this.ranges.splice(n,r-n,e)},this.addList=function(e){var t=[];for(var n=e.length;n--;)t.push.call(t,this.add(e[n]));return t},this.substractPoint=function(e){var t=this.pointIndex(e);if(t>=0)return this.ranges.splice(t,1)},this.merge=function(){var e=[],t=this.ranges;t=t.sort(function(e,t){return i(e.start,t.start)});var n=t[0],r;for(var s=1;s<t.length;s++){r=n,n=t[s];var o=i(r.end,n.start);if(o<0)continue;if(o==0&&!r.isEmpty()&&!n.isEmpty())continue;i(r.end,n.end)<0&&(r.end.row=n.end.row,r.end.column=n.end.column),t.splice(s,1),e.push(n),n=r,s--}return this.ranges=t,e},this.contains=function(e,t){return this.pointIndex({row:e,column:t})>=0},this.containsPoint=function(e){return this.pointIndex(e)>=0},this.rangeAtPoint=function(e){var t=this.pointIndex(e);if(t>=0)return this.ranges[t]},this.clipRows=function(e,t){var n=this.ranges;if(n[0].start.row>t||n[n.length-1].start.row<e)return[];var r=this.pointIndex({row:e,column:0});r<0&&(r=-r-1);var i=this.pointIndex({row:t,column:0},r);i<0&&(i=-i-1);var s=[];for(var o=r;o<i;o++)s.push(n[o]);return s},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(e){this.session&&this.detach(),this.session=e,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},this.detach=function(){if(!this.session)return;this.session.removeListener("change",this.onChange),this.session=null},this.$onChange=function(e){var t=e.data.range;if(e.data.action[0]=="i")var n=t.start,r=t.end;else var r=t.start,n=t.end;var i=n.row,s=r.row,o=s-i,u=-n.column+r.column,a=this.ranges;for(var f=0,l=a.length;f<l;f++){var c=a[f];if(c.end.row<i)continue;if(c.start.row>i)break;c.start.row==i&&c.start.column>=n.column&&(c.start.column!=n.column||!this.$insertRight)&&(c.start.column+=u,c.start.row+=o);if(c.end.row==i&&c.end.column>=n.column){if(c.end.column==n.column&&this.$insertRight)continue;c.end.column==n.column&&u>0&&f<l-1&&c.end.column>c.start.column&&c.end.column==a[f+1].start.column&&(c.end.column-=u),c.end.column+=u,c.end.row+=o}}if(o!=0&&f<l)for(;f<l;f++){var c=a[f];c.start.row+=o,c.end.row+=o}}}).call(s.prototype),t.RangeList=s}),define("ace/range",["require","exports","module"],function(e,t,n){var r=function(e,t){return e.row-t.row||e.column-t.column},i=function(e,t,n,r){this.start={row:e,column:t},this.end={row:n,column:r}};(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(e,t){return this.compare(e,t)==0},this.compareRange=function(e){var t,n=e.end,r=e.start;return t=this.compare(n.row,n.column),t==1?(t=this.compare(r.row,r.column),t==1?2:t==0?1:0):t==-1?-2:(t=this.compare(r.row,r.column),t==-1?-1:t==1?42:0)},this.comparePoint=function(e){return this.compare(e.row,e.column)},this.containsRange=function(e){return this.comparePoint(e.start)==0&&this.comparePoint(e.end)==0},this.intersects=function(e){var t=this.compareRange(e);return t==-1||t==0||t==1},this.isEnd=function(e,t){return this.end.row==e&&this.end.column==t},this.isStart=function(e,t){return this.start.row==e&&this.start.column==t},this.setStart=function(e,t){typeof e=="object"?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=t)},this.setEnd=function(e,t){typeof e=="object"?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=t)},this.inside=function(e,t){return this.compare(e,t)==0?this.isEnd(e,t)||this.isStart(e,t)?!1:!0:!1},this.insideStart=function(e,t){return this.compare(e,t)==0?this.isEnd(e,t)?!1:!0:!1},this.insideEnd=function(e,t){return this.compare(e,t)==0?this.isStart(e,t)?!1:!0:!1},this.compare=function(e,t){return!this.isMultiLine()&&e===this.start.row?t<this.start.column?-1:t>this.end.column?1:0:e<this.start.row?-1:e>this.end.row?1:this.start.row===e?t>=this.start.column?0:-1:this.end.row===e?t<=this.end.column?0:1:0},this.compareStart=function(e,t){return this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.compareEnd=function(e,t){return this.end.row==e&&this.end.column==t?1:this.compare(e,t)},this.compareInside=function(e,t){return this.end.row==e&&this.end.column==t?1:this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.clipRows=function(e,t){if(this.end.row>t)var n={row:t+1,column:0};else if(this.end.row<e)var n={row:e,column:0};if(this.start.row>t)var r={row:t+1,column:0};else if(this.start.row<e)var r={row:e,column:0};return i.fromPoints(r||this.start,n||this.end)},this.extend=function(e,t){var n=this.compare(e,t);if(n==0)return this;if(n==-1)var r={row:e,column:t};else var s={row:e,column:t};return i.fromPoints(r||this.start,s||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return i.fromPoints(this.start,this.end)},this.collapseRows=function(){return this.end.column==0?new i(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new i(this.start.row,0,this.end.row,0)},this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start),n=e.documentToScreenPosition(this.end);return new i(t.row,t.column,n.row,n.column)},this.moveBy=function(e,t){this.start.row+=e,this.start.column+=t,this.end.row+=e,this.end.column+=t}}).call(i.prototype),i.fromPoints=function(e,t){return new i(e.row,e.column,t.row,t.column)},i.comparePoints=r,i.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},t.Range=i}),define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(e,t,n){function s(){this.findMatchingBracket=function(e,t){if(e.column==0)return null;var n=t||this.getLine(e.row).charAt(e.column-1);if(n=="")return null;var r=n.match(/([\(\[\{])|([\)\]\}])/);return r?r[1]?this.$findClosingBracket(r[1],e):this.$findOpeningBracket(r[2],e):null},this.getBracketRange=function(e){var t=this.getLine(e.row),n=!0,r,s=t.charAt(e.column-1),o=s&&s.match(/([\(\[\{])|([\)\]\}])/);o||(s=t.charAt(e.column),e={row:e.row,column:e.column+1},o=s&&s.match(/([\(\[\{])|([\)\]\}])/),n=!1);if(!o)return null;if(o[1]){var u=this.$findClosingBracket(o[1],e);if(!u)return null;r=i.fromPoints(e,u),n||(r.end.column++,r.start.column--),r.cursor=r.end}else{var u=this.$findOpeningBracket(o[2],e);if(!u)return null;r=i.fromPoints(u,e),n||(r.start.column++,r.end.column--),r.cursor=r.start}return r},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{"},this.$findOpeningBracket=function(e,t,n){var i=this.$brackets[e],s=1,o=new r(this,t.row,t.column),u=o.getCurrentToken();u||(u=o.stepForward());if(!u)return;n||(n=new RegExp("(\\.?"+u.type.replace(".","\\.").replace("rparen",".paren")+")+"));var a=t.column-o.getCurrentTokenColumn()-2,f=u.value;for(;;){while(a>=0){var l=f.charAt(a);if(l==i){s-=1;if(s==0)return{row:o.getCurrentTokenRow(),column:a+o.getCurrentTokenColumn()}}else l==e&&(s+=1);a-=1}do u=o.stepBackward();while(u&&!n.test(u.type));if(u==null)break;f=u.value,a=f.length-1}return null},this.$findClosingBracket=function(e,t,n){var i=this.$brackets[e],s=1,o=new r(this,t.row,t.column),u=o.getCurrentToken();u||(u=o.stepForward());if(!u)return;n||(n=new RegExp("(\\.?"+u.type.replace(".","\\.").replace("lparen",".paren")+")+"));var a=t.column-o.getCurrentTokenColumn();for(;;){var f=u.value,l=f.length;while(a<l){var c=f.charAt(a);if(c==i){s-=1;if(s==0)return{row:o.getCurrentTokenRow(),column:a+o.getCurrentTokenColumn()}}else c==e&&(s+=1);a+=1}do u=o.stepForward();while(u&&!n.test(u.type));if(u==null)break;a=0}return null}}var r=e("../token_iterator").TokenIterator,i=e("../range").Range;t.BracketMatch=s}),define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/lang"),s=e("./lib/event_emitter").EventEmitter,o=e("./range").Range,u=function(e){this.session=e,this.doc=e.getDocument(),this.clearSelection(),this.lead=this.selectionLead=this.doc.createAnchor(0,0),this.anchor=this.selectionAnchor=this.doc.createAnchor(0,0);var t=this;this.lead.on("change",function(e){t._emit("changeCursor"),t.$isEmpty||t._emit("changeSelection"),!t.$keepDesiredColumnOnChange&&e.old.column!=e.value.column&&(t.$desiredColumn=null)}),this.selectionAnchor.on("change",function(){t.$isEmpty||t._emit("changeSelection")})};(function(){r.implement(this,s),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},this.isMultiLine=function(){return this.isEmpty()?!1:this.getRange().isMultiLine()},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(e,t){this.anchor.setPosition(e,t),this.$isEmpty&&(this.$isEmpty=!1,this._emit("changeSelection"))},this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.shiftSelection=function(e){if(this.$isEmpty){this.moveCursorTo(this.lead.row,this.lead.column+e);return}var t=this.getSelectionAnchor(),n=this.getSelectionLead(),r=this.isBackwards();(!r||t.column!==0)&&this.setSelectionAnchor(t.row,t.column+e),(r||n.column!==0)&&this.$moveSelection(function(){this.moveCursorTo(n.row,n.column+e)})},this.isBackwards=function(){var e=this.anchor,t=this.lead;return e.row>t.row||e.row==t.row&&e.column>t.column},this.getRange=function(){var e=this.anchor,t=this.lead;return this.isEmpty()?o.fromPoints(t,t):this.isBackwards()?o.fromPoints(t,e):o.fromPoints(e,t)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},this.selectAll=function(){var e=this.doc.getLength()-1;this.setSelectionAnchor(0,0),this.moveCursorTo(e,this.doc.getLine(e).length)},this.setRange=this.setSelectionRange=function(e,t){t?(this.setSelectionAnchor(e.end.row,e.end.column),this.selectTo(e.start.row,e.start.column)):(this.setSelectionAnchor(e.start.row,e.start.column),this.selectTo(e.end.row,e.end.column)),this.getRange().isEmpty()&&(this.$isEmpty=!0),this.$desiredColumn=null},this.$moveSelection=function(e){var t=this.lead;this.$isEmpty&&this.setSelectionAnchor(t.row,t.column),e.call(this)},this.selectTo=function(e,t){this.$moveSelection(function(){this.moveCursorTo(e,t)})},this.selectToPosition=function(e){this.$moveSelection(function(){this.moveCursorToPosition(e)})},this.moveTo=function(e,t){this.clearSelection(),this.moveCursorTo(e,t)},this.moveToPosition=function(e){this.clearSelection(),this.moveCursorToPosition(e)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(e,t){if(typeof t=="undefined"){var n=e||this.lead;e=n.row,t=n.column}return this.session.getWordRange(e,t)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var e=this.getCursor(),t=this.session.getAWordRange(e.row,e.column);this.setSelectionRange(t)},this.getLineRange=function(e,t){var n=typeof e=="number"?e:this.lead.row,r,i=this.session.getFoldLine(n);return i?(n=i.start.row,r=i.end.row):r=n,t===!0?new o(n,0,r,this.session.getLine(r).length):new o(n,0,r+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.moveCursorLeft=function(){var e=this.lead.getPosition(),t;if(t=this.session.getFoldAt(e.row,e.column,-1))this.moveCursorTo(t.start.row,t.start.column);else if(e.column==0)e.row>0&&this.moveCursorTo(e.row-1,this.doc.getLine(e.row-1).length);else{var n=this.session.getTabSize();this.session.isTabStop(e)&&this.doc.getLine(e.row).slice(e.column-n,e.column).split(" ").length-1==n?this.moveCursorBy(0,-n):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){var e=this.lead.getPosition(),t;if(t=this.session.getFoldAt(e.row,e.column,1))this.moveCursorTo(t.end.row,t.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0);else{var n=this.session.getTabSize(),e=this.lead;this.session.isTabStop(e)&&this.doc.getLine(e.row).slice(e.column,e.column+n).split(" ").length-1==n?this.moveCursorBy(0,n):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var e=this.lead.row,t=this.lead.column,n=this.session.documentToScreenRow(e,t),r=this.session.screenToDocumentPosition(n,0),i=this.session.getDisplayLine(e,null,r.row,r.column),s=i.match(/^\s*/);s[0].length!=t&&!this.session.$useEmacsStyleLineStart&&(r.column+=s[0].length),this.moveCursorToPosition(r)},this.moveCursorLineEnd=function(){var e=this.lead,t=this.session.getDocumentLastRowColumnPosition(e.row,e.column);if(this.lead.column==t.column){var n=this.session.getLine(t.row);if(t.column==n.length){var r=n.search(/\s+$/);r>0&&(t.column=r)}}this.moveCursorTo(t.row,t.column)},this.moveCursorFileEnd=function(){var e=this.doc.getLength()-1,t=this.doc.getLine(e).length;this.moveCursorTo(e,t)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),r=n.substring(t),i;this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var s=this.session.getFoldAt(e,t,1);if(s){this.moveCursorTo(s.end.row,s.end.column);return}if(i=this.session.nonTokenRe.exec(r))t+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,r=n.substring(t);if(t>=n.length){this.moveCursorTo(e,n.length),this.moveCursorRight(),e<this.doc.getLength()-1&&this.moveCursorWordRight();return}if(i=this.session.tokenRe.exec(r))t+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0;this.moveCursorTo(e,t)},this.moveCursorLongWordLeft=function(){var e=this.lead.row,t=this.lead.column,n;if(n=this.session.getFoldAt(e,t,-1)){this.moveCursorTo(n.start.row,n.start.column);return}var r=this.session.getFoldStringAt(e,t,-1);r==null&&(r=this.doc.getLine(e).substring(0,t));var s=i.stringReverse(r),o;this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;if(o=this.session.nonTokenRe.exec(s))t-=this.session.nonTokenRe.lastIndex,s=s.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0;if(t<=0){this.moveCursorTo(e,0),this.moveCursorLeft(),e>0&&this.moveCursorWordLeft();return}if(o=this.session.tokenRe.exec(s))t-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0;this.moveCursorTo(e,t)},this.$shortWordEndIndex=function(e){var t,n=0,r,i=/\s/,s=this.session.tokenRe;s.lastIndex=0;if(t=this.session.tokenRe.exec(e))n=this.session.tokenRe.lastIndex;else{while((r=e[n])&&i.test(r))n++;if(n<1){s.lastIndex=0;while((r=e[n])&&!s.test(r)){s.lastIndex=0,n++;if(i.test(r)){if(n>2){n--;break}while((r=e[n])&&i.test(r))n++;if(n>2)break}}}}return s.lastIndex=0,n},this.moveCursorShortWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),r=n.substring(t),i=this.session.getFoldAt(e,t,1);if(i)return this.moveCursorTo(i.end.row,i.end.column);if(t==n.length){var s=this.doc.getLength();do e++,r=this.doc.getLine(e);while(e<s&&/^\s*$/.test(r));/^\s+/.test(r)||(r=""),t=0}var o=this.$shortWordEndIndex(r);this.moveCursorTo(e,t+o)},this.moveCursorShortWordLeft=function(){var e=this.lead.row,t=this.lead.column,n;if(n=this.session.getFoldAt(e,t,-1))return this.moveCursorTo(n.start.row,n.start.column);var r=this.session.getLine(e).substring(0,t);if(t==0){do e--,r=this.doc.getLine(e);while(e>0&&/^\s*$/.test(r));t=r.length,/\s+$/.test(r)||(r="")}var s=i.stringReverse(r),o=this.$shortWordEndIndex(s);return this.moveCursorTo(e,t-o)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(e,t){var n=this.session.documentToScreenPosition(this.lead.row,this.lead.column);t===0&&(this.$desiredColumn?n.column=this.$desiredColumn:this.$desiredColumn=n.column);var r=this.session.screenToDocumentPosition(n.row+e,n.column);e!==0&&t===0&&r.row===this.lead.row&&r.column===this.lead.column&&this.session.lineWidgets&&this.session.lineWidgets[r.row]&&r.row++,this.moveCursorTo(r.row,r.column+t,t===0)},this.moveCursorToPosition=function(e){this.moveCursorTo(e.row,e.column)},this.moveCursorTo=function(e,t,n){var r=this.session.getFoldAt(e,t,1);r&&(e=r.start.row,t=r.start.column),this.$keepDesiredColumnOnChange=!0,this.lead.setPosition(e,t),this.$keepDesiredColumnOnChange=!1,n||(this.$desiredColumn=null)},this.moveCursorToScreen=function(e,t,n){var r=this.session.screenToDocumentPosition(e,t);this.moveCursorTo(r.row,r.column,n)},this.detach=function(){this.lead.detach(),this.anchor.detach(),this.session=this.doc=null},this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start),this.$desiredColumn=e.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(e){var t=this.getRange();return e?(e.start.column=t.start.column,e.start.row=t.start.row,e.end.column=t.end.column,e.end.row=t.end.row):e=t,e.cursor=this.isBackwards()?e.start:e.end,e.desiredColumn=this.$desiredColumn,e},this.toJSON=function(){if(this.rangeCount)var e=this.ranges.map(function(e){var t=e.clone();return t.isBackwards=e.cursor==e.start,t});else{var e=this.getRange();e.isBackwards=this.isBackwards()}return e},this.fromJSON=function(e){if(e.start==undefined){if(this.rangeList){this.toSingleRange(e[0]);for(var t=e.length;t--;){var n=o.fromPoints(e[t].start,e[t].end);e.isBackwards&&(n.cursor=n.start),this.addRange(n,!0)}return}e=e[0]}this.rangeList&&this.toSingleRange(e),this.setSelectionRange(e,e.isBackwards)},this.isEqual=function(e){if((e.length||this.rangeCount)&&e.length!=this.rangeCount)return!1;if(!e.length||!this.ranges)return this.getRange().isEqual(e);for(var t=this.ranges.length;t--;)if(!this.ranges[t].isEqual(e[t]))return!1;return!0}}).call(u.prototype),t.Selection=u}),define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(e,t,n){var r=e("./lib/lang"),i=e("./lib/oop"),s=e("./range").Range,o=function(){this.$options={}};(function(){this.set=function(e){return i.mixin(this.$options,e),this},this.getOptions=function(){return r.copyObject(this.$options)},this.setOptions=function(e){this.$options=e},this.find=function(e){var t=this.$matchIterator(e,this.$options);if(!t)return!1;var n=null;return t.forEach(function(e,t,r){if(!e.start){var i=e.offset+(r||0);n=new s(t,i,t,i+e.length)}else n=e;return!0}),n},this.findAll=function(e){var t=this.$options;if(!t.needle)return[];this.$assembleRegExp(t);var n=t.range,i=n?e.getLines(n.start.row,n.end.row):e.doc.getAllLines(),o=[],u=t.re;if(t.$isMultiLine){var a=u.length,f=i.length-a,l;e:for(var c=u.offset||0;c<=f;c++){for(var h=0;h<a;h++)if(i[c+h].search(u[h])==-1)continue e;var p=i[c],d=i[c+a-1],v=p.length-p.match(u[0])[0].length,m=d.match(u[a-1])[0].length;if(l&&l.end.row===c&&l.end.column>v)continue;o.push(l=new s(c,v,c+a-1,m)),a>2&&(c=c+a-2)}}else for(var g=0;g<i.length;g++){var y=r.getMatchOffsets(i[g],u);for(var h=0;h<y.length;h++){var b=y[h];o.push(new s(g,b.offset,g,b.offset+b.length))}}if(n){var w=n.start.column,E=n.start.column,g=0,h=o.length-1;while(g<h&&o[g].start.column<w&&o[g].start.row==n.start.row)g++;while(g<h&&o[h].end.column>E&&o[h].end.row==n.end.row)h--;o=o.slice(g,h+1);for(g=0,h=o.length;g<h;g++)o[g].start.row+=n.start.row,o[g].end.row+=n.start.row}return o},this.replace=function(e,t){var n=this.$options,r=this.$assembleRegExp(n);if(n.$isMultiLine)return t;if(!r)return;var i=r.exec(e);if(!i||i[0].length!=e.length)return null;t=e.replace(r,t);if(n.preserveCase){t=t.split("");for(var s=Math.min(e.length,e.length);s--;){var o=e[s];o&&o.toLowerCase()!=o?t[s]=t[s].toUpperCase():t[s]=t[s].toLowerCase()}t=t.join("")}return t},this.$matchIterator=function(e,t){var n=this.$assembleRegExp(t);if(!n)return!1;var i=this,o,u=t.backwards;if(t.$isMultiLine)var a=n.length,f=function(t,r,i){var u=t.search(n[0]);if(u==-1)return;for(var f=1;f<a;f++){t=e.getLine(r+f);if(t.search(n[f])==-1)return}var l=t.match(n[a-1])[0].length,c=new s(r,u,r+a-1,l);n.offset==1?(c.start.row--,c.start.column=Number.MAX_VALUE):i&&(c.start.column+=i);if(o(c))return!0};else if(u)var f=function(e,t,i){var s=r.getMatchOffsets(e,n);for(var u=s.length-1;u>=0;u--)if(o(s[u],t,i))return!0};else var f=function(e,t,i){var s=r.getMatchOffsets(e,n);for(var u=0;u<s.length;u++)if(o(s[u],t,i))return!0};return{forEach:function(n){o=n,i.$lineIterator(e,t).forEach(f)}}},this.$assembleRegExp=function(e,t){if(e.needle instanceof RegExp)return e.re=e.needle;var n=e.needle;if(!e.needle)return e.re=!1;e.regExp||(n=r.escapeRegExp(n)),e.wholeWord&&(n="\\b"+n+"\\b");var i=e.caseSensitive?"g":"gi";e.$isMultiLine=!t&&/[\n\r]/.test(n);if(e.$isMultiLine)return e.re=this.$assembleMultilineRegExp(n,i);try{var s=new RegExp(n,i)}catch(o){s=!1}return e.re=s},this.$assembleMultilineRegExp=function(e,t){var n=e.replace(/\r\n|\r|\n/g,"$\n^").split("\n"),r=[];for(var i=0;i<n.length;i++)try{r.push(new RegExp(n[i],t))}catch(s){return!1}return n[0]==""?(r.shift(),r.offset=1):r.offset=0,r},this.$lineIterator=function(e,t){var n=t.backwards==1,r=t.skipCurrent!=0,i=t.range,s=t.start;s||(s=i?i[n?"end":"start"]:e.selection.getRange()),s.start&&(s=s[r!=n?"end":"start"]);var o=i?i.start.row:0,u=i?i.end.row:e.getLength()-1,a=n?function(n){var r=s.row,i=e.getLine(r).substring(0,s.column);if(n(i,r))return;for(r--;r>=o;r--)if(n(e.getLine(r),r))return;if(t.wrap==0)return;for(r=u,o=s.row;r>=o;r--)if(n(e.getLine(r),r))return}:function(n){var r=s.row,i=e.getLine(r).substr(s.column);if(n(i,r,s.column))return;for(r+=1;r<=u;r++)if(n(e.getLine(r),r))return;if(t.wrap==0)return;for(r=o,u=s.row;r<=u;r++)if(n(e.getLine(r),r))return};return{forEach:a}}}).call(o.prototype),t.Search=o}),define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/lang"),s=e("./config"),o=e("./lib/event_emitter").EventEmitter,u=e("./selection").Selection,a=e("./mode/text").Mode,f=e("./range").Range,l=e("./document").Document,c=e("./background_tokenizer").BackgroundTokenizer,h=e("./search_highlight").SearchHighlight,p=function(e,t){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.$foldData.toString=function(){return this.join("\n")},this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this);if(typeof e!="object"||!e.getLine)e=new l(e);this.setDocument(e),this.selection=new u(this),s.resetOptions(this),this.setMode(t),s._signal("session",this)};(function(){function g(e){return e<4352?!1:e>=4352&&e<=4447||e>=4515&&e<=4519||e>=4602&&e<=4607||e>=9001&&e<=9002||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12283||e>=12288&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12589||e>=12593&&e<=12686||e>=12688&&e<=12730||e>=12736&&e<=12771||e>=12784&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=13054||e>=13056&&e<=19903||e>=19968&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=55216&&e<=55238||e>=55243&&e<=55291||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=65281&&e<=65376||e>=65504&&e<=65510}r.implement(this,o),this.setDocument=function(e){this.doc&&this.doc.removeListener("change",this.$onChange),this.doc=e,e.on("change",this.$onChange),this.bgTokenizer&&this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc},this.$resetRowCache=function(e){if(!e){this.$docRowCache=[],this.$screenRowCache=[];return}var t=this.$docRowCache.length,n=this.$getRowCacheIndex(this.$docRowCache,e)+1;t>n&&(this.$docRowCache.splice(n,t),this.$screenRowCache.splice(n,t))},this.$getRowCacheIndex=function(e,t){var n=0,r=e.length-1;while(n<=r){var i=n+r>>1,s=e[i];if(t>s)n=i+1;else{if(!(t<s))return i;r=i-1}}return n-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.bgTokenizer&&this.bgTokenizer.start(0)},this.onChangeFold=function(e){var t=e.data;this.$resetRowCache(t.start.row)},this.onChange=function(e){var t=e.data;this.$modified=!0,this.$resetRowCache(t.range.start.row);var n=this.$updateInternalDataOnChange(e);!this.$fromUndo&&this.$undoManager&&!t.ignore&&(this.$deltasDoc.push(t),n&&n.length!=0&&this.$deltasFold.push({action:"removeFolds",folds:n}),this.$informUndoManager.schedule()),this.bgTokenizer.$updateOnChange(t),this._signal("change",e)},this.setValue=function(e){this.doc.setValue(e),this.selection.moveTo(0,0),this.$resetRowCache(0),this.$deltas=[],this.$deltasDoc=[],this.$deltasFold=[],this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(e){return this.bgTokenizer.getState(e)},this.getTokens=function(e){return this.bgTokenizer.getTokens(e)},this.getTokenAt=function(e,t){var n=this.bgTokenizer.getTokens(e),r,i=0;if(t==null)s=n.length-1,i=this.getLine(e).length;else for(var s=0;s<n.length;s++){i+=n[s].value.length;if(i>=t)break}return r=n[s],r?(r.index=s,r.start=i-r.value.length,r):null},this.setUndoManager=function(e){this.$undoManager=e,this.$deltas=[],this.$deltasDoc=[],this.$deltasFold=[],this.$informUndoManager&&this.$informUndoManager.cancel();if(e){var t=this;this.$syncInformUndoManager=function(){t.$informUndoManager.cancel(),t.$deltasFold.length&&(t.$deltas.push({group:"fold",deltas:t.$deltasFold}),t.$deltasFold=[]),t.$deltasDoc.length&&(t.$deltas.push({group:"doc",deltas:t.$deltasDoc}),t.$deltasDoc=[]),t.$deltas.length>0&&e.execute({action:"aceupdate",args:[t.$deltas,t],merge:t.mergeUndoDeltas}),t.mergeUndoDeltas=!1,t.$deltas=[]},this.$informUndoManager=i.delayedCall(this.$syncInformUndoManager)}},this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},reset:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?i.stringRepeat(" ",this.getTabSize()):"	"},this.setUseSoftTabs=function(e){this.setOption("useSoftTabs",e)},this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},this.setTabSize=function(e){this.setOption("tabSize",e)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(e){return this.$useSoftTabs&&e.column%this.$tabSize===0},this.$overwrite=!1,this.setOverwrite=function(e){this.setOption("overwrite",e)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(e,t){this.$decorations[e]||(this.$decorations[e]=""),this.$decorations[e]+=" "+t,this._signal("changeBreakpoint",{})},this.removeGutterDecoration=function(e,t){this.$decorations[e]=(this.$decorations[e]||"").replace(" "+t,""),this._signal("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(e){this.$breakpoints=[];for(var t=0;t<e.length;t++)this.$breakpoints[e[t]]="ace_breakpoint";this._signal("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},this.setBreakpoint=function(e,t){t===undefined&&(t="ace_breakpoint"),t?this.$breakpoints[e]=t:delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.clearBreakpoint=function(e){delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.addMarker=function(e,t,n,r){var i=this.$markerId++,s={range:e,type:n||"line",renderer:typeof n=="function"?n:null,clazz:t,inFront:!!r,id:i};return r?(this.$frontMarkers[i]=s,this._signal("changeFrontMarker")):(this.$backMarkers[i]=s,this._signal("changeBackMarker")),i},this.addDynamicMarker=function(e,t){if(!e.update)return;var n=this.$markerId++;return e.id=n,e.inFront=!!t,t?(this.$frontMarkers[n]=e,this._signal("changeFrontMarker")):(this.$backMarkers[n]=e,this._signal("changeBackMarker")),e},this.removeMarker=function(e){var t=this.$frontMarkers[e]||this.$backMarkers[e];if(!t)return;var n=t.inFront?this.$frontMarkers:this.$backMarkers;t&&(delete n[e],this._signal(t.inFront?"changeFrontMarker":"changeBackMarker"))},this.getMarkers=function(e){return e?this.$frontMarkers:this.$backMarkers},this.highlight=function(e){if(!this.$searchHighlight){var t=new h(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(t)}this.$searchHighlight.setRegexp(e)},this.highlightLines=function(e,t,n,r){typeof t!="number"&&(n=t,t=e),n||(n="ace_step");var i=new f(e,0,t,Infinity);return i.id=this.addMarker(i,n,"fullLine",r),i},this.setAnnotations=function(e){this.$annotations=e,this._signal("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r?\n)/m);t?this.$autoNewLine=t[1]:this.$autoNewLine="\n"},this.getWordRange=function(e,t){var n=this.getLine(e),r=!1;t>0&&(r=!!n.charAt(t-1).match(this.tokenRe)),r||(r=!!n.charAt(t).match(this.tokenRe));if(r)var i=this.tokenRe;else if(/^\s+$/.test(n.slice(t-1,t+1)))var i=/\s/;else var i=this.nonTokenRe;var s=t;if(s>0){do s--;while(s>=0&&n.charAt(s).match(i));s++}var o=t;while(o<n.length&&n.charAt(o).match(i))o++;return new f(e,s,e,o)},this.getAWordRange=function(e,t){var n=this.getWordRange(e,t),r=this.getLine(n.end.row);while(r.charAt(n.end.column).match(/[ \t]/))n.end.column+=1;return n},this.setNewLineMode=function(e){this.doc.setNewLineMode(e)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(e){this.setOption("useWorker",e)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var t=e.data;this.bgTokenizer.start(t.first),this._signal("tokenizerUpdate",e)},this.$modes={},this.$mode=null,this.$modeId=null,this.setMode=function(e,t){if(e&&typeof e=="object"){if(e.getTokenizer)return this.$onChangeMode(e);var n=e,r=n.path}else r=e||"ace/mode/text";this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new a);if(this.$modes[r]&&!n){this.$onChangeMode(this.$modes[r]),t&&t();return}this.$modeId=r,s.loadModule(["mode",r],function(e){if(this.$modeId!==r)return t&&t();if(this.$modes[r]&&!n)return this.$onChangeMode(this.$modes[r]);e&&e.Mode&&(e=new e.Mode(n),n||(this.$modes[r]=e,e.$id=r),this.$onChangeMode(e),t&&t())}.bind(this)),this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0)},this.$onChangeMode=function(e,t){t||(this.$modeId=e.$id);if(this.$mode===e)return;this.$mode=e,this.$stopWorker(),this.$useWorker&&this.$startWorker();var n=e.getTokenizer();if(n.addEventListener!==undefined){var r=this.onReloadTokenizer.bind(this);n.addEventListener("update",r)}if(!this.bgTokenizer){this.bgTokenizer=new c(n);var i=this;this.bgTokenizer.addEventListener("update",function(e){i._signal("tokenizerUpdate",e)})}else this.bgTokenizer.setTokenizer(n);this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=e.tokenRe,this.nonTokenRe=e.nonTokenRe,t||(this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(e.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode"))},this.$stopWorker=function(){this.$worker&&this.$worker.terminate(),this.$worker=null},this.$startWorker=function(){if(typeof Worker!="undefined"&&!e.noWorker)try{this.$worker=this.$mode.createWorker(this)}catch(t){console.log("Could not load worker"),console.log(t),this.$worker=null}else this.$worker=null},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(e){if(this.$scrollTop===e||isNaN(e))return;this.$scrollTop=e,this._signal("changeScrollTop",e)},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(e){if(this.$scrollLeft===e||isNaN(e))return;this.$scrollLeft=e,this._signal("changeScrollLeft",e)},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(this.lineWidgetsWidth!=null)return this.lineWidgetsWidth;var e=0;return this.lineWidgets.forEach(function(t){t&&t.screenWidth>e&&(e=t.screenWidth)}),this.lineWidgetWidth=e},this.$computeWidth=function(e){if(this.$modified||e){this.$modified=!1;if(this.$useWrapMode)return this.screenWidth=this.$wrapLimit;var t=this.doc.getAllLines(),n=this.$rowLengthCache,r=0,i=0,s=this.$foldData[i],o=s?s.start.row:Infinity,u=t.length;for(var a=0;a<u;a++){if(a>o){a=s.end.row+1;if(a>=u)break;s=this.$foldData[i++],o=s?s.start.row:Infinity}n[a]==null&&(n[a]=this.$getStringScreenWidth(t[a])[0]),n[a]>r&&(r=n[a])}this.screenWidth=r}},this.getLine=function(e){return this.doc.getLine(e)},this.getLines=function(e,t){return this.doc.getLines(e,t)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(e){return this.doc.getTextRange(e||this.selection.getRange())},this.insert=function(e,t){return this.doc.insert(e,t)},this.remove=function(e){return this.doc.remove(e)},this.undoChanges=function(e,t){if(!e.length)return;this.$fromUndo=!0;var n=null;for(var r=e.length-1;r!=-1;r--){var i=e[r];i.group=="doc"?(this.doc.revertDeltas(i.deltas),n=this.$getUndoSelection(i.deltas,!0,n)):i.deltas.forEach(function(e){this.addFolds(e.folds)},this)}return this.$fromUndo=!1,n&&this.$undoSelect&&!t&&this.selection.setSelectionRange(n),n},this.redoChanges=function(e,t){if(!e.length)return;this.$fromUndo=!0;var n=null;for(var r=0;r<e.length;r++){var i=e[r];i.group=="doc"&&(this.doc.applyDeltas(i.deltas),n=this.$getUndoSelection(i.deltas,!1,n))}return this.$fromUndo=!1,n&&this.$undoSelect&&!t&&this.selection.setSelectionRange(n),n},this.setUndoSelect=function(e){this.$undoSelect=e},this.$getUndoSelection=function(e,t,n){function r(e){var n=e.action==="insertText"||e.action==="insertLines";return t?!n:n}var i=e[0],s,o,u=!1;r(i)?(s=f.fromPoints(i.range.start,i.range.end),u=!0):(s=f.fromPoints(i.range.start,i.range.start),u=!1);for(var a=1;a<e.length;a++)i=e[a],r(i)?(o=i.range.start,s.compare(o.row,o.column)==-1&&s.setStart(i.range.start),o=i.range.end,s.compare(o.row,o.column)==1&&s.setEnd(i.range.end),u=!0):(o=i.range.start,s.compare(o.row,o.column)==-1&&(s=f.fromPoints(i.range.start,i.range.start)),u=!1);if(n!=null){f.comparePoints(n.start,s.start)===0&&(n.start.column+=s.end.column-s.start.column,n.end.column+=s.end.column-s.start.column);var l=n.compareRange(s);l==1?s.setStart(n.start):l==-1&&s.setEnd(n.end)}return s},this.replace=function(e,t){return this.doc.replace(e,t)},this.moveText=function(e,t,n){var r=this.getTextRange(e),i=this.getFoldsInRange(e),s=f.fromPoints(t,t);if(!n){this.remove(e);var o=e.start.row-e.end.row,u=o?-e.end.column:e.start.column-e.end.column;u&&(s.start.row==e.end.row&&s.start.column>e.end.column&&(s.start.column+=u),s.end.row==e.end.row&&s.end.column>e.end.column&&(s.end.column+=u)),o&&s.start.row>=e.end.row&&(s.start.row+=o,s.end.row+=o)}s.end=this.insert(s.start,r);if(i.length){var a=e.start,l=s.start,o=l.row-a.row,u=l.column-a.column;this.addFolds(i.map(function(e){return e=e.clone(),e.start.row==a.row&&(e.start.column+=u),e.end.row==a.row&&(e.end.column+=u),e.start.row+=o,e.end.row+=o,e}))}return s},this.indentRows=function(e,t,n){n=n.replace(/\t/g,this.getTabString());for(var r=e;r<=t;r++)this.insert({row:r,column:0},n)},this.outdentRows=function(e){var t=e.collapseRows(),n=new f(0,0,0,0),r=this.getTabSize();for(var i=t.start.row;i<=t.end.row;++i){var s=this.getLine(i);n.start.row=i,n.end.row=i;for(var o=0;o<r;++o)if(s.charAt(o)!=" ")break;o<r&&s.charAt(o)=="	"?(n.start.column=o,n.end.column=o+1):(n.start.column=0,n.end.column=o),this.remove(n)}},this.$moveLines=function(e,t,n){e=this.getRowFoldStart(e),t=this.getRowFoldEnd(t);if(n<0){var r=this.getRowFoldStart(e+n);if(r<0)return 0;var i=r-e}else if(n>0){var r=this.getRowFoldEnd(t+n);if(r>this.doc.getLength()-1)return 0;var i=r-t}else{e=this.$clipRowToDocument(e),t=this.$clipRowToDocument(t);var i=t-e+1}var s=new f(e,0,t,Number.MAX_VALUE),o=this.getFoldsInRange(s).map(function(e){return e=e.clone(),e.start.row+=i,e.end.row+=i,e}),u=n==0?this.doc.getLines(e,t):this.doc.removeLines(e,t);return this.doc.insertLines(e+i,u),o.length&&this.addFolds(o),i},this.moveLinesUp=function(e,t){return this.$moveLines(e,t,-1)},this.moveLinesDown=function(e,t){return this.$moveLines(e,t,1)},this.duplicateLines=function(e,t){return this.$moveLines(e,t,0)},this.$clipRowToDocument=function(e){return Math.max(0,Math.min(e,this.doc.getLength()-1))},this.$clipColumnToRow=function(e,t){return t<0?0:Math.min(this.doc.getLine(e).length,t)},this.$clipPositionToDocument=function(e,t){t=Math.max(0,t);if(e<0)e=0,t=0;else{var n=this.doc.getLength();e>=n?(e=n-1,t=this.doc.getLine(n-1).length):t=Math.min(this.doc.getLine(e).length,t)}return{row:e,column:t}},this.$clipRangeToDocument=function(e){e.start.row<0?(e.start.row=0,e.start.column=0):e.start.column=this.$clipColumnToRow(e.start.row,e.start.column);var t=this.doc.getLength()-1;return e.end.row>t?(e.end.row=t,e.end.column=this.doc.getLine(t).length):e.end.column=this.$clipColumnToRow(e.end.row,e.end.column),e},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(e){if(e!=this.$useWrapMode){this.$useWrapMode=e,this.$modified=!0,this.$resetRowCache(0);if(e){var t=this.getLength();this.$wrapData=Array(t),this.$updateWrapData(0,t-1)}this._signal("changeWrapMode")}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(e,t){if(this.$wrapLimitRange.min!==e||this.$wrapLimitRange.max!==t)this.$wrapLimitRange={min:e,max:t},this.$modified=!0,this._signal("changeWrapMode")},this.adjustWrapLimit=function(e,t){var n=this.$wrapLimitRange;n.max<0&&(n={min:t,max:t});var r=this.$constrainWrapLimit(e,n.min,n.max);return r!=this.$wrapLimit&&r>1?(this.$wrapLimit=r,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0):!1},this.$constrainWrapLimit=function(e,t,n){return t&&(e=Math.max(t,e)),n&&(e=Math.min(n,e)),e},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(e){this.setWrapLimitRange(e,e)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(e){var t=this.$useWrapMode,n,r=e.data.action,i=e.data.range.start.row,s=e.data.range.end.row,o=e.data.range.start,u=e.data.range.end,a=null;r.indexOf("Lines")!=-1?(r=="insertLines"?s=i+e.data.lines.length:s=i,n=e.data.lines?e.data.lines.length:s-i):n=s-i,this.$updating=!0;if(n!=0)if(r.indexOf("remove")!=-1){this[t?"$wrapData":"$rowLengthCache"].splice(i,n);var f=this.$foldData;a=this.getFoldsInRange(e.data.range),this.removeFolds(a);var l=this.getFoldLine(u.row),c=0;if(l){l.addRemoveChars(u.row,u.column,o.column-u.column),l.shiftRow(-n);var h=this.getFoldLine(i);h&&h!==l&&(h.merge(l),l=h),c=f.indexOf(l)+1}for(c;c<f.length;c++){var l=f[c];l.start.row>=u.row&&l.shiftRow(-n)}s=i}else{var p=Array(n);p.unshift(i,0);var d=t?this.$wrapData:this.$rowLengthCache;d.splice.apply(d,p);var f=this.$foldData,l=this.getFoldLine(i),c=0;if(l){var v=l.range.compareInside(o.row,o.column);v==0?(l=l.split(o.row,o.column),l.shiftRow(n),l.addRemoveChars(s,0,u.column-o.column)):v==-1&&(l.addRemoveChars(i,0,u.column-o.column),l.shiftRow(n)),c=f.indexOf(l)+1}for(c;c<f.length;c++){var l=f[c];l.start.row>=i&&l.shiftRow(n)}}else{n=Math.abs(e.data.range.start.column-e.data.range.end.column),r.indexOf("remove")!=-1&&(a=this.getFoldsInRange(e.data.range),this.removeFolds(a),n=-n);var l=this.getFoldLine(i);l&&l.addRemoveChars(i,o.column,n)}return t&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,t?this.$updateWrapData(i,s):this.$updateRowLengthCache(i,s),a},this.$updateRowLengthCache=function(e,t,n){this.$rowLengthCache[e]=null,this.$rowLengthCache[t]=null},this.$updateWrapData=function(e,t){var n=this.doc.getAllLines(),r=this.getTabSize(),i=this.$wrapData,s=this.$wrapLimit,o,a,f=e;t=Math.min(t,n.length-1);while(f<=t)a=this.getFoldLine(f,a),a?(o=[],a.walk(function(e,t,r,i){var s;if(e!=null){s=this.$getDisplayTokens(e,o.length),s[0]=u;for(var a=1;a<s.length;a++)s[a]=l}else s=this.$getDisplayTokens(n[t].substring(i,r),o.length);o=o.concat(s)}.bind(this),a.end.row,n[a.end.row].length+1),i[a.start.row]=this.$computeWrapSplits(o,s,r),f=a.end.row+1):(o=this.$getDisplayTokens(n[f]),i[f]=this.$computeWrapSplits(o,s,r),f++)};var t=1,n=2,u=3,l=4,p=9,d=10,v=11,m=12;this.$computeWrapSplits=function(e,t){function a(t){var r=e.slice(i,t),o=r.length;r.join("").replace(/12/g,function(){o-=1}).replace(/2/g,function(){o-=1}),s+=o,n.push(s),i=t}if(e.length==0)return[];var n=[],r=e.length,i=0,s=0,o=this.$wrapAsCode;while(r-i>t){var f=i+t;if(e[f-1]>=d&&e[f]>=d){a(f);continue}if(e[f]==u||e[f]==l){for(f;f!=i-1;f--)if(e[f]==u)break;if(f>i){a(f);continue}f=i+t;for(f;f<e.length;f++)if(e[f]!=l)break;if(f==e.length)break;a(f);continue}var c=Math.max(f-(o?10:t-(t>>2)),i-1);while(f>c&&e[f]<u)f--;if(o){while(f>c&&e[f]<u)f--;while(f>c&&e[f]==p)f--}else while(f>c&&e[f]<d)f--;if(f>c){a(++f);continue}f=i+t,a(f)}return n},this.$getDisplayTokens=function(e,r){var i=[],s;r=r||0;for(var o=0;o<e.length;o++){var u=e.charCodeAt(o);if(u==9){s=this.getScreenTabSize(i.length+r),i.push(v);for(var a=1;a<s;a++)i.push(m)}else u==32?i.push(d):u>39&&u<48||u>57&&u<64?i.push(p):u>=4352&&g(u)?i.push(t,n):i.push(t)}return i},this.$getStringScreenWidth=function(e,t,n){if(t==0)return[0,0];t==null&&(t=Infinity),n=n||0;var r,i;for(i=0;i<e.length;i++){r=e.charCodeAt(i),r==9?n+=this.getScreenTabSize(n):r>=4352&&g(r)?n+=2:n+=1;if(n>t)break}return[n,i]},this.lineWidgets=null,this.getRowLength=function(e){if(this.lineWidgets)var t=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0;else t=0;return!this.$useWrapMode||!this.$wrapData[e]?1+t:this.$wrapData[e].length+1+t},this.getRowLineCount=function(e){return!this.$useWrapMode||!this.$wrapData[e]?1:this.$wrapData[e].length+1},this.getScreenLastRowColumn=function(e){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE);return this.documentToScreenColumn(t.row,t.column)},this.getDocumentLastRowColumn=function(e,t){var n=this.documentToScreenRow(e,t);return this.getScreenLastRowColumn(n)},this.getDocumentLastRowColumnPosition=function(e,t){var n=this.documentToScreenRow(e,t);return this.screenToDocumentPosition(n,Number.MAX_VALUE/10)},this.getRowSplitData=function(e){return this.$useWrapMode?this.$wrapData[e]:undefined},this.getScreenTabSize=function(e){return this.$tabSize-e%this.$tabSize},this.screenToDocumentRow=function(e,t){return this.screenToDocumentPosition(e,t).row},this.screenToDocumentColumn=function(e,t){return this.screenToDocumentPosition(e,t).column},this.screenToDocumentPosition=function(e,t){if(e<0)return{row:0,column:0};var n,r=0,i=0,s,o=0,u=0,a=this.$screenRowCache,f=this.$getRowCacheIndex(a,e),l=a.length;if(l&&f>=0)var o=a[f],r=this.$docRowCache[f],c=e>a[l-1];else var c=!l;var h=this.getLength()-1,p=this.getNextFoldLine(r),d=p?p.start.row:Infinity;while(o<=e){u=this.getRowLength(r);if(o+u>e||r>=h)break;o+=u,r++,r>d&&(r=p.end.row+1,p=this.getNextFoldLine(r,p),d=p?p.start.row:Infinity),c&&(this.$docRowCache.push(r),this.$screenRowCache.push(o))}if(p&&p.start.row<=r)n=this.getFoldDisplayLine(p),r=p.start.row;else{if(o+u<=e||r>h)return{row:h,column:this.getLine(h).length};n=this.getLine(r),p=null}if(this.$useWrapMode){var v=this.$wrapData[r];if(v){var m=Math.floor(e-o);s=v[m],m>0&&v.length&&(i=v[m-1]||v[v.length-1],n=n.substring(i))}}return i+=this.$getStringScreenWidth(n,t)[1],this.$useWrapMode&&i>=s&&(i=s-1),p?p.idxToPosition(i):{row:r,column:i}},this.documentToScreenPosition=function(e,t){if(typeof t=="undefined")var n=this.$clipPositionToDocument(e.row,e.column);else n=this.$clipPositionToDocument(e,t);e=n.row,t=n.column;var r=0,i=null,s=null;s=this.getFoldAt(e,t,1),s&&(e=s.start.row,t=s.start.column);var o,u=0,a=this.$docRowCache,f=this.$getRowCacheIndex(a,e),l=a.length;if(l&&f>=0)var u=a[f],r=this.$screenRowCache[f],c=e>a[l-1];else var c=!l;var h=this.getNextFoldLine(u),p=h?h.start.row:Infinity;while(u<e){if(u>=p){o=h.end.row+1;if(o>e)break;h=this.getNextFoldLine(o,h),p=h?h.start.row:Infinity}else o=u+1;r+=this.getRowLength(u),u=o,c&&(this.$docRowCache.push(u),this.$screenRowCache.push(r))}var d="";h&&u>=p?(d=this.getFoldDisplayLine(h,e,t),i=h.start.row):(d=this.getLine(e).substring(0,t),i=e);if(this.$useWrapMode){var v=this.$wrapData[i];if(v){var m=0;while(d.length>=v[m])r++,m++;d=d.substring(v[m-1]||0,d.length)}}return{row:r,column:this.$getStringScreenWidth(d)[0]}},this.documentToScreenColumn=function(e,t){return this.documentToScreenPosition(e,t).column},this.documentToScreenRow=function(e,t){return this.documentToScreenPosition(e,t).row},this.getScreenLength=function(){var e=0,t=null;if(!this.$useWrapMode){e=this.getLength();var n=this.$foldData;for(var r=0;r<n.length;r++)t=n[r],e-=t.end.row-t.start.row}else{var i=this.$wrapData.length,s=0,r=0,t=this.$foldData[r++],o=t?t.start.row:Infinity;while(s<i){var u=this.$wrapData[s];e+=u?u.length+1:1,s++,s>o&&(s=t.end.row+1,t=this.$foldData[r++],o=t?t.start.row:Infinity)}}return this.lineWidgets&&(e+=this.$getWidgetScreenLength()),e},this.$setFontMetrics=function(e){}}).call(p.prototype),e("./edit_session/folding").Folding.call(p.prototype),e("./edit_session/bracket_match").BracketMatch.call(p.prototype),s.defineOptions(p.prototype,"session",{wrap:{set:function(e){!e||e=="off"?e=!1:e=="free"?e=!0:e=="printMargin"?e=-1:typeof e=="string"&&(e=parseInt(e,10)||!1);if(this.$wrap==e)return;if(!e)this.setUseWrapMode(!1);else{var t=typeof e=="number"?e:null;this.setWrapLimitRange(t,t),this.setUseWrapMode(!0)}this.$wrap=e},get:function(){return this.getUseWrapMode()?this.$wrap==-1?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(e){e=e=="auto"?this.$mode.type!="text":e!="text",e!=this.$wrapAsCode&&(this.$wrapAsCode=e,this.$useWrapMode&&(this.$modified=!0,this.$resetRowCache(0),this.$updateWrapData(0,this.getLength()-1)))},initialValue:"auto"},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(e){this.$useWorker=e,this.$stopWorker(),e&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(e){if(isNaN(e)||this.$tabSize===e)return;this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=e,this._signal("changeTabSize")},initialValue:4,handlesSet:!0},overwrite:{set:function(e){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(e){this.doc.setNewLineMode(e)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(e){this.setMode(e)},get:function(){return this.$modeId}}}),t.EditSession=p}),define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],function(e,t,n){var r=e("../lib/oop"),i=e("../keyboard/hash_handler").HashHandler,s=e("../lib/event_emitter").EventEmitter,o=function(e,t){i.call(this,t,e),this.byName=this.commands,this.setDefaultHandler("exec",function(e){return e.command.exec(e.editor,e.args||{})})};r.inherits(o,i),function(){r.implement(this,s),this.exec=function(e,t,n){typeof e=="string"&&(e=this.commands[e]);if(!e)return!1;if(t&&t.$readOnly&&!e.readOnly)return!1;var r={editor:t,command:e,args:n},i=this._emit("exec",r);return this._signal("afterExec",r),i===!1?!1:!0},this.toggleRecording=function(e){if(this.$inReplay)return;return e&&e._emit("changeStatus"),this.recording?(this.macro.pop(),this.removeEventListener("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0)},this.replay=function(e){if(this.$inReplay||!this.macro)return;if(this.recording)return this.toggleRecording(e);try{this.$inReplay=!0,this.macro.forEach(function(t){typeof t=="string"?this.exec(t,e):this.exec(t[0],e,t[1])},this)}finally{this.$inReplay=!1}},this.trimMacro=function(e){return e.map(function(e){return typeof e[0]!="string"&&(e[0]=e[0].name),e[1]||(e=e[0]),e})}}.call(o.prototype),t.CommandManager=o}),define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(e,t,n){var r=e("../lib/keys"),i=e("../lib/event"),s=function(e){this.$editor=e,this.$data={},this.$handlers=[],this.setDefaultHandler(e.commands)};(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=e,this.addKeyboardHandler(e,0),this.$data={editor:this.$editor}},this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]==e)return;while(t[t.length-1]&&t[t.length-1]!=this.$defaultHandler)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)},this.addKeyboardHandler=function(e,t){if(!e)return;typeof e=="function"&&!e.handleKeyboard&&(e.handleKeyboard=e);var n=this.$handlers.indexOf(e);n!=-1&&this.$handlers.splice(n,1),t==undefined?this.$handlers.push(e):this.$handlers.splice(t,0,e),n==-1&&e.attach&&e.attach(this.$editor)},this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);return t==-1?!1:(this.$handlers.splice(t,1),e.detach&&e.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.$callKeyboardHandlers=function(e,t,n,r){var s,o=!1,u=this.$editor.commands;for(var a=this.$handlers.length;a--;){s=this.$handlers[a].handleKeyboard(this.$data,e,t,n,r);if(!s||!s.command)continue;s.command=="null"?o=!0:o=u.exec(s.command,this.$editor,s.args,r),o&&r&&e!=-1&&s.passEvent!=1&&s.command.passEvent!=1&&i.stopEvent(r);if(o)break}return o},this.onCommandKey=function(e,t,n){var i=r.keyCodeToString(n);this.$callKeyboardHandlers(t,i,n,e)},this.onTextInput=function(e){var t=this.$callKeyboardHandlers(-1,e);t||this.$editor.commands.exec("insertstring",this.$editor,e)}}).call(s.prototype),t.KeyBinding=s}),define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(e,t,n){function s(e,t){this.platform=t||(i.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={};if(this.__defineGetter__&&this.__defineSetter__&&typeof console!="undefined"&&console.error){var n=!1,r=function(){n||(n=!0,console.error("commmandKeyBinding has too many m's. use commandKeyBinding"))};this.__defineGetter__("commmandKeyBinding",function(){return r(),this.commandKeyBinding}),this.__defineSetter__("commmandKeyBinding",function(e){return r(),this.commandKeyBinding=e})}else this.commmandKeyBinding=this.commandKeyBinding;this.addCommands(e)}var r=e("../lib/keys"),i=e("../lib/useragent");(function(){this.addCommand=function(e){this.commands[e.name]&&this.removeCommand(e),this.commands[e.name]=e,e.bindKey&&this._buildKeyHash(e)},this.removeCommand=function(e){var t=typeof e=="string"?e:e.name;e=this.commands[t],delete this.commands[t];var n=this.commandKeyBinding;for(var r in n)for(var i in n[r])n[r][i]==e&&delete n[r][i]},this.bindKey=function(e,t){if(!e)return;if(typeof t=="function"){this.addCommand({exec:t,bindKey:e,name:t.name||e});return}var n=this.commandKeyBinding;e.split("|").forEach(function(e){var r=this.parseKeys(e,t),i=r.hashId;(n[i]||(n[i]={}))[r.key]=t},this)},this.addCommands=function(e){e&&Object.keys(e).forEach(function(t){var n=e[t];if(!n)return;if(typeof n=="string")return this.bindKey(n,t);typeof n=="function"&&(n={exec:n});if(typeof n!="object")return;n.name||(n.name=t),this.addCommand(n)},this)},this.removeCommands=function(e){Object.keys(e).forEach(function(t){this.removeCommand(e[t])},this)},this.bindKeys=function(e){Object.keys(e).forEach(function(t){this.bindKey(t,e[t])},this)},this._buildKeyHash=function(e){var t=e.bindKey;if(!t)return;var n=typeof t=="string"?t:t[this.platform];this.bindKey(n,e)},this.parseKeys=function(e){e.indexOf(" ")!=-1&&(e=e.split(/\s+/).pop());var t=e.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(e){return e}),n=t.pop(),i=r[n];if(r.FUNCTION_KEYS[i])n=r.FUNCTION_KEYS[i].toLowerCase();else{if(!t.length)return{key:n,hashId:-1};if(t.length==1&&t[0]=="shift")return{key:n.toUpperCase(),hashId:-1}}var s=0;for(var o=t.length;o--;){var u=r.KEY_MODS[t[o]];if(u==null)return typeof console!="undefined"&&console.error("invalid modifier "+t[o]+" in "+e),!1;s|=u}return{key:n,hashId:s}},this.findKeyCommand=function(t,n){var r=this.commandKeyBinding;return r[t]&&r[t][n]},this.handleKeyboard=function(e,t,n,r){return{command:this.findKeyCommand(t,n)}}}).call(s.prototype),t.HashHandler=s}),define("ace/mouse/fold_handler",["require","exports","module"],function(e,t,n){function r(e){e.on("click",function(t){var n=t.getDocumentPosition(),r=e.session,i=r.getFoldAt(n.row,n.column,1);i&&(t.getAccelKey()?r.removeFold(i):r.expandFold(i),t.stop())}),e.on("gutterclick",function(t){var n=e.renderer.$gutterLayer.getRegion(t);if(n=="foldWidgets"){var r=t.getDocumentPosition().row,i=e.session;i.foldWidgets&&i.foldWidgets[r]&&e.session.onFoldWidgetClick(r,t),e.isFocused()||e.focus(),t.stop()}}),e.on("gutterdblclick",function(t){var n=e.renderer.$gutterLayer.getRegion(t);if(n=="foldWidgets"){var r=t.getDocumentPosition().row,i=e.session,s=i.getParentFoldRangeData(r,!0),o=s.range||s.firstRange;if(o){r=o.start.row;var u=i.getFoldAt(r,i.getLine(r).length,1);u?i.removeFold(u):(i.addFold("...",o),e.renderer.scrollCursorIntoView({row:o.start.row,column:0}))}t.stop()}})}t.FoldHandler=r}),define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config"],function(e,t,n){function s(e,t){return{win:e,mac:t}}var r=e("../lib/lang"),i=e("../config");t.commands=[{name:"showSettingsMenu",bindKey:s("Ctrl-,","Command-,"),exec:function(e){i.loadModule("ace/ext/settings_menu",function(t){t.init(e),e.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",bindKey:s("Alt-E","Ctrl-E"),exec:function(e){i.loadModule("ace/ext/error_marker",function(t){t.showErrorMarker(e,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",bindKey:s("Alt-Shift-E","Ctrl-Shift-E"),exec:function(e){i.loadModule("ace/ext/error_marker",function(t){t.showErrorMarker(e,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",bindKey:s("Ctrl-A","Command-A"),exec:function(e){e.selectAll()},readOnly:!0},{name:"centerselection",bindKey:s(null,"Ctrl-L"),exec:function(e){e.centerSelection()},readOnly:!0},{name:"gotoline",bindKey:s("Ctrl-L","Command-L"),exec:function(e){var t=parseInt(prompt("Enter line number:"),10);isNaN(t)||e.gotoLine(t)},readOnly:!0},{name:"fold",bindKey:s("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(e){e.session.toggleFold(!1)},scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:s("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(e){e.session.toggleFold(!0)},scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",bindKey:s("F2","F2"),exec:function(e){e.session.toggleFoldWidget()},scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",bindKey:s("Alt-F2","Alt-F2"),exec:function(e){e.session.toggleFoldWidget(!0)},scrollIntoView:"center",readOnly:!0},{name:"foldall",bindKey:s("Ctrl-Alt-0","Ctrl-Command-Option-0"),exec:function(e){e.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",bindKey:s("Alt-0","Command-Option-0"),exec:function(e){e.session.foldAll(),e.session.unfold(e.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",bindKey:s("Alt-Shift-0","Command-Option-Shift-0"),exec:function(e){e.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",bindKey:s("Ctrl-K","Command-G"),exec:function(e){e.findNext()},readOnly:!0},{name:"findprevious",bindKey:s("Ctrl-Shift-K","Command-Shift-G"),exec:function(e){e.findPrevious()},readOnly:!0},{name:"selectOrFindNext",bindKey:s("ALt-K","Ctrl-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findNext()},readOnly:!0},{name:"selectOrFindPrevious",bindKey:s("Alt-Shift-K","Ctrl-Shift-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findPrevious()},readOnly:!0},{name:"find",bindKey:s("Ctrl-F","Command-F"),exec:function(e){i.loadModule("ace/ext/searchbox",function(t){t.Search(e)})},readOnly:!0},{name:"overwrite",bindKey:"Insert",exec:function(e){e.toggleOverwrite()},readOnly:!0},{name:"selecttostart",bindKey:s("Ctrl-Shift-Home","Command-Shift-Up"),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",bindKey:s("Ctrl-Home","Command-Home|Command-Up"),exec:function(e){e.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",bindKey:s("Shift-Up","Shift-Up"),exec:function(e){e.getSelection().selectUp()},multiSelectAction:"forEach",readOnly:!0},{name:"golineup",bindKey:s("Up","Up|Ctrl-P"),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:"forEach",readOnly:!0},{name:"selecttoend",bindKey:s("Ctrl-Shift-End","Command-Shift-Down"),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",bindKey:s("Ctrl-End","Command-End|Command-Down"),exec:function(e){e.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",bindKey:s("Shift-Down","Shift-Down"),exec:function(e){e.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",bindKey:s("Down","Down|Ctrl-N"),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",bindKey:s("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(e){e.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",bindKey:s("Ctrl-Left","Option-Left"),exec:function(e){e.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",bindKey:s("Alt-Shift-Left","Command-Shift-Left"),exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",bindKey:s("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(e){e.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",bindKey:s("Shift-Left","Shift-Left"),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",bindKey:s("Left","Left|Ctrl-B"),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",bindKey:s("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(e){e.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",bindKey:s("Ctrl-Right","Option-Right"),exec:function(e){e.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",bindKey:s("Alt-Shift-Right","Command-Shift-Right"),exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",bindKey:s("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(e){e.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",bindKey:s("Shift-Right","Shift-Right"),exec:function(e){e.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",bindKey:s("Right","Right|Ctrl-F"),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",bindKey:"Shift-PageDown",exec:function(e){e.selectPageDown()},readOnly:!0},{name:"pagedown",bindKey:s(null,"Option-PageDown"),exec:function(e){e.scrollPageDown()},readOnly:!0},{name:"gotopagedown",bindKey:s("PageDown","PageDown|Ctrl-V"),exec:function(e){e.gotoPageDown()},readOnly:!0},{name:"selectpageup",bindKey:"Shift-PageUp",exec:function(e){e.selectPageUp()},readOnly:!0},{name:"pageup",bindKey:s(null,"Option-PageUp"),exec:function(e){e.scrollPageUp()},readOnly:!0},{name:"gotopageup",bindKey:"PageUp",exec:function(e){e.gotoPageUp()},readOnly:!0},{name:"scrollup",bindKey:s("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",bindKey:s("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",bindKey:"Shift-Home",exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",bindKey:"Shift-End",exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",bindKey:s("Ctrl-Alt-E","Command-Option-E"),exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},{name:"replaymacro",bindKey:s("Ctrl-Shift-E","Command-Shift-E"),exec:function(e){e.commands.replay(e)},readOnly:!0},{name:"jumptomatching",bindKey:s("Ctrl-P","Ctrl-Shift-P"),exec:function(e){e.jumpToMatching()},multiSelectAction:"forEach",readOnly:!0},{name:"selecttomatching",bindKey:s("Ctrl-Shift-P",null),exec:function(e){e.jumpToMatching(!0)},multiSelectAction:"forEach",readOnly:!0},{name:"cut",exec:function(e){var t=e.getSelectionRange();e._emit("cut",t),e.selection.isEmpty()||(e.session.remove(t),e.clearSelection())},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"removeline",bindKey:s("Ctrl-D","Command-D"),exec:function(e){e.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",bindKey:s("Ctrl-Shift-D","Command-Shift-D"),exec:function(e){e.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",bindKey:s("Ctrl-Alt-S","Command-Alt-S"),exec:function(e){e.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",bindKey:s("Ctrl-/","Command-/"),exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",bindKey:s("Ctrl-Shift-/","Command-Shift-/"),exec:function(e){e.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",bindKey:s("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(e){e.modifyNumber(1)},multiSelectAction:"forEach"},{name:"modifyNumberDown",bindKey:s("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(e){e.modifyNumber(-1)},multiSelectAction:"forEach"},{name:"replace",bindKey:s("Ctrl-H","Command-Option-F"),exec:function(e){i.loadModule("ace/ext/searchbox",function(t){t.Search(e,!0)})}},{name:"undo",bindKey:s("Ctrl-Z","Command-Z"),exec:function(e){e.undo()}},{name:"redo",bindKey:s("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(e){e.redo()}},{name:"copylinesup",bindKey:s("Alt-Shift-Up","Command-Option-Up"),exec:function(e){e.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",bindKey:s("Alt-Up","Option-Up"),exec:function(e){e.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",bindKey:s("Alt-Shift-Down","Command-Option-Down"),exec:function(e){e.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",bindKey:s("Alt-Down","Option-Down"),exec:function(e){e.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",bindKey:s("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(e){e.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",bindKey:s("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(e){e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",bindKey:s("Shift-Delete",null),exec:function(e){if(!e.selection.isEmpty())return!1;e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",bindKey:s("Alt-Backspace","Command-Backspace"),exec:function(e){e.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",bindKey:s("Alt-Delete","Ctrl-K"),exec:function(e){e.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",bindKey:s("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(e){e.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",bindKey:s("Ctrl-Delete","Alt-Delete"),exec:function(e){e.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",bindKey:s("Shift-Tab","Shift-Tab"),exec:function(e){e.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",bindKey:s("Tab","Tab"),exec:function(e){e.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",bindKey:s("Ctrl-[","Ctrl-["),exec:function(e){e.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",bindKey:s("Ctrl-]","Ctrl-]"),exec:function(e){e.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",exec:function(e,t){e.insert(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",exec:function(e,t){e.insert(r.stringRepeat(t.text||"",t.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",bindKey:s(null,"Ctrl-O"),exec:function(e){e.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",bindKey:s("Ctrl-T","Ctrl-T"),exec:function(e){e.transposeLetters()},multiSelectAction:function(e){e.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",bindKey:s("Ctrl-U","Ctrl-U"),exec:function(e){e.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",bindKey:s("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(e){e.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"}]}),define("ace/lib/event_emitter",["require","exports","module"],function(e,t,n){var r={},i=function(){this.propagationStopped=!0},s=function(){this.defaultPrevented=!0};r._emit=r._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var n=this._eventRegistry[e]||[],r=this._defaultHandlers[e];if(!n.length&&!r)return;if(typeof t!="object"||!t)t={};t.type||(t.type=e),t.stopPropagation||(t.stopPropagation=i),t.preventDefault||(t.preventDefault=s),n=n.slice();for(var o=0;o<n.length;o++){n[o](t,this);if(t.propagationStopped)break}if(r&&!t.defaultPrevented)return r(t,this)},r._signal=function(e,t){var n=(this._eventRegistry||{})[e];if(!n)return;n=n.slice();for(var r=0;r<n.length;r++)n[r](t,this)},r.once=function(e,t){var n=this;t&&this.addEventListener(e,function r(){n.removeEventListener(e,r),t.apply(null,arguments)})},r.setDefaultHandler=function(e,t){var n=this._defaultHandlers;n||(n=this._defaultHandlers={_disabled_:{}});if(n[e]){var r=n[e],i=n._disabled_[e];i||(n._disabled_[e]=i=[]),i.push(r);var s=i.indexOf(t);s!=-1&&i.splice(s,1)}n[e]=t},r.removeDefaultHandler=function(e,t){var n=this._defaultHandlers;if(!n)return;var r=n._disabled_[e];if(n[e]==t){var i=n[e];r&&this.setDefaultHandler(e,r.pop())}else if(r){var s=r.indexOf(t);s!=-1&&r.splice(s,1)}},r.on=r.addEventListener=function(e,t,n){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[e];return r||(r=this._eventRegistry[e]=[]),r.indexOf(t)==-1&&r[n?"unshift":"push"](t),t},r.off=r.removeListener=r.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var n=this._eventRegistry[e];if(!n)return;var r=n.indexOf(t);r!==-1&&n.splice(r,1)},r.removeAllListeners=function(e){this._eventRegistry&&(this._eventRegistry[e]=[])},t.EventEmitter=r}),define("ace/undomanager",["require","exports","module"],function(e,t,n){var r=function(){this.reset()};(function(){this.execute=function(e){var t=e.args[0];this.$doc=e.args[1],e.merge&&this.hasUndo()&&(this.dirtyCounter--,t=this.$undoStack.pop().concat(t)),this.$undoStack.push(t),this.$redoStack=[],this.dirtyCounter<0&&(this.dirtyCounter=NaN),this.dirtyCounter++},this.undo=function(e){var t=this.$undoStack.pop(),n=null;return t&&(n=this.$doc.undoChanges(t,e),this.$redoStack.push(t),this.dirtyCounter--),n},this.redo=function(e){var t=this.$redoStack.pop(),n=null;return t&&(n=this.$doc.redoChanges(t,e),this.$undoStack.push(t),this.dirtyCounter++),n},this.reset=function(){this.$undoStack=[],this.$redoStack=[],this.dirtyCounter=0},this.hasUndo=function(){return this.$undoStack.length>0},this.hasRedo=function(){return this.$redoStack.length>0},this.markClean=function(){this.dirtyCounter=0},this.isClean=function(){return this.dirtyCounter===0}}).call(r.prototype),t.UndoManager=r}),define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(e,t,n){var r=e("./dom");t.get=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)},t.loadScript=function(e,t){var n=r.getDocumentHead(),i=document.createElement("script");i.src=e,n.appendChild(i),i.onload=i.onreadystatechange=function(e,n){if(n||!i.readyState||i.readyState=="loaded"||i.readyState=="complete")i=i.onload=i.onreadystatechange=null,n||t()}}}),define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./config"),o=e("./layer/gutter").Gutter,u=e("./layer/marker").Marker,a=e("./layer/text").Text,f=e("./layer/cursor").Cursor,l=e("./scrollbar").HScrollBar,c=e("./scrollbar").VScrollBar,h=e("./renderloop").RenderLoop,p=e("./layer/font_metrics").FontMetrics,d=e("./lib/event_emitter").EventEmitter,v='.ace_editor {position: relative;overflow: hidden;font-family: \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;font-size: 12px;line-height: normal;direction: ltr;}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_content {position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: text;min-width: 100%;}.ace_dragging, .ace_dragging * {cursor: move !important;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;text-indent: -1em;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;}.ace_text-input.ace_composition {background: #f8f8f8;color: #111;z-index: 1000;opacity: 1;text-indent: 0;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;white-space: pre;height: 100%;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;/* setting pointer-events: auto; on node under the mouse, which changesduring scroll, will break mouse wheel scrolling in Safari */pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;}.ace_text-layer {font: inherit !important;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;border-left: 2px solid}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0px;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {-moz-transition: opacity 0.18s;-webkit-transition: opacity 0.18s;-o-transition: opacity 0.18s;-ms-transition: opacity 0.18s;transition: opacity 0.18s;}.ace_editor.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.ace_line .ace_fold {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;-moz-border-radius: 2px;-webkit-border-radius: 2px;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;display: block;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);-moz-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);-webkit-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);-moz-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);-webkit-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}/*** Dark version for fold widgets*/.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {-moz-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);-webkit-box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {-moz-transition: opacity 0.4s ease 0.05s;-webkit-transition: opacity 0.4s ease 0.05s;-o-transition: opacity 0.4s ease 0.05s;-ms-transition: opacity 0.4s ease 0.05s;transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {-moz-transition: opacity 0.05s ease 0.05s;-webkit-transition: opacity 0.05s ease 0.05s;-o-transition: opacity 0.05s ease 0.05s;-ms-transition: opacity 0.05s ease 0.05s;transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}';i.importCssString(v,"ace_editor");var m=function(e,t){var n=this;this.container=e||i.createElement("div"),this.$keepTextAreaAtCursor=!0,i.addCssClass(this.container,"ace_editor"),this.setTheme(t),this.$gutter=i.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.scroller=i.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=i.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new o(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new u(this.content);var r=this.$textLayer=new a(this.content);this.canvas=r.element,this.$markerFront=new u(this.content),this.$cursorLayer=new f(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new c(this.container,this),this.scrollBarH=new l(this.container,this),this.scrollBarV.addEventListener("scroll",function(e){n.$scrollAnimation||n.session.setScrollTop(e.data-n.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(e){n.$scrollAnimation||n.session.setScrollLeft(e.data-n.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new p(this.container,500),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.addEventListener("changeCharacterSize",function(e){n.updateCharacterSize(),n.onResize(!0,n.gutterWidth,n.$size.width,n.$size.height),n._signal("changeCharacterSize",e)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$loop=new h(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),s.resetOptions(this),s._emit("renderer",this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,r.implement(this,d),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin()},this.setSession=function(e){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=e;if(!e)return;this.scrollMargin.top&&e.getScrollTop()<=0&&e.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(e),this.$markerBack.setSession(e),this.$markerFront.setSession(e),this.$gutterLayer.setSession(e),this.$textLayer.setSession(e),this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode)},this.updateLines=function(e,t){t===undefined&&(t=Infinity),this.$changedLines?(this.$changedLines.firstRow>e&&(this.$changedLines.firstRow=e),this.$changedLines.lastRow<t&&(this.$changedLines.lastRow=t)):this.$changedLines={firstRow:e,lastRow:t};if(this.$changedLines.firstRow>this.layerConfig.lastRow||this.$changedLines.lastRow<this.layerConfig.firstRow)return;this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar()},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(e){e?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(e,t,n,r){if(this.resizing>2)return;this.resizing>0?this.resizing++:this.resizing=e?1:0;var i=this.container;r||(r=i.clientHeight||i.scrollHeight),n||(n=i.clientWidth||i.scrollWidth);var s=this.$updateCachedSize(e,t,n,r);if(!this.$size.scrollerHeight||!n&&!r)return this.resizing=0;e&&(this.$gutterLayer.$padding=null),e?this.$renderChanges(s|this.$changes,!0):this.$loop.schedule(s|this.$changes),this.resizing&&(this.resizing=0)},this.$updateCachedSize=function(e,t,n,r){r-=this.$extraHeight||0;var i=0,s=this.$size,o={width:s.width,height:s.height,scrollerHeight:s.scrollerHeight,scrollerWidth:s.scrollerWidth};r&&(e||s.height!=r)&&(s.height=r,i|=this.CHANGE_SIZE,s.scrollerHeight=s.height,this.$horizScroll&&(s.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",i|=this.CHANGE_SCROLL);if(n&&(e||s.width!=n)){i|=this.CHANGE_SIZE,s.width=n,t==null&&(t=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=t,this.scrollBarH.element.style.left=this.scroller.style.left=t+"px",s.scrollerWidth=Math.max(0,n-t-this.scrollBarV.getWidth()),this.scrollBarH.element.style.right=this.scroller.style.right=this.scrollBarV.getWidth()+"px",this.scroller.style.bottom=this.scrollBarH.getHeight()+"px";if(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||e)i|=this.CHANGE_FULL}return s.$dirty=!n||!r,i&&this._signal("resize",o),i},this.onGutterResize=function(){var e=this.$showGutter?this.$gutter.offsetWidth:0;e!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,e,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):(this.$computeLayerConfig(),this.$loop.schedule(this.CHANGE_MARKER))},this.adjustWrapLimit=function(){var e=this.$size.scrollerWidth-this.$padding*2,t=Math.floor(e/this.characterWidth);return this.session.adjustWrapLimit(t,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(e){this.setOption("animatedScroll",e)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(e){this.setOption("showInvisibles",e)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(e){this.setOption("displayIndentGuides",e)},this.setShowPrintMargin=function(e){this.setOption("showPrintMargin",e)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(e){this.setOption("printMarginColumn",e)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(e){return this.setOption("showGutter",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updateGutterLineHighlight=function(){var e=this.$cursorLayer.$pixelPos,t=this.layerConfig.lineHeight;if(this.session.getUseWrapMode()){var n=this.session.selection.getCursor();n.column=0,e=this.$cursorLayer.getPixelPosition(n,!0),t*=this.session.getRowLength(n.row)}this.$gutterLineHighlight.style.top=e.top-this.layerConfig.offset+"px",this.$gutterLineHighlight.style.height=t+"px"},this.$updatePrintMargin=function(){if(!this.$showPrintMargin&&!this.$printMarginEl)return;if(!this.$printMarginEl){var e=i.createElement("div");e.className="ace_layer ace_print-margin-layer",this.$printMarginEl=i.createElement("div"),this.$printMarginEl.className="ace_print-margin",e.appendChild(this.$printMarginEl),this.content.insertBefore(e,this.content.firstChild)}var t=this.$printMarginEl.style;t.left=this.characterWidth*this.$printMarginColumn+this.$padding+"px",t.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&this.session.$wrap==-1&&this.adjustWrapLimit()},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.content},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){if(!this.$keepTextAreaAtCursor)return;var e=this.layerConfig,t=this.$cursorLayer.$pixelPos.top,n=this.$cursorLayer.$pixelPos.left;t-=e.offset;var r=this.lineHeight;if(t<0||t>e.height-r)return;var i=this.characterWidth;if(this.$composition){var s=this.textarea.value.replace(/^\x01+/,"");i*=this.session.$getStringScreenWidth(s)[0]+2,r+=2,t-=1}n-=this.scrollLeft,n>this.$size.scrollerWidth-i&&(n=this.$size.scrollerWidth-i),n-=this.scrollBar.width,this.textarea.style.height=r+"px",this.textarea.style.width=i+"px",this.textarea.style.right=Math.max(0,this.$size.scrollerWidth-n-i)+"px",this.textarea.style.bottom=Math.max(0,this.$size.height-t-r)+"px"},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)},this.getLastFullyVisibleRow=function(){var e=Math.floor((this.layerConfig.height+this.layerConfig.offset)/this.layerConfig.lineHeight);return this.layerConfig.firstRow-1+e},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(e){this.$padding=e,this.$textLayer.setPadding(e),this.$cursorLayer.setPadding(e),this.$markerFront.setPadding(e),this.$markerBack.setPadding(e),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(e,t,n,r){var i=this.scrollMargin;i.top=e|0,i.bottom=t|0,i.right=r|0,i.left=n|0,i.v=i.top+i.bottom,i.h=i.left+i.right,i.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-i.top),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(e){this.setOption("hScrollBarAlwaysVisible",e)},this.getVScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(e){this.setOption("vScrollBarAlwaysVisible",e)},this.$updateScrollBarV=function(){this.scrollBarV.setScrollHeight(this.layerConfig.maxHeight+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(e,t){this.$changes&&(e|=this.$changes,this.$changes=0);if(!this.session||!this.container.offsetWidth||this.$frozen||!e&&!t){this.$changes|=e;return}if(this.$size.$dirty)return this.$changes|=e,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender");var n=this.layerConfig;if(e&this.CHANGE_FULL||e&this.CHANGE_SIZE||e&this.CHANGE_TEXT||e&this.CHANGE_LINES||e&this.CHANGE_SCROLL||e&this.CHANGE_H_SCROLL)e|=this.$computeLayerConfig(),n=this.layerConfig,this.$updateScrollBarV(),e&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),this.$gutterLayer.element.style.marginTop=-n.offset+"px",this.content.style.marginTop=-n.offset+"px",this.content.style.width=n.width+2*this.$padding+"px",this.content.style.height=n.minHeight+"px";e&this.CHANGE_H_SCROLL&&(this.content.style.marginLeft=-this.scrollLeft+"px",this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left");if(e&this.CHANGE_FULL){this.$textLayer.update(n),this.$showGutter&&this.$gutterLayer.update(n),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),this.$highlightGutterLine&&this.$updateGutterLineHighlight(),this._signal("afterRender");return}if(e&this.CHANGE_SCROLL){e&this.CHANGE_TEXT||e&this.CHANGE_LINES?this.$textLayer.update(n):this.$textLayer.scrollLines(n),this.$showGutter&&this.$gutterLayer.update(n),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$highlightGutterLine&&this.$updateGutterLineHighlight(),this.$moveTextAreaToCursor(),this._signal("afterRender");return}e&this.CHANGE_TEXT?(this.$textLayer.update(n),this.$showGutter&&this.$gutterLayer.update(n)):e&this.CHANGE_LINES?(this.$updateLines()||e&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(n):(e&this.CHANGE_TEXT||e&this.CHANGE_GUTTER)&&this.$showGutter&&this.$gutterLayer.update(n),e&this.CHANGE_CURSOR&&(this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),this.$highlightGutterLine&&this.$updateGutterLineHighlight()),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(n),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(n),this._signal("afterRender")},this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight,t=this.$maxLines*this.lineHeight,n=Math.max((this.$minLines||1)*this.lineHeight,Math.min(t,e))+this.scrollMargin.v+(this.$extraHeight||0),r=e>t;if(n!=this.desiredHeight||this.$size.height!=this.desiredHeight||r!=this.$vScroll){r!=this.$vScroll&&(this.$vScroll=r,this.scrollBarV.setVisible(r));var i=this.container.clientWidth;this.container.style.height=n+"px",this.$updateCachedSize(!0,this.$gutterWidth,i,n),this.desiredHeight=n}},this.$computeLayerConfig=function(){this.$maxLines&&this.lineHeight>1&&this.$autosize();var e=this.session,t=this.$size,n=t.height<=2*this.lineHeight,r=this.session.getScreenLength(),i=r*this.lineHeight,s=this.scrollTop%this.lineHeight,o=t.scrollerHeight+this.lineHeight,u=this.$getLongestLine(),a=!n&&(this.$hScrollBarAlwaysVisible||t.scrollerWidth-u-2*this.$padding<0),f=this.$horizScroll!==a;f&&(this.$horizScroll=a,this.scrollBarH.setVisible(a)),!this.$maxLines&&this.$scrollPastEnd&&this.scrollTop>i-t.scrollerHeight&&(i+=Math.min((t.scrollerHeight-this.lineHeight)*this.$scrollPastEnd,this.scrollTop-i+t.scrollerHeight));var l=!n&&(this.$vScrollBarAlwaysVisible||t.scrollerHeight-i<0),c=this.$vScroll!==l;c&&(this.$vScroll=l,this.scrollBarV.setVisible(l)),this.session.setScrollTop(Math.max(-this.scrollMargin.top,Math.min(this.scrollTop,i-t.scrollerHeight+this.scrollMargin.bottom))),this.session.setScrollLeft(Math.max(-this.scrollMargin.left,Math.min(this.scrollLeft,u+2*this.$padding-t.scrollerWidth+this.scrollMargin.right)));var h=Math.ceil(o/this.lineHeight)-1,p=Math.max(0,Math.round((this.scrollTop-s)/this.lineHeight)),d=p+h,v,m,g=this.lineHeight;p=e.screenToDocumentRow(p,0);var y=e.getFoldLine(p);y&&(p=y.start.row),v=e.documentToScreenRow(p,0),m=e.getRowLength(p)*g,d=Math.min(e.screenToDocumentRow(d,0),e.getLength()-1),o=t.scrollerHeight+e.getRowLength(d)*g+m,s=this.scrollTop-v*g;var b=0;this.layerConfig.width!=u&&(b=this.CHANGE_H_SCROLL);if(f||c)b=this.$updateCachedSize(!0,this.gutterWidth,t.width,t.height),this._signal("scrollbarVisibilityChanged"),c&&(u=this.$getLongestLine());return this.layerConfig={width:u,padding:this.$padding,firstRow:p,firstRowScreen:v,lastRow:d,lineHeight:g,characterWidth:this.characterWidth,minHeight:o,maxHeight:i,offset:s,gutterOffset:Math.max(0,Math.ceil((s+t.height-t.scrollerHeight)/g)),height:this.$size.scrollerHeight},b},this.$updateLines=function(){var e=this.$changedLines.firstRow,t=this.$changedLines.lastRow;this.$changedLines=null;var n=this.layerConfig;if(e>n.lastRow+1)return;if(t<n.firstRow)return;if(t===Infinity){this.$showGutter&&this.$gutterLayer.update(n),this.$textLayer.update(n);return}return this.$textLayer.updateLines(n,e,t),!0},this.$getLongestLine=function(){var e=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(e+=1),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(e*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(e,t){this.$gutterLayer.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){this.$gutterLayer.removeGutterDecoration(e,t)},this.updateBreakpoints=function(e){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(e){this.$gutterLayer.setAnnotations(e),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(e,t,n){this.scrollCursorIntoView(e,n),this.scrollCursorIntoView(t,n)},this.scrollCursorIntoView=function(e,t,n){if(this.$size.scrollerHeight===0)return;var r=this.$cursorLayer.getPixelPosition(e),i=r.left,s=r.top,o=n&&n.top||0,u=n&&n.bottom||0,a=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;a+o>s?(t&&(s-=t*this.$size.scrollerHeight),s===0&&(s=-this.scrollMargin.top),this.session.setScrollTop(s)):a+this.$size.scrollerHeight-u<s+this.lineHeight&&(t&&(s+=t*this.$size.scrollerHeight),this.session.setScrollTop(s+this.lineHeight-this.$size.scrollerHeight));var f=this.scrollLeft;f>i?(i<this.$padding+2*this.layerConfig.characterWidth&&(i=-this.scrollMargin.left),this.session.setScrollLeft(i)):f+this.$size.scrollerWidth<i+this.characterWidth?this.session.setScrollLeft(Math.round(i+this.characterWidth-this.$size.scrollerWidth)):f<=this.$padding&&i-f<this.characterWidth&&this.session.setScrollLeft(0)},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(e){this.session.setScrollTop(e*this.lineHeight)},this.alignCursor=function(e,t){typeof e=="number"&&(e={row:e,column:0});var n=this.$cursorLayer.getPixelPosition(e),r=this.$size.scrollerHeight-this.lineHeight,i=n.top-r*(t||0);return this.session.setScrollTop(i),i},this.STEPS=8,this.$calcSteps=function(e,t){var n=0,r=this.STEPS,i=[],s=function(e,t,n){return n*(Math.pow(e-1,3)+1)+t};for(n=0;n<r;++n)i.push(s(n/this.STEPS,e,t-e));return i},this.scrollToLine=function(e,t,n,r){var i=this.$cursorLayer.getPixelPosition({row:e,column:0}),s=i.top;t&&(s-=this.$size.scrollerHeight/2);var o=this.scrollTop;this.session.setScrollTop(s),n!==!1&&this.animateScrolling(o,r)},this.animateScrolling=function(e,t){var n=this.scrollTop;if(!this.$animatedScroll)return;var r=this;if(e==n)return;if(this.$scrollAnimation){var i=this.$scrollAnimation.steps;if(i.length){e=i[0];if(e==n)return}}var s=r.$calcSteps(e,n);this.$scrollAnimation={from:e,to:n,steps:s},clearInterval(this.$timer),r.session.setScrollTop(s.shift()),r.session.$scrollTop=n,this.$timer=setInterval(function(){s.length?(r.session.setScrollTop(s.shift()),r.session.$scrollTop=n):n!=null?(r.session.$scrollTop=-1,r.session.setScrollTop(n),n=null):(r.$timer=clearInterval(r.$timer),r.$scrollAnimation=null,t&&t())},10)},this.scrollToY=function(e){this.scrollTop!==e&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=e)},this.scrollToX=function(e){this.scrollLeft!==e&&(this.scrollLeft=e),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(e,t){this.session.setScrollTop(t),this.session.setScrollLeft(t)},this.scrollBy=function(e,t){t&&this.session.setScrollTop(this.session.getScrollTop()+t),e&&this.session.setScrollLeft(this.session.getScrollLeft()+e)},this.isScrollableBy=function(e,t){if(t<0&&this.session.getScrollTop()>=1-this.scrollMargin.top)return!0;if(t>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight-(this.$size.scrollerHeight-this.lineHeight)*this.$scrollPastEnd<-1+this.scrollMargin.bottom)return!0;if(e<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left)return!0;if(e>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right)return!0},this.pixelToScreenCoordinates=function(e,t){var n=this.scroller.getBoundingClientRect(),r=(e+this.scrollLeft-n.left-this.$padding)/this.characterWidth,i=Math.floor((t+this.scrollTop-n.top)/this.lineHeight),s=Math.round(r);return{row:i,column:s,side:r-s>0?1:-1}},this.screenToTextCoordinates=function(e,t){var n=this.scroller.getBoundingClientRect(),r=Math.round((e+this.scrollLeft-n.left-this.$padding)/this.characterWidth),i=(t+this.scrollTop-n.top)/this.lineHeight;return this.session.screenToDocumentPosition(i,Math.max(r,0))},this.textToScreenCoordinates=function(e,t){var n=this.scroller.getBoundingClientRect(),r=this.session.documentToScreenPosition(e,t),i=this.$padding+Math.round(r.column*this.characterWidth),s=r.row*this.lineHeight;return{pageX:n.left+i-this.scrollLeft,pageY:n.top+s-this.scrollTop}},this.visualizeFocus=function(){i.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){i.removeCssClass(this.container,"ace_focus")},this.showComposition=function(e){this.$composition||(this.$composition={keepTextAreaAtCursor:this.$keepTextAreaAtCursor,cssText:this.textarea.style.cssText}),this.$keepTextAreaAtCursor=!0,i.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor()},this.setCompositionText=function(e){this.$moveTextAreaToCursor()},this.hideComposition=function(){if(!this.$composition)return;i.removeCssClass(this.textarea,"ace_composition"),this.$keepTextAreaAtCursor=this.$composition.keepTextAreaAtCursor,this.textarea.style.cssText=this.$composition.cssText,this.$composition=null},this.setTheme=function(e,t){function o(r){if(n.$themeId!=e)return t&&t();if(!r.cssClass)return;i.importCssString(r.cssText,r.cssClass,n.container.ownerDocument),n.theme&&i.removeCssClass(n.container,n.theme.cssClass);var s="padding"in r?r.padding:"padding"in(n.theme||{})?4:n.$padding;n.$padding&&s!=n.$padding&&n.setPadding(s),n.$theme=r.cssClass,n.theme=r,i.addCssClass(n.container,r.cssClass),i.setCssClass(n.container,"ace_dark",r.isDark),n.$size&&(n.$size.width=0,n.$updateSizeAsync()),n._dispatchEvent("themeLoaded",{theme:r}),t&&t()}var n=this;this.$themeId=e,n._dispatchEvent("themeChange",{theme:e});if(!e||typeof e=="string"){var r=e||this.$options.theme.initialValue;s.loadModule(["theme",r],o)}else o(e)},this.getTheme=function(){return this.$themeId},this.setStyle=function(e,t){i.setCssClass(this.container,e,t!==!1)},this.unsetStyle=function(e){i.removeCssClass(this.container,e)},this.setCursorStyle=function(e){this.content.style.cursor!=e&&(this.content.style.cursor=e)},this.setMouseCursor=function(e){this.content.style.cursor=e},this.destroy=function(){this.$textLayer.destroy(),this.$cursorLayer.destroy()}}).call(m.prototype),s.defineOptions(m.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(e){this.$textLayer.setShowInvisibles(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(e){typeof e=="number"&&(this.$printMarginColumn=e),this.$showPrintMargin=!!e,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(e){this.$gutter.style.display=e?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(e){i.setCssClass(this.$gutter,"ace_fade-fold-widgets",e)},initialValue:!1},showFoldWidgets:{set:function(e){this.$gutterLayer.setShowFoldWidgets(e)},initialValue:!0},showLineNumbers:{set:function(e){this.$gutterLayer.setShowLineNumbers(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(e){this.$textLayer.setDisplayIndentGuides(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(e){if(!this.$gutterLineHighlight){this.$gutterLineHighlight=i.createElement("div"),this.$gutterLineHighlight.className="ace_gutter-active-line",this.$gutter.appendChild(this.$gutterLineHighlight);return}this.$gutterLineHighlight.style.display=e?"":"none",this.$cursorLayer.$pixelPos&&this.$updateGutterLineHighlight()},initialValue:!1,value:!0},hScrollBarAlwaysVisible:{set:function(e){(!this.$hScrollBarAlwaysVisible||!this.$horizScroll)&&this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(e){(!this.$vScrollBarAlwaysVisible||!this.$vScroll)&&this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(e){typeof e=="number"&&(e+="px"),this.container.style.fontSize=e,this.updateFontSize()},initialValue:12},fontFamily:{set:function(e){this.container.style.fontFamily=e,this.updateFontSize()}},maxLines:{set:function(e){this.updateFull()}},minLines:{set:function(e){this.updateFull()}},scrollPastEnd:{set:function(e){e=+e||0;if(this.$scrollPastEnd==e)return;this.$scrollPastEnd=e,this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(e){this.$gutterLayer.$fixedWidth=!!e,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(e){this.setTheme(e)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0}}),t.VirtualRenderer=m}),define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/event_emitter"],function(e,t,n){"no use strict";function f(r){a.packaged=r||e.packaged||n.packaged||u.define&&define.packaged;if(!u.document)return"";var i={},s="",o=document.getElementsByTagName("script");for(var f=0;f<o.length;f++){var c=o[f],h=c.src||c.getAttribute("src");if(!h)continue;var p=c.attributes;for(var d=0,v=p.length;d<v;d++){var m=p[d];m.name.indexOf("data-ace-")===0&&(i[l(m.name.replace(/^data-ace-/,""))]=m.value)}var g=h.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);g&&(s=g[1])}s&&(i.base=i.base||s,i.packaged=!0),i.basePath=i.base,i.workerPath=i.workerPath||i.base,i.modePath=i.modePath||i.base,i.themePath=i.themePath||i.base,delete i.base;for(var y in i)typeof i[y]!="undefined"&&t.set(y,i[y])}function l(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}var r=e("./lib/lang"),i=e("./lib/oop"),s=e("./lib/net"),o=e("./lib/event_emitter").EventEmitter,u=function(){return this}(),a={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{}};t.get=function(e){if(!a.hasOwnProperty(e))throw new Error("Unknown config key: "+e);return a[e]},t.set=function(e,t){if(!a.hasOwnProperty(e))throw new Error("Unknown config key: "+e);a[e]=t},t.all=function(){return r.copyObject(a)},i.implement(t,o),t.moduleUrl=function(e,t){if(a.$moduleUrls[e])return a.$moduleUrls[e];var n=e.split("/");t=t||n[n.length-2]||"";var r=t=="snippets"?"/":"-",i=n[n.length-1];if(r=="-"){var s=new RegExp("^"+t+"[\\-_]|[\\-_]"+t+"$","g");i=i.replace(s,"")}(!i||i==t)&&n.length>1&&(i=n[n.length-2]);var o=a[t+"Path"];return o==null?o=a.basePath:r=="/"&&(t=r=""),o&&o.slice(-1)!="/"&&(o+="/"),o+t+r+i+this.get("suffix")},t.setModuleUrl=function(e,t){return a.$moduleUrls[e]=t},t.$loading={},t.loadModule=function(n,r){var i,o;Array.isArray(n)&&(o=n[0],n=n[1]);try{i=e(n)}catch(u){}if(i&&!t.$loading[n])return r&&r(i);t.$loading[n]||(t.$loading[n]=[]),t.$loading[n].push(r);if(t.$loading[n].length>1)return;var a=function(){e([n],function(e){t._emit("load.module",{name:n,module:e});var r=t.$loading[n];t.$loading[n]=null,r.forEach(function(t){t&&t(e)})})};if(!t.get("packaged"))return a();s.loadScript(t.moduleUrl(n,o),a)},f(!0),t.init=f;var c={setOptions:function(e){Object.keys(e).forEach(function(t){this.setOption(t,e[t])},this)},getOptions:function(e){var t={};return e?Array.isArray(e)||(t=e,e=Object.keys(t)):e=Object.keys(this.$options),e.forEach(function(e){t[e]=this.getOption(e)},this),t},setOption:function(e,t){if(this["$"+e]===t)return;var n=this.$options[e];if(!n)return typeof console!="undefined"&&console.warn&&console.warn('misspelled option "'+e+'"'),undefined;if(n.forwardTo)return this[n.forwardTo]&&this[n.forwardTo].setOption(e,t);n.handlesSet||(this["$"+e]=t),n&&n.set&&n.set.call(this,t)},getOption:function(e){var t=this.$options[e];return t?t.forwardTo?this[t.forwardTo]&&this[t.forwardTo].getOption(e):t&&t.get?t.get.call(this):this["$"+e]:(typeof console!="undefined"&&console.warn&&console.warn('misspelled option "'+e+'"'),undefined)}},h={};t.defineOptions=function(e,t,n){return e.$options||(h[t]=e.$options={}),Object.keys(n).forEach(function(t){var r=n[t];typeof r=="string"&&(r={forwardTo:r}),r.name||(r.name=t),e.$options[r.name]=r,"initialValue"in r&&(e["$"+r.name]=r.initialValue)}),i.implement(e,c),this},t.resetOptions=function(e){Object.keys(e.$options).forEach(function(t){var n=e.$options[t];"value"in n&&e.setOption(t,n.value)})},t.setDefaultValue=function(e,n,r){var i=h[e]||(h[e]={});i[n]&&(i.forwardTo?t.setDefaultValue(i.forwardTo,n,r):i[n].value=r)},t.setDefaultValues=function(e,n){Object.keys(n).forEach(function(r){t.setDefaultValue(e,r,n[r])})}}),define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter"],function(e,t,n){var r=e("../lib/dom"),i=e("../lib/oop"),s=e("../lib/lang"),o=e("../lib/event_emitter").EventEmitter,u=function(e){this.element=r.createElement("div"),this.element.className="ace_layer ace_gutter-layer",e.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$cells=[]};(function(){i.implement(this,o),this.setSession=function(e){this.session&&this.session.removeEventListener("change",this.$updateAnnotations),this.session=e,e.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(e,t)},this.setAnnotations=function(e){this.$annotations=[];for(var t=0;t<e.length;t++){var n=e[t],r=n.row,i=this.$annotations[r];i||(i=this.$annotations[r]={text:[]});var o=n.text;o=o?s.escapeHTML(o):n.html||"",i.text.indexOf(o)===-1&&i.text.push(o);var u=n.type;u=="error"?i.className=" ace_error":u=="warning"&&i.className!=" ace_error"?i.className=" ace_warning":u=="info"&&!i.className&&(i.className=" ace_info")}},this.$updateAnnotations=function(e){if(!this.$annotations.length)return;var t=e.data,n=t.range,r=n.start.row,i=n.end.row-r;if(i!==0)if(t.action=="removeText"||t.action=="removeLines")this.$annotations.splice(r,i+1,null);else{var s=new Array(i+1);s.unshift(r,1),this.$annotations.splice.apply(this.$annotations,s)}},this.update=function(e){var t=this.session,n=e.firstRow,i=Math.min(e.lastRow+e.gutterOffset,t.getLength()-1),s=t.getNextFoldLine(n),o=s?s.start.row:Infinity,u=this.$showFoldWidgets&&t.foldWidgets,a=t.$breakpoints,f=t.$decorations,l=t.$firstLineNumber,c=0,h=t.gutterRenderer||this.$renderer,p=null,d=-1,v=n;for(;;){v>o&&(v=s.end.row+1,s=t.getNextFoldLine(v,s),o=s?s.start.row:Infinity);if(v>i){while(this.$cells.length>d+1)p=this.$cells.pop(),this.element.removeChild(p.element);break}p=this.$cells[++d],p||(p={element:null,textNode:null,foldWidget:null},p.element=r.createElement("div"),p.textNode=document.createTextNode(""),p.element.appendChild(p.textNode),this.element.appendChild(p.element),this.$cells[d]=p);var m="ace_gutter-cell ";a[v]&&(m+=a[v]),f[v]&&(m+=f[v]),this.$annotations[v]&&(m+=this.$annotations[v].className),p.element.className!=m&&(p.element.className=m);var g=t.getRowLength(v)*e.lineHeight+"px";g!=p.element.style.height&&(p.element.style.height=g);if(u){var y=u[v];y==null&&(y=u[v]=t.getFoldWidget(v))}if(y){p.foldWidget||(p.foldWidget=r.createElement("span"),p.element.appendChild(p.foldWidget));var m="ace_fold-widget ace_"+y;y=="start"&&v==o&&v<s.end.row?m+=" ace_closed":m+=" ace_open",p.foldWidget.className!=m&&(p.foldWidget.className=m);var g=e.lineHeight+"px";p.foldWidget.style.height!=g&&(p.foldWidget.style.height=g)}else p.foldWidget&&(p.element.removeChild(p.foldWidget),p.foldWidget=null);var b=c=h?h.getText(t,v):v+l;b!=p.textNode.data&&(p.textNode.data=b),v++}this.element.style.height=e.minHeight+"px";if(this.$fixedWidth||t.$useWrapMode)c=t.getLength()+l;var w=h?h.getWidth(t,c,e):c.toString().length*e.characterWidth,E=this.$padding||this.$computePadding();w+=E.left+E.right,w!==this.gutterWidth&&!isNaN(w)&&(this.gutterWidth=w,this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._emit("changeGutterWidth",w))},this.$fixedWidth=!1,this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(e){this.$renderer=!e&&{getWidth:function(){return""},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(e){e?r.addCssClass(this.element,"ace_folding-enabled"):r.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=e,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var e=r.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=parseInt(e.paddingLeft)+1||0,this.$padding.right=parseInt(e.paddingRight)||0,this.$padding},this.getRegion=function(e){var t=this.$padding||this.$computePadding(),n=this.element.getBoundingClientRect();if(e.x<t.left+n.left)return"markers";if(this.$showFoldWidgets&&e.x>n.right-t.right)return"foldWidgets"}}).call(u.prototype),t.Gutter=u}),define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(e,t,n){function f(e){function T(e,n){var r=Date.now(),i=!n||e.row!=n.row,s=!n||e.column!=n.column;if(!S||i||s)t.$blockScrolling+=1,t.moveCursorToPosition(e),t.$blockScrolling-=1,S=r,x={x:p,y:d};else{var o=l(x.x,x.y,p,d);o>a?S=null:r-S>=u&&(t.renderer.scrollCursorIntoView(),S=null)}}function N(e,n){var r=Date.now(),i=t.renderer.layerConfig.lineHeight,s=t.renderer.layerConfig.characterWidth,u=t.renderer.scroller.getBoundingClientRect(),a={x:{left:p-u.left,right:u.right-p},y:{top:d-u.top,bottom:u.bottom-d}},f=Math.min(a.x.left,a.x.right),l=Math.min(a.y.top,a.y.bottom),c={row:e.row,column:e.column};f/s<=2&&(c.column+=a.x.left<a.x.right?-3:2),l/i<=1&&(c.row+=a.y.top<a.y.bottom?-1:1);var h=e.row!=c.row,v=e.column!=c.column,m=!n||e.row!=n.row;h||v&&!m?E?r-E>=o&&t.renderer.scrollCursorIntoView(c):E=r:E=null}function C(){var e=g;g=t.renderer.screenToTextCoordinates(p,d),T(g,e),N(g,e)}function k(){m=t.selection.toOrientedRange(),h=t.session.addMarker(m,"ace_selection",t.getSelectionStyle()),t.clearSelection(),t.isFocused()&&t.renderer.$cursorLayer.setBlinking(!1),clearInterval(v),v=setInterval(C,20),y=0,i.addListener(document,"mousemove",O)}function L(){clearInterval(v),t.session.removeMarker(h),h=null,t.$blockScrolling+=1,t.selection.fromOrientedRange(m),t.$blockScrolling-=1,t.isFocused()&&!w&&t.renderer.$cursorLayer.setBlinking(!t.getReadOnly()),m=null,y=0,E=null,S=null,i.removeListener(document,"mousemove",O)}function O(){A==null&&(A=setTimeout(function(){A!=null&&h&&L()},20))}function M(e){var t=e.types;return!t||Array.prototype.some.call(t,function(e){return e=="text/plain"||e=="Text"})}function _(e){var t=["copy","copymove","all","uninitialized"],n=["move","copymove","linkmove","all","uninitialized"],r=s.isMac?e.altKey:e.ctrlKey,i="uninitialized";try{i=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var o="none";return r&&t.indexOf(i)>=0?o="copy":n.indexOf(i)>=0?o="move":t.indexOf(i)>=0&&(o="copy"),o}var t=e.editor,n=r.createElement("img");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",s.isOpera&&(n.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;");var f=["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"];f.forEach(function(t){e[t]=this[t]},this),t.addEventListener("mousedown",this.onMouseDown.bind(e));var c=t.container,h,p,d,v,m,g,y=0,b,w,E,S,x;this.onDragStart=function(e){if(this.cancelDrag||!c.draggable){var r=this;return setTimeout(function(){r.startSelect(),r.captureMouse(e)},0),e.preventDefault()}m=t.getSelectionRange();var i=e.dataTransfer;i.effectAllowed=t.getReadOnly()?"copy":"copyMove",s.isOpera&&(t.container.appendChild(n),n._top=n.offsetTop),i.setDragImage&&i.setDragImage(n,0,0),s.isOpera&&t.container.removeChild(n),i.clearData(),i.setData("Text",t.session.getTextRange()),w=!0,this.setState("drag")},this.onDragEnd=function(e){c.draggable=!1,w=!1,this.setState(null);if(!t.getReadOnly()){var n=e.dataTransfer.dropEffect;!b&&n=="move"&&t.session.remove(t.getSelectionRange()),t.renderer.$cursorLayer.setBlinking(!0)}this.editor.unsetStyle("ace_dragging")},this.onDragEnter=function(e){if(t.getReadOnly()||!M(e.dataTransfer))return;return h||k(),y++,e.dataTransfer.dropEffect=b=_(e),i.preventDefault(e)},this.onDragOver=function(e){if(t.getReadOnly()||!M(e.dataTransfer))return;return h||(k(),y++),A!==null&&(A=null),p=e.clientX,d=e.clientY,e.dataTransfer.dropEffect=b=_(e),i.preventDefault(e)},this.onDragLeave=function(e){y--;if(y<=0&&h)return L(),b=null,i.preventDefault(e)},this.onDrop=function(e){if(!h)return;var n=e.dataTransfer;if(w)switch(b){case"move":m.contains(g.row,g.column)?m={start:g,end:g}:m=t.moveText(m,g);break;case"copy":m=t.moveText(m,g,!0)}else{var r=n.getData("Text");m={start:g,end:t.session.insert(g,r)},t.focus(),b=null}return L(),i.preventDefault(e)},i.addListener(c,"dragstart",this.onDragStart.bind(e)),i.addListener(c,"dragend",this.onDragEnd.bind(e)),i.addListener(c,"dragenter",this.onDragEnter.bind(e)),i.addListener(c,"dragover",this.onDragOver.bind(e)),i.addListener(c,"dragleave",this.onDragLeave.bind(e)),i.addListener(c,"drop",this.onDrop.bind(e));var A=null}function l(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var r=e("../lib/dom"),i=e("../lib/event"),s=e("../lib/useragent"),o=200,u=200,a=5;(function(){this.dragWait=function(){var e=Date.now()-this.mousedownEvent.time;e>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){var e=this.editor.container;e.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly()),this.editor.unsetStyle("ace_dragging"),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor.container;e.draggable=!0,this.editor.renderer.$cursorLayer.setBlinking(!1),this.editor.setStyle("ace_dragging"),this.setState("dragReady")},this.onMouseDrag=function(e){var t=this.editor.container;if(s.isIE&&this.state=="dragReady"){var n=l(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n>3&&t.dragDrop()}if(this.state==="dragWait"){var n=l(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n>0&&(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))}},this.onMouseDown=function(e){if(!this.$dragEnabled)return;this.mousedownEvent=e;var t=this.editor,n=e.inSelection(),r=e.getButton(),i=e.domEvent.detail||1;if(i===1&&r===0&&n){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var o=e.domEvent.target||e.domEvent.srcElement;"unselectable"in o&&(o.unselectable="on");if(t.getDragDelay()){if(s.isWebKit){this.cancelDrag=!0;var u=t.container;u.draggable=!0}this.setState("dragWait")}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}).call(f.prototype),t.DragdropHandler=f}),define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(e,t,n){var r=e("../range").Range,i=e("../lib/dom"),s=function(e){this.element=i.createElement("div"),this.element.className="ace_layer ace_marker-layer",e.appendChild(this.element)};(function(){this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setMarkers=function(e){this.markers=e},this.update=function(e){var e=e||this.config;if(!e)return;this.config=e;var t=[];for(var n in this.markers){var r=this.markers[n];if(!r.range){r.update(t,this,this.session,e);continue}var s=r.range.clipRows(e.firstRow,e.lastRow);if(s.isEmpty())continue;s=s.toScreenRange(this.session);if(r.renderer){var o=this.$getTop(s.start.row,e),u=this.$padding+s.start.column*e.characterWidth;r.renderer(t,s,u,o,e)}else r.type=="fullLine"?this.drawFullLineMarker(t,s,r.clazz,e):r.type=="screenLine"?this.drawScreenLineMarker(t,s,r.clazz,e):s.isMultiLine()?r.type=="text"?this.drawTextMarker(t,s,r.clazz,e):this.drawMultiLineMarker(t,s,r.clazz,e):this.drawSingleLineMarker(t,s,r.clazz+" ace_start",e)}this.element=i.setInnerHtml(this.element,t.join(""))},this.$getTop=function(e,t){return(e-t.firstRowScreen)*t.lineHeight},this.drawTextMarker=function(e,t,n,i,s){var o=t.start.row,u=new r(o,t.start.column,o,this.session.getScreenLastRowColumn(o));this.drawSingleLineMarker(e,u,n+" ace_start",i,1,s),o=t.end.row,u=new r(o,0,o,t.end.column),this.drawSingleLineMarker(e,u,n,i,0,s);for(o=t.start.row+1;o<t.end.row;o++)u.start.row=o,u.end.row=o,u.end.column=this.session.getScreenLastRowColumn(o),this.drawSingleLineMarker(e,u,n,i,1,s)},this.drawMultiLineMarker=function(e,t,n,r,i){var s=this.$padding,o=r.lineHeight,u=this.$getTop(t.start.row,r),a=s+t.start.column*r.characterWidth;i=i||"",e.push("<div class='",n," ace_start' style='","height:",o,"px;","right:0;","top:",u,"px;","left:",a,"px;",i,"'></div>"),u=this.$getTop(t.end.row,r);var f=t.end.column*r.characterWidth;e.push("<div class='",n,"' style='","height:",o,"px;","width:",f,"px;","top:",u,"px;","left:",s,"px;",i,"'></div>"),o=(t.end.row-t.start.row-1)*r.lineHeight;if(o<0)return;u=this.$getTop(t.start.row+1,r),e.push("<div class='",n,"' style='","height:",o,"px;","right:0;","top:",u,"px;","left:",s,"px;",i,"'></div>")},this.drawSingleLineMarker=function(e,t,n,r,i,s){var o=r.lineHeight,u=(t.end.column+(i||0)-t.start.column)*r.characterWidth,a=this.$getTop(t.start.row,r),f=this.$padding+t.start.column*r.characterWidth;e.push("<div class='",n,"' style='","height:",o,"px;","width:",u,"px;","top:",a,"px;","left:",f,"px;",s||"","'></div>")},this.drawFullLineMarker=function(e,t,n,r,i){var s=this.$getTop(t.start.row,r),o=r.lineHeight;t.start.row!=t.end.row&&(o+=this.$getTop(t.end.row,r)-s),e.push("<div class='",n,"' style='","height:",o,"px;","top:",s,"px;","left:0;right:0;",i||"","'></div>")},this.drawScreenLineMarker=function(e,t,n,r,i){var s=this.$getTop(t.start.row,r),o=r.lineHeight;e.push("<div class='",n,"' style='","height:",o,"px;","top:",s,"px;","left:0;right:0;",i||"","'></div>")}}).call(s.prototype),t.Marker=s}),define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(e,t,n){var r=e("../lib/event"),i=e("../lib/useragent"),s=t.MouseEvent=function(e,t){this.domEvent=e,this.editor=t,this.x=this.clientX=e.clientX,this.y=this.clientY=e.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};(function(){this.stopPropagation=function(){r.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){r.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos?this.$pos:(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},this.inSelection=function(){if(this.$inSelection!==null)return this.$inSelection;var e=this.editor,t=e.getSelectionRange();if(t.isEmpty())this.$inSelection=!1;else{var n=this.getDocumentPosition();this.$inSelection=t.contains(n.row,n.column)}return this.$inSelection},this.getButton=function(){return r.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=i.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(s.prototype)}),define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"],function(e,t,n){var r=e("../lib/oop"),i=e("../lib/dom"),s=e("../lib/lang"),o=e("../lib/useragent"),u=e("../lib/event_emitter").EventEmitter,a=function(e){this.element=i.createElement("div"),this.element.className="ace_layer ace_text-layer",e.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this)};(function(){r.implement(this,u),this.EOF_CHAR="",this.EOL_CHAR_LF="",this.EOL_CHAR_CRLF="",this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR="",this.SPACE_CHAR="",this.$padding=0,this.$updateEolChar=function(){var e=this.session.doc.getNewLineCharacter()=="\n"?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=e)return this.EOL_CHAR=e,!0},this.setPadding=function(e){this.$padding=e,this.element.style.padding="0 "+e+"px"},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(e){this.$fontMetrics=e,this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(e){this.session=e,this.$computeTabString()},this.showInvisibles=!1,this.setShowInvisibles=function(e){return this.showInvisibles==e?!1:(this.showInvisibles=e,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(e){return this.displayIndentGuides==e?!1:(this.displayIndentGuides=e,this.$computeTabString(),!0)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){var e=this.session.getTabSize();this.tabSize=e;var t=this.$tabStrings=[0];for(var n=1;n<e+1;n++)this.showInvisibles?t.push("<span class='ace_invisible'>"+this.TAB_CHAR+s.stringRepeat("",n-1)+"</span>"):t.push(s.stringRepeat("",n));if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var r="ace_indent-guide";if(this.showInvisibles){r+=" ace_invisible";var i=s.stringRepeat(this.SPACE_CHAR,this.tabSize),o=this.TAB_CHAR+s.stringRepeat("",this.tabSize-1)}else var i=s.stringRepeat("",this.tabSize),o=i;this.$tabStrings[" "]="<span class='"+r+"'>"+i+"</span>",this.$tabStrings["	"]="<span class='"+r+"'>"+o+"</span>"}},this.updateLines=function(e,t,n){(this.config.lastRow!=e.lastRow||this.config.firstRow!=e.firstRow)&&this.scrollLines(e),this.config=e;var r=Math.max(t,e.firstRow),s=Math.min(n,e.lastRow),o=this.element.childNodes,u=0;for(var a=e.firstRow;a<r;a++){var f=this.session.getFoldLine(a);if(f){if(f.containsRow(r)){r=f.start.row;break}a=f.end.row}u++}var a=r,f=this.session.getNextFoldLine(a),l=f?f.start.row:Infinity;for(;;){a>l&&(a=f.end.row+1,f=this.session.getNextFoldLine(a,f),l=f?f.start.row:Infinity);if(a>s)break;var c=o[u++];if(c){var h=[];this.$renderLine(h,a,!this.$useLineGroups(),a==l?f:!1),c.style.height=e.lineHeight*this.session.getRowLength(a)+"px",i.setInnerHtml(c,h.join(""))}a++}},this.scrollLines=function(e){var t=this.config;this.config=e;if(!t||t.lastRow<e.firstRow)return this.update(e);if(e.lastRow<t.firstRow)return this.update(e);var n=this.element;if(t.firstRow<e.firstRow)for(var r=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);r>0;r--)n.removeChild(n.firstChild);if(t.lastRow>e.lastRow)for(var r=this.session.getFoldedRowCount(e.lastRow+1,t.lastRow);r>0;r--)n.removeChild(n.lastChild);if(e.firstRow<t.firstRow){var i=this.$renderLinesFragment(e,e.firstRow,t.firstRow-1);n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i)}if(e.lastRow>t.lastRow){var i=this.$renderLinesFragment(e,t.lastRow+1,e.lastRow);n.appendChild(i)}},this.$renderLinesFragment=function(e,t,n){var r=this.element.ownerDocument.createDocumentFragment(),s=t,o=this.session.getNextFoldLine(s),u=o?o.start.row:Infinity;for(;;){s>u&&(s=o.end.row+1,o=this.session.getNextFoldLine(s,o),u=o?o.start.row:Infinity);if(s>n)break;var a=i.createElement("div"),f=[];this.$renderLine(f,s,!1,s==u?o:!1),a.innerHTML=f.join("");if(this.$useLineGroups())a.className="ace_line_group",r.appendChild(a),a.style.height=e.lineHeight*this.session.getRowLength(s)+"px";else while(a.firstChild)r.appendChild(a.firstChild);s++}return r},this.update=function(e){this.config=e;var t=[],n=e.firstRow,r=e.lastRow,s=n,o=this.session.getNextFoldLine(s),u=o?o.start.row:Infinity;for(;;){s>u&&(s=o.end.row+1,o=this.session.getNextFoldLine(s,o),u=o?o.start.row:Infinity);if(s>r)break;this.$useLineGroups()&&t.push("<div class='ace_line_group' style='height:",e.lineHeight*this.session.getRowLength(s),"px'>"),this.$renderLine(t,s,!1,s==u?o:!1),this.$useLineGroups()&&t.push("</div>"),s++}this.element=i.setInnerHtml(this.element,t.join(""))},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(e,t,n,r){var i=this,o=/\t|&|<|( +)|([\x00-\x1f\x80-\xa0\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF])|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]/g,u=function(e,n,r,o,u){if(n)return i.showInvisibles?"<span class='ace_invisible'>"+s.stringRepeat(i.SPACE_CHAR,e.length)+"</span>":s.stringRepeat("",e.length);if(e=="&")return"&#38;";if(e=="<")return"&#60;";if(e=="	"){var a=i.session.getScreenTabSize(t+o);return t+=a-1,i.$tabStrings[a]}if(e==""){var f=i.showInvisibles?"ace_cjk ace_invisible":"ace_cjk",l=i.showInvisibles?i.SPACE_CHAR:"";return t+=1,"<span class='"+f+"' style='width:"+i.config.characterWidth*2+"px'>"+l+"</span>"}return r?"<span class='ace_invisible ace_invalid'>"+i.SPACE_CHAR+"</span>":(t+=1,"<span class='ace_cjk' style='width:"+i.config.characterWidth*2+"px'>"+e+"</span>")},a=r.replace(o,u);if(!this.$textToken[n.type]){var f="ace_"+n.type.replace(/\./g," ace_"),l="";n.type=="fold"&&(l=" style='width:"+n.value.length*this.config.characterWidth+"px;' "),e.push("<span class='",f,"'",l,">",a,"</span>")}else e.push(a);return t+r.length},this.renderIndentGuide=function(e,t,n){var r=t.search(this.$indentGuideRe);return r<=0||r>=n?t:t[0]==" "?(r-=r%this.tabSize,e.push(s.stringRepeat(this.$tabStrings[" "],r/this.tabSize)),t.substr(r)):t[0]=="	"?(e.push(s.stringRepeat(this.$tabStrings["	"],r)),t.substr(r)):t},this.$renderWrappedLine=function(e,t,n,r){var i=0,s=0,o=n[0],u=0;for(var a=0;a<t.length;a++){var f=t[a],l=f.value;if(a==0&&this.displayIndentGuides){i=l.length,l=this.renderIndentGuide(e,l,o);if(!l)continue;i-=l.length}if(i+l.length<o)u=this.$renderToken(e,u,f,l),i+=l.length;else{while(i+l.length>=o)u=this.$renderToken(e,u,f,l.substring(0,o-i)),l=l.substring(o-i),i=o,r||e.push("</div>","<div class='ace_line' style='height:",this.config.lineHeight,"px'>"),s++,u=0,o=n[s]||Number.MAX_VALUE;l.length!=0&&(i+=l.length,u=this.$renderToken(e,u,f,l))}}},this.$renderSimpleLine=function(e,t){var n=0,r=t[0],i=r.value;this.displayIndentGuides&&(i=this.renderIndentGuide(e,i)),i&&(n=this.$renderToken(e,n,r,i));for(var s=1;s<t.length;s++)r=t[s],i=r.value,n=this.$renderToken(e,n,r,i)},this.$renderLine=function(e,t,n,r){!r&&r!=0&&(r=this.session.getFoldLine(t));if(r)var i=this.$getFoldLineTokens(t,r);else var i=this.session.getTokens(t);n||e.push("<div class='ace_line' style='height:",this.config.lineHeight*(this.$useLineGroups()?1:this.session.getRowLength(t)),"px'>");if(i.length){var s=this.session.getRowSplitData(t);s&&s.length?this.$renderWrappedLine(e,i,s,n):this.$renderSimpleLine(e,i)}this.showInvisibles&&(r&&(t=r.end.row),e.push("<span class='ace_invisible'>",t==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,"</span>")),n||e.push("</div>")},this.$getFoldLineTokens=function(e,t){function i(e,t,n){var i=0,s=0;while(s+e[i].value.length<t){s+=e[i].value.length,i++;if(i==e.length)return}if(s!=t){var o=e[i].value.substring(t-s);o.length>n-t&&(o=o.substring(0,n-t)),r.push({type:e[i].type,value:o}),s=t+o.length,i+=1}while(s<n&&i<e.length){var o=e[i].value;o.length+s>n?r.push({type:e[i].type,value:o.substring(0,n-s)}):r.push(e[i]),s+=o.length,i+=1}}var n=this.session,r=[],s=n.getTokens(e);return t.walk(function(e,t,o,u,a){e!=null?r.push({type:"fold",value:e}):(a&&(s=n.getTokens(t)),s.length&&i(s,u,o))},t.end.row,this.session.getLine(t.end.row).length),r},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$measureNode&&this.$measureNode.parentNode.removeChild(this.$measureNode),delete this.$measureNode}}).call(a.prototype),t.Text=a}),define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],function(e,t,n){function s(e){this.isOpen=!1,this.$element=null,this.$parentNode=e}var r=e("./lib/oop"),i=e("./lib/dom");(function(){this.$init=function(){return this.$element=i.createElement("div"),this.$element.className="ace_tooltip",this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(e){i.setInnerText(this.getElement(),e)},this.setHtml=function(e){this.getElement().innerHTML=e},this.setPosition=function(e,t){this.getElement().style.left=e+"px",this.getElement().style.top=t+"px"},this.setClassName=function(e){i.addCssClass(this.getElement(),e)},this.show=function(e,t,n){e!=null&&this.setText(e),t!=null&&n!=null&&this.setPosition(t,n),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth}}).call(s.prototype),t.Tooltip=s}),define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(e,t,n){var r=e("../lib/dom"),i,s=function(e){this.element=r.createElement("div"),this.element.className="ace_layer ace_cursor-layer",e.appendChild(this.element),i===undefined&&(i="opacity"in this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),r.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateVisibility.bind(this)};(function(){this.$updateVisibility=function(e){var t=this.cursors;for(var n=t.length;n--;)t[n].style.visibility=e?"":"hidden"},this.$updateOpacity=function(e){var t=this.cursors;for(var n=t.length;n--;)t[n].style.opacity=e?"":"0"},this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setBlinking=function(e){e!=this.isBlinking&&(this.isBlinking=e,this.restartTimer())},this.setBlinkInterval=function(e){e!=this.blinkInterval&&(this.blinkInterval=e,this.restartTimer())},this.setSmoothBlinking=function(e){e!=this.smoothBlinking&&!i&&(this.smoothBlinking=e,r.setCssClass(this.element,"ace_smooth-blinking",e),this.$updateCursors(!0),this.$updateCursors=(e?this.$updateOpacity:this.$updateVisibility).bind(this),this.restartTimer())},this.addCursor=function(){var e=r.createElement("div");return e.className="ace_cursor",this.element.appendChild(e),this.cursors.push(e),e},this.removeCursor=function(){if(this.cursors.length>1){var e=this.cursors.pop();return e.parentNode.removeChild(e),e}},this.hideCursor=function(){this.isVisible=!1,r.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,r.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var e=this.$updateCursors;clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.smoothBlinking&&r.removeCssClass(this.element,"ace_smooth-blinking"),e(!0);if(!this.isBlinking||!this.blinkInterval||!this.isVisible)return;this.smoothBlinking&&setTimeout(function(){r.addCssClass(this.element,"ace_smooth-blinking")}.bind(this));var t=function(){this.timeoutId=setTimeout(function(){e(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){e(!0),t()},this.blinkInterval),t()},this.getPixelPosition=function(e,t){if(!this.config||!this.session)return{left:0,top:0};e||(e=this.session.selection.getCursor());var n=this.session.documentToScreenPosition(e),r=this.$padding+n.column*this.config.characterWidth,i=(n.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:r,top:i}},this.update=function(e){this.config=e;var t=this.session.$selectionMarkers,n=0,r=0;if(t===undefined||t.length===0)t=[{cursor:null}];for(var n=0,i=t.length;n<i;n++){var s=this.getPixelPosition(t[n].cursor,!0);if((s.top>e.height+e.offset||s.top<0)&&n>1)continue;var o=(this.cursors[r++]||this.addCursor()).style;o.left=s.left+"px",o.top=s.top+"px",o.width=e.characterWidth+"px",o.height=e.lineHeight+"px"}while(this.cursors.length>r)this.removeCursor();var u=this.session.getOverwrite();this.$setOverwrite(u),this.$pixelPos=s,this.restartTimer()},this.$setOverwrite=function(e){e!=this.overwrite&&(this.overwrite=e,e?r.addCssClass(this.element,"ace_overwrite-cursors"):r.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(s.prototype),t.Cursor=s}),define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"],function(e,t,n){function u(e){function l(){var r=u.getDocumentPosition().row,s=n.$annotations[r];if(!s)return c();var o=t.session.getLength();if(r==o){var a=t.renderer.pixelToScreenCoordinates(0,u.y).row,l=u.$pos;if(a>t.session.documentToScreenRow(l.row,l.column))return c()}if(f==s)return;f=s.text.join("<br/>"),i.setHtml(f),i.show(),t.on("mousewheel",c);if(e.$tooltipFollowsMouse)h(u);else{var p=n.$cells[r].element,d=p.getBoundingClientRect(),v=i.getElement().style;v.left=d.right+"px",v.top=d.bottom+"px"}}function c(){o&&(o=clearTimeout(o)),f&&(i.hide(),f=null,t.removeEventListener("mousewheel",c))}function h(e){i.setPosition(e.x,e.y)}var t=e.editor,n=t.renderer.$gutterLayer,i=new a(t.container);e.editor.setDefaultHandler("guttermousedown",function(r){if(!t.isFocused()||r.getButton()!=0)return;var i=n.getRegion(r);if(i=="foldWidgets")return;var s=r.getDocumentPosition().row,o=t.session.selection;if(r.getShiftKey())o.selectTo(s,0);else{if(r.domEvent.detail==2)return t.selectAll(),r.preventDefault();e.$clickSelection=t.selection.getLineRange(s)}return e.setState("selectByLines"),e.captureMouse(r),r.preventDefault()});var o,u,f;e.editor.setDefaultHandler("guttermousemove",function(t){var n=t.domEvent.target||t.domEvent.srcElement;if(r.hasCssClass(n,"ace_fold-widget"))return c();f&&e.$tooltipFollowsMouse&&h(t),u=t;if(o)return;o=setTimeout(function(){o=null,u&&!e.isMousePressed?l():c()},50)}),s.addListener(t.renderer.$gutter,"mouseout",function(e){u=null;if(!f||o)return;o=setTimeout(function(){o=null,c()},50)}),t.on("changeSession",c)}function a(e){o.call(this,e)}var r=e("../lib/dom"),i=e("../lib/oop"),s=e("../lib/event"),o=e("../tooltip").Tooltip;i.inherits(a,o),function(){this.setPosition=function(e,t){var n=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight,i=this.getWidth(),s=this.getHeight();e+=15,t+=15,e+i>n&&(e-=e+i-n),t+s>r&&(t-=20+s),o.prototype.setPosition.call(this,e,t)}}.call(a.prototype),t.GutterHandler=u}),define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./lib/event"),o=e("./lib/event_emitter").EventEmitter,u=function(e){this.element=i.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix,this.inner=i.createElement("div"),this.inner.className="ace_scrollbar-inner",this.element.appendChild(this.inner),e.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,s.addListener(this.element,"scroll",this.onScroll.bind(this)),s.addListener(this.element,"mousedown",s.preventDefault)};(function(){r.implement(this,o),this.setVisible=function(e){this.element.style.display=e?"":"none",this.isVisible=e}}).call(u.prototype);var a=function(e,t){u.call(this,e),this.scrollTop=0,t.$scrollbarWidth=this.width=i.scrollbarWidth(e.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+"px"};r.inherits(a,u),function(){this.classSuffix="-v",this.onScroll=function(){this.skipEvent||(this.scrollTop=this.element.scrollTop,this._emit("scroll",{data:this.scrollTop})),this.skipEvent=!1},this.getWidth=function(){return this.isVisible?this.width:0},this.setHeight=function(e){this.element.style.height=e+"px"},this.setInnerHeight=function(e){this.inner.style.height=e+"px"},this.setScrollHeight=function(e){this.inner.style.height=e+"px"},this.setScrollTop=function(e){this.scrollTop!=e&&(this.skipEvent=!0,this.scrollTop=this.element.scrollTop=e)}}.call(a.prototype);var f=function(e,t){u.call(this,e),this.scrollLeft=0,this.height=t.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"};r.inherits(f,u),function(){this.classSuffix="-h",this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(e){this.element.style.width=e+"px"},this.setInnerWidth=function(e){this.inner.style.width=e+"px"},this.setScrollWidth=function(e){this.inner.style.width=e+"px"},this.setScrollLeft=function(e){this.scrollLeft!=e&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=e)}}.call(f.prototype),t.ScrollBar=a,t.ScrollBarV=a,t.ScrollBarH=f,t.VScrollBar=a,t.HScrollBar=f}),define("ace/mouse/default_handlers",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(e,t,n){function u(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler("mousedown",this.onMouseDown.bind(e)),t.setDefaultHandler("dblclick",this.onDoubleClick.bind(e)),t.setDefaultHandler("tripleclick",this.onTripleClick.bind(e)),t.setDefaultHandler("quadclick",this.onQuadClick.bind(e)),t.setDefaultHandler("mousewheel",this.onMouseWheel.bind(e));var n=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];n.forEach(function(t){e[t]=this[t]},this),e.selectByLines=this.extendSelectionBy.bind(e,"getLineRange"),e.selectByWords=this.extendSelectionBy.bind(e,"getWordRange")}function a(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}function f(e,t){if(e.start.row==e.end.row)var n=2*t.column-e.start.column-e.end.column;else if(e.start.row==e.end.row-1&&!e.start.column&&!e.end.column)var n=t.column-4;else var n=2*t.row-e.start.row-e.end.row;return n<0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}var r=e("../lib/dom"),i=e("../lib/event"),s=e("../lib/useragent"),o=0;(function(){this.onMouseDown=function(e){var t=e.inSelection(),n=e.getDocumentPosition();this.mousedownEvent=e;var r=this.editor,i=e.getButton();if(i!==0){var s=r.getSelectionRange(),o=s.isEmpty();o&&r.selection.moveToPosition(n),r.textInput.onContextMenu(e.domEvent);return}if(t&&!r.isFocused()){r.focus();if(this.$focusTimout&&!this.$clickSelection&&!r.inMultiSelectMode){this.mousedownEvent.time=Date.now(),this.setState("focusWait"),this.captureMouse(e);return}}return this.captureMouse(e),!t||this.$clickSelection||e.getShiftKey()||r.inMultiSelectMode?this.startSelect(n):t&&(this.mousedownEvent.time=Date.now(),this.startSelect(n)),e.preventDefault()},this.startSelect=function(e){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var t=this.editor,n=this.mousedownEvent.getShiftKey();n?t.selection.selectToPosition(e):this.$clickSelection||t.selection.moveToPosition(e),t.renderer.scroller.setCapture&&t.renderer.scroller.setCapture(),t.setStyle("ace_selecting"),this.setState("select")},this.select=function(){var e,t=this.editor,n=t.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var r=this.$clickSelection.comparePoint(n);if(r==-1)e=this.$clickSelection.end;else if(r==1)e=this.$clickSelection.start;else{var i=f(this.$clickSelection,n);n=i.cursor,e=i.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(n),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,n=this.editor,r=n.renderer.screenToTextCoordinates(this.x,this.y),i=n.selection[e](r.row,r.column);if(this.$clickSelection){var s=this.$clickSelection.comparePoint(i.start),o=this.$clickSelection.comparePoint(i.end);if(s==-1&&o<=0){t=this.$clickSelection.end;if(i.end.row!=r.row||i.end.column!=r.column)r=i.start}else if(o==1&&s>=0){t=this.$clickSelection.start;if(i.start.row!=r.row||i.start.column!=r.column)r=i.end}else if(s==-1&&o==1)r=i.end,t=i.start;else{var u=f(this.$clickSelection,r);r=u.cursor,t=u.anchor}n.selection.setSelectionAnchor(t.row,t.column)}n.selection.selectToPosition(r),n.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var e=a(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y),t=Date.now();(e>o||t-this.mousedownEvent.time>this.$focusTimout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var t=e.getDocumentPosition(),n=this.editor,r=n.session,i=r.getBracketRange(t);i?(i.isEmpty()&&(i.start.column--,i.end.column++),this.setState("select")):(i=n.selection.getWordRange(t.row,t.column),this.setState("selectByWords")),this.$clickSelection=i,this[this.state]&&this[this.state](e)},this.onTripleClick=function(e){var t=e.getDocumentPosition(),n=this.editor;this.setState("selectByLines"),this.$clickSelection=n.selection.getLineRange(t.row),this[this.state]&&this[this.state](e)},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(e){if(e.getAccelKey())return;e.getShiftKey()&&e.wheelY&&!e.wheelX&&(e.wheelX=e.wheelY,e.wheelY=0);var t=e.domEvent.timeStamp,n=t-(this.$lastScrollTime||0),r=this.editor,i=r.renderer.isScrollableBy(e.wheelX*e.speed,e.wheelY*e.speed);if(i||n<200)return this.$lastScrollTime=t,r.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()}}).call(u.prototype),t.DefaultHandlers=u}),define("ace/renderloop",["require","exports","module","ace/lib/event"],function(e,t,n){var r=e("./lib/event"),i=function(e,t){this.onRender=e,this.pending=!1,this.changes=0,this.window=t||window};(function(){this.schedule=function(e){this.changes=this.changes|e;if(!this.pending&&this.changes){this.pending=!0;var t=this;r.nextFrame(function(){t.pending=!1;var e;while(e=t.changes)t.changes=0,t.onRender(e)},this.window)}}}).call(i.prototype),t.RenderLoop=i}),define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/config"],function(e,t,n){var r=e("../lib/event"),i=e("../lib/useragent"),s=e("./default_handlers").DefaultHandlers,o=e("./default_gutter_handler").GutterHandler,u=e("./mouse_event").MouseEvent,a=e("./dragdrop_handler").DragdropHandler,f=e("../config"),l=function(e){this.editor=e,new s(this),new o(this),new a(this);var t=e.renderer.getMouseEventTarget();r.addListener(t,"click",this.onMouseEvent.bind(this,"click")),r.addListener(t,"mousemove",this.onMouseMove.bind(this,"mousemove")),r.addMultiMouseDownListener(t,[300,300,250],this,"onMouseEvent"),e.renderer.scrollBarV&&(r.addMultiMouseDownListener(e.renderer.scrollBarV.inner,[300,300,250],this,"onMouseEvent"),r.addMultiMouseDownListener(e.renderer.scrollBarH.inner,[300,300,250],this,"onMouseEvent")),r.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,"mousewheel"));var n=e.renderer.$gutter;r.addListener(n,"mousedown",this.onMouseEvent.bind(this,"guttermousedown")),r.addListener(n,"click",this.onMouseEvent.bind(this,"gutterclick")),r.addListener(n,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick")),r.addListener(n,"mousemove",this.onMouseEvent.bind(this,"guttermousemove")),r.addListener(t,"mousedown",function(t){e.focus()}),r.addListener(n,"mousedown",function(t){return e.focus(),r.preventDefault(t)})};(function(){this.onMouseEvent=function(e,t){this.editor._emit(e,new u(t,this.editor))},this.onMouseMove=function(e,t){var n=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;if(!n||!n.length)return;this.editor._emit(e,new u(t,this.editor))},this.onMouseWheel=function(e,t){var n=new u(t,this.editor);n.speed=this.$scrollSpeed*2,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;var n=this.editor.renderer;n.$keepTextAreaAtCursor&&(n.$keepTextAreaAtCursor=null);var s=this,o=function(e){s.x=e.clientX,s.y=e.clientY,t&&t(e),s.mouseEvent=new u(e,s.editor),s.$mouseMoved=!0},a=function(e){clearInterval(l),f(),s[s.state+"End"]&&s[s.state+"End"](e),s.$clickSelection=null,n.$keepTextAreaAtCursor==null&&(n.$keepTextAreaAtCursor=!0,n.$moveTextAreaToCursor()),s.isMousePressed=!1,s.$onCaptureMouseMove=s.releaseMouse=null,s.onMouseEvent("mouseup",e)},f=function(){s[s.state]&&s[s.state](),s.$mouseMoved=!1};if(i.isOldIE&&e.domEvent.type=="dblclick")return setTimeout(function(){a(e)});s.$onCaptureMouseMove=o,s.releaseMouse=r.capture(this.editor.container,o,a);var l=setInterval(f,20)},this.releaseMouse=null}).call(l.prototype),f.defineOptions(l.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:150},dragEnabled:{initialValue:!0},focusTimout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=l}),define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/event_emitter"],function(e,t,n){var r=e("../lib/oop"),i=e("../lib/dom"),s=e("../lib/lang"),o=e("../lib/event_emitter").EventEmitter,u=0,a=t.FontMetrics=function(e,t){this.el=i.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=i.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=i.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),e.appendChild(this.el),u||this.$testFractionalRect(),this.$measureNode.textContent=s.stringRepeat("X",u),this.$characterSize={width:0,height:0},this.checkForSizeChanges()};(function(){r.implement(this,o),this.$characterSize={width:0,height:0},this.$testFractionalRect=function(){var e=i.createElement("div");this.$setMeasureNodeStyles(e.style),e.style.width="0.2px",document.documentElement.appendChild(e);var t=e.getBoundingClientRect().width;t>0&&t<1?u=1:u=100,e.parentNode.removeChild(e)},this.$setMeasureNodeStyles=function(e,t){e.width=e.height="auto",e.left=e.top="-100px",e.visibility="hidden",e.position="fixed",e.whiteSpace="pre",e.font="inherit",e.overflow=t?"hidden":"visible"},this.checkForSizeChanges=function(){var e=this.$measureSizes();if(e&&(this.$characterSize.width!==e.width||this.$characterSize.height!==e.height)){this.$measureNode.style.fontWeight="bold";var t=this.$measureSizes();this.$measureNode.style.fontWeight="",this.$characterSize=e,this.charSizes=Object.create(null),this.allowBoldFonts=t&&t.width===e.width&&t.height===e.height,this._emit("changeCharacterSize",{data:e})}},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer)return this.$pollSizeChangesTimer;var e=this;return this.$pollSizeChangesTimer=setInterval(function(){e.checkForSizeChanges()},500)},this.setPolling=function(e){e?this.$pollSizeChanges():this.$pollSizeChangesTimer&&this.$pollSizeChangesTimer},this.$measureSizes=function(){var e=this.$measureNode.getBoundingClientRect(),t={height:e.height,width:e.width/u};return t.width===0||t.height===0?null:t},this.$measureCharWidth=function(e){this.$main.textContent=s.stringRepeat(e,u);var t=this.$main.getBoundingClientRect();return t.width/u},this.getCharacterWidth=function(e){var t=this.charSizes[e];return t===undefined&&(this.charSizes[e]=this.$measureCharWidth(e)/this.$characterSize.width),t},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}}).call(a.prototype)}),define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang"],function(e,t,n){var r=e("../lib/event"),i=e("../lib/useragent"),s=e("../lib/dom"),o=e("../lib/lang"),u=i.isChrome<18,a=function(e,t){function b(e){if(h)return;if(k)t=0,r=e?0:n.value.length-1;else var t=e?2:1,r=2;try{n.setSelectionRange(t,r)}catch(i){}}function w(){if(h)return;n.value=a,i.isWebKit&&y.schedule()}function F(){setTimeout(function(){p&&(n.style.cssText=p,p=""),t.renderer.$keepTextAreaAtCursor==null&&(t.renderer.$keepTextAreaAtCursor=!0,t.renderer.$moveTextAreaToCursor())},0)}var n=s.createElement("textarea");n.className="ace_text-input",i.isTouchPad&&n.setAttribute("x-palm-disable-auto-cap",!0),n.wrap="off",n.autocorrect="off",n.autocapitalize="off",n.spellcheck=!1,n.style.opacity="0",e.insertBefore(n,e.firstChild);var a="",f=!1,l=!1,c=!1,h=!1,p="",d=!0;try{var v=document.activeElement===n}catch(m){}r.addListener(n,"blur",function(){t.onBlur(),v=!1}),r.addListener(n,"focus",function(){v=!0,t.onFocus(),b()}),this.focus=function(){n.focus()},this.blur=function(){n.blur()},this.isFocused=function(){return v};var g=o.delayedCall(function(){v&&b(d)}),y=o.delayedCall(function(){h||(n.value=a,v&&b())});i.isWebKit||t.addEventListener("changeSelection",function(){t.selection.isEmpty()!=d&&(d=!d,g.schedule())}),w(),v&&t.onFocus();var E=function(e){return e.selectionStart===0&&e.selectionEnd===e.value.length};!n.setSelectionRange&&n.createTextRange&&(n.setSelectionRange=function(e,t){var n=this.createTextRange();n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select()},E=function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return!t||t.parentElement()!=e?!1:t.text==e.value});if(i.isOldIE){var S=!1,x=function(e){if(S)return;var t=n.value;if(h||!t||t==a)return;if(e&&t==a[0])return T.schedule();A(t),S=!0,w(),S=!1},T=o.delayedCall(x);r.addListener(n,"propertychange",x);var N={13:1,27:1};r.addListener(n,"keyup",function(e){h&&(!n.value||N[e.keyCode])&&setTimeout(B,0);if((n.value.charCodeAt(0)||0)<129)return T.call();h?H():P()}),r.addListener(n,"keydown",function(e){T.schedule(50)})}var C=function(e){f?f=!1:l?l=!1:E(n)?(t.selectAll(),b()):k&&b(t.selection.isEmpty())},k=null;this.setInputHandler=function(e){k=e},this.getInputHandler=function(){return k};var L=!1,A=function(e){k&&(e=k(e),k=null),c?(b(),e&&t.onPaste(e),c=!1):e==a.charAt(0)?L?t.execCommand("del",{source:"ace"}):t.execCommand("backspace",{source:"ace"}):(e.substring(0,2)==a?e=e.substr(2):e.charAt(0)==a.charAt(0)?e=e.substr(1):e.charAt(e.length-1)==a.charAt(0)&&(e=e.slice(0,-1)),e.charAt(e.length-1)==a.charAt(0)&&(e=e.slice(0,-1)),e&&t.onTextInput(e)),L&&(L=!1)},O=function(e){if(h)return;var t=n.value;A(t),w()},M=function(e){var i=t.getCopyText();if(!i){r.preventDefault(e);return}var s=e.clipboardData||window.clipboardData;if(s&&!u){var o=s.setData("Text",i);o&&(t.onCut(),r.preventDefault(e))}o||(f=!0,n.value=i,n.select(),setTimeout(function(){f=!1,w(),b(),t.onCut()}))},_=function(e){var i=t.getCopyText();if(!i){r.preventDefault(e);return}var s=e.clipboardData||window.clipboardData;if(s&&!u){var o=s.setData("Text",i);o&&(t.onCopy(),r.preventDefault(e))}o||(l=!0,n.value=i,n.select(),setTimeout(function(){l=!1,w(),b(),t.onCopy()}))},D=function(e){var s=e.clipboardData||window.clipboardData;if(s){var o=s.getData("Text");o&&t.onPaste(o),i.isIE&&setTimeout(b),r.preventDefault(e)}else n.value="",c=!0};r.addCommandKeyListener(n,t.onCommandKey.bind(t)),r.addListener(n,"select",C),r.addListener(n,"input",O),r.addListener(n,"cut",M),r.addListener(n,"copy",_),r.addListener(n,"paste",D),(!("oncut"in n)||!("oncopy"in n)||!("onpaste"in n))&&r.addListener(e,"keydown",function(e){if(i.isMac&&!e.metaKey||!e.ctrlKey)return;switch(e.keyCode){case 67:_(e);break;case 86:D(e);break;case 88:M(e)}});var P=function(e){if(h||!t.onCompositionStart)return;h={},t.onCompositionStart(),setTimeout(H,0),t.on("mousedown",B),t.selection.isEmpty()||(t.insert(""),t.session.markUndoGroup(),t.selection.clearSelection()),t.session.markUndoGroup()},H=function(){if(!h||!t.onCompositionUpdate)return;var e=n.value.replace(/\x01/g,"");if(h.lastValue===e)return;t.onCompositionUpdate(e),h.lastValue&&t.undo(),h.lastValue=e;if(h.lastValue){var r=t.selection.getRange();t.insert(h.lastValue),t.session.markUndoGroup(),h.range=t.selection.getRange(),t.selection.setRange(r),t.selection.clearSelection()}},B=function(e){if(!t.onCompositionEnd)return;var r=h;h=!1;var i=setTimeout(function(){i=null;var e=n.value.replace(/\x01/g,"");if(h)return;e==r.lastValue?w():!r.lastValue&&e&&(w(),A(e))});k=function(n){return i&&clearTimeout(i),n=n.replace(/\x01/g,""),n==r.lastValue?"":(r.lastValue&&i&&t.undo(),n)},t.onCompositionEnd(),t.removeListener("mousedown",B),e.type=="compositionend"&&r.range&&t.selection.setRange(r.range)},j=o.delayedCall(H,50);r.addListener(n,"compositionstart",P),i.isGecko?r.addListener(n,"text",function(){j.schedule()}):(r.addListener(n,"keyup",function(){j.schedule()}),r.addListener(n,"keydown",function(){j.schedule()})),r.addListener(n,"compositionend",B),this.getElement=function(){return n},this.setReadOnly=function(e){n.readOnly=e},this.onContextMenu=function(e){L=!0,p||(p=n.style.cssText),n.style.cssText="z-index:100000;"+(i.isIE?"opacity:0.1;":""),b(t.selection.isEmpty()),t._emit("nativecontextmenu",{target:t,domEvent:e});var o=t.container.getBoundingClientRect(),u=s.computedStyle(t.container),a=o.top+(parseInt(u.borderTopWidth)||0),f=o.left+(parseInt(o.borderLeftWidth)||0),l=o.bottom-a-n.clientHeight,c=function(e){n.style.left=e.clientX-f-2+"px",n.style.top=Math.min(e.clientY-a-2,l)+"px"};c(e);if(e.type!="mousedown")return;t.renderer.$keepTextAreaAtCursor&&(t.renderer.$keepTextAreaAtCursor=null),i.isWin&&r.capture(t.container,c,F)},this.onContextMenuClose=F;if(!i.isGecko||i.isMac){var I=function(e){t.textInput.onContextMenu(e),F()};r.addListener(t.renderer.scroller,"contextmenu",I),r.addListener(n,"contextmenu",I)}};t.TextInput=a}),define("ace/lib/lang",["require","exports","module"],function(e,t,n){t.last=function(e){return e[e.length-1]},t.stringReverse=function(e){return e.split("").reverse().join("")},t.stringRepeat=function(e,t){var n="";while(t>0){t&1&&(n+=e);if(t>>=1)e+=e}return n};var r=/^\s\s*/,i=/\s\s*$/;t.stringTrimLeft=function(e){return e.replace(r,"")},t.stringTrimRight=function(e){return e.replace(i,"")},t.copyObject=function(e){var t={};for(var n in e)t[n]=e[n];return t},t.copyArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)e[n]&&typeof e[n]=="object"?t[n]=this.copyObject(e[n]):t[n]=e[n];return t},t.deepCopy=function(e){if(typeof e!="object"||!e)return e;var n=e.constructor;if(n===RegExp)return e;var r=n();for(var i in e)typeof e[i]=="object"?r[i]=t.deepCopy(e[i]):r[i]=e[i];return r},t.arrayToMap=function(e){var t={};for(var n=0;n<e.length;n++)t[e[n]]=1;return t},t.createMap=function(e){var t=Object.create(null);for(var n in e)t[n]=e[n];return t},t.arrayRemove=function(e,t){for(var n=0;n<=e.length;n++)t===e[n]&&e.splice(n,1)},t.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},t.escapeHTML=function(e){return e.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},t.getMatchOffsets=function(e,t){var n=[];return e.replace(t,function(e){n.push({offset:arguments[arguments.length-2],length:e.length})}),n},t.deferredCall=function(e){var t=null,n=function(){t=null,e()},r=function(e){return r.cancel(),t=setTimeout(n,e||0),r};return r.schedule=r,r.call=function(){return this.cancel(),e(),r},r.cancel=function(){return clearTimeout(t),t=null,r},r.isPending=function(){return t},r},t.delayedCall=function(e,t){var n=null,r=function(){n=null,e()},i=function(e){n==null&&(n=setTimeout(r,e||t))};return i.delay=function(e){n&&clearTimeout(n),n=setTimeout(r,e||t)},i.schedule=i,i.call=function(){this.cancel(),e()},i.cancel=function(){n&&clearTimeout(n),n=null},i.isPending=function(){return n},i}}),define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],function(e,t,n){function h(e,t,n){return c.$options.wrap=!0,c.$options.needle=t,c.$options.backwards=n==-1,c.find(e)}function v(e,t){return e.row==t.row&&e.column==t.column}function m(e){if(e.$multiselectOnSessionChange)return;e.$onAddRange=e.$onAddRange.bind(e),e.$onRemoveRange=e.$onRemoveRange.bind(e),e.$onMultiSelect=e.$onMultiSelect.bind(e),e.$onSingleSelect=e.$onSingleSelect.bind(e),e.$multiselectOnSessionChange=t.onSessionChange.bind(e),e.$multiselectOnSessionChange(e),e.on("changeSession",e.$multiselectOnSessionChange),e.on("mousedown",o),e.commands.addCommands(f.defaultCommands),g(e)}function g(e){function r(t){n&&(e.renderer.setMouseCursor(""),n=!1)}var t=e.textInput.getElement(),n=!1;u.addListener(t,"keydown",function(t){t.keyCode==18&&!(t.ctrlKey||t.shiftKey||t.metaKey)?n||(e.renderer.setMouseCursor("crosshair"),n=!0):n&&r()}),u.addListener(t,"keyup",r),u.addListener(t,"blur",r)}var r=e("./range_list").RangeList,i=e("./range").Range,s=e("./selection").Selection,o=e("./mouse/multi_select_handler").onMouseDown,u=e("./lib/event"),a=e("./lib/lang"),f=e("./commands/multi_select_commands");t.commands=f.defaultCommands.concat(f.multiSelectCommands);var l=e("./search").Search,c=new l,p=e("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(p.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(e,t){if(!e)return;if(!this.inMultiSelectMode&&this.rangeCount==0){var n=this.toOrientedRange();this.rangeList.add(n),this.rangeList.add(e);if(this.rangeList.ranges.length!=2)return this.rangeList.removeAll(),t||this.fromOrientedRange(e);this.rangeList.removeAll(),this.rangeList.add(n),this.$onAddRange(n)}e.cursor||(e.cursor=e.end);var r=this.rangeList.add(e);return this.$onAddRange(e),r.length&&this.$onRemoveRange(r),this.rangeCount>1&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),t||this.fromOrientedRange(e)},this.toSingleRange=function(e){e=e||this.ranges[0];var t=this.rangeList.removeAll();t.length&&this.$onRemoveRange(t),e&&this.fromOrientedRange(e)},this.substractPoint=function(e){var t=this.rangeList.substractPoint(e);if(t)return this.$onRemoveRange(t),t[0]},this.mergeOverlappingRanges=function(){var e=this.rangeList.merge();e.length?this.$onRemoveRange(e):this.ranges[0]&&this.fromOrientedRange(this.ranges[0])},this.$onAddRange=function(e){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(e),this._signal("addRange",{range:e})},this.$onRemoveRange=function(e){this.rangeCount=this.rangeList.ranges.length;if(this.rangeCount==1&&this.inMultiSelectMode){var t=this.rangeList.ranges.pop();e.push(t),this.rangeCount=0}for(var n=e.length;n--;){var r=this.ranges.indexOf(e[n]);this.ranges.splice(r,1)}this._signal("removeRange",{ranges:e}),this.rangeCount==0&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),t=t||this.ranges[0],t&&!t.isEqual(this.getRange())&&this.fromOrientedRange(t)},this.$initRangeList=function(){if(this.rangeList)return;this.rangeList=new r,this.ranges=[],this.rangeCount=0},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){if(this.rangeCount>1){var e=this.rangeList.ranges,t=e[e.length-1],n=i.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)}else{var n=this.getRange(),r=this.isBackwards(),s=n.start.row,o=n.end.row;if(s==o){if(r)var u=n.end,a=n.start;else var u=n.start,a=n.end;this.addRange(i.fromPoints(a,a)),this.addRange(i.fromPoints(u,u));return}var f=[],l=this.getLineRange(s,!0);l.start.column=n.start.column,f.push(l);for(var c=s+1;c<o;c++)f.push(this.getLineRange(c,!0));l=this.getLineRange(o,!0),l.end.column=n.end.column,f.push(l),f.forEach(this.addRange,this)}},this.toggleBlockSelection=function(){if(this.rangeCount>1){var e=this.rangeList.ranges,t=e[e.length-1],n=i.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)}else{var r=this.session.documentToScreenPosition(this.selectionLead),s=this.session.documentToScreenPosition(this.selectionAnchor),o=this.rectangularRangeBlock(r,s);o.forEach(this.addRange,this)}},this.rectangularRangeBlock=function(e,t,n){var r=[],s=e.column<t.column;if(s)var o=e.column,u=t.column;else var o=t.column,u=e.column;var a=e.row<t.row;if(a)var f=e.row,l=t.row;else var f=t.row,l=e.row;o<0&&(o=0),f<0&&(f=0),f==l&&(n=!0);for(var c=f;c<=l;c++){var h=i.fromPoints(this.session.screenToDocumentPosition(c,o),this.session.screenToDocumentPosition(c,u));if(h.isEmpty()){if(p&&v(h.end,p))break;var p=h.end}h.cursor=s?h.start:h.end,r.push(h)}a&&r.reverse();if(!n){var d=r.length-1;while(r[d].isEmpty()&&d>0)d--;if(d>0){var m=0;while(r[m].isEmpty())m++}for(var g=d;g>=m;g--)r[g].isEmpty()&&r.splice(g,1)}return r}}.call(s.prototype);var d=e("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(e){e.cursor||(e.cursor=e.end);var t=this.getSelectionStyle();return e.marker=this.session.addMarker(e,"ace_selection",t),this.session.$selectionMarkers.push(e),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,e},this.removeSelectionMarker=function(e){if(!e.marker)return;this.session.removeMarker(e.marker);var t=this.session.$selectionMarkers.indexOf(e);t!=-1&&this.session.$selectionMarkers.splice(t,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length},this.removeSelectionMarkers=function(e){var t=this.session.$selectionMarkers;for(var n=e.length;n--;){var r=e[n];if(!r.marker)continue;this.session.removeMarker(r.marker);var i=t.indexOf(r);i!=-1&&t.splice(i,1)}this.session.selectionMarkerCount=t.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){if(this.inMultiSelectMode)return;this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(f.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onSingleSelect=function(e){if(this.session.multiSelect.inVirtualMode)return;this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(f.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection")},this.$onMultiSelectExec=function(e){var t=e.command,n=e.editor;if(!n.multiSelect)return;if(!t.multiSelectAction){var r=t.exec(n,e.args||{});n.multiSelect.addRange(n.multiSelect.toOrientedRange()),n.multiSelect.mergeOverlappingRanges()}else t.multiSelectAction=="forEach"?r=n.forEachSelection(t,e.args):t.multiSelectAction=="forEachLine"?r=n.forEachSelection(t,e.args,!0):t.multiSelectAction=="single"?(n.exitMultiSelectMode(),r=t.exec(n,e.args||{})):r=t.multiSelectAction(n,e.args||{});return r},this.forEachSelection=function(e,t,n){if(this.inVirtualSelectionMode)return;var r=this.session,i=this.selection,o=i.rangeList,u,a=i._eventRegistry;i._eventRegistry={};var f=new s(r);this.inVirtualSelectionMode=!0;for(var l=o.ranges.length;l--;){if(n)while(l>0&&o.ranges[l].start.row==o.ranges[l-1].end.row)l--;f.fromOrientedRange(o.ranges[l]),f.id=o.ranges[l].marker,this.selection=r.selection=f;var c=e.exec(this,t||{});u!==undefined&&(u=c),f.toOrientedRange(o.ranges[l])}f.detach(),this.selection=r.selection=i,this.inVirtualSelectionMode=!1,i._eventRegistry=a,i.mergeOverlappingRanges();var h=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),h&&h.from==h.to&&this.renderer.animateScrolling(h.from),u},this.exitMultiSelectMode=function(){if(!this.inMultiSelectMode||this.inVirtualSelectionMode)return;this.multiSelect.toSingleRange()},this.getSelectedText=function(){var e="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var t=this.multiSelect.rangeList.ranges,n=[];for(var r=0;r<t.length;r++)n.push(this.session.getTextRange(t[r]));var i=this.session.getDocument().getNewLineCharacter();e=n.join(i),e.length==(n.length-1)*i.length&&(e="")}else this.selection.isEmpty()||(e=this.session.getTextRange(this.getSelectionRange()));return e},this.onPaste=function(e){if(this.$readOnly)return;var t={text:e};this._signal("paste",t),e=t.text;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)return this.insert(e);var n=e.split(/\r\n|\r|\n/),r=this.selection.rangeList.ranges;if(n.length>r.length||n.length<2||!n[1])return this.commands.exec("insertstring",this,e);for(var i=r.length;i--;){var s=r[i];s.isEmpty()||this.session.remove(s),this.session.insert(s.start,n[i])}},this.findAll=function(e,t,n){t=t||{},t.needle=e||t.needle,this.$search.set(t);var r=this.$search.findAll(this.session);if(!r.length)return 0;this.$blockScrolling+=1;var i=this.multiSelect;n||i.toSingleRange(r[0]);for(var s=r.length;s--;)i.addRange(r[s],!0);return this.$blockScrolling-=1,r.length},this.selectMoreLines=function(e,t){var n=this.selection.toOrientedRange(),r=n.cursor==n.end,s=this.session.documentToScreenPosition(n.cursor);this.selection.$desiredColumn&&(s.column=this.selection.$desiredColumn);var o=this.session.screenToDocumentPosition(s.row+e,s.column);if(!n.isEmpty())var u=this.session.documentToScreenPosition(r?n.end:n.start),a=this.session.screenToDocumentPosition(u.row+e,u.column);else var a=o;if(r){var f=i.fromPoints(o,a);f.cursor=f.start}else{var f=i.fromPoints(a,o);f.cursor=f.end}f.desiredColumn=s.column;if(!this.selection.inMultiSelectMode)this.selection.addRange(n);else if(t)var l=n.cursor;this.selection.addRange(f),l&&this.selection.substractPoint(l)},this.transposeSelections=function(e){var t=this.session,n=t.multiSelect,r=n.ranges;for(var i=r.length;i--;){var s=r[i];if(s.isEmpty()){var o=t.getWordRange(s.start.row,s.start.column);s.start.row=o.start.row,s.start.column=o.start.column,s.end.row=o.end.row,s.end.column=o.end.column}}n.mergeOverlappingRanges();var u=[];for(var i=r.length;i--;){var s=r[i];u.unshift(t.getTextRange(s))}e<0?u.unshift(u.pop()):u.push(u.shift());for(var i=r.length;i--;){var s=r[i],o=s.clone();t.replace(s,u[i]),s.start.row=o.start.row,s.start.column=o.start.column}},this.selectMore=function(e,t){var n=this.session,r=n.multiSelect,i=r.toOrientedRange();i.isEmpty()&&(i=n.getWordRange(i.start.row,i.start.column),i.cursor=e==-1?i.start:i.end,this.multiSelect.addRange(i));var s=n.getTextRange(i),o=h(n,s,e);o&&(o.cursor=e==-1?o.start:o.end,this.$blockScrolling+=1,this.session.unfold(o),this.multiSelect.addRange(o),this.$blockScrolling-=1,this.renderer.scrollCursorIntoView(null,.5)),t&&this.multiSelect.substractPoint(i.cursor)},this.alignCursors=function(){var e=this.session,t=e.multiSelect,n=t.ranges;if(!n.length){var r=this.selection.getRange(),s=r.start.row,o=r.end.row,u=s==o;if(u){var f=this.session.getLength(),l;do l=this.session.getLine(o);while(/[=:]/.test(l)&&++o<f);do l=this.session.getLine(s);while(/[=:]/.test(l)&&--s>0);s<0&&(s=0),o>=f&&(o=f-1)}var c=this.session.doc.removeLines(s,o);c=this.$reAlignText(c,u),this.session.doc.insert({row:s,column:0},c.join("\n")+"\n"),u||(r.start.column=0,r.end.column=c[c.length-1].length),this.selection.setRange(r)}else{var h=-1,p=n.filter(function(e){if(e.cursor.row==h)return!0;h=e.cursor.row});t.$onRemoveRange(p);var d=0,v=Infinity,m=n.map(function(t){var n=t.cursor,r=e.getLine(n.row),i=r.substr(n.column).search(/\S/g);return i==-1&&(i=0),n.column>d&&(d=n.column),i<v&&(v=i),i});n.forEach(function(t,n){var r=t.cursor,s=d-r.column,o=m[n]-v;s>o?e.insert(r,a.stringRepeat(" ",s-o)):e.remove(new i(r.row,r.column,r.row,r.column-s+o)),t.start.column=t.end.column=d,t.start.row=t.end.row=r.row,t.cursor=t.end}),t.fromOrientedRange(n[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}},this.$reAlignText=function(e,t){function u(e){return a.stringRepeat(" ",e)}function f(e){return e[2]?u(i)+e[2]+u(s-e[2].length+o)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}function l(e){return e[2]?u(i+s-e[2].length)+e[2]+u(o," ")+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}function c(e){return e[2]?u(i)+e[2]+u(o)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}var n=!0,r=!0,i,s,o;return e.map(function(e){var t=e.match(/(\s*)(.*?)(\s*)([=:].*)/);return t?i==null?(i=t[1].length,s=t[2].length,o=t[3].length,t):(i+s+o!=t[1].length+t[2].length+t[3].length&&(r=!1),i!=t[1].length&&(n=!1),i>t[1].length&&(i=t[1].length),s<t[2].length&&(s=t[2].length),o>t[3].length&&(o=t[3].length),t):[e]}).map(t?f:n?r?l:f:c)}}).call(d.prototype),t.onSessionChange=function(e){var t=e.session;t.multiSelect||(t.$selectionMarkers=[],t.selection.$initRangeList(),t.multiSelect=t.selection),this.multiSelect=t.multiSelect;var n=e.oldSession;n&&(n.multiSelect.removeEventListener("addRange",this.$onAddRange),n.multiSelect.removeEventListener("removeRange",this.$onRemoveRange),n.multiSelect.removeEventListener("multiSelect",this.$onMultiSelect),n.multiSelect.removeEventListener("singleSelect",this.$onSingleSelect)),t.multiSelect.on("addRange",this.$onAddRange),t.multiSelect.on("removeRange",this.$onRemoveRange),t.multiSelect.on("multiSelect",this.$onMultiSelect),t.multiSelect.on("singleSelect",this.$onSingleSelect),this.inMultiSelectMode!=t.selection.inMultiSelectMode&&(t.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},t.MultiSelect=m,e("./config").defineOptions(d.prototype,"editor",{enableMultiselect:{set:function(e){m(this),e?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",o)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",o))},value:!0}})}),define("ace/editor",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config"],function(e,t,n){e("./lib/fixoldbrowsers");var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./lib/lang"),o=e("./lib/useragent"),u=e("./keyboard/textinput").TextInput,a=e("./mouse/mouse_handler").MouseHandler,f=e("./mouse/fold_handler").FoldHandler,l=e("./keyboard/keybinding").KeyBinding,c=e("./edit_session").EditSession,h=e("./search").Search,p=e("./range").Range,d=e("./lib/event_emitter").EventEmitter,v=e("./commands/command_manager").CommandManager,m=e("./commands/default_commands").commands,g=e("./config"),y=function(e,t){var n=e.getContainerElement();this.container=n,this.renderer=e,this.commands=new v(o.isMac?"mac":"win",m),this.textInput=new u(e.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.keyBinding=new l(this),this.$mouseHandler=new a(this),new f(this),this.$blockScrolling=0,this.$search=(new h).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=s.delayedCall(function(){this._signal("input",{}),this.session.bgTokenizer&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",function(e,t){t._$emitInputEvent.schedule(31)}),this.setSession(t||new c("")),g.resetOptions(this),g._signal("editor",this)};(function(){r.implement(this,d),this.$initOperationListeners=function(){function e(e){return e[e.length-1]}this.selections=[],this.commands.on("exec",function(t){this.startOperation(t);var n=t.command;if(n.aceCommandGroup=="fileJump"){var r=this.prevOp;if(!r||r.command.aceCommandGroup!="fileJump")this.lastFileJumpPos=e(this.selections)}else this.lastFileJumpPos=null}.bind(this),!0),this.commands.on("afterExec",function(e){var t=e.command;t.aceCommandGroup=="fileJump"&&this.lastFileJumpPos&&!this.curOp.selectionChanged&&this.selection.fromJSON(this.lastFileJumpPos),this.endOperation(e)}.bind(this),!0),this.$opResetTimer=s.delayedCall(this.endOperation.bind(this)),this.on("change",function(){this.curOp||this.startOperation(),this.curOp.docChanged=!0}.bind(this),!0),this.on("changeSelection",function(){this.curOp||this.startOperation(),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(e){if(this.curOp){if(!e||this.curOp.command)return;this.prevOp=this.curOp}e||(this.previousCommand=null,e={}),this.$opResetTimer.schedule(),this.curOp={command:e.command||{},args:e.args,scrollTop:this.renderer.scrollTop};var t=this.curOp.command;t&&t.scrollIntoView&&this.$blockScrolling++,this.selections.push(this.selection.toJSON())},this.endOperation=function(){if(this.curOp){var e=this.curOp.command;if(e&&e.scrollIntoView){this.$blockScrolling--;switch(e.scrollIntoView){case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var t=this.selection.getRange(),n=this.renderer.layerConfig;(t.start.row>=n.lastRow||t.end.row<=n.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead);break;default:}e.scrollIntoView=="animate"&&this.renderer.animateScrolling(this.curOp.scrollTop)}this.prevOp=this.curOp,this.curOp=null}},this.$historyTracker=function(e){if(!this.$mergeUndoDeltas)return;var t=this.prevOp,n=["backspace","del","insertstring"],r=t.command&&e.command.name==t.command.name;if(e.command.name=="insertstring"){var i=e.args;this.mergeNextCommand===undefined&&(this.mergeNextCommand=!0),r=r&&this.mergeNextCommand&&(!/\s/.test(i)||/\s/.test(t.args)),this.mergeNextCommand=!0}else r=r&&n.indexOf(e.command.name)!==-1;this.$mergeUndoDeltas!="always"&&Date.now()-this.sequenceStartTime>2e3&&(r=!1),r?this.session.mergeUndoDeltas=!0:n.indexOf(e.command.name)!==-1&&(this.sequenceStartTime=Date.now())},this.setKeyboardHandler=function(e){if(!e)this.keyBinding.setKeyboardHandler(null);else if(typeof e=="string"){this.$keybindingId=e;var t=this;g.loadModule(["keybinding",e],function(n){t.$keybindingId==e&&t.keyBinding.setKeyboardHandler(n&&n.handler)})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(e)},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(e){if(this.session==e)return;var t=this.session;if(t){this.session.removeEventListener("change",this.$onDocumentChange),this.session.removeEventListener("changeMode",this.$onChangeMode),this.session.removeEventListener("tokenizerUpdate",this.$onTokenizerUpdate),this.session.removeEventListener("changeTabSize",this.$onChangeTabSize),this.session.removeEventListener("changeWrapLimit",this.$onChangeWrapLimit),this.session.removeEventListener("changeWrapMode",this.$onChangeWrapMode),this.session.removeEventListener("onChangeFold",this.$onChangeFold),this.session.removeEventListener("changeFrontMarker",this.$onChangeFrontMarker),this.session.removeEventListener("changeBackMarker",this.$onChangeBackMarker),this.session.removeEventListener("changeBreakpoint",this.$onChangeBreakpoint),this.session.removeEventListener("changeAnnotation",this.$onChangeAnnotation),this.session.removeEventListener("changeOverwrite",this.$onCursorChange),this.session.removeEventListener("changeScrollTop",this.$onScrollTopChange),this.session.removeEventListener("changeScrollLeft",this.$onScrollLeftChange);var n=this.session.getSelection();n.removeEventListener("changeCursor",this.$onCursorChange),n.removeEventListener("changeSelection",this.$onSelectionChange)}this.session=e,e&&(this.$onDocumentChange=this.onDocumentChange.bind(this),e.addEventListener("change",this.$onDocumentChange),this.renderer.setSession(e),this.$onChangeMode=this.onChangeMode.bind(this),e.addEventListener("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),e.addEventListener("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),e.addEventListener("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),e.addEventListener("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),e.addEventListener("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),e.addEventListener("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.addEventListener("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.addEventListener("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.addEventListener("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.addEventListener("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.addEventListener("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.addEventListener("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.addEventListener("changeScrollLeft",this.$onScrollLeftChange),this.selection=e.getSelection(),this.selection.addEventListener("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.addEventListener("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.$blockScrolling+=1,this.onCursorChange(),this.$blockScrolling-=1,this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()),this._signal("changeSession",{session:e,oldSession:t}),t&&t._signal("changeEditor",{oldEditor:this}),e&&e._signal("changeEditor",{editor:this})},this.getSession=function(){return this.session},this.setValue=function(e,t){return this.session.doc.setValue(e),t?t==1?this.navigateFileEnd():t==-1&&this.navigateFileStart():this.selectAll(),e},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(e){this.renderer.onResize(e)},this.setTheme=function(e,t){this.renderer.setTheme(e,t)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(e){this.renderer.setStyle(e)},this.unsetStyle=function(e){this.renderer.unsetStyle(e)},this.getFontSize=function(){return this.getOption("fontSize")||i.computedStyle(this.container,"fontSize")},this.setFontSize=function(e){this.setOption("fontSize",e)},this.$highlightBrackets=function(){this.session.$bracketHighlight&&(this.session.removeMarker(this.session.$bracketHighlight),this.session.$bracketHighlight=null);if(this.$highlightPending)return;var e=this;this.$highlightPending=!0,setTimeout(function(){e.$highlightPending=!1;var t=e.session.findMatchingBracket(e.getCursorPosition());if(t)var n=new p(t.row,t.column,t.row,t.column+1);else if(e.session.$mode.getMatching)var n=e.session.$mode.getMatching(e.session);n&&(e.session.$bracketHighlight=e.session.addMarker(n,"ace_bracket","text"))},50)},this.focus=function(){var e=this;setTimeout(function(){e.textInput.focus()}),this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(){if(this.$isFocused)return;this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus")},this.onBlur=function(){if(!this.$isFocused)return;this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur")},this.$cursorChange=function(){this.renderer.updateCursor()},this.onDocumentChange=function(e){var t=e.data,n=t.range,r;n.start.row==n.end.row&&t.action!="insertLines"&&t.action!="removeLines"?r=n.end.row:r=Infinity,this.renderer.updateLines(n.start.row,r),this._signal("change",e),this.$cursorChange()},this.onTokenizerUpdate=function(e){var t=e.data;this.renderer.updateLines(t.first,t.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this.$blockScrolling||this.renderer.scrollCursorIntoView(),this.$highlightBrackets(),this.$updateHighlightActiveLine(),this._signal("changeSelection")},this.$updateHighlightActiveLine=function(){var e=this.getSession(),t;if(this.$highlightActiveLine){if(this.$selectionStyle!="line"||!this.selection.isMultiLine())t=this.getCursorPosition();this.renderer.$maxLines&&this.session.getLength()===1&&!(this.renderer.$minLines>1)&&(t=!1)}if(e.$highlightLineMarker&&!t)e.removeMarker(e.$highlightLineMarker.id),e.$highlightLineMarker=null;else if(!e.$highlightLineMarker&&t){var n=new p(t.row,t.column,t.row,Infinity);n.id=e.addMarker(n,"ace_active-line","screenLine"),e.$highlightLineMarker=n}else t&&(e.$highlightLineMarker.start.row=t.row,e.$highlightLineMarker.end.row=t.row,e.$highlightLineMarker.start.column=t.column,e._signal("changeBackMarker"))},this.onSelectionChange=function(e){var t=this.session;t.$selectionMarker&&t.removeMarker(t.$selectionMarker),t.$selectionMarker=null;if(!this.selection.isEmpty()){var n=this.selection.getRange(),r=this.getSelectionStyle();t.$selectionMarker=t.addMarker(n,"ace_selection",r)}else this.$updateHighlightActiveLine();var i=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(i),this._signal("changeSelection")},this.$getSelectionHighLightRegexp=function(){var e=this.session,t=this.getSelectionRange();if(t.isEmpty()||t.isMultiLine())return;var n=t.start.column-1,r=t.end.column+1,i=e.getLine(t.start.row),s=i.length,o=i.substring(Math.max(n,0),Math.min(r,s));if(n>=0&&/^[\w\d]/.test(o)||r<=s&&/[\w\d]$/.test(o))return;o=i.substring(t.start.column,t.end.column);if(!/^[\w\d]+$/.test(o))return;var u=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:o});return u},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit("changeMode",e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var e=this.getSelectedText();return this._signal("copy",e),e},this.onCopy=function(){this.commands.exec("copy",this)},this.onCut=function(){this.commands.exec("cut",this)},this.onPaste=function(e){if(this.$readOnly)return;var t={text:e};this._signal("paste",t),this.insert(t.text,!0)},this.execCommand=function(e,t){this.commands.exec(e,this,t)},this.insert=function(e,t){var n=this.session,r=n.getMode(),i=this.getCursorPosition();if(this.getBehavioursEnabled()&&!t){var s=r.transformAction(n.getState(i.row),"insertion",this,n,e);s&&(e!==s.text&&(this.session.mergeUndoDeltas=!1,this.$mergeNextCommand=!1),e=s.text)}e=="	"&&(e=this.session.getTabString());if(!this.selection.isEmpty()){var o=this.getSelectionRange();i=this.session.remove(o),this.clearSelection()}else if(this.session.getOverwrite()){var o=new p.fromPoints(i,i);o.end.column+=e.length,this.session.remove(o)}if(e=="\n"||e=="\r\n"){var u=n.getLine(i.row);if(i.column>u.search(/\S|$/)){var a=u.substr(i.column).search(/\S|$/);n.doc.removeInLine(i.row,i.column,i.column+a)}}this.clearSelection();var f=i.column,l=n.getState(i.row),u=n.getLine(i.row),c=r.checkOutdent(l,u,e),h=n.insert(i,e);s&&s.selection&&(s.selection.length==2?this.selection.setSelectionRange(new p(i.row,f+s.selection[0],i.row,f+s.selection[1])):this.selection.setSelectionRange(new p(i.row+s.selection[0],s.selection[1],i.row+s.selection[2],s.selection[3])));if(n.getDocument().isNewLine(e)){var d=r.getNextLineIndent(l,u.slice(0,i.column),n.getTabString());n.insert({row:i.row+1,column:0},d)}c&&r.autoOutdent(l,n,i.row)},this.onTextInput=function(e){this.keyBinding.onTextInput(e)},this.onCommandKey=function(e,t,n){this.keyBinding.onCommandKey(e,t,n)},this.setOverwrite=function(e){this.session.setOverwrite(e)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(e){this.setOption("scrollSpeed",e)},this.getScrollSpeed=function(){return this.getOption("scrollSpeed")},this.setDragDelay=function(e){this.setOption("dragDelay",e)},this.getDragDelay=function(){return this.getOption("dragDelay")},this.setSelectionStyle=function(e){this.setOption("selectionStyle",e)},this.getSelectionStyle=function(){return this.getOption("selectionStyle")},this.setHighlightActiveLine=function(e){this.setOption("highlightActiveLine",e)},this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.setHighlightSelectedWord=function(e){this.setOption("highlightSelectedWord",e)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(e){this.renderer.setAnimatedScroll(e)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(e){this.renderer.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(e){this.renderer.setDisplayIndentGuides(e)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setShowPrintMargin=function(e){this.renderer.setShowPrintMargin(e)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(e){this.renderer.setPrintMarginColumn(e)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(e){this.setOption("readOnly",e)},this.getReadOnly=function(){return this.getOption("readOnly")},this.setBehavioursEnabled=function(e){this.setOption("behavioursEnabled",e)},this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},this.setWrapBehavioursEnabled=function(e){this.setOption("wrapBehavioursEnabled",e)},this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},this.setShowFoldWidgets=function(e){this.setOption("showFoldWidgets",e)},this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.remove=function(e){this.selection.isEmpty()&&(e=="left"?this.selection.selectLeft():this.selection.selectRight());var t=this.getSelectionRange();if(this.getBehavioursEnabled()){var n=this.session,r=n.getState(t.start.row),i=n.getMode().transformAction(r,"deletion",this,n,t);if(t.end.column===0){var s=n.getTextRange(t);if(s[s.length-1]=="\n"){var o=n.getLine(t.end.row);/^\s+$/.test(o)&&(t.end.column=o.length)}}i&&(t=i)}this.session.remove(t),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var e=this.getSelectionRange();e.start.column==e.end.column&&e.start.row==e.end.row&&(e.end.column=0,e.end.row++),this.session.remove(e),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var e=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(e)},this.transposeLetters=function(){if(!this.selection.isEmpty())return;var e=this.getCursorPosition(),t=e.column;if(t===0)return;var n=this.session.getLine(e.row),r,i;t<n.length?(r=n.charAt(t)+n.charAt(t-1),i=new p(e.row,t-1,e.row,t+1)):(r=n.charAt(t-1)+n.charAt(t-2),i=new p(e.row,t-2,e.row,t)),this.session.replace(i,r)},this.toLowerCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toLowerCase()),this.selection.setSelectionRange(e)},this.toUpperCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toUpperCase()),this.selection.setSelectionRange(e)},this.indent=function(){var e=this.session,t=this.getSelectionRange();if(t.start.row<t.end.row){var n=this.$getSelectedRows();e.indentRows(n.first,n.last,"	");return}if(t.start.column<t.end.column){var r=e.getTextRange(t);if(!/^\s+$/.test(r)){var n=this.$getSelectedRows();e.indentRows(n.first,n.last,"	");return}}var i=e.getLine(t.start.row),o=t.start,u=e.getTabSize(),a=e.documentToScreenColumn(o.row,o.column);if(this.session.getUseSoftTabs())var f=u-a%u,l=s.stringRepeat(" ",f);else{var f=a%u;while(i[t.start.column]==" "&&f)t.start.column--,f--;this.selection.setSelectionRange(t),l="	"}return this.insert(l)},this.blockIndent=function(){var e=this.$getSelectedRows();this.session.indentRows(e.first,e.last,"	")},this.blockOutdent=function(){var e=this.session.getSelection();this.session.outdentRows(e.getRange())},this.sortLines=function(){var e=this.$getSelectedRows(),t=this.session,n=[];for(i=e.first;i<=e.last;i++)n.push(t.getLine(i));n.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0});var r=new p(0,0,0,0);for(var i=e.first;i<=e.last;i++){var s=t.getLine(i);r.start.row=i,r.end.row=i,r.end.column=s.length,t.replace(r,n[i-e.first])}},this.toggleCommentLines=function(){var e=this.session.getState(this.getCursorPosition().row),t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(e,this.session,t.first,t.last)},this.toggleBlockComment=function(){var e=this.getCursorPosition(),t=this.session.getState(e.row),n=this.getSelectionRange();this.session.getMode().toggleBlockComment(t,this.session,n,e)},this.getNumberAt=function(e,t){var n=/[\-]?[0-9]+(?:\.[0-9]+)?/g;n.lastIndex=0;var r=this.session.getLine(e);while(n.lastIndex<t){var i=n.exec(r);if(i.index<=t&&i.index+i[0].length>=t){var s={value:i[0],start:i.index,end:i.index+i[0].length};return s}}return null},this.modifyNumber=function(e){var t=this.selection.getCursor().row,n=this.selection.getCursor().column,r=new p(t,n-1,t,n),i=this.session.getTextRange(r);if(!isNaN(parseFloat(i))&&isFinite(i)){var s=this.getNumberAt(t,n);if(s){var o=s.value.indexOf(".")>=0?s.start+s.value.indexOf(".")+1:s.end,u=s.start+s.value.length-o,a=parseFloat(s.value);a*=Math.pow(10,u),o!==s.end&&n<o?e*=Math.pow(10,s.end-n-1):e*=Math.pow(10,s.end-n),a+=e,a/=Math.pow(10,u);var f=a.toFixed(u),l=new p(t,s.start,t,s.end);this.session.replace(l,f),this.moveCursorTo(t,Math.max(s.start+1,n+f.length-s.value.length))}}},this.removeLines=function(){var e=this.$getSelectedRows(),t;e.first===0||e.last+1<this.session.getLength()?t=new p(e.first,0,e.last+1,0):t=new p(e.first-1,this.session.getLine(e.first-1).length,e.last,this.session.getLine(e.last).length),this.session.remove(t),this.clearSelection()},this.duplicateSelection=function(){var e=this.selection,t=this.session,n=e.getRange(),r=e.isBackwards();if(n.isEmpty()){var i=n.start.row;t.duplicateLines(i,i)}else{var s=r?n.start:n.end,o=t.insert(s,t.getTextRange(n),!1);n.start=s,n.end=o,e.setSelectionRange(n,r)}},this.moveLinesDown=function(){this.$moveLines(function(e,t){return this.session.moveLinesDown(e,t)})},this.moveLinesUp=function(){this.$moveLines(function(e,t){return this.session.moveLinesUp(e,t)})},this.moveText=function(e,t,n){return this.session.moveText(e,t,n)},this.copyLinesUp=function(){this.$moveLines(function(e,t){return this.session.duplicateLines(e,t),0})},this.copyLinesDown=function(){this.$moveLines(function(e,t){return this.session.duplicateLines(e,t)})},this.$moveLines=function(e){var t=this.selection;if(!t.inMultiSelectMode||this.inVirtualSelectionMode){var n=t.toOrientedRange(),r=this.$getSelectedRows(n),i=e.call(this,r.first,r.last);n.moveBy(i,0),t.fromOrientedRange(n)}else{var s=t.rangeList.ranges;t.rangeList.detach(this.session);for(var o=s.length;o--;){var u=o,r=s[o].collapseRows(),a=r.end.row,f=r.start.row;while(o--){r=s[o].collapseRows();if(!(f-r.end.row<=1))break;f=r.end.row}o++;var i=e.call(this,f,a);while(u>=o)s[u].moveBy(i,0),u--}t.fromOrientedRange(t.ranges[0]),t.rangeList.attach(this.session)}},this.$getSelectedRows=function(){var e=this.getSelectionRange().collapseRows();return{first:this.session.getRowFoldStart(e.start.row),last:this.session.getRowFoldEnd(e.end.row)}},this.onCompositionStart=function(e){this.renderer.showComposition(this.getCursorPosition())},this.onCompositionUpdate=function(e){this.renderer.setCompositionText(e)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(e){return e>=this.getFirstVisibleRow()&&e<=this.getLastVisibleRow()},this.isRowFullyVisible=function(e){return e>=this.renderer.getFirstFullyVisibleRow()&&e<=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(e,t){var n=this.renderer,r=this.renderer.layerConfig,i=e*Math.floor(r.height/r.lineHeight);this.$blockScrolling++,t===!0?this.selection.$moveSelection(function(){this.moveCursorBy(i,0)}):t===!1&&(this.selection.moveCursorBy(i,0),this.selection.clearSelection()),this.$blockScrolling--;var s=n.scrollTop;n.scrollBy(0,i*r.lineHeight),t!=null&&n.scrollCursorIntoView(null,.5),n.animateScrolling(s)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(e){this.renderer.scrollToRow(e)},this.scrollToLine=function(e,t,n,r){this.renderer.scrollToLine(e,t,n,r)},this.centerSelection=function(){var e=this.getSelectionRange(),t={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCursor(t,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.$blockScrolling+=1,this.selection.selectAll(),this.$blockScrolling-=1},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(e,t){this.selection.moveCursorTo(e,t)},this.moveCursorToPosition=function(e){this.selection.moveCursorToPosition(e)},this.jumpToMatching=function(e){var t=this.getCursorPosition(),n=this.session.getBracketRange(t);if(!n){n=this.find({needle:/[{}()\[\]]/g,preventScroll:!0,start:{row:t.row,column:t.column-1}});if(!n)return;var r=n.start;r.row==t.row&&Math.abs(r.column-t.column)<2&&(n=this.session.getBracketRange(r))}r=n&&n.cursor||r,r&&(e?n&&n.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(r.row,r.column):this.selection.moveTo(r.row,r.column))},this.gotoLine=function(e,t,n){this.selection.clearSelection(),this.session.unfold({row:e-1,column:t||0}),this.$blockScrolling+=1,this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(e-1,t||0),this.$blockScrolling-=1,this.isRowFullyVisible(e-1)||this.scrollToLine(e-1,!0,n)},this.navigateTo=function(e,t){this.selection.moveTo(e,t)},this.navigateUp=function(e){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(-e||-1,0)},this.navigateDown=function(e){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(e||1,0)},this.navigateLeft=function(e){if(!this.selection.isEmpty()){var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}else{e=e||1;while(e--)this.selection.moveCursorLeft()}this.clearSelection()},this.navigateRight=function(e){if(!this.selection.isEmpty()){var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}else{e=e||1;while(e--)this.selection.moveCursorRight()}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(e,t){t&&this.$search.set(t);var n=this.$search.find(this.session),r=0;return n?(this.$tryReplace(n,e)&&(r=1),n!==null&&(this.selection.setSelectionRange(n),this.renderer.scrollSelectionIntoView(n.start,n.end)),r):r},this.replaceAll=function(e,t){t&&this.$search.set(t);var n=this.$search.findAll(this.session),r=0;if(!n.length)return r;this.$blockScrolling+=1;var i=this.getSelectionRange();this.selection.moveTo(0,0);for(var s=n.length-1;s>=0;--s)this.$tryReplace(n[s],e)&&r++;return this.selection.setSelectionRange(i),this.$blockScrolling-=1,r},this.$tryReplace=function(e,t){var n=this.session.getTextRange(e);return t=this.$search.replace(n,t),t!==null?(e.end=this.session.replace(e,t),e):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(e,t,n){t||(t={}),typeof e=="string"||e instanceof RegExp?t.needle=e:typeof e=="object"&&r.mixin(t,e);var i=this.selection.getRange();t.needle==null&&(e=this.session.getTextRange(i)||this.$search.$options.needle,e||(i=this.session.getWordRange(i.start.row,i.start.column),e=this.session.getTextRange(i)),this.$search.set({needle:e})),this.$search.set(t),t.start||this.$search.set({start:i});var s=this.$search.find(this.session);if(t.preventScroll)return s;if(s)return this.revealRange(s,n),s;t.backwards?i.start=i.end:i.end=i.start,this.selection.setRange(i)},this.findNext=function(e,t){this.find({skipCurrent:!0,backwards:!1},e,t)},this.findPrevious=function(e,t){this.find(e,{skipCurrent:!0,backwards:!0},t)},this.revealRange=function(e,t){this.$blockScrolling+=1,this.session.unfold(e),this.selection.setSelectionRange(e),this.$blockScrolling-=1;var n=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5),t!==!1&&this.renderer.animateScrolling(n)},this.undo=function(){this.$blockScrolling++,this.session.getUndoManager().undo(),this.$blockScrolling--,this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.$blockScrolling++,this.session.getUndoManager().redo(),this.$blockScrolling--,this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.renderer.destroy(),this._signal("destroy",this)},this.setAutoScrollEditorIntoView=function(e){if(!e)return;var t,n=this,r=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var i=this.$scrollAnchor;i.style.cssText="position:absolute",this.container.insertBefore(i,this.container.firstChild);var s=this.on("changeSelection",function(){r=!0}),o=this.renderer.on("beforeRender",function(){r&&(t=n.renderer.container.getBoundingClientRect())}),u=this.renderer.on("afterRender",function(){if(r&&t&&n.isFocused()){var e=n.renderer,s=e.$cursorLayer.$pixelPos,o=e.layerConfig,u=s.top-o.offset;s.top>=0&&u+t.top<0?r=!0:s.top<o.height&&s.top+t.top+o.lineHeight>window.innerHeight?r=!1:r=null,r!=null&&(i.style.top=u+"px",i.style.left=s.left+"px",i.style.height=o.lineHeight+"px",i.scrollIntoView(r)),r=t=null}});this.setAutoScrollEditorIntoView=function(e){if(e)return;delete this.setAutoScrollEditorIntoView,this.removeEventListener("changeSelection",s),this.renderer.removeEventListener("afterRender",u),this.renderer.removeEventListener("beforeRender",o)}},this.$resetCursorStyle=function(){var e=this.$cursorStyle||"ace",t=this.renderer.$cursorLayer;if(!t)return;t.setSmoothBlinking(e=="smooth"),t.isBlinking=!this.$readOnly&&e!="wide"}}).call(y.prototype),g.defineOptions(y.prototype,"editor",{selectionStyle:{set:function(e){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:e})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(e){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(e){this.textInput.setReadOnly(e),this.$resetCursorStyle()},initialValue:!1},cursorStyle:{set:function(e){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},autoScrollEditorIntoView:{set:function(e){this.setAutoScrollEditorIntoView(e)}},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",showLineNumbers:"renderer",showGutter:"renderer",displayIndentGuides:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",tabSize:"session",wrap:"session",foldStyle:"session",mode:"session"}),t.Editor=y}),define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event"],function(e,t,n){function i(e,t){return e.row==t.row&&e.column==t.column}function s(e){var t=e.domEvent,n=t.altKey,s=t.shiftKey,o=e.getAccelKey(),u=e.getButton();if(e.editor.inMultiSelectMode&&u==2){e.editor.textInput.onContextMenu(e.domEvent);return}if(!o&&!n){u===0&&e.editor.inMultiSelectMode&&e.editor.exitMultiSelectMode();return}var a=e.editor,f=a.selection,l=a.inMultiSelectMode,c=e.getDocumentPosition(),h=f.getCursor(),p=e.inSelection()||f.isEmpty()&&i(c,h),d=e.x,v=e.y,m=function(e){d=e.clientX,v=e.clientY},g=function(){var e=a.renderer.pixelToScreenCoordinates(d,v),t=y.screenToDocumentPosition(e.row,e.column);if(i(w,e)&&i(t,f.selectionLead))return;w=e,a.selection.moveToPosition(t),a.renderer.scrollCursorIntoView(),a.removeSelectionMarkers(x),x=f.rectangularRangeBlock(w,b),x.forEach(a.addSelectionMarker,a),a.updateSelectionMarkers()},y=a.session,b=a.renderer.pixelToScreenCoordinates(d,v),w=b;if(o&&!n&&!s&&u===0){if(!l&&p)return;if(!l){var E=f.toOrientedRange();a.addSelectionMarker(E)}var S=f.rangeList.rangeAtPoint(c);a.$blockScrolling++,a.once("mouseup",function(){var e=f.toOrientedRange();S&&e.isEmpty()&&i(S.cursor,e.cursor)?f.substractPoint(e.cursor):(E&&(a.removeSelectionMarker(E),f.addRange(E)),f.addRange(e)),a.$blockScrolling--})}else if(n&&u===0){e.stop(),l&&!o?f.toSingleRange():!l&&o&&f.addRange();var x=[];s?(b=y.documentToScreenPosition(f.lead),g()):f.moveToPosition(c);var T=function(e){clearInterval(C),a.removeSelectionMarkers(x);for(var t=0;t<x.length;t++)f.addRange(x[t])},N=g;r.capture(a.container,m,T);var C=setInterval(function(){N()},20);return e.preventDefault()}}var r=e("../lib/event");t.onMouseDown=s}),define("ace/lib/useragent",["require","exports","module"],function(e,t,n){t.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},t.getOS=function(){return t.isMac?t.OS.MAC:t.isLinux?t.OS.LINUX:t.OS.WINDOWS};if(typeof navigator!="object")return;var r=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase(),i=navigator.userAgent;t.isWin=r=="win",t.isMac=r=="mac",t.isLinux=r=="linux",t.isIE=(navigator.appName=="Microsoft Internet Explorer"||navigator.appName.indexOf("MSAppHost")>=0)&&parseFloat(navigator.userAgent.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:|MSIE )([0-9]+[\.0-9]+)/)[1]),t.isOldIE=t.isIE&&t.isIE<9,t.isGecko=t.isMozilla=window.controllers&&window.navigator.product==="Gecko",t.isOldGecko=t.isGecko&&parseInt((navigator.userAgent.match(/rv\:(\d+)/)||[])[1],10)<4,t.isOpera=window.opera&&Object.prototype.toString.call(window.opera)=="[object Opera]",t.isWebKit=parseFloat(i.split("WebKit/")[1])||undefined,t.isChrome=parseFloat(i.split(" Chrome/")[1])||undefined,t.isAIR=i.indexOf("AdobeAIR")>=0,t.isIPad=i.indexOf("iPad")>=0,t.isTouchPad=i.indexOf("TouchPad")>=0}),define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(e,t,n){t.defaultCommands=[{name:"addCursorAbove",exec:function(e){e.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},readonly:!0},{name:"addCursorBelow",exec:function(e){e.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},readonly:!0},{name:"addCursorAboveSkipCurrent",exec:function(e){e.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},readonly:!0},{name:"addCursorBelowSkipCurrent",exec:function(e){e.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},readonly:!0},{name:"selectMoreBefore",exec:function(e){e.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},readonly:!0},{name:"selectMoreAfter",exec:function(e){e.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},readonly:!0},{name:"selectNextBefore",exec:function(e){e.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},readonly:!0},{name:"selectNextAfter",exec:function(e){e.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},readonly:!0},{name:"splitIntoLines",exec:function(e){e.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readonly:!0},{name:"alignCursors",exec:function(e){e.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"}}],t.multiSelectCommands=[{name:"singleSelection",bindKey:"esc",exec:function(e){e.exitMultiSelectMode()},readonly:!0,isAvailable:function(e){return e&&e.inMultiSelectMode}}];var r=e("../keyboard/hash_handler").HashHandler;t.keyboardHandler=new r(t.multiSelectCommands)}),define("ace/lib/oop",["require","exports","module"],function(e,t,n){t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.mixin=function(e,t){for(var n in t)e[n]=t[n];return e},t.implement=function(e,n){t.mixin(e,n)}}),define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/config"],function(e,t,n){var r=e("../lib/oop"),i=e("../lib/event_emitter").EventEmitter,s=e("../config"),o=function(t,n,r,i){this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),e.nameToUrl&&!e.toUrl&&(e.toUrl=e.nameToUrl);if(s.get("packaged")||!e.toUrl)i=i||s.moduleUrl(n,"worker");else{var o=this.$normalizePath;i=i||o(e.toUrl("ace/worker/worker.js",null,"_"));var u={};t.forEach(function(t){u[t]=o(e.toUrl(t,null,"_").replace(/(\.js)?(\?.*)?$/,""))})}try{this.$worker=new Worker(i)}catch(a){if(!(a instanceof window.DOMException))throw a;var f=this.$workerBlob(i),l=window.URL||window.webkitURL,c=l.createObjectURL(f);this.$worker=new Worker(c),l.revokeObjectURL(c)}this.$worker.postMessage({init:!0,tlns:u,module:n,classname:r}),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){r.implement(this,i),this.onMessage=function(e){var t=e.data;switch(t.type){case"log":window.console&&console.log&&console.log.apply(console,t.data);break;case"event":this._signal(t.name,{data:t.data});break;case"call":var n=this.callbacks[t.id];n&&(n(t.data),delete this.callbacks[t.id])}},this.$normalizePath=function(e){return location.host?(e=e.replace(/^[a-z]+:\/\/[^\/]+/,""),e=location.protocol+"//"+location.host+(e.charAt(0)=="/"?"":location.pathname.replace(/\/[^\/]*$/,""))+"/"+e.replace(/^[\/]+/,""),e):e},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc.removeEventListener("change",this.changeListener),this.$doc=null},this.send=function(e,t){this.$worker.postMessage({command:e,args:t})},this.call=function(e,t,n){if(n){var r=this.callbackId++;this.callbacks[r]=n,t.push(r)}this.send(e,t)},this.emit=function(e,t){try{this.$worker.postMessage({event:e,data:{data:t.data}})}catch(n){}},this.attachToDocument=function(e){this.$doc&&this.terminate(),this.$doc=e,this.call("setValue",[e.getValue()]),e.on("change",this.changeListener)},this.changeListener=function(e){this.deltaQueue?this.deltaQueue.push(e.data):(this.deltaQueue=[e.data],setTimeout(this.$sendDeltaQueue,0))},this.$sendDeltaQueue=function(){var e=this.deltaQueue;if(!e)return;this.deltaQueue=null,e.length>20&&e.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:e})},this.$workerBlob=function(e){var t="importScripts('"+e+"');";try{return new Blob([t],{type:"application/javascript"})}catch(n){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,i=new r;return i.append(t),i.getBlob("application/javascript")}}}).call(o.prototype);var u=function(e,t,n){this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.callbackId=1,this.callbacks={},this.messageBuffer=[];var r=null,o=!1,u=Object.create(i),a=this;this.$worker={},this.$worker.terminate=function(){},this.$worker.postMessage=function(e){a.messageBuffer.push(e),r&&(o?setTimeout(f):f())},this.setEmitSync=function(e){o=e};var f=function(){var e=a.messageBuffer.shift();e.command?r[e.command].apply(r,e.args):e.event&&u._signal(e.event,e.data)};u.postMessage=function(e){a.onMessage({data:e})},u.callback=function(e,t){this.postMessage({type:"call",id:t,data:e})},u.emit=function(e,t){this.postMessage({type:"event",name:e,data:t})},s.loadModule(["worker",t],function(e){r=new e[n](u);while(a.messageBuffer.length)f()})};u.prototype=o.prototype,t.UIWorkerClient=u,t.WorkerClient=o}),define("ace/lib/keys",["require","exports","module","ace/lib/oop"],function(e,t,n){var r=e("./oop"),i=function(){var e={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,"super":8,meta:8,command:8,cmd:8},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}},t,n;for(n in e.FUNCTION_KEYS)t=e.FUNCTION_KEYS[n].toLowerCase(),e[t]=parseInt(n,10);for(n in e.PRINTABLE_KEYS)t=e.PRINTABLE_KEYS[n].toLowerCase(),e[t]=parseInt(n,10);return r.mixin(e,e.MODIFIER_KEYS),r.mixin(e,e.PRINTABLE_KEYS),r.mixin(e,e.FUNCTION_KEYS),e.enter=e["return"],e.escape=e.esc,e.del=e["delete"],e[173]="-",function(){var t=["cmd","ctrl","alt","shift"];for(var n=Math.pow(2,t.length);n--;)e.KEY_MODS[n]=t.filter(function(t){return n&e.KEY_MODS[t]}).join("-")+"-"}(),e}();r.mixin(t,i),t.keyCodeToString=function(e){return(i[e]||String.fromCharCode(e)).toLowerCase()}}),define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],function(e,t,n){var r=e("./range").Range,i=e("./lib/event_emitter").EventEmitter,s=e("./lib/oop"),o=function(e,t,n,r,i,s){var o=this;this.length=t,this.session=e,this.doc=e.getDocument(),this.mainClass=i,this.othersClass=s,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=r,this.$onCursorChange=function(){setTimeout(function(){o.onCursorChange()})},this.$pos=n;var u=e.getUndoManager().$undoStack||e.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=u.length,this.setup(),e.selection.on("changeCursor",this.$onCursorChange)};(function(){s.implement(this,i),this.setup=function(){var e=this,t=this.doc,n=this.session,i=this.$pos;this.pos=t.createAnchor(i.row,i.column),this.markerId=n.addMarker(new r(i.row,i.column,i.row,i.column+this.length),this.mainClass,null,!1),this.pos.on("change",function(t){n.removeMarker(e.markerId),e.markerId=n.addMarker(new r(t.value.row,t.value.column,t.value.row,t.value.column+e.length),e.mainClass,null,!1)}),this.others=[],this.$others.forEach(function(n){var r=t.createAnchor(n.row,n.column);e.others.push(r)}),n.setUndoSelect(!1)},this.showOtherMarkers=function(){if(this.othersActive)return;var e=this.session,t=this;this.othersActive=!0,this.others.forEach(function(n){n.markerId=e.addMarker(new r(n.row,n.column,n.row,n.column+t.length),t.othersClass,null,!1),n.on("change",function(i){e.removeMarker(n.markerId),n.markerId=e.addMarker(new r(i.value.row,i.value.column,i.value.row,i.value.column+t.length),t.othersClass,null,!1)})})},this.hideOtherMarkers=function(){if(!this.othersActive)return;this.othersActive=!1;for(var e=0;e<this.others.length;e++)this.session.removeMarker(this.others[e].markerId)},this.onUpdate=function(e){var t=e.data,n=t.range;if(n.start.row!==n.end.row)return;if(n.start.row!==this.pos.row)return;if(this.$updating)return;this.$updating=!0;var i=t.action==="insertText"?n.end.column-n.start.column:n.start.column-n.end.column;if(n.start.column>=this.pos.column&&n.start.column<=this.pos.column+this.length+1){var s=n.start.column-this.pos.column;this.length+=i;if(!this.session.$fromUndo){if(t.action==="insertText")for(var o=this.others.length-1;o>=0;o--){var u=this.others[o],a={row:u.row,column:u.column+s};u.row===n.start.row&&n.start.column<u.column&&(a.column+=i),this.doc.insert(a,t.text)}else if(t.action==="removeText")for(var o=this.others.length-1;o>=0;o--){var u=this.others[o],a={row:u.row,column:u.column+s};u.row===n.start.row&&n.start.column<u.column&&(a.column+=i),this.doc.remove(new r(a.row,a.column,a.row,a.column-i))}n.start.column===this.pos.column&&t.action==="insertText"?setTimeout(function(){this.pos.setPosition(this.pos.row,this.pos.column-i);for(var e=0;e<this.others.length;e++){var t=this.others[e],r={row:t.row,column:t.column-i};t.row===n.start.row&&n.start.column<t.column&&(r.column+=i),t.setPosition(r.row,r.column)}}.bind(this),0):n.start.column===this.pos.column&&t.action==="removeText"&&setTimeout(function(){for(var e=0;e<this.others.length;e++){var t=this.others[e];t.row===n.start.row&&n.start.column<t.column&&t.setPosition(t.row,t.column-i)}}.bind(this),0)}this.pos._emit("change",{value:this.pos});for(var o=0;o<this.others.length;o++)this.others[o]._emit("change",{value:this.others[o]})}this.$updating=!1},this.onCursorChange=function(e){if(this.$updating)return;var t=this.session.selection.getCursor();t.row===this.pos.row&&t.column>=this.pos.column&&t.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",e)):(this.hideOtherMarkers(),this._emit("cursorLeave",e))},this.detach=function(){this.session.removeMarker(this.markerId),this.hideOtherMarkers(),this.doc.removeEventListener("change",this.$onUpdate),this.session.selection.removeEventListener("changeCursor",this.$onCursorChange),this.pos.detach();for(var e=0;e<this.others.length;e++)this.others[e].detach();this.session.setUndoSelect(!0)},this.cancel=function(){if(this.$undoStackDepth===-1)throw Error("Canceling placeholders only supported with undo manager attached to session.");var e=this.session.getUndoManager(),t=(e.$undoStack||e.$undostack).length-this.$undoStackDepth;for(var n=0;n<t;n++)e.undo(!0)}}).call(o.prototype),t.PlaceHolder=o}),define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(e,t,n){function o(e,t,n){var o=s(t);if(!i.isMac&&u){if(u[91]||u[92])o|=8;if(u.altGr){if((3&o)==3)return;u.altGr=0}if(n===18||n===17){var f=t.location||t.keyLocation;if(n===17&&f===1)a=t.timeStamp;else if(n===18&&o===3&&f===2){var l=-a;a=t.timeStamp,l+=a,l<3&&(u.altGr=!0)}}}if(n in r.MODIFIER_KEYS){switch(r.MODIFIER_KEYS[n]){case"Alt":o=2;break;case"Shift":o=4;break;case"Ctrl":o=1;break;default:o=8}n=-1}o&8&&(n===91||n===93)&&(n=-1);if(!o&&n===13)if(t.location||t.keyLocation===3){e(t,o,-n);if(t.defaultPrevented)return}return!!o||n in r.FUNCTION_KEYS||n in r.PRINTABLE_KEYS?e(t,o,n):!1}var r=e("./keys"),i=e("./useragent");t.addListener=function(e,t,n){if(e.addEventListener)return e.addEventListener(t,n,!1);if(e.attachEvent){var r=function(){n.call(e,window.event)};n._wrapper=r,e.attachEvent("on"+t,r)}},t.removeListener=function(e,t,n){if(e.removeEventListener)return e.removeEventListener(t,n,!1);e.detachEvent&&e.detachEvent("on"+t,n._wrapper||n)},t.stopEvent=function(e){return t.stopPropagation(e),t.preventDefault(e),!1},t.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},t.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},t.getButton=function(e){return e.type=="dblclick"?0:e.type=="contextmenu"||e.ctrlKey&&i.isMac?2:e.preventDefault?e.button:{1:0,2:2,4:1}[e.button]},t.capture=function(e,n,r){function i(e){n&&n(e),r&&r(e),t.removeListener(document,"mousemove",n,!0),t.removeListener(document,"mouseup",i,!0),t.removeListener(document,"dragstart",i,!0)}return t.addListener(document,"mousemove",n,!0),t.addListener(document,"mouseup",i,!0),t.addListener(document,"dragstart",i,!0),i},t.addMouseWheelListener=function(e,n){"onmousewheel"in e?t.addListener(e,"mousewheel",function(e){var t=8;e.wheelDeltaX!==undefined?(e.wheelX=-e.wheelDeltaX/t,e.wheelY=-e.wheelDeltaY/t):(e.wheelX=0,e.wheelY=-e.wheelDelta/t),n(e)}):"onwheel"in e?t.addListener(e,"wheel",function(e){var t=.35;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=e.deltaX*t||0,e.wheelY=e.deltaY*t||0;break;case e.DOM_DELTA_LINE:case e.DOM_DELTA_PAGE:e.wheelX=(e.deltaX||0)*5,e.wheelY=(e.deltaY||0)*5}n(e)}):t.addListener(e,"DOMMouseScroll",function(e){e.axis&&e.axis==e.HORIZONTAL_AXIS?(e.wheelX=(e.detail||0)*5,e.wheelY=0):(e.wheelX=0,e.wheelY=(e.detail||0)*5),n(e)})},t.addMultiMouseDownListener=function(e,n,r,s){var o=0,u,a,f,l={2:"dblclick",3:"tripleclick",4:"quadclick"};t.addListener(e,"mousedown",function(e){t.getButton(e)!==0?o=0:e.detail>1?(o++,o>4&&(o=1)):o=1;if(i.isIE){var n=Math.abs(e.clientX-u)>5||Math.abs(e.clientY-a)>5;n&&(o=1),o==1&&(u=e.clientX,a=e.clientY)}r[s]("mousedown",e);if(o>4)o=0;else if(o>1)return r[s](l[o],e)}),i.isOldIE&&t.addListener(e,"dblclick",function(e){o=2,f&&clearTimeout(f),f=setTimeout(function(){f=null},n[o-1]||600),r[s]("mousedown",e),r[s](l[o],e)})};var s=!i.isMac||!i.isOpera||"KeyboardEvent"in window?function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)}:function(e){return 0|(e.metaKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.ctrlKey?8:0)};t.getModifierString=function(e){return r.KEY_MODS[s(e)]};var u=null,a=0;t.addCommandKeyListener=function(e,n){var r=t.addListener;if(i.isOldGecko||i.isOpera&&!("KeyboardEvent"in window)){var s=null;r(e,"keydown",function(e){s=e.keyCode}),r(e,"keypress",function(e){return o(n,e,s)})}else{var a=null;r(e,"keydown",function(e){u[e.keyCode]=!0;var t=o(n,e,e.keyCode);return a=e.defaultPrevented,t}),r(e,"keypress",function(e){a&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&&(t.stopEvent(e),a=null)}),r(e,"keyup",function(e){u[e.keyCode]=null}),u||(u=Object.create(null),r(window,"focus",function(e){u=Object.create(null)}))}};if(window.postMessage&&!i.isOldIE){var f=1;t.nextTick=function(e,n){n=n||window;var r="zero-timeout-message-"+f;t.addListener(n,"message",function i(s){s.data==r&&(t.stopPropagation(s),t.removeListener(n,"message",i),e())}),n.postMessage(r,"*")}}t.nextFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,t.nextFrame?t.nextFrame=t.nextFrame.bind(window):t.nextFrame=function(e){setTimeout(e,17)}}),define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(e,t,n){var r=e("../../range").Range,i=t.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(e,t,n){var r=e.getLine(n);return this.foldingStartMarker.test(r)?"start":t=="markbeginend"&&this.foldingStopMarker&&this.foldingStopMarker.test(r)?"end":""},this.getFoldWidgetRange=function(e,t,n){return null},this.indentationBlock=function(e,t,n){var i=/\S/,s=e.getLine(t),o=s.search(i);if(o==-1)return;var u=n||s.length,a=e.getLength(),f=t,l=t;while(++t<a){var c=e.getLine(t).search(i);if(c==-1)continue;if(c<=o)break;l=t}if(l>f){var h=e.getLine(l).length;return new r(f,u,l,h)}},this.openingBracketBlock=function(e,t,n,i,s){var o={row:n,column:i+1},u=e.$findClosingBracket(t,o,s);if(!u)return;var a=e.foldWidgets[u.row];return a==null&&(a=e.getFoldWidget(u.row)),a=="start"&&u.row>o.row&&(u.row--,u.column=e.getLine(u.row).length),r.fromPoints(o,u)},this.closingBracketBlock=function(e,t,n,i,s){var o={row:n,column:i},u=e.$findOpeningBracket(t,o);if(!u)return;return u.column++,o.column--,r.fromPoints(u,o)}}).call(i.prototype)}),define("ace/lib/dom",["require","exports","module"],function(e,t,n){if(typeof document=="undefined")return;var r="http://www.w3.org/1999/xhtml";t.getDocumentHead=function(e){return e||(e=document),e.head||e.getElementsByTagName("head")[0]||e.documentElement},t.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||r,e):document.createElement(e)},t.hasCssClass=function(e,t){var n=e.className.split(/\s+/g);return n.indexOf(t)!==-1},t.addCssClass=function(e,n){t.hasCssClass(e,n)||(e.className+=" "+n)},t.removeCssClass=function(e,t){var n=e.className.split(/\s+/g);for(;;){var r=n.indexOf(t);if(r==-1)break;n.splice(r,1)}e.className=n.join(" ")},t.toggleCssClass=function(e,t){var n=e.className.split(/\s+/g),r=!0;for(;;){var i=n.indexOf(t);if(i==-1)break;r=!1,n.splice(i,1)}return r&&n.push(t),e.className=n.join(" "),r},t.setCssClass=function(e,n,r){r?t.addCssClass(e,n):t.removeCssClass(e,n)},t.hasCssString=function(e,t){var n=0,r;t=t||document;if(t.createStyleSheet&&(r=t.styleSheets)){while(n<r.length)if(r[n++].owningElement.id===e)return!0}else if(r=t.getElementsByTagName("style"))while(n<r.length)if(r[n++].id===e)return!0;return!1},t.importCssString=function(n,i,s){s=s||document;if(i&&t.hasCssString(i,s))return null;var o;s.createStyleSheet?(o=s.createStyleSheet(),o.cssText=n,i&&(o.owningElement.id=i)):(o=s.createElementNS?s.createElementNS(r,"style"):s.createElement("style"),o.appendChild(s.createTextNode(n)),i&&(o.id=i),t.getDocumentHead(s).appendChild(o))},t.importCssStylsheet=function(e,n){if(n.createStyleSheet)n.createStyleSheet(e);else{var r=t.createElement("link");r.rel="stylesheet",r.href=e,t.getDocumentHead(n).appendChild(r)}},t.getInnerWidth=function(e){return parseInt(t.computedStyle(e,"paddingLeft"),10)+parseInt(t.computedStyle(e,"paddingRight"),10)+e.clientWidth},t.getInnerHeight=function(e){return parseInt(t.computedStyle(e,"paddingTop"),10)+parseInt(t.computedStyle(e,"paddingBottom"),10)+e.clientHeight},window.pageYOffset!==undefined?(t.getPageScrollTop=function(){return window.pageYOffset},t.getPageScrollLeft=function(){return window.pageXOffset}):(t.getPageScrollTop=function(){return document.body.scrollTop},t.getPageScrollLeft=function(){return document.body.scrollLeft}),window.getComputedStyle?t.computedStyle=function(e,t){return t?(window.getComputedStyle(e,"")||{})[t]||"":window.getComputedStyle(e,"")||{}}:t.computedStyle=function(e,t){return t?e.currentStyle[t]:e.currentStyle},t.scrollbarWidth=function(e){var n=t.createElement("ace_inner");n.style.width="100%",n.style.minWidth="0px",n.style.height="200px",n.style.display="block";var r=t.createElement("ace_outer"),i=r.style;i.position="absolute",i.left="-10000px",i.overflow="hidden",i.width="200px",i.minWidth="0px",i.height="150px",i.display="block",r.appendChild(n);var s=e.documentElement;s.appendChild(r);var o=n.offsetWidth;i.overflow="scroll";var u=n.offsetWidth;return o==u&&(u=r.clientWidth),s.removeChild(r),o-u},t.setInnerHtml=function(e,t){var n=e.cloneNode(!1);return n.innerHTML=t,e.parentNode.replaceChild(n,e),n},"textContent"in document.documentElement?(t.setInnerText=function(e,t){e.textContent=t},t.getInnerText=function(e){return e.textContent}):(t.setInnerText=function(e,t){e.innerText=t},t.getInnerText=function(e){return e.innerText}),t.getParentWindow=function(e){return e.defaultView||e.parentWindow}}),define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],function(e,t,n){t.isDark=!1,t.cssClass="ace-tm",t.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;border-radius: 2px;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}';var r=e("../lib/dom");r.importCssString(t.cssText,t.cssClass)}),define("ace/lib/es5-shim",["require","exports","module"],function(e,t,n){function r(){}function w(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){}}function H(e){return e=+e,e!==e?e=0:e!==0&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function B(e){var t=typeof e;return e===null||t==="undefined"||t==="boolean"||t==="number"||t==="string"}function j(e){var t,n,r;if(B(e))return e;n=e.valueOf;if(typeof n=="function"){t=n.call(e);if(B(t))return t}r=e.toString;if(typeof r=="function"){t=r.call(e);if(B(t))return t}throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new TypeError("Function.prototype.bind called on incompatible "+n);var i=u.call(arguments,1),s=function(){if(this instanceof s){var e=n.apply(this,i.concat(u.call(arguments)));return Object(e)===e?e:this}return n.apply(t,i.concat(u.call(arguments)))};return n.prototype&&(r.prototype=n.prototype,s.prototype=new r,r.prototype=null),s});var i=Function.prototype.call,s=Array.prototype,o=Object.prototype,u=s.slice,a=i.bind(o.toString),f=i.bind(o.hasOwnProperty),l,c,h,p,d;if(d=f(o,"__defineGetter__"))l=i.bind(o.__defineGetter__),c=i.bind(o.__defineSetter__),h=i.bind(o.__lookupGetter__),p=i.bind(o.__lookupSetter__);if([1,2].splice(0).length!=2)if(!function(){function e(e){var t=new Array(e+2);return t[0]=t[1]=0,t}var t=[],n;t.splice.apply(t,e(20)),t.splice.apply(t,e(26)),n=t.length,t.splice(5,0,"XXX"),n+1==t.length;if(n+1==t.length)return!0}())Array.prototype.splice=function(e,t){var n=this.length;e>0?e>n&&(e=n):e==void 0?e=0:e<0&&(e=Math.max(n+e,0)),e+t<n||(t=n-e);var r=this.slice(e,e+t),i=u.call(arguments,2),s=i.length;if(e===n)s&&this.push.apply(this,i);else{var o=Math.min(t,n-e),a=e+o,f=a+s-o,l=n-a,c=n-o;if(f<a)for(var h=0;h<l;++h)this[f+h]=this[a+h];else if(f>a)for(h=l;h--;)this[f+h]=this[a+h];if(s&&e===c)this.length=c,this.push.apply(this,i);else{this.length=c+s;for(h=0;h<s;++h)this[e+h]=i[h]}}return r};else{var v=Array.prototype.splice;Array.prototype.splice=function(e,t){return arguments.length?v.apply(this,[e===void 0?0:e,t===void 0?this.length-e:t].concat(u.call(arguments,2))):[]}}Array.isArray||(Array.isArray=function(t){return a(t)=="[object Array]"});var m=Object("a"),g=m[0]!="a"||!(0 in m);Array.prototype.forEach||(Array.prototype.forEach=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=arguments[1],s=-1,o=r.length>>>0;if(a(t)!="[object Function]")throw new TypeError;while(++s<o)s in r&&t.call(i,r[s],s,n)}),Array.prototype.map||(Array.prototype.map=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=r.length>>>0,s=Array(i),o=arguments[1];if(a(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var u=0;u<i;u++)u in r&&(s[u]=t.call(o,r[u],u,n));return s}),Array.prototype.filter||(Array.prototype.filter=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=r.length>>>0,s=[],o,u=arguments[1];if(a(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var f=0;f<i;f++)f in r&&(o=r[f],t.call(u,o,f,n)&&s.push(o));return s}),Array.prototype.every||(Array.prototype.every=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=r.length>>>0,s=arguments[1];if(a(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var o=0;o<i;o++)if(o in r&&!t.call(s,r[o],o,n))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=r.length>>>0,s=arguments[1];if(a(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var o=0;o<i;o++)if(o in r&&t.call(s,r[o],o,n))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=r.length>>>0;if(a(t)!="[object Function]")throw new TypeError(t+" is not a function");if(!i&&arguments.length==1)throw new TypeError("reduce of empty array with no initial value");var s=0,o;if(arguments.length>=2)o=arguments[1];else do{if(s in r){o=r[s++];break}if(++s>=i)throw new TypeError("reduce of empty array with no initial value")}while(!0);for(;s<i;s++)s in r&&(o=t.call(void 0,o,r[s],s,n));return o}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(t){var n=F(this),r=g&&a(this)=="[object String]"?this.split(""):n,i=r.length>>>0;if(a(t)!="[object Function]")throw new TypeError(t+" is not a function");if(!i&&arguments.length==1)throw new TypeError("reduceRight of empty array with no initial value");var s,o=i-1;if(arguments.length>=2)s=arguments[1];else do{if(o in r){s=r[o--];break}if(--o<0)throw new TypeError("reduceRight of empty array with no initial value")}while(!0);do o in this&&(s=t.call(void 0,s,r[o],o,n));while(o--);return s});if(!Array.prototype.indexOf||[0,1].indexOf(1,2)!=-1)Array.prototype.indexOf=function(t){var n=g&&a(this)=="[object String]"?this.split(""):F(this),r=n.length>>>0;if(!r)return-1;var i=0;arguments.length>1&&(i=H(arguments[1])),i=i>=0?i:Math.max(0,r+i);for(;i<r;i++)if(i in n&&n[i]===t)return i;return-1};if(!Array.prototype.lastIndexOf||[0,1].lastIndexOf(0,-3)!=-1)Array.prototype.lastIndexOf=function(t){var n=g&&a(this)=="[object String]"?this.split(""):F(this),r=n.length>>>0;if(!r)return-1;var i=r-1;arguments.length>1&&(i=Math.min(i,H(arguments[1]))),i=i>=0?i:r-Math.abs(i);for(;i>=0;i--)if(i in n&&t===n[i])return i;return-1};Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__||(t.constructor?t.constructor.prototype:o)});if(!Object.getOwnPropertyDescriptor){var y="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(t,n){if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError(y+t);if(!f(t,n))return;var r,i,s;r={enumerable:!0,configurable:!0};if(d){var u=t.__proto__;t.__proto__=o;var i=h(t,n),s=p(t,n);t.__proto__=u;if(i||s)return i&&(r.get=i),s&&(r.set=s),r}return r.value=t[n],r}}Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(t){return Object.keys(t)});if(!Object.create){var b;Object.prototype.__proto__===null?b=function(){return{__proto__:null}}:b=function(){var e={};for(var t in e)e[t]=null;return e.constructor=e.hasOwnProperty=e.propertyIsEnumerable=e.isPrototypeOf=e.toLocaleString=e.toString=e.valueOf=e.__proto__=null,e},Object.create=function(t,n){var r;if(t===null)r=b();else{if(typeof t!="object")throw new TypeError("typeof prototype["+typeof t+"] != 'object'");var i=function(){};i.prototype=t,r=new i,r.__proto__=t}return n!==void 0&&Object.defineProperties(r,n),r}}if(Object.defineProperty){var E=w({}),S=typeof document=="undefined"||w(document.createElement("div"));if(!E||!S)var x=Object.defineProperty}if(!Object.defineProperty||x){var T="Property description must be an object: ",N="Object.defineProperty called on non-object: ",C="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(t,n,r){if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError(N+t);if(typeof r!="object"&&typeof r!="function"||r===null)throw new TypeError(T+r);if(x)try{return x.call(Object,t,n,r)}catch(i){}if(f(r,"value"))if(d&&(h(t,n)||p(t,n))){var s=t.__proto__;t.__proto__=o,delete t[n],t[n]=r.value,t.__proto__=s}else t[n]=r.value;else{if(!d)throw new TypeError(C);f(r,"get")&&l(t,n,r.get),f(r,"set")&&c(t,n,r.set)}return t}}Object.defineProperties||(Object.defineProperties=function(t,n){for(var r in n)f(n,r)&&Object.defineProperty(t,r,n[r]);return t}),Object.seal||(Object.seal=function(t){return t}),Object.freeze||(Object.freeze=function(t){return t});try{Object.freeze(function(){})}catch(k){Object.freeze=function(t){return function(n){return typeof n=="function"?n:t(n)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(t){return t}),Object.isSealed||(Object.isSealed=function(t){return!1}),Object.isFrozen||(Object.isFrozen=function(t){return!1}),Object.isExtensible||(Object.isExtensible=function(t){if(Object(t)===t)throw new TypeError;var n="";while(f(t,n))n+="?";t[n]=!0;var r=f(t,n);return delete t[n],r});if(!Object.keys){var L=!0,A=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],O=A.length;for(var M in{toString:null})L=!1;Object.keys=function I(e){if(typeof e!="object"&&typeof e!="function"||e===null)throw new TypeError("Object.keys called on a non-object");var I=[];for(var t in e)f(e,t)&&I.push(t);if(L)for(var n=0,r=O;n<r;n++){var i=A[n];f(e,i)&&I.push(i)}return I}}Date.now||(Date.now=function(){return(new Date).getTime()});var _="	\n\f\r \u2028\u2029";if(!String.prototype.trim||_.trim()){_="["+_+"]";var D=new RegExp("^"+_+_+"*"),P=new RegExp(_+_+"*$");String.prototype.trim=function(){return String(this).replace(D,"").replace(P,"")}}var F=function(e){if(e==null)throw new TypeError("can't convert "+e+" to object");return Object(e)}}),define("ace/lib/regexp",["require","exports","module"],function(e,t,n){function o(e){return(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":"")}function u(e,t,n){if(Array.prototype.indexOf)return e.indexOf(t,n);for(var r=n||0;r<e.length;r++)if(e[r]===t)return r;return-1}var r={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},i=r.exec.call(/()??/,"")[1]===undefined,s=function(){var e=/^/g;return r.test.call(e,""),!e.lastIndex}();if(s&&i)return;RegExp.prototype.exec=function(e){var t=r.exec.apply(this,arguments),n,a;if(typeof e=="string"&&t){!i&&t.length>1&&u(t,"")>-1&&(a=RegExp(this.source,r.replace.call(o(this),"g","")),r.replace.call(e.slice(t.index),a,function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===undefined&&(t[e]=undefined)}));if(this._xregexp&&this._xregexp.captureNames)for(var f=1;f<t.length;f++)n=this._xregexp.captureNames[f-1],n&&(t[n]=t[f]);!s&&this.global&&!t[0].length&&this.lastIndex>t.index&&this.lastIndex--}return t},s||(RegExp.prototype.test=function(e){var t=r.exec.call(this,e);return t&&this.global&&!t[0].length&&this.lastIndex>t.index&&this.lastIndex--,!!t})}),define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],function(e,t,n){function o(e,t,n){var r=0,i=e.length-1;while(r<=i){var s=r+i>>1,o=n(t,e[s]);if(o>0)r=s+1;else{if(!(o<0))return s;i=s-1}}return-(r+1)}function u(e,t,n){var r=e.getAnnotations().sort(s.comparePoints);if(!r.length)return;var i=o(r,{row:t,column:-1},s.comparePoints);i<0&&(i=-i-1),i>=r.length-1?i=n>0?0:r.length-1:i===0&&n<0&&(i=r.length-1);var u=r[i];if(!u||!n)return;if(u.row===t){do u=r[i+=n];while(u&&u.row===t);if(!u)return r.slice()}var a=[];t=u.row;do a[n<0?"unshift":"push"](u),u=r[i+=n];while(u&&u.row==t);return a.length&&a}var r=e("ace/line_widgets").LineWidgets,i=e("ace/lib/dom"),s=e("ace/range").Range;t.showErrorMarker=function(e,t){var n=e.session;n.widgetManager||(n.widgetManager=new r(n),n.widgetManager.attach(e));var s=e.getCursorPosition(),o=s.row,a=n.lineWidgets&&n.lineWidgets[o];a?a.destroy():o-=t;var f=u(n,o,t),l;if(f){var c=f[0];s.column=(c.pos&&typeof c.column!="number"?c.pos.sc:c.column)||0,s.row=c.row,l=e.renderer.$gutterLayer.$annotations[s.row]}else{if(a)return;l={text:["Looks good!"],className:"ace_ok"}}e.session.unfold(s.row),e.selection.moveToPosition(s);var h={row:s.row,fixedWidth:!0,coverGutter:!0,el:i.createElement("div")},p=h.el.appendChild(i.createElement("div")),d=h.el.appendChild(i.createElement("div"));d.className="error_widget_arrow "+l.className;var v=e.renderer.$cursorLayer.getPixelPosition(s).left;d.style.left=v+e.renderer.gutterWidth-5+"px",h.el.className="error_widget_wrapper",p.className="error_widget "+l.className,p.innerHTML=l.text.join("<br>"),p.appendChild(i.createElement("div"));var m=function(e,t,n){if(t===0&&(n==="esc"||n==="return"))return h.destroy(),{command:"null"}};h.destroy=function(){if(e.$mouseHandler.isMousePressed)return;e.keyBinding.removeKeyboardHandler(m),n.widgetManager.removeLineWidget(h),e.off("changeSelection",h.destroy),e.off("changeSession",h.destroy),e.off("mouseup",h.destroy),e.off("change",h.destroy)},e.keyBinding.addKeyboardHandler(m),e.on("changeSelection",h.destroy),e.on("changeSession",h.destroy),e.on("mouseup",h.destroy),e.on("change",h.destroy),e.session.widgetManager.addLineWidget(h),h.el.onmousedown=e.focus.bind(e),e.renderer.scrollCursorIntoView(null,.5,{bottom:h.el.offsetHeight})},i.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","")}),define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/regexp","ace/lib/es5-shim"],function(e,t,n){e("./regexp"),e("./es5-shim")}),define("ace/line_widgets",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/range"],function(e,t,n){function o(e){this.session=e,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.detach=this.detach.bind(this),this.session.on("change",this.updateOnChange)}var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./range").Range;(function(){this.getRowLength=function(e){var t;return this.lineWidgets?t=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0:t=0,!this.$useWrapMode||!this.$wrapData[e]?1+t:this.$wrapData[e].length+1+t},this.$getWidgetScreenLength=function(){var e=0;return this.lineWidgets.forEach(function(t){t&&t.rowCount&&(e+=t.rowCount)}),e},this.attach=function(e){e.widgetManager&&e.widgetManager!=this&&e.widgetManager.detach();if(this.editor==e)return;this.detach(),this.editor=e,this.editor.on("changeSession",this.detach),e.widgetManager=this,e.setOption("enableLineWidgets",!0),e.renderer.on("beforeRender",this.measureWidgets),e.renderer.on("afterRender",this.renderWidgets)},this.detach=function(e){if(e&&e.session==this.session)return;var t=this.editor;if(!t)return;t.off("changeSession",this.detach),this.editor=null,t.widgetManager=null,t.renderer.off("beforeRender",this.measureWidgets),t.renderer.off("afterRender",this.renderWidgets);var n=this.session.lineWidgets;n&&n.forEach(function(e){e&&e.el&&e.el.parentNode&&(e._inDocument=!1,e.el.parentNode.removeChild(e.el))})},this.updateOnChange=function(e){var t=this.session.lineWidgets;if(!t)return;var n=e.data,r=n.range,i=r.start.row,s=r.end.row-i;if(s!==0)if(n.action=="removeText"||n.action=="removeLines"){var o=t.splice(i+1,s);o.forEach(function(e){e&&this.removeLineWidget(e)},this),this.$updateRows()}else{var u=new Array(s);u.unshift(i,0),t.splice.apply(t,u),this.$updateRows()}},this.$updateRows=function(){var e=this.session.lineWidgets;if(!e)return;var t=!0;e.forEach(function(e,n){e&&(t=!1,e.row=n)}),t&&(this.session.lineWidgets=null)},this.addLineWidget=function(e){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength())),this.session.lineWidgets[e.row]=e;var t=this.editor.renderer;return e.html&&!e.el&&(e.el=i.createElement("div"),e.el.innerHTML=e.html),e.el&&(i.addCssClass(e.el,"ace_lineWidgetContainer"),e.el.style.position="absolute",e.el.style.zIndex=5,t.container.appendChild(e.el),e._inDocument=!0),e.coverGutter||(e.el.style.zIndex=3),e.pixelHeight||(e.pixelHeight=e.el.offsetHeight),e.rowCount==null&&(e.rowCount=e.pixelHeight/t.layerConfig.lineHeight),this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows(),this.renderWidgets(null,t),e},this.removeLineWidget=function(e){e._inDocument=!1,e.el&&e.el.parentNode&&e.el.parentNode.removeChild(e.el);if(e.editor&&e.editor.destroy)try{e.editor.destroy()}catch(t){}this.session.lineWidgets&&(this.session.lineWidgets[e.row]=undefined),this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows()},this.onWidgetChanged=function(e){this.session._changedWidgets.push(e),this.editor&&this.editor.renderer.updateFull()},this.measureWidgets=function(e,t){var n=this.session._changedWidgets,r=t.layerConfig;if(!n||!n.length)return;var i=Infinity;for(var s=0;s<n.length;s++){var o=n[s];o._inDocument||(o._inDocument=!0,t.container.appendChild(o.el)),o.h=o.el.offsetHeight,o.fixedWidth||(o.w=o.el.offsetWidth,o.screenWidth=Math.ceil(o.w/r.characterWidth));var u=o.h/r.lineHeight;o.coverLine&&(u-=this.session.getRowLineCount(o.row),u<0&&(u=0)),o.rowCount!=u&&(o.rowCount=u,o.row<i&&(i=o.row))}i!=Infinity&&(this.session._emit("changeFold",{data:{start:{row:i}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]},this.renderWidgets=function(e,t){var n=t.layerConfig,r=this.session.lineWidgets;if(!r)return;var i=Math.min(this.firstRow,n.firstRow),s=Math.max(this.lastRow,n.lastRow,r.length);while(i>0&&!r[i])i--;this.firstRow=n.firstRow,this.lastRow=n.lastRow,t.$cursorLayer.config=n;for(var o=i;o<=s;o++){var u=r[o];if(!u||!u.el)continue;u._inDocument||(u._inDocument=!0,t.container.appendChild(u.el));var a=t.$cursorLayer.getPixelPosition({row:o,column:0},!0).top;u.coverLine||(a+=n.lineHeight*this.session.getRowLineCount(u.row)),u.el.style.top=a-n.offset+"px";var f=u.coverGutter?0:t.gutterWidth;u.fixedWidth||(f-=t.scrollLeft),u.el.style.left=f+"px",u.fixedWidth?u.el.style.right=t.scrollBar.getWidth()+"px":u.el.style.right=""}}}).call(o.prototype),t.LineWidgets=o}),define("ace/document",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/range","ace/anchor"],function(e,t,n){var r=e("./lib/oop"),i=e("./lib/event_emitter").EventEmitter,s=e("./range").Range,o=e("./anchor").Anchor,u=function(e){this.$lines=[],e.length===0?this.$lines=[""]:Array.isArray(e)?this._insertLines(0,e):this.insert({row:0,column:0},e)};(function(){r.implement(this,i),this.setValue=function(e){var t=this.getLength();this.remove(new s(0,0,t,this.getLine(t-1).length)),this.insert({row:0,column:0},e)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(e,t){return new o(this,e,t)},"aaa".split(/a/).length===0?this.$split=function(e){return e.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(e){return e.split(/\r\n|\r|\n/)},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=t?t[1]:"\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(e){if(this.$newLineMode===e)return;this.$newLineMode=e,this._signal("changeNewLineMode")},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(e){return e=="\r\n"||e=="\r"||e=="\n"},this.getLine=function(e){return this.$lines[e]||""},this.getLines=function(e,t){return this.$lines.slice(e,t+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(e){if(e.start.row==e.end.row)return this.getLine(e.start.row).substring(e.start.column,e.end.column);var t=this.getLines(e.start.row,e.end.row);t[0]=(t[0]||"").substring(e.start.column);var n=t.length-1;return e.end.row-e.start.row==n&&(t[n]=t[n].substring(0,e.end.column)),t.join(this.getNewLineCharacter())},this.$clipPosition=function(e){var t=this.getLength();return e.row>=t?(e.row=Math.max(0,t-1),e.column=this.getLine(t-1).length):e.row<0&&(e.row=0),e},this.insert=function(e,t){if(!t||t.length===0)return e;e=this.$clipPosition(e),this.getLength()<=1&&this.$detectNewLine(t);var n=this.$split(t),r=n.splice(0,1)[0],i=n.length==0?null:n.splice(n.length-1,1)[0];return e=this.insertInLine(e,r),i!==null&&(e=this.insertNewLine(e),e=this._insertLines(e.row,n),e=this.insertInLine(e,i||"")),e},this.insertLines=function(e,t){return e>=this.getLength()?this.insert({row:e,column:0},"\n"+t.join("\n")):this._insertLines(Math.max(e,0),t)},this._insertLines=function(e,t){if(t.length==0)return{row:e,column:0};while(t.length>61440){var n=this._insertLines(e,t.slice(0,61440));t=t.slice(61440),e=n.row}var r=[e,0];r.push.apply(r,t),this.$lines.splice.apply(this.$lines,r);var i=new s(e,0,e+t.length,0),o={action:"insertLines",range:i,lines:t};return this._signal("change",{data:o}),i.end},this.insertNewLine=function(e){e=this.$clipPosition(e);var t=this.$lines[e.row]||"";this.$lines[e.row]=t.substring(0,e.column),this.$lines.splice(e.row+1,0,t.substring(e.column,t.length));var n={row:e.row+1,column:0},r={action:"insertText",range:s.fromPoints(e,n),text:this.getNewLineCharacter()};return this._signal("change",{data:r}),n},this.insertInLine=function(e,t){if(t.length==0)return e;var n=this.$lines[e.row]||"";this.$lines[e.row]=n.substring(0,e.column)+t+n.substring(e.column);var r={row:e.row,column:e.column+t.length},i={action:"insertText",range:s.fromPoints(e,r),text:t};return this._signal("change",{data:i}),r},this.remove=function(e){e instanceof s||(e=s.fromPoints(e.start,e.end)),e.start=this.$clipPosition(e.start),e.end=this.$clipPosition(e.end);if(e.isEmpty())return e.start;var t=e.start.row,n=e.end.row;if(e.isMultiLine()){var r=e.start.column==0?t:t+1,i=n-1;e.end.column>0&&this.removeInLine(n,0,e.end.column),i>=r&&this._removeLines(r,i),r!=t&&(this.removeInLine(t,e.start.column,this.getLine(t).length),this.removeNewLine(e.start.row))}else this.removeInLine(t,e.start.column,e.end.column);return e.start},this.removeInLine=function(e,t,n){if(t==n)return;var r=new s(e,t,e,n),i=this.getLine(e),o=i.substring(t,n),u=i.substring(0,t)+i.substring(n,i.length);this.$lines.splice(e,1,u);var a={action:"removeText",range:r,text:o};return this._signal("change",{data:a}),r.start},this.removeLines=function(e,t){return e<0||t>=this.getLength()?this.remove(new s(e,0,t+1,0)):this._removeLines(e,t)},this._removeLines=function(e,t){var n=new s(e,0,t+1,0),r=this.$lines.splice(e,t-e+1),i={action:"removeLines",range:n,nl:this.getNewLineCharacter(),lines:r};return this._signal("change",{data:i}),r},this.removeNewLine=function(e){var t=this.getLine(e),n=this.getLine(e+1),r=new s(e,t.length,e+1,0),i=t+n;this.$lines.splice(e,2,i);var o={action:"removeText",range:r,text:this.getNewLineCharacter()};this._signal("change",{data:o})},this.replace=function(e,t){e instanceof s||(e=s.fromPoints(e.start,e.end));if(t.length==0&&e.isEmpty())return e.start;if(t==this.getTextRange(e))return e.end;this.remove(e);if(t)var n=this.insert(e.start,t);else n=e.start;return n},this.applyDeltas=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=s.fromPoints(n.range.start,n.range.end);n.action=="insertLines"?this.insertLines(r.start.row,n.lines):n.action=="insertText"?this.insert(r.start,n.text):n.action=="removeLines"?this._removeLines(r.start.row,r.end.row-1):n.action=="removeText"&&this.remove(r)}},this.revertDeltas=function(e){for(var t=e.length-1;t>=0;t--){var n=e[t],r=s.fromPoints(n.range.start,n.range.end);n.action=="insertLines"?this._removeLines(r.start.row,r.end.row-1):n.action=="insertText"?this.remove(r):n.action=="removeLines"?this._insertLines(r.start.row,n.lines):n.action=="removeText"&&this.insert(r.start,n.text)}},this.indexToPosition=function(e,t){var n=this.$lines||this.getAllLines(),r=this.getNewLineCharacter().length;for(var i=t||0,s=n.length;i<s;i++){e-=n[i].length+r;if(e<0)return{row:i,column:e+n[i].length+r}}return{row:s-1,column:n[s-1].length}},this.positionToIndex=function(e,t){var n=this.$lines||this.getAllLines(),r=this.getNewLineCharacter().length,i=0,s=Math.min(e.row,n.length);for(var o=t||0;o<s;++o)i+=n[o].length+r;return i+e.column}}).call(u.prototype),t.Document=u}),function(){window.require(["ace/ace"],function(e){e&&e.config.init(!0),window.ace||(window.ace=e);for(var t in e)e.hasOwnProperty(t)&&(ace[t]=e[t])})}(),define("thirdparty/ace/ace",function(){}),define("ace/mode/html",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/javascript","ace/mode/css","ace/tokenizer","ace/mode/html_highlight_rules","ace/mode/behaviour/html","ace/mode/folding/html","ace/mode/html_completions","ace/worker/worker_client"],function(e,t,n){var r=e("../lib/oop"),i=e("./text").Mode,s=e("./javascript").Mode,o=e("./css").Mode,u=e("../tokenizer").Tokenizer,a=e("./html_highlight_rules").HtmlHighlightRules,f=e("./behaviour/html").HtmlBehaviour,l=e("./folding/html").FoldMode,c=e("./html_completions").HtmlCompletions,h=e("../worker/worker_client").WorkerClient,p=function(e){this.fragmentContext=e&&e.fragmentContext,this.HighlightRules=a,this.$behaviour=new f,this.$completer=new c,this.createModeDelegates({"js-":s,"css-":o}),this.foldingRules=new l};r.inherits(p,i),function(){this.blockComment={start:"<!--",end:"-->"},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1},this.getCompletions=function(e,t,n,r){return this.$completer.getCompletions(e,t,n,r)},this.createWorker=function(e){if(this.constructor!=p)return;var t=new h(["ace"],"ace/mode/html_worker","Worker");return t.attachToDocument(e.getDocument()),this.fragmentContext&&t.call("setOptions",[{context:this.fragmentContext}]),t.on("error",function(t){e.setAnnotations(t.data)}),t.on("terminate",function(){e.clearAnnotations()}),t},this.$id="ace/mode/html"}.call(p.prototype),t.Mode=p}),define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],function(e,t,n){var r=e("../../lib/oop"),i=e("../../range").Range,s=e("./fold_mode").FoldMode,o=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};r.inherits(o,s),function(){this.foldingStartMarker=/(\{|\[)[^\}\]]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{]*(\}|\])|^[\s\*]*(\*\/)/,this.getFoldWidgetRange=function(e,t,n,r){var i=e.getLine(n),s=i.match(this.foldingStartMarker);if(s){var o=s.index;if(s[1])return this.openingBracketBlock(e,s[1],n,o);var u=e.getCommentFoldRange(n,o+s[0].length,1);return u&&!u.isMultiLine()&&(r?u=this.getSectionRange(e,n):t!="all"&&(u=null)),u}if(t==="markbegin")return;var s=i.match(this.foldingStopMarker);if(s){var o=s.index+s[0].length;return s[1]?this.closingBracketBlock(e,s[1],n,o):e.getCommentFoldRange(n,o,-1)}},this.getSectionRange=function(e,t){var n=e.getLine(t),r=n.search(/\S/),s=t,o=n.length;t+=1;var u=t,a=e.getLength();while(++t<a){n=e.getLine(t);var f=n.search(/\S/);if(f===-1)continue;if(r>f)break;var l=this.getFoldWidgetRange(e,"all",t);if(l){if(l.start.row<=s)break;if(l.isMultiLine())t=l.end.row;else if(r==f)break}u=t}return new i(s,o,u,e.getLine(u).length)}}.call(o.prototype)}),define("ace/mode/css",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/css_highlight_rules","ace/mode/matching_brace_outdent","ace/worker/worker_client","ace/mode/behaviour/css","ace/mode/folding/cstyle"],function(e,t,n){var r=e("../lib/oop"),i=e("./text").Mode,s=e("../tokenizer").Tokenizer,o=e("./css_highlight_rules").CssHighlightRules,u=e("./matching_brace_outdent").MatchingBraceOutdent,a=e("../worker/worker_client").WorkerClient,f=e("./behaviour/css").CssBehaviour,l=e("./folding/cstyle").FoldMode,c=function(){this.HighlightRules=o,this.$outdent=new u,this.$behaviour=new f,this.foldingRules=new l};r.inherits(c,i),function(){this.foldingRules="cStyle",this.blockComment={start:"/*",end:"*/"},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t),i=this.getTokenizer().getLineTokens(t,e).tokens;if(i.length&&i[i.length-1].type=="comment")return r;var s=t.match(/^.*\{\s*$/);return s&&(r+=n),r},this.checkOutdent=function(e,t,n){return this.$outdent.checkOutdent(t,n)},this.autoOutdent=function(e,t,n){this.$outdent.autoOutdent(t,n)},this.createWorker=function(e){var t=new a(["ace"],"ace/mode/css_worker","Worker");return t.attachToDocument(e.getDocument()),t.on("csslint",function(t){e.setAnnotations(t.data)}),t.on("terminate",function(){e.clearAnnotations()}),t},this.$id="ace/mode/css"}.call(c.prototype),t.Mode=c}),define("ace/mode/css_highlight_rules",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/mode/text_highlight_rules"],function(e,t,n){var r=e("../lib/oop"),i=e("../lib/lang"),s=e("./text_highlight_rules").TextHighlightRules,o=t.supportType="animation-fill-mode|alignment-adjust|alignment-baseline|animation-delay|animation-direction|animation-duration|animation-iteration-count|animation-name|animation-play-state|animation-timing-function|animation|appearance|azimuth|backface-visibility|background-attachment|background-break|background-clip|background-color|background-image|background-origin|background-position|background-repeat|background-size|background|baseline-shift|binding|bleed|bookmark-label|bookmark-level|bookmark-state|bookmark-target|border-bottom|border-bottom-color|border-bottom-left-radius|border-bottom-right-radius|border-bottom-style|border-bottom-width|border-collapse|border-color|border-image|border-image-outset|border-image-repeat|border-image-slice|border-image-source|border-image-width|border-left|border-left-color|border-left-style|border-left-width|border-radius|border-right|border-right-color|border-right-style|border-right-width|border-spacing|border-style|border-top|border-top-color|border-top-left-radius|border-top-right-radius|border-top-style|border-top-width|border-width|border|bottom|box-align|box-decoration-break|box-direction|box-flex-group|box-flex|box-lines|box-ordinal-group|box-orient|box-pack|box-shadow|box-sizing|break-after|break-before|break-inside|caption-side|clear|clip|color-profile|color|column-count|column-fill|column-gap|column-rule|column-rule-color|column-rule-style|column-rule-width|column-span|column-width|columns|content|counter-increment|counter-reset|crop|cue-after|cue-before|cue|cursor|direction|display|dominant-baseline|drop-initial-after-adjust|drop-initial-after-align|drop-initial-before-adjust|drop-initial-before-align|drop-initial-size|drop-initial-value|elevation|empty-cells|fit|fit-position|float-offset|float|font-family|font-size|font-size-adjust|font-stretch|font-style|font-variant|font-weight|font|grid-columns|grid-rows|hanging-punctuation|height|hyphenate-after|hyphenate-before|hyphenate-character|hyphenate-lines|hyphenate-resource|hyphens|icon|image-orientation|image-rendering|image-resolution|inline-box-align|left|letter-spacing|line-height|line-stacking-ruby|line-stacking-shift|line-stacking-strategy|line-stacking|list-style-image|list-style-position|list-style-type|list-style|margin-bottom|margin-left|margin-right|margin-top|margin|mark-after|mark-before|mark|marks|marquee-direction|marquee-play-count|marquee-speed|marquee-style|max-height|max-width|min-height|min-width|move-to|nav-down|nav-index|nav-left|nav-right|nav-up|opacity|orphans|outline-color|outline-offset|outline-style|outline-width|outline|overflow-style|overflow-x|overflow-y|overflow|padding-bottom|padding-left|padding-right|padding-top|padding|page-break-after|page-break-before|page-break-inside|page-policy|page|pause-after|pause-before|pause|perspective-origin|perspective|phonemes|pitch-range|pitch|play-during|pointer-events|position|presentation-level|punctuation-trim|quotes|rendering-intent|resize|rest-after|rest-before|rest|richness|right|rotation-point|rotation|ruby-align|ruby-overhang|ruby-position|ruby-span|size|speak-header|speak-numeral|speak-punctuation|speak|speech-rate|stress|string-set|table-layout|target-name|target-new|target-position|target|text-align-last|text-align|text-decoration|text-emphasis|text-height|text-indent|text-justify|text-outline|text-shadow|text-transform|text-wrap|top|transform-origin|transform-style|transform|transition-delay|transition-duration|transition-property|transition-timing-function|transition|unicode-bidi|vertical-align|visibility|voice-balance|voice-duration|voice-family|voice-pitch-range|voice-pitch|voice-rate|voice-stress|voice-volume|volume|white-space-collapse|white-space|widows|width|word-break|word-spacing|word-wrap|z-index",u=t.supportFunction="rgb|rgba|url|attr|counter|counters",a=t.supportConstant="absolute|after-edge|after|all-scroll|all|alphabetic|always|antialiased|armenian|auto|avoid-column|avoid-page|avoid|balance|baseline|before-edge|before|below|bidi-override|block-line-height|block|bold|bolder|border-box|both|bottom|box|break-all|break-word|capitalize|caps-height|caption|center|central|char|circle|cjk-ideographic|clone|close-quote|col-resize|collapse|column|consider-shifts|contain|content-box|cover|crosshair|cubic-bezier|dashed|decimal-leading-zero|decimal|default|disabled|disc|disregard-shifts|distribute-all-lines|distribute-letter|distribute-space|distribute|dotted|double|e-resize|ease-in|ease-in-out|ease-out|ease|ellipsis|end|exclude-ruby|fill|fixed|georgian|glyphs|grid-height|groove|hand|hanging|hebrew|help|hidden|hiragana-iroha|hiragana|horizontal|icon|ideograph-alpha|ideograph-numeric|ideograph-parenthesis|ideograph-space|ideographic|inactive|include-ruby|inherit|initial|inline-block|inline-box|inline-line-height|inline-table|inline|inset|inside|inter-ideograph|inter-word|invert|italic|justify|katakana-iroha|katakana|keep-all|last|left|lighter|line-edge|line-through|line|linear|list-item|local|loose|lower-alpha|lower-greek|lower-latin|lower-roman|lowercase|lr-tb|ltr|mathematical|max-height|max-size|medium|menu|message-box|middle|move|n-resize|ne-resize|newspaper|no-change|no-close-quote|no-drop|no-open-quote|no-repeat|none|normal|not-allowed|nowrap|nw-resize|oblique|open-quote|outset|outside|overline|padding-box|page|pointer|pre-line|pre-wrap|pre|preserve-3d|progress|relative|repeat-x|repeat-y|repeat|replaced|reset-size|ridge|right|round|row-resize|rtl|s-resize|scroll|se-resize|separate|slice|small-caps|small-caption|solid|space|square|start|static|status-bar|step-end|step-start|steps|stretch|strict|sub|super|sw-resize|table-caption|table-cell|table-column-group|table-column|table-footer-group|table-header-group|table-row-group|table-row|table|tb-rl|text-after-edge|text-before-edge|text-bottom|text-size|text-top|text|thick|thin|transparent|underline|upper-alpha|upper-latin|upper-roman|uppercase|use-script|vertical-ideographic|vertical-text|visible|w-resize|wait|whitespace|z-index|zero",f=t.supportConstantColor="aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow",l=t.supportConstantFonts="arial|century|comic|courier|garamond|georgia|helvetica|impact|lucida|symbol|system|tahoma|times|trebuchet|utopia|verdana|webdings|sans-serif|serif|monospace",c=t.numRe="\\-?(?:(?:[0-9]+)|(?:[0-9]*\\.[0-9]+))",h=t.pseudoElements="(\\:+)\\b(after|before|first-letter|first-line|moz-selection|selection)\\b",p=t.pseudoClasses="(:)\\b(active|checked|disabled|empty|enabled|first-child|first-of-type|focus|hover|indeterminate|invalid|last-child|last-of-type|link|not|nth-child|nth-last-child|nth-last-of-type|nth-of-type|only-child|only-of-type|required|root|target|valid|visited)\\b",d=function(){var e=this.createKeywordMapper({"support.function":u,"support.constant":a,"support.type":o,"support.constant.color":f,"support.constant.fonts":l},"text",!0);this.$rules={start:[{token:"comment",regex:"\\/\\*",push:"comment"},{token:"paren.lparen",regex:"\\{",push:"ruleset"},{token:"string",regex:"@.*?{",push:"media"},{token:"keyword",regex:"#[a-z0-9-_]+"},{token:"variable",regex:"\\.[a-z0-9-_]+"},{token:"string",regex:":[a-z0-9-_]+"},{token:"constant",regex:"[a-z0-9-_]+"},{caseInsensitive:!0}],media:[{token:"comment",regex:"\\/\\*",push:"comment"},{token:"paren.lparen",regex:"\\{",push:"ruleset"},{token:"string",regex:"\\}",next:"pop"},{token:"keyword",regex:"#[a-z0-9-_]+"},{token:"variable",regex:"\\.[a-z0-9-_]+"},{token:"string",regex:":[a-z0-9-_]+"},{token:"constant",regex:"[a-z0-9-_]+"},{caseInsensitive:!0}],comment:[{token:"comment",regex:"\\*\\/",next:"pop"},{defaultToken:"comment"}],ruleset:[{token:"paren.rparen",regex:"\\}",next:"pop"},{token:"comment",regex:"\\/\\*",push:"comment"},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:["constant.numeric","keyword"],regex:"("+c+")(ch|cm|deg|em|ex|fr|gd|grad|Hz|in|kHz|mm|ms|pc|pt|px|rad|rem|s|turn|vh|vm|vw|%)"},{token:"constant.numeric",regex:c},{token:"constant.numeric",regex:"#[a-f0-9]{6}"},{token:"constant.numeric",regex:"#[a-f0-9]{3}"},{token:["punctuation","entity.other.attribute-name.pseudo-element.css"],regex:h},{token:["punctuation","entity.other.attribute-name.pseudo-class.css"],regex:p},{token:["support.function","string","support.function"],regex:"(url\\()(.*)(\\))"},{token:e,regex:"\\-?[a-zA-Z_][a-zA-Z0-9_\\-]*"},{caseInsensitive:!0}]},this.normalizeRules()};r.inherits(d,s),t.CssHighlightRules=d}),define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(e,t,n){var r=e("../../lib/oop"),i=e("../behaviour").Behaviour,s=e("../../token_iterator").TokenIterator,o=e("../../lib/lang"),u=["text","paren.rparen","punctuation.operator"],a=["text","paren.rparen","punctuation.operator","comment"],f,l={},c=function(e){var t=-1;e.multiSelect&&(t=e.selection.id,l.rangeCount!=e.multiSelect.rangeCount&&(l={rangeCount:e.multiSelect.rangeCount}));if(l[t])return f=l[t];f=l[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},h=function(){this.add("braces","insertion",function(e,t,n,r,i){var s=n.getCursorPosition(),u=r.doc.getLine(s.row);if(i=="{"){c(n);var a=n.getSelectionRange(),l=r.doc.getTextRange(a);if(l!==""&&l!=="{"&&n.getWrapBehavioursEnabled())return{text:"{"+l+"}",selection:!1};if(h.isSaneInsertion(n,r))return/[\]\}\)]/.test(u[s.column])||n.inMultiSelectMode?(h.recordAutoInsert(n,r,"}"),{text:"{}",selection:[1,1]}):(h.recordMaybeInsert(n,r,"{"),{text:"{",selection:[1,1]})}else if(i=="}"){c(n);var p=u.substring(s.column,s.column+1);if(p=="}"){var d=r.$findOpeningBracket("}",{column:s.column+1,row:s.row});if(d!==null&&h.isAutoInsertedClosing(s,u,i))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}else{if(i=="\n"||i=="\r\n"){c(n);var v="";h.isMaybeInsertedClosing(s,u)&&(v=o.stringRepeat("}",f.maybeInsertedBrackets),h.clearMaybeInsertedClosing());var p=u.substring(s.column,s.column+1);if(p==="}"){var m=r.findMatchingBracket({row:s.row,column:s.column+1},"}");if(!m)return null;var g=this.$getIndent(r.getLine(m.row))}else{if(!v){h.clearMaybeInsertedClosing();return}var g=this.$getIndent(u)}var y=g+r.getTabString();return{text:"\n"+y+"\n"+g+v,selection:[1,y.length,1,y.length]}}h.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s=="{"){c(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.end.column,i.end.column+1);if(u=="}")return i.end.column++,i;f.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,n,r,i){if(i=="("){c(n);var s=n.getSelectionRange(),o=r.doc.getTextRange(s);if(o!==""&&n.getWrapBehavioursEnabled())return{text:"("+o+")",selection:!1};if(h.isSaneInsertion(n,r))return h.recordAutoInsert(n,r,")"),{text:"()",selection:[1,1]}}else if(i==")"){c(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row),f=a.substring(u.column,u.column+1);if(f==")"){var l=r.$findOpeningBracket(")",{column:u.column+1,row:u.row});if(l!==null&&h.isAutoInsertedClosing(u,a,i))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("parens","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s=="("){c(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u==")")return i.end.column++,i}}),this.add("brackets","insertion",function(e,t,n,r,i){if(i=="["){c(n);var s=n.getSelectionRange(),o=r.doc.getTextRange(s);if(o!==""&&n.getWrapBehavioursEnabled())return{text:"["+o+"]",selection:!1};if(h.isSaneInsertion(n,r))return h.recordAutoInsert(n,r,"]"),{text:"[]",selection:[1,1]}}else if(i=="]"){c(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row),f=a.substring(u.column,u.column+1);if(f=="]"){var l=r.$findOpeningBracket("]",{column:u.column+1,row:u.row});if(l!==null&&h.isAutoInsertedClosing(u,a,i))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("brackets","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s=="["){c(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u=="]")return i.end.column++,i}}),this.add("string_dquotes","insertion",function(e,t,n,r,i){if(i=='"'||i=="'"){c(n);var s=i,o=n.getSelectionRange(),u=r.doc.getTextRange(o);if(u!==""&&u!=="'"&&u!='"'&&n.getWrapBehavioursEnabled())return{text:s+u+s,selection:!1};var a=n.getCursorPosition(),f=r.doc.getLine(a.row),l=f.substring(a.column-1,a.column);if(l=="\\")return null;var p=r.getTokens(o.start.row),d=0,v,m=-1;for(var g=0;g<p.length;g++){v=p[g],v.type=="string"?m=-1:m<0&&(m=v.value.indexOf(s));if(v.value.length+d>o.start.column)break;d+=p[g].value.length}if(!v||m<0&&v.type!=="comment"&&(v.type!=="string"||o.start.column!==v.value.length+d-1&&v.value.lastIndexOf(s)===v.value.length-1)){if(!h.isSaneInsertion(n,r))return;return{text:s+s,selection:[1,1]}}if(v&&v.type==="string"){var y=f.substring(a.column,a.column+1);if(y==s)return{text:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&(s=='"'||s=="'")){c(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u==s)return i.end.column++,i}})};h.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),r=new s(t,n.row,n.column);if(!this.$matchTokenType(r.getCurrentToken()||"text",u)){var i=new s(t,n.row,n.column+1);if(!this.$matchTokenType(i.getCurrentToken()||"text",u))return!1}return r.stepForward(),r.getCurrentTokenRow()!==n.row||this.$matchTokenType(r.getCurrentToken()||"text",a)},h.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},h.recordAutoInsert=function(e,t,n){var r=e.getCursorPosition(),i=t.doc.getLine(r.row);this.isAutoInsertedClosing(r,i,f.autoInsertedLineEnd[0])||(f.autoInsertedBrackets=0),f.autoInsertedRow=r.row,f.autoInsertedLineEnd=n+i.substr(r.column),f.autoInsertedBrackets++},h.recordMaybeInsert=function(e,t,n){var r=e.getCursorPosition(),i=t.doc.getLine(r.row);this.isMaybeInsertedClosing(r,i)||(f.maybeInsertedBrackets=0),f.maybeInsertedRow=r.row,f.maybeInsertedLineStart=i.substr(0,r.column)+n,f.maybeInsertedLineEnd=i.substr(r.column),f.maybeInsertedBrackets++},h.isAutoInsertedClosing=function(e,t,n){return f.autoInsertedBrackets>0&&e.row===f.autoInsertedRow&&n===f.autoInsertedLineEnd[0]&&t.substr(e.column)===f.autoInsertedLineEnd},h.isMaybeInsertedClosing=function(e,t){return f.maybeInsertedBrackets>0&&e.row===f.maybeInsertedRow&&t.substr(e.column)===f.maybeInsertedLineEnd&&t.substr(0,e.column)==f.maybeInsertedLineStart},h.popAutoInsertedClosing=function(){f.autoInsertedLineEnd=f.autoInsertedLineEnd.substr(1),f.autoInsertedBrackets--},h.clearMaybeInsertedClosing=function(){f&&(f.maybeInsertedBrackets=0,f.maybeInsertedRow=-1)},r.inherits(h,i),t.CstyleBehaviour=h}),define("ace/mode/html_highlight_rules",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/mode/css_highlight_rules","ace/mode/javascript_highlight_rules","ace/mode/xml_highlight_rules"],function(e,t,n){var r=e("../lib/oop"),i=e("../lib/lang"),s=e("./css_highlight_rules").CssHighlightRules,o=e("./javascript_highlight_rules").JavaScriptHighlightRules,u=e("./xml_highlight_rules").XmlHighlightRules,a=i.createMap({a:"anchor",button:"form",form:"form",img:"image",input:"form",label:"form",option:"form",script:"script",select:"form",textarea:"form",style:"style",table:"table",tbody:"table",td:"table",tfoot:"table",th:"table",tr:"table"}),f=function(){u.call(this),this.addRules({attributes:[{include:"space"},{token:"entity.other.attribute-name",regex:"[-_a-zA-Z0-9:]+"},{token:"keyword.operator.separator",regex:"=",push:[{include:"space"},{token:"string",regex:"[^<>='\"`\\s]+",next:"pop"},{token:"empty",regex:"",next:"pop"}]},{include:"string"}],tag:[{token:function(e,t){var n=a[t];return["meta.tag.punctuation.begin","meta.tag.name"+(n?"."+n:"")]},regex:"(<)([-_a-zA-Z0-9:]+)",next:"start_tag_stuff"},{token:function(e,t){var n=a[t];return["meta.tag.punctuation.begin","meta.tag.name"+(n?"."+n:"")]},regex:"(</)([-_a-zA-Z0-9:]+)",next:"end_tag_stuff"}],start_tag_stuff:[{include:"attributes"},{token:"meta.tag.punctuation.end",regex:"/?>",next:"start"}],end_tag_stuff:[{include:"space"},{token:"meta.tag.punctuation.end",regex:">",next:"start"}]}),this.embedTagRules(s,"css-","style"),this.embedTagRules(o,"js-","script"),this.constructor===f&&this.normalizeRules()};r.inherits(f,u),t.HtmlHighlightRules=f}),define("ace/mode/xml_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/xml_util","ace/mode/text_highlight_rules"],function(e,t,n){var r=e("../lib/oop"),i=e("./xml_util"),s=e("./text_highlight_rules").TextHighlightRules,o=function(e){this.$rules={start:[{token:"punctuation.string.begin",regex:"<\\!\\[CDATA\\[",next:"cdata"},{token:["punctuation.instruction.begin","keyword.instruction"],regex:"(<\\?)(xml)(?=[\\s])",next:"xml_declaration"},{token:["punctuation.instruction.begin","keyword.instruction"],regex:"(<\\?)([-_a-zA-Z0-9]+)",next:"instruction"},{token:"comment",regex:"<\\!--",next:"comment"},{token:["punctuation.doctype.begin","meta.tag.doctype"],regex:"(<\\!)(DOCTYPE)(?=[\\s])",next:"doctype"},{include:"tag"},{include:"reference"}],xml_declaration:[{include:"attributes"},{include:"instruction"}],instruction:[{token:"punctuation.instruction.end",regex:"\\?>",next:"start"}],doctype:[{include:"space"},{include:"string"},{token:"punctuation.doctype.end",regex:">",next:"start"},{token:"xml-pe",regex:"[-_a-zA-Z0-9:]+"},{token:"punctuation.begin",regex:"\\[",push:"declarations"}],declarations:[{token:"text",regex:"\\s+"},{token:"punctuation.end",regex:"]",next:"pop"},{token:["punctuation.begin","keyword"],regex:"(<\\!)([-_a-zA-Z0-9]+)",push:[{token:"text",regex:"\\s+"},{token:"punctuation.end",regex:">",next:"pop"},{include:"string"}]}],cdata:[{token:"string.end",regex:"\\]\\]>",next:"start"},{token:"text",regex:"\\s+"},{token:"text",regex:"(?:[^\\]]|\\](?!\\]>))+"}],comment:[{token:"comment",regex:"-->",next:"start"},{defaultToken:"comment"}],tag:[{token:["meta.tag.punctuation.begin","meta.tag.name"],regex:"(<)((?:[-_a-zA-Z0-9]+:)?[-_a-zA-Z0-9]+)",next:[{include:"attributes"},{token:"meta.tag.punctuation.end",regex:"/?>",next:"start"}]},{token:["meta.tag.punctuation.begin","meta.tag.name"],regex:"(</)((?:[-_a-zA-Z0-9]+:)?[-_a-zA-Z0-9]+)",next:[{include:"space"},{token:"meta.tag.punctuation.end",regex:">",next:"start"}]}],space:[{token:"text",regex:"\\s+"}],reference:[{token:"constant.language.escape",regex:"(?:&#[0-9]+;)|(?:&#x[0-9a-fA-F]+;)|(?:&[a-zA-Z0-9_:\\.-]+;)"},{token:"text",regex:"&"}],string:[{token:"string",regex:"'",push:"qstring_inner"},{token:"string",regex:'"',push:"qqstring_inner"}],qstring_inner:[{token:"string",regex:"'",next:"pop"},{include:"reference"},{defaultToken:"string"}],qqstring_inner:[{token:"string",regex:'"',next:"pop"},{include:"reference"},{defaultToken:"string"}],attributes:[{token:"entity.other.attribute-name",regex:"(?:[-_a-zA-Z0-9]+:)?[-_a-zA-Z0-9]+"},{token:"keyword.operator.separator",regex:"="},{include:"space"},{include:"string"}]},this.constructor===o&&this.normalizeRules()};(function(){this.embedTagRules=function(e,t,n){this.$rules.tag.unshift({token:["meta.tag.punctuation.begin","meta.tag.name."+n],regex:"(<)("+n+")",next:[{include:"space"},{include:"attributes"},{token:"meta.tag.punctuation.end",regex:"/?>",next:t+"start"}]}),this.$rules[n+"-end"]=[{include:"space"},{token:"meta.tag.punctuation.end",regex:">",next:"start",onMatch:function(e,t,n){return n.splice(0),this.token}}],this.embedRules(e,t,[{token:["meta.tag.punctuation.begin","meta.tag.name."+n],regex:"(</)("+n+")",next:n+"-end"},{token:"string.begin",regex:"<\\!\\[CDATA\\["},{token:"string.end",regex:"\\]\\]>"}])}}).call(s.prototype),r.inherits(o,s),t.XmlHighlightRules=o}),define("ace/mode/xml_util",["require","exports","module"],function(e,t,n){function r(e){return[{token:"string",regex:'"',next:e+"_qqstring"},{token:"string",regex:"'",next:e+"_qstring"}]}function i(e,t){return[{token:"string",regex:e,next:t},{token:"constant.language.escape",regex:"(?:&#[0-9]+;)|(?:&#x[0-9a-fA-F]+;)|(?:&[a-zA-Z0-9_:\\.-]+;)"},{defaultToken:"string"}]}t.tag=function(e,t,n,s){e[t]=[{token:"text",regex:"\\s+"},{token:s?function(e){return s[e]?"meta.tag.tag-name."+s[e]:"meta.tag.tag-name"}:"meta.tag.tag-name",regex:"[-_a-zA-Z0-9:]+",next:t+"_embed_attribute_list"},{token:"empty",regex:"",next:t+"_embed_attribute_list"}],e[t+"_qstring"]=i("'",t+"_embed_attribute_list"),e[t+"_qqstring"]=i('"',t+"_embed_attribute_list"),e[t+"_embed_attribute_list"]=[{token:"meta.tag.r",regex:"/?>",next:n},{token:"keyword.operator",regex:"="},{token:"entity.other.attribute-name",regex:"[-_a-zA-Z0-9:]+"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"text",regex:"\\s+"}].concat(r(t))}}),define("ace/mode/behaviour/html",["require","exports","module","ace/lib/oop","ace/mode/behaviour/xml","ace/mode/behaviour/cstyle","ace/token_iterator"],function(e,t,n){function a(e,t){var n=e.type.split(".");return t.split(".").every(function(e){return n.indexOf(e)!==-1})}var r=e("../../lib/oop"),i=e("../behaviour/xml").XmlBehaviour,s=e("./cstyle").CstyleBehaviour,o=e("../../token_iterator").TokenIterator,u=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],f=function(){this.inherit(i),this.add("autoclosing","insertion",function(e,t,n,r,i){if(i==">"){var s=n.getCursorPosition(),f=new o(r,s.row,s.column),l=f.getCurrentToken();if(l&&a(l,"string")&&f.getCurrentTokenColumn()+l.value.length>s.column)return;var c=!1;if(!l||!a(l,"meta.tag")&&(!a(l,"text")||!l.value.match("/"))){do l=f.stepBackward();while(l&&(a(l,"string")||a(l,"keyword.operator")||a(l,"entity.attribute-name")||a(l,"text")))}else c=!0;if(!l||!a(l,"meta.tag.name")||f.stepBackward().value.match("/"))return;var h=l.value;if(c)var h=h.substring(0,s.column-l.start);if(u.indexOf(h)!==-1)return;return{text:"></"+h+">",selection:[1,1]}}})};r.inherits(f,i),t.HtmlBehaviour=f}),define("ace/mode/behaviour/xml",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/mode/behaviour/cstyle","ace/token_iterator"],function(e,t,n){function u(e,t){var n=e.type.split(".");return t.split(".").every(function(e){return n.indexOf(e)!==-1})}var r=e("../../lib/oop"),i=e("../behaviour").Behaviour,s=e("./cstyle").CstyleBehaviour,o=e("../../token_iterator").TokenIterator,a=function(){this.inherit(s,["string_dquotes"]),this.add("autoclosing","insertion",function(e,t,n,r,i){if(i==">"){var s=n.getCursorPosition(),a=new o(r,s.row,s.column),f=a.getCurrentToken();if(f&&u(f,"string")&&a.getCurrentTokenColumn()+f.value.length>s.column)return;var l=!1;if(!f||!u(f,"meta.tag")&&(!u(f,"text")||!f.value.match("/"))){do f=a.stepBackward();while(f&&(u(f,"string")||u(f,"keyword.operator")||u(f,"entity.attribute-name")||u(f,"text")))}else l=!0;if(!f||!u(f,"meta.tag.name")||a.stepBackward().value.match("/"))return;var c=f.value;if(l)var c=c.substring(0,s.column-f.start);return{text:"></"+c+">",selection:[1,1]}}}),this.add("autoindent","insertion",function(e,t,n,r,i){if(i=="\n"){var s=n.getCursorPosition(),o=r.getLine(s.row),u=o.substring(s.column,s.column+2);if(u=="</"){var a=this.$getIndent(o),f=a+r.getTabString();return{text:"\n"+f+"\n"+a,selection:[1,f.length,1,f.length]}}}})};r.inherits(a,i),t.XmlBehaviour=a}),define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],function(e,t,n){var r=e("../range").Range,i=function(){};(function(){this.checkOutdent=function(e,t){return/^\s+$/.test(e)?/^\s*\}/.test(t):!1},this.autoOutdent=function(e,t){var n=e.getLine(t),i=n.match(/^(\s*\})/);if(!i)return 0;var s=i[1].length,o=e.findMatchingBracket({row:t,column:s});if(!o||o.row==t)return 0;var u=this.$getIndent(e.getLine(o.row));e.replace(new r(t,0,t,s-1),u)},this.$getIndent=function(e){return e.match(/^\s*/)[0]}}).call(i.prototype),t.MatchingBraceOutdent=i}),define("ace/mode/folding/html",["require","exports","module","ace/lib/oop","ace/mode/folding/mixed","ace/mode/folding/xml","ace/mode/folding/cstyle"],function(e,t,n){var r=e("../../lib/oop"),i=e("./mixed").FoldMode,s=e("./xml").FoldMode,o=e("./cstyle").FoldMode,u=t.FoldMode=function(){i.call(this,new s({area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1,li:1,dt:1,dd:1,p:1,rt:1,rp:1,optgroup:1,option:1,colgroup:1,td:1,th:1}),{"js-":new o,"css-":new o})};r.inherits(u,i)}),define("ace/mode/doc_comment_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,n){var r=e("../lib/oop"),i=e("./text_highlight_rules").TextHighlightRules,s=function(){this.$rules={start:[{token:"comment.doc.tag",regex:"@[\\w\\d_]+"},{token:"comment.doc.tag",regex:"\\bTODO\\b"},{defaultToken:"comment.doc"}]}};r.inherits(s,i),s.getStartRule=function(e){return{token:"comment.doc",regex:"\\/\\*(?=\\*)",next:e}},s.getEndRule=function(e){return{token:"comment.doc",regex:"\\*\\/",next:e}},t.DocCommentHighlightRules=s}),define("ace/mode/folding/mixed",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(e,t,n){var r=e("../../lib/oop"),i=e("./fold_mode").FoldMode,s=t.FoldMode=function(e,t){this.defaultMode=e,this.subModes=t};r.inherits(s,i),function(){this.$getMode=function(e){typeof e!="string"&&(e=e[0]);for(var t in this.subModes)if(e.indexOf(t)===0)return this.subModes[t];return null},this.$tryMode=function(e,t,n,r){var i=this.$getMode(e);return i?i.getFoldWidget(t,n,r):""},this.getFoldWidget=function(e,t,n){return this.$tryMode(e.getState(n-1),e,t,n)||this.$tryMode(e.getState(n),e,t,n)||this.defaultMode.getFoldWidget(e,t,n)},this.getFoldWidgetRange=function(e,t,n){var r=this.$getMode(e.getState(n-1));if(!r||!r.getFoldWidget(e,t,n))r=this.$getMode(e.getState(n));if(!r||!r.getFoldWidget(e,t,n))r=this.defaultMode;return r.getFoldWidgetRange(e,t,n)}}.call(s.prototype)}),define("ace/mode/javascript_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/doc_comment_highlight_rules","ace/mode/text_highlight_rules"],function(e,t,n){var r=e("../lib/oop"),i=e("./doc_comment_highlight_rules").DocCommentHighlightRules,s=e("./text_highlight_rules").TextHighlightRules,o=function(){var e=this.createKeywordMapper({"variable.language":"Array|Boolean|Date|Function|Iterator|Number|Object|RegExp|String|Proxy|Namespace|QName|XML|XMLList|ArrayBuffer|Float32Array|Float64Array|Int16Array|Int32Array|Int8Array|Uint16Array|Uint32Array|Uint8Array|Uint8ClampedArray|Error|EvalError|InternalError|RangeError|ReferenceError|StopIteration|SyntaxError|TypeError|URIError|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|eval|isFinite|isNaN|parseFloat|parseInt|JSON|Math|this|arguments|prototype|window|document",keyword:"const|yield|import|get|set|break|case|catch|continue|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|let|var|while|with|debugger|__parent__|__count__|escape|unescape|with|__proto__|class|enum|extends|super|export|implements|private|public|interface|package|protected|static","storage.type":"const|let|var|function","constant.language":"null|Infinity|NaN|undefined","support.function":"alert","constant.language.boolean":"true|false"},"identifier"),t="case|do|else|finally|in|instanceof|return|throw|try|typeof|yield|void",n="[a-zA-Z\\$_-][a-zA-Z\\d\\$_-]*\\b",r="\\\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|[0-2][0-7]{0,2}|3[0-6][0-7]?|37[0-7]?|[4-7][0-7]?|.)";this.$rules={no_regex:[{token:"comment",regex:"\\/\\/",next:"line_comment"},i.getStartRule("doc-start"),{token:"comment",regex:/\/\*/,next:"comment"},{token:"string",regex:"'(?=.)",next:"qstring"},{token:"string",regex:'"(?=.)',next:"qqstring"},{token:"constant.numeric",regex:/0[xX][0-9a-fA-F]+\b/},{token:"constant.numeric",regex:/[+-]?\d+(?:(?:\.\d*)?(?:[eE][+-]?\d+)?)?\b/},{token:["storage.type","punctuation.operator","support.function","punctuation.operator","entity.name.function","text","keyword.operator"],regex:"("+n+")(\\.)(prototype)(\\.)("+n+")(\\s*)(=)",next:"function_arguments"},{token:["storage.type","punctuation.operator","entity.name.function","text","keyword.operator","text","storage.type","text","paren.lparen"],regex:"("+n+")(\\.)("+n+")(\\s*)(=)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:["entity.name.function","text","keyword.operator","text","storage.type","text","paren.lparen"],regex:"("+n+")(\\s*)(=)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:["storage.type","punctuation.operator","entity.name.function","text","keyword.operator","text","storage.type","text","entity.name.function","text","paren.lparen"],regex:"("+n+")(\\.)("+n+")(\\s*)(=)(\\s*)(function)(\\s+)(\\w+)(\\s*)(\\()",next:"function_arguments"},{token:["storage.type","text","entity.name.function","text","paren.lparen"],regex:"(function)(\\s+)("+n+")(\\s*)(\\()",next:"function_arguments"},{token:["entity.name.function","text","punctuation.operator","text","storage.type","text","paren.lparen"],regex:"("+n+")(\\s*)(:)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:["text","text","storage.type","text","paren.lparen"],regex:"(:)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:"keyword",regex:"(?:"+t+")\\b",next:"start"},{token:["punctuation.operator","support.function"],regex:/(\.)(s(?:h(?:ift|ow(?:Mod(?:elessDialog|alDialog)|Help))|croll(?:X|By(?:Pages|Lines)?|Y|To)?|t(?:op|rike)|i(?:n|zeToContent|debar|gnText)|ort|u(?:p|b(?:str(?:ing)?)?)|pli(?:ce|t)|e(?:nd|t(?:Re(?:sizable|questHeader)|M(?:i(?:nutes|lliseconds)|onth)|Seconds|Ho(?:tKeys|urs)|Year|Cursor|Time(?:out)?|Interval|ZOptions|Date|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Date|FullYear)|FullYear|Active)|arch)|qrt|lice|avePreferences|mall)|h(?:ome|andleEvent)|navigate|c(?:har(?:CodeAt|At)|o(?:s|n(?:cat|textual|firm)|mpile)|eil|lear(?:Timeout|Interval)?|a(?:ptureEvents|ll)|reate(?:StyleSheet|Popup|EventObject))|t(?:o(?:GMTString|S(?:tring|ource)|U(?:TCString|pperCase)|Lo(?:caleString|werCase))|est|a(?:n|int(?:Enabled)?))|i(?:s(?:NaN|Finite)|ndexOf|talics)|d(?:isableExternalCapture|ump|etachEvent)|u(?:n(?:shift|taint|escape|watch)|pdateCommands)|j(?:oin|avaEnabled)|p(?:o(?:p|w)|ush|lugins.refresh|a(?:ddings|rse(?:Int|Float)?)|r(?:int|ompt|eference))|e(?:scape|nableExternalCapture|val|lementFromPoint|x(?:p|ec(?:Script|Command)?))|valueOf|UTC|queryCommand(?:State|Indeterm|Enabled|Value)|f(?:i(?:nd|le(?:ModifiedDate|Size|CreatedDate|UpdatedDate)|xed)|o(?:nt(?:size|color)|rward)|loor|romCharCode)|watch|l(?:ink|o(?:ad|g)|astIndexOf)|a(?:sin|nchor|cos|t(?:tachEvent|ob|an(?:2)?)|pply|lert|b(?:s|ort))|r(?:ou(?:nd|teEvents)|e(?:size(?:By|To)|calc|turnValue|place|verse|l(?:oad|ease(?:Capture|Events)))|andom)|g(?:o|et(?:ResponseHeader|M(?:i(?:nutes|lliseconds)|onth)|Se(?:conds|lection)|Hours|Year|Time(?:zoneOffset)?|Da(?:y|te)|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Da(?:y|te)|FullYear)|FullYear|A(?:ttention|llResponseHeaders)))|m(?:in|ove(?:B(?:y|elow)|To(?:Absolute)?|Above)|ergeAttributes|a(?:tch|rgins|x))|b(?:toa|ig|o(?:ld|rderWidths)|link|ack))\b(?=\()/},{token:["punctuation.operator","support.function.dom"],regex:/(\.)(s(?:ub(?:stringData|mit)|plitText|e(?:t(?:NamedItem|Attribute(?:Node)?)|lect))|has(?:ChildNodes|Feature)|namedItem|c(?:l(?:ick|o(?:se|neNode))|reate(?:C(?:omment|DATASection|aption)|T(?:Head|extNode|Foot)|DocumentFragment|ProcessingInstruction|E(?:ntityReference|lement)|Attribute))|tabIndex|i(?:nsert(?:Row|Before|Cell|Data)|tem)|open|delete(?:Row|C(?:ell|aption)|T(?:Head|Foot)|Data)|focus|write(?:ln)?|a(?:dd|ppend(?:Child|Data))|re(?:set|place(?:Child|Data)|move(?:NamedItem|Child|Attribute(?:Node)?)?)|get(?:NamedItem|Element(?:sBy(?:Name|TagName)|ById)|Attribute(?:Node)?)|blur)\b(?=\()/},{token:["punctuation.operator","support.constant"],regex:/(\.)(s(?:ystemLanguage|cr(?:ipts|ollbars|een(?:X|Y|Top|Left))|t(?:yle(?:Sheets)?|atus(?:Text|bar)?)|ibling(?:Below|Above)|ource|uffixes|e(?:curity(?:Policy)?|l(?:ection|f)))|h(?:istory|ost(?:name)?|as(?:h|Focus))|y|X(?:MLDocument|SLDocument)|n(?:ext|ame(?:space(?:s|URI)|Prop))|M(?:IN_VALUE|AX_VALUE)|c(?:haracterSet|o(?:n(?:structor|trollers)|okieEnabled|lorDepth|mp(?:onents|lete))|urrent|puClass|l(?:i(?:p(?:boardData)?|entInformation)|osed|asses)|alle(?:e|r)|rypto)|t(?:o(?:olbar|p)|ext(?:Transform|Indent|Decoration|Align)|ags)|SQRT(?:1_2|2)|i(?:n(?:ner(?:Height|Width)|put)|ds|gnoreCase)|zIndex|o(?:scpu|n(?:readystatechange|Line)|uter(?:Height|Width)|p(?:sProfile|ener)|ffscreenBuffering)|NEGATIVE_INFINITY|d(?:i(?:splay|alog(?:Height|Top|Width|Left|Arguments)|rectories)|e(?:scription|fault(?:Status|Ch(?:ecked|arset)|View)))|u(?:ser(?:Profile|Language|Agent)|n(?:iqueID|defined)|pdateInterval)|_content|p(?:ixelDepth|ort|ersonalbar|kcs11|l(?:ugins|atform)|a(?:thname|dding(?:Right|Bottom|Top|Left)|rent(?:Window|Layer)?|ge(?:X(?:Offset)?|Y(?:Offset)?))|r(?:o(?:to(?:col|type)|duct(?:Sub)?|mpter)|e(?:vious|fix)))|e(?:n(?:coding|abledPlugin)|x(?:ternal|pando)|mbeds)|v(?:isibility|endor(?:Sub)?|Linkcolor)|URLUnencoded|P(?:I|OSITIVE_INFINITY)|f(?:ilename|o(?:nt(?:Size|Family|Weight)|rmName)|rame(?:s|Element)|gColor)|E|whiteSpace|l(?:i(?:stStyleType|n(?:eHeight|kColor))|o(?:ca(?:tion(?:bar)?|lName)|wsrc)|e(?:ngth|ft(?:Context)?)|a(?:st(?:M(?:odified|atch)|Index|Paren)|yer(?:s|X)|nguage))|a(?:pp(?:MinorVersion|Name|Co(?:deName|re)|Version)|vail(?:Height|Top|Width|Left)|ll|r(?:ity|guments)|Linkcolor|bove)|r(?:ight(?:Context)?|e(?:sponse(?:XML|Text)|adyState))|global|x|m(?:imeTypes|ultiline|enubar|argin(?:Right|Bottom|Top|Left))|L(?:N(?:10|2)|OG(?:10E|2E))|b(?:o(?:ttom|rder(?:Width|RightWidth|BottomWidth|Style|Color|TopWidth|LeftWidth))|ufferDepth|elow|ackground(?:Color|Image)))\b/},{token:["storage.type","punctuation.operator","support.function.firebug"],regex:/(console)(\.)(warn|info|log|error|time|timeEnd|assert)\b/},{token:e,regex:n},{token:"keyword.operator",regex:/--|\+\+|[!$%&*+\-~]|===|==|=|!=|!==|<=|>=|<<=|>>=|>>>=|<>|<|>|!|&&|\|\||\?\:|\*=|%=|\+=|\-=|&=|\^=/,next:"start"},{token:"punctuation.operator",regex:/\?|\:|\,|\;|\./,next:"start"},{token:"paren.lparen",regex:/[\[({]/,next:"start"},{token:"paren.rparen",regex:/[\])}]/},{token:"keyword.operator",regex:/\/=?/,next:"start"},{token:"comment",regex:/^#!.*$/}],start:[i.getStartRule("doc-start"),{token:"comment",regex:"\\/\\*",next:"comment_regex_allowed"},{token:"comment",regex:"\\/\\/",next:"line_comment_regex_allowed"},{token:"string.regexp",regex:"\\/",next:"regex"},{token:"text",regex:"\\s+|^$",next:"start"},{token:"empty",regex:"",next:"no_regex"}],regex:[{token:"regexp.keyword.operator",regex:"\\\\(?:u[\\da-fA-F]{4}|x[\\da-fA-F]{2}|.)"},{token:"string.regexp",regex:"/[sxngimy]*",next:"no_regex"},{token:"invalid",regex:/\{\d+\b,?\d*\}[+*]|[+*$^?][+*]|[$^][?]|\?{3,}/},{token:"constant.language.escape",regex:/\(\?[:=!]|\)|\{\d+\b,?\d*\}|[+*]\?|[()$^+*?.]/},{token:"constant.language.delimiter",regex:/\|/},{token:"constant.language.escape",regex:/\[\^?/,next:"regex_character_class"},{token:"empty",regex:"$",next:"no_regex"},{defaultToken:"string.regexp"}],regex_character_class:[{token:"regexp.keyword.operator",regex:"\\\\(?:u[\\da-fA-F]{4}|x[\\da-fA-F]{2}|.)"},{token:"constant.language.escape",regex:"]",next:"regex"},{token:"constant.language.escape",regex:"-"},{token:"empty",regex:"$",next:"no_regex"},{defaultToken:"string.regexp.charachterclass"}],function_arguments:[{token:"variable.parameter",regex:n},{token:"punctuation.operator",regex:"[, ]+"},{token:"punctuation.operator",regex:"$"},{token:"empty",regex:"",next:"no_regex"}],comment_regex_allowed:[{token:"comment",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}],comment:[{token:"comment",regex:"\\*\\/",next:"no_regex"},{defaultToken:"comment"}],line_comment_regex_allowed:[{token:"comment",regex:"$|^",next:"start"},{defaultToken:"comment"}],line_comment:[{token:"comment",regex:"$|^",next:"no_regex"},{defaultToken:"comment"}],qqstring:[{token:"constant.language.escape",regex:r},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"no_regex"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:r},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"no_regex"},{defaultToken:"string"}]},this.embedRules(i,"doc-",[i.getEndRule("no_regex")])};r.inherits(o,s),t.JavaScriptHighlightRules=o}),define("ace/mode/folding/xml",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/range","ace/mode/folding/fold_mode","ace/token_iterator"],function(e,t,n){var r=e("../../lib/oop"),i=e("../../lib/lang"),s=e("../../range").Range,o=e("./fold_mode").FoldMode,u=e("../../token_iterator").TokenIterator,a=t.FoldMode=function(e){o.call(this),this.voidElements=e||{}};r.inherits(a,o),function(){this.getFoldWidget=function(e,t,n){var r=this._getFirstTagInLine(e,n);return r.closing?t=="markbeginend"?"end":"":!r.tagName||this.voidElements[r.tagName.toLowerCase()]?"":r.selfClosing?"":r.value.indexOf("/"+r.tagName)!==-1?"":"start"},this._getFirstTagInLine=function(e,t){var n=e.getTokens(t),r="";for(var s=0;s<n.length;s++){var o=n[s];o.type.lastIndexOf("meta.tag",0)===0?r+=o.value:r+=i.stringRepeat(" ",o.value.length)}return this._parseTag(r)},this.tagRe=/^(\s*)(<?(\/?)([-_a-zA-Z0-9:!]*)\s*(\/?)>?)/,this._parseTag=function(e){var t=e.match(this.tagRe),n=0;return{value:e,match:t?t[2]:"",closing:t?!!t[3]:!1,selfClosing:t?!!t[5]||t[2]=="/>":!1,tagName:t?t[4]:"",column:t[1]?n+t[1].length:n}},this._readTagForward=function(e){var t=e.getCurrentToken();if(!t)return null;var n="",r;do if(t.type.lastIndexOf("meta.tag",0)===0){if(!r)var r={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()};n+=t.value;if(n.indexOf(">")!==-1){var i=this._parseTag(n);return i.start=r,i.end={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()+t.value.length},e.stepForward(),i}}while(t=e.stepForward());return null},this._readTagBackward=function(e){var t=e.getCurrentToken();if(!t)return null;var n="",r;do if(t.type.lastIndexOf("meta.tag",0)===0){r||(r={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()+t.value.length}),n=t.value+n;if(n.indexOf("<")!==-1){var i=this._parseTag(n);return i.end=r,i.start={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()},e.stepBackward(),i}}while(t=e.stepBackward());return null},this._pop=function(e,t){while(e.length){var n=e[e.length-1];if(!t||n.tagName==t.tagName)return e.pop();if(this.voidElements[t.tagName])return;if(this.voidElements[n.tagName]){e.pop();continue}return null}},this.getFoldWidgetRange=function(e,t,n){var r=this._getFirstTagInLine(e,n);if(!r.match)return null;var i=r.closing||r.selfClosing,o=[],a;if(!i){var f=new u(e,n,r.column),l={row:n,column:r.column+r.tagName.length+2};while(a=this._readTagForward(f)){if(a.selfClosing){if(!o.length)return a.start.column+=a.tagName.length+2,a.end.column-=2,s.fromPoints(a.start,a.end);continue}if(a.closing){this._pop(o,a);if(o.length==0)return s.fromPoints(l,a.start)}else o.push(a)}}else{var f=new u(e,n,r.column+r.match.length),c={row:n,column:r.column};while(a=this._readTagBackward(f)){if(a.selfClosing){if(!o.length)return a.start.column+=a.tagName.length+2,a.end.column-=2,s.fromPoints(a.start,a.end);continue}if(!a.closing){this._pop(o,a);if(o.length==0)return a.start.column+=a.tagName.length+2,s.fromPoints(a.start,c)}else o.push(a)}}}}.call(a.prototype)}),define("ace/mode/javascript",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/javascript_highlight_rules","ace/mode/matching_brace_outdent","ace/range","ace/worker/worker_client","ace/mode/behaviour/cstyle","ace/mode/folding/cstyle"],function(e,t,n){var r=e("../lib/oop"),i=e("./text").Mode,s=e("../tokenizer").Tokenizer,o=e("./javascript_highlight_rules").JavaScriptHighlightRules,u=e("./matching_brace_outdent").MatchingBraceOutdent,a=e("../range").Range,f=e("../worker/worker_client").WorkerClient,l=e("./behaviour/cstyle").CstyleBehaviour,c=e("./folding/cstyle").FoldMode,h=function(){this.HighlightRules=o,this.$outdent=new u,this.$behaviour=new l,this.foldingRules=new c};r.inherits(h,i),function(){this.lineCommentStart="//",this.blockComment={start:"/*",end:"*/"},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t),i=this.getTokenizer().getLineTokens(t,e),s=i.tokens,o=i.state;if(s.length&&s[s.length-1].type=="comment")return r;if(e=="start"||e=="no_regex"){var u=t.match(/^.*(?:\bcase\b.*\:|[\{\(\[])\s*$/);u&&(r+=n)}else if(e=="doc-start"){if(o=="start"||o=="no_regex")return"";var u=t.match(/^\s*(\/?)\*/);u&&(u[1]&&(r+=" "),r+="* ")}return r},this.checkOutdent=function(e,t,n){return this.$outdent.checkOutdent(t,n)},this.autoOutdent=function(e,t,n){this.$outdent.autoOutdent(t,n)},this.createWorker=function(e){var t=new f(["ace"],"ace/mode/javascript_worker","JavaScriptWorker");return t.attachToDocument(e.getDocument()),t.on("jslint",function(t){e.setAnnotations(t.data)}),t.on("terminate",function(){e.clearAnnotations()}),t},this.$id="ace/mode/javascript"}.call(h.prototype),t.Mode=h}),define("ace/mode/html_completions",["require","exports","module","ace/token_iterator"],function(e,t,n){function f(e,t){var n=e.type.split(".");return t.split(".").every(function(e){return n.indexOf(e)!==-1})}function l(e,t){var n=new r(e,t.row,t.column),i=n.getCurrentToken();if(!i||!f(i,"tag")&&(!f(i,"text")||!i.value.match("/")))do i=n.stepBackward();while(i&&(f(i,"string")||f(i,"operator")||f(i,"attribute-name")||f(i,"text")));if(i&&f(i,"tag-name")&&!n.stepBackward().value.match("/"))return i.value}var r=e("../token_iterator").TokenIterator,i=["accesskey","class","contenteditable","contextmenu","dir","draggable","dropzone","hidden","id","lang","spellcheck","style","tabindex","title","translate"],s=["onabort","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextmenu","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onscroll","onseeked","onseeking","onselect","onshow","onstalled","onsubmit","onsuspend","ontimeupdate","onvolumechange","onwaiting"],o=i.concat(s),u={html:["manifest"],head:[],title:[],base:["href","target"],link:["href","hreflang","rel","media","type","sizes"],meta:["http-equiv","name","content","charset"],style:["type","media","scoped"],script:["charset","type","src","defer","async"],noscript:["href"],body:["onafterprint","onbeforeprint","onbeforeunload","onhashchange","onmessage","onoffline","onpopstate","onredo","onresize","onstorage","onundo","onunload"],section:[],nav:[],article:["pubdate"],aside:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],footer:[],address:[],main:[],p:[],hr:[],pre:[],blockquote:["cite"],ol:["start","reversed"],ul:[],li:["value"],dl:[],dt:[],dd:[],figure:[],figcaption:[],div:[],a:["href","target","ping","rel","media","hreflang","type"],em:[],strong:[],small:[],s:[],cite:[],q:["cite"],dfn:[],abbr:[],data:[],time:["datetime"],code:[],"var":[],samp:[],kbd:[],sub:[],sup:[],i:[],b:[],u:[],mark:[],ruby:[],rt:[],rp:[],bdi:[],bdo:[],span:[],br:[],wbr:[],ins:["cite","datetime"],del:["cite","datetime"],img:["alt","src","height","width","usemap","ismap"],iframe:["name","src","height","width","sandbox","seamless"],embed:["src","height","width","type"],object:["param","data","type","height","width","usemap","name","form","classid"],param:["name","value"],video:["src","autobuffer","autoplay","loop","controls","width","height","poster"],audio:["src","autobuffer","autoplay","loop","controls"],source:["src","type","media"],track:["kind","src","srclang","label","default"],canvas:["width","height"],map:["name"],area:["shape","coords","href","hreflang","alt","target","media","rel","ping","type"],svg:[],math:[],table:["summary"],caption:[],colgroup:["span"],col:["span"],tbody:[],thead:[],tfoot:[],tr:[],td:["headers","rowspan","colspan"],th:["headers","rowspan","colspan","scope"],form:["accept-charset","action","autocomplete","enctype","method","name","novalidate","target"],fieldset:["disabled","form","name"],legend:[],label:["form","for"],input:["type","accept","alt","autocomplete","checked","disabled","form","formaction","formenctype","formmethod","formnovalidate","formtarget","height","list","max","maxlength","min","multiple","pattern","placeholder","readonly","required","size","src","step","width","files","value"],button:["autofocus","disabled","form","formaction","formenctype","formmethod","formnovalidate","formtarget","name","value","type"],select:["autofocus","disabled","form","multiple","name","size"],datalist:[],optgroup:["disabled","label"],option:["disabled","selected","label","value"],textarea:["autofocus","disabled","form","maxlength","name","placeholder","readonly","required","rows","cols","wrap"],keygen:["autofocus","challenge","disabled","form","keytype","name"],output:["for","form","name"],progress:["value","max"],meter:["value","min","max","low","high","optimum"],details:["open"],summary:[],command:["type","label","icon","disabled","checked","radiogroup","command"],menu:["type","label"],dialog:["open"]},a=Object.keys(u),c=function(){};(function(){this.getCompletions=function(e,t,n,r){var i=t.getTokenAt(n.row,n.column);return i?f(i,"tag-name")||i.value=="<"&&f(i,"text")?this.getTagCompletions(e,t,n,r):f(i,"text")||f(i,"attribute-name")?this.getAttributeCompetions(e,t,n,r):[]:[]},this.getTagCompletions=function(e,t,n,r){var i=a;return r&&(i=i.filter(function(e){return e.indexOf(r)===0})),i.map(function(e){return{value:e,meta:"tag"}})},this.getAttributeCompetions=function(e,t,n,r){var i=l(t,n);if(!i)return[];var s=o;return i in u&&(s=s.concat(u[i])),r&&(s=s.filter(function(e){return e.indexOf(r)===0})),s.map(function(e){return{caption:e,snippet:e+'="$0"',meta:"attribute"}})}}).call(c.prototype),t.HtmlCompletions=c}),define("ace/mode/behaviour/css",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/mode/behaviour/cstyle","ace/token_iterator"],function(e,t,n){var r=e("../../lib/oop"),i=e("../behaviour").Behaviour,s=e("./cstyle").CstyleBehaviour,o=e("../../token_iterator").TokenIterator,u=function(){this.inherit(s),this.add("colon","insertion",function(e,t,n,r,i){if(i===":"){var s=n.getCursorPosition(),u=new o(r,s.row,s.column),a=u.getCurrentToken();a&&a.value.match(/\s+/)&&(a=u.stepBackward());if(a&&a.type==="support.type"){var f=r.doc.getLine(s.row),l=f.substring(s.column,s.column+1);if(l===":")return{text:"",selection:[1,1]};if(!f.substring(s.column).match(/^\s*;/))return{text:":;",selection:[1,1]}}}}),this.add("colon","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s===":"){var u=n.getCursorPosition(),a=new o(r,u.row,u.column),f=a.getCurrentToken();f&&f.value.match(/\s+/)&&(f=a.stepBackward());if(f&&f.type==="support.type"){var l=r.doc.getLine(i.start.row),c=l.substring(i.end.column,i.end.column+1);if(c===";")return i.end.column++,i}}}),this.add("semicolon","insertion",function(e,t,n,r,i){if(i===";"){var s=n.getCursorPosition(),o=r.doc.getLine(s.row),u=o.substring(s.column,s.column+1);if(u===";")return{text:"",selection:[1,1]}}})};r.inherits(u,s),t.CssBehaviour=u}),define("thirdparty/ace/mode-html",function(){}),define("ace/mode/tictail",["require","exports","module","ace/lib/oop","ace/mode/html","ace/mode/javascript","ace/mode/css","ace/tokenizer","ace/mode/tictail_highlight_rules","ace/mode/behaviour/tictail","ace/mode/folding/tictail","ace/mode/folding/html"],function(e,t,n){var r=e("ace/lib/oop"),i=e("ace/mode/html").Mode,s=e("ace/mode/javascript").Mode,o=e("ace/mode/css").Mode,u=e("ace/tokenizer").Tokenizer,a=e("ace/mode/tictail_highlight_rules").TictailHighlightRules,f=e("ace/mode/behaviour/tictail").TictailBehaviour,l=e("ace/mode/folding/tictail").FoldMode,c=e("ace/mode/folding/html").FoldMode,h=function(){var e=new a;this.$tokenizer=new u(e.getRules()),this.$behaviour=new f,this.$embeds=e.getEmbeds(),this.createModeDelegates({"js-":s,"css-":o});var t=this.foldingRules=new c;t.defaultMode=new l(t.defaultMode.voidElements)};r.inherits(h,i),function(){this.toggleCommentLines=function(e,t,n,r){return 0},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1}}.call(h.prototype),t.Mode=h}),define("ace/mode/tictail_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/html_highlight_rules"],function(e,t,n){var r=e("ace/lib/oop"),i=e("ace/mode/html_highlight_rules").HtmlHighlightRules,s=function(){var e=new i;this.$rules=e.getRules(),this.$embeds=e.getEmbeds(),this.$rules.start=[{token:"tictail_block.start",regex:"{{\\s*(?:#|\\^|/)",next:"tictail-block"},{token:"tictail_comment.start",regex:"{{\\s*!",next:"tictail-comment"},{token:"tictail_variable.start",regex:"{{",next:"tictail-variable"}].concat(this.$rules.start),this.$rules["tictail-block"]=[{token:function(e){return e.substr(-5)==="_page"?"tictail_block.tictail_page":"tictail_block"},regex:"[a-z0-9-_?.]+"},{token:"tictail_block.end",regex:"}}",next:"start"}],this.$rules["tictail-comment"]=[{token:"tictail_comment.end",regex:"}}",next:"start"},{defaultToken:"tictail_comment"}],this.$rules["tictail-variable"]=[{token:"tictail_variable",regex:"[a-z0-9-_?.]+"},{token:"tictail_variable.end",regex:"}}",next:"start"}];var t=this.$rules.start,n;for(var r=t.length-1;r>=0;r--){n=t[r];if(n.regex==="[^<]+"){n.regex="[^<{]+";break}}};r.inherits(s,i),t.TictailHighlightRules=s}),define("ace/mode/behaviour/tictail",["require","exports","module","ace/lib/oop","ace/mode/behaviour/html","ace/token_iterator"],function(e,t,n){var r=e("../../lib/oop"),i=e("../behaviour/html").HtmlBehaviour,s=e("../../token_iterator").TokenIterator,o=function(e,t){var n=!0,r=e.type.split("."),i=t.split(".");return i.forEach(function(e){if(r.indexOf(e)===-1)return n=!1,!1}),n},u=/\{\{\s*(?:#|\^)([a-z0-9-_?]+)\s*\}$/,a=function(){this.inherit(i),this.add("tictail_autoclosing","insertion",function(e,t,n,r,i){if(i==="}"){var a=n.getCursorPosition(),f=new s(r,a.row,a.column),l=f.getCurrentToken();if(!l||!o(l,"tictail_block")&&!o(l,"text"))return;var c=l.value.match(u);if(c===null)return;return{text:"}{{/"+c[1]+"}}",selection:[1,1]}}}),this.add("tictail_autoindent","insertion",function(e,t,n,r,i){if(i==="\n"){var s=n.getCursorPosition(),o=r.doc.getLine(s.row),u=o.substring(s.column,s.column+3);if(u=="{{/"){var a=this.$getIndent(r.doc.getLine(s.row))+r.getTabString(),f=this.$getIndent(r.doc.getLine(s.row));return{text:"\n"+a+"\n"+f,selection:[1,a.length,1,a.length]}}}})};r.inherits(a,i),t.TictailBehaviour=a}),define("ace/mode/folding/tictail",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/range","ace/token_iterator","ace/mode/folding/xml"],function(e,t,n){var r=e("../../lib/oop"),i=e("../../lib/lang"),s=e("../../range").Range,o=e("../../token_iterator").TokenIterator,u=e("./xml").FoldMode,a=function(){u.apply(this,arguments)};r.inherits(a,u),function(){this.getFoldWidget=function(e,t,n){var r=this._getFirstTictailTagInLine(e,n);return r.closing?t==="markbeginend"?"end":"":r.tagName?r.value.indexOf("/"+r.tagName)!==-1?"":"start":u.prototype.getFoldWidget.apply(this,arguments)},this._getFirstTictailTagInLine=function(e,t){var n=e.getTokens(t),r="";for(var s=0,o=n.length;s<o;s++){var u=n[s];u.type.indexOf("tictail_block")===0?r+=u.value:r+=i.stringRepeat(" ",u.value.length)}return this._parseTictailTag(r)},this.tictailTagRe=/^(\s*)((?:\{\{)?\s*([#\^\/]?)([a-z0-9-_?]*)\s*(?:\}\})?)/,this._parseTictailTag=function(e){var t=this.tictailTagRe.exec(e),n=this.tictailTagRe.lastIndex||0;return this.tictailTagRe.lastIndex=0,{value:e,match:t?t[2]:"",closing:t?t[3]==="/":!1,tagName:t?t[4]:"",column:t[1]?n+t[1].length:n}},this._readTictailTagForward=function(e){var t=e.getCurrentToken();if(!t)return null;var n="",r;do if(t.type.indexOf("tictail_block")===0){r||(r={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()}),n+=t.value;if(n.indexOf("}}")!==-1){var i=this._parseTictailTag(n);return i.start=r,i.end={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()+t.value.length},e.stepForward(),i}}while(t=e.stepForward());return null},this._readTictailTagBackward=function(e){var t=e.getCurrentToken();if(!t)return null;var n="",r;do if(t.type.indexOf("tictail_block")===0){r||(r={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()+t.value.length}),n=t.value+n;if(n.indexOf("{{")!==-1){var i=this._parseTictailTag(n);return i.end=r,i.start={row:e.getCurrentTokenRow(),column:e.getCurrentTokenColumn()},e.stepBackward(),i}}while(t=e.stepBackward());return null},this._tictailPop=function(e,t){while(e.length){var n=e[e.length-1];return!t||n.tagName===t.tagName?e.pop():null}},this.getFoldWidgetRange=function(e,t,n){var r=this._getFirstTictailTagInLine(e,n);if(!r.match)return u.prototype.getFoldWidgetRange.apply(this,arguments);var i=[],a;if(!r.closing){var f=new o(e,n,r.column),l={row:n,column:r.column+r.match.length};while(a=this._readTictailTagForward(f))if(a.closing){this._tictailPop(i,a);if(i.length===0)return s.fromPoints(l,a.start)}else i.push(a)}else{var f=new o(e,n,r.column+r.match.length),c={row:n,column:r.column};while(a=this._readTictailTagBackward(f))if(!a.closing){this._tictailPop(i,a);if(i.length===0)return a.start.column+=a.match.length,s.fromPoints(a.start,c)}else i.push(a)}}}.call(a.prototype),t.FoldMode=a}),define("dashboard/module/theme/ace/mode-tictail",function(){}),define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],function(e,t,n){t.isDark=!0,t.cssClass="ace-tictail",t.cssText=".ace-tictail .ace_gutter {  background: transparent;  color: #676363;}.ace-tictail .ace_print_margin {  width: 1px;  background: #e8e8e8;}.ace-tictail .ace_scroller {  background-color: rgba(255, 255, 255, 0.05);}.ace-tictail .ace_text-layer {  color: #fff;}.ace-tictail .ace_cursor {  border-left: 2px solid #fff;}.ace-tictail .ace_overwrite-cursors .ace_cursor {  border-left: 0px;  border-bottom: 1px solid #fff;}.ace-tictail .ace_marker-layer .ace_selection {  background: rgba(154, 155, 157, 0.4);}.ace-tictail.ace_multiselect .ace_selection.ace_start {  box-shadow: 0 0 2px 0 #ddd;  border-radius: 2px;}.ace-tictail .ace_marker-layer .ace_step {  background: rgb(198, 219, 174);}.ace-tictail .ace_marker-layer .ace_bracket {  margin: -1px 0 0 -1px;  border: 1px solid rgba(255, 255, 255, 0.15);}.ace-tictail .ace_marker-layer .ace_active_line {  background: rgba(0, 0, 0, 0.35);}.ace-tictail .ace_gutter-active-line {  background-color: rgba(0, 0, 0, 0.35);}.ace-tictail .ace_marker-layer .ace_selected-word {  border: 1px solid rgba(255, 255, 255, 0.15);}.ace-tictail .ace_invisible {  color: rgba(255, 255, 255, 0.25);}.ace-tictail .ace_keyword,.ace-tictail .ace_meta {  color: #33b9e4;}.ace-tictail .ace_operator {  color: #ccc;}.ace-tictail .ace_constant,.ace-tictail .ace_constant.ace_character,.ace-tictail .ace_constant.ace_character.ace_escape,.ace-tictail .ace_constant.ace_other,.ace-tictail .ace_markup.ace_heading {  color: #33b0e4;}.ace-tictail .ace_constant.ace_numeric,.ace-tictail .ace_support.ace_constant {  color: #33e454;}.ace-tictail .ace_invalid.ace_illegal {  color: #f8f8f8;  background-color: #800f00;}.ace-tictail .ace_invalid.ace_deprecated {  text-decoration: underline;  font-style: italic;  color: #d2a8a1;}.ace-tictail .ace_support {  color: #e47633;}.ace-tictail .ace_fold {  background-color: #ff80e1;  border-color: #222;}.ace-tictail .ace_support.ace_function {  color: #ffb054;}.ace-tictail .ace_markup.ace_list,.ace-tictail .ace_storage {  color: #33b0e4;}.ace-tictail .ace_entity.ace_name.ace_function,.ace-tictail .ace_meta.ace_tag,.ace-tictail .ace_variable {  color: #fff;}.ace-tictail .ace_string {  color: #e433c1;}.ace-tictail .ace_string.ace_regexp {  color: #33e454;}.ace-tictail .ace_comment {  color: #888686;}.ace-tictail .ace_variable {  color: #ff80e1;}.ace-tictail .ace_xml-pe {  color: #888686;}.ace-tictail .ace_markup.ace_underline {  text-decoration: underline;}.ace-tictail .ace_indent-guide {  background: url(data:image/gif;base64,R0lGODlhAQACAIABAEdHR////yH5BAEAAAEALAAAAAABAAIAAAICRAoAOw==) right repeat-y;}.ace-tictail .ace_tictail_block {  color: #33b0e4;}.ace-tictail .ace_tictail_variable {  color: #33e454;}.ace-tictail .ace_tictail_comment {  color: #888686;}button.ace_searchbtn {  border-radius: 0px;}button.ace_searchbtn:hover {  background-repeat: no-repeat;  background-position: 50%;  background-color: rgb(247, 247, 247);  border-left: 1px solid #dcdcdc;}button.ace_searchbtn:active {  border: none;  background-repeat: no-repeat;  background-position: 50%;  background-color: rgb(238, 238, 238);  border-left: 1px solid #dcdcdc;}button.ace_searchbtn_close {  border: none;  box-shadow: none;  -moz-box-shadow: none;  -webkit-box-shadow: none;  background-position: 0% 0%;  background-color: rgba(0,0,0,0);  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==);}";var r=e("ace/lib/dom");r.importCssString(t.cssText,t.cssClass)}),define("dashboard/module/theme/ace/theme-textmate",function(){}),define("dashboard/module/theme/editor",["require","underscore","icanhaz","tictail/core","../../view","i18n!../../nls/themes","thirdparty/ace/ace","thirdparty/ace/mode-html","./ace/mode-tictail","./ace/theme-textmate"],function(e,t,n,r,i,s){var o=/item-([a-z_\-]+)/,u="themesEditorWrapMode",a=this;a.Dashboard=a.Dashboard||{},a.Dashboard.Module=a.Dashboard.Module||{},a.Dashboard.Module.Theme=a.Dashboard.Module.Theme={};var f=a.Dashboard.Module.Theme.Editor=i.extend({className:"theme-editor",events:{"click .theme-editor-toolbar a":"onClickToolbarItem"},initialize:function(){f.__super__.initialize.apply(this,arguments);var e=this.options;t.isUndefined(e.value)||(e.state=e.state||{},e.state.value=e.value)},willRemove:function(){t.isUndefined(this.aceEditor)||(this.aceEditor.destroy(),delete this.aceEditor)},getAceEditor:function(){return this.aceEditor||null},getAceSession:function(){var e=this.getAceEditor();return e!==null?e.getSession():null},getValue:function(){var e=this.getAceEditor(),n=this.options;return e!==null?e.getSession().getValue():!t.isUndefined(n.state)&&!t.isUndefined(n.state.value)?n.state.value:""},_setup:function(e){var n=this,i=e.edit(this.el),s=i.getSession();return i.setTheme("ace/theme/textmate"),s.setMode("ace/mode/tictail"),s.setUseWrapMode(r.localStorage.getItem(u)!=="false"),t.isUndefined(this.options.state)||(f.restoreState(this,this.options.state,i),delete this.options.state),s.on("change",function(){n.trigger("onChange",n)}),i.commands.addCommands([{name:"Save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(){n.trigger("onSaveCommand",n)}},{name:"Preview",bindKey:{win:"Ctrl-P",mac:"Command-P"},exec:function(){n.trigger("onPreviewCommand",n)}},{name:"Detach editor",bindKey:{win:"Ctrl-O",mac:"Command-O"},exec:function(){n.trigger("onDetachCommand",n)}}]),i.focus(),i},_renderToolbar:function(){var e=s.index.sidebar.edit.toolbar,t=n["module/theme/editortoolbar"]({detachable:this.options.detachable!==!1,detach_item_label:e.detach,wrap_mode_item_label:e.wrap_mode,documentation_item_label:e.documentation}),r=this.getAceSession();r!==null&&t.find(".item-wrap-mode").toggleClass("selected",r.getUseWrapMode()),this.$el.append(t)},renderContent:function(){this.$el.text(this.getValue());var t=this;return e(["ace/ace","ace/theme/textmate","ace/mode/tictail"],function(e){setTimeout(function(){t.aceEditor=t._setup(e),t._renderToolbar()},0)}),this},onClickToolbarItem:function(e){e.preventDefault();var t=$(e.currentTarget).parent(),n=t.attr("class")||"",i=n.match(o);if(i!==null)switch(i[1]){case"detach":this.trigger("onDetachCommand",this);break;case"wrap-mode":var s=this.getAceEditor();if(s!==null){var a=s.getSession(),f=!a.getUseWrapMode();a.setUseWrapMode(f),s.centerSelection(),t.toggleClass("selected",f),r.localStorage.setItem(u,String(f))}break;case"documentation":window.open("https://tictail.com/docs","docsWin").focus()}}},{storeState:function(e){var t=e.getAceEditor();if(t===null)return null;var n=t.getSession(),r=function(e){return{startRow:e.start.row,startColumn:e.start.column,endRow:e.end.row,endColumn:e.end.column}},i={value:n.getValue(),selectionRange:r(n.getSelection().getRange()),useWrapMode:n.getUseWrapMode(),annotations:n.getAnnotations()},s=n.getAllFolds();if(s.length!==0){var o=i.folds=[];for(var u=0,a=s.length;u<a;u++){var f=s[u];o.push({placeholder:f.placeholder,range:r(f.range)})}}return i},restoreState:function(n,r,i){t.isUndefined(i)&&(i=n.getAceEditor());if(i===null){n.options.state=r;return}var s=e("ace/range").Range,o=i.getSession(),u=function(e){return new s(e.startRow,e.startColumn,e.endRow,e.endColumn)};t.isUndefined(r.value)||o.setValue(r.value),t.isUndefined(r.selectionRange)||(o.getSelection().setSelectionRange(u(r.selectionRange)),setTimeout(function(){i.centerSelection()},0)),t.isUndefined(r.useWrapMode)||o.setUseWrapMode(r.useWrapMode),t.isUndefined(r.annotations)||o.setAnnotations(r.annotations);if(!t.isUndefined(r.folds))for(var a=0,f=r.folds.length;a<f;a++){var l=r.folds[a];o.addFold(l.placeholder,u(l.range))}}});return f}),define("ace/ext/searchbox",["require","exports","module","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/keyboard/hash_handler","ace/lib/keys"],function(e,t,n){var r=e("../lib/dom"),i=e("../lib/lang"),s=e("../lib/event"),o="/* ------------------------------------------------------------------------------------------* Editor Search Form* --------------------------------------------------------------------------------------- */.ace_search {background-color: #ddd;border: 1px solid #cbcbcb;border-top: 0 none;max-width: 297px;overflow: hidden;margin: 0;padding: 4px;padding-right: 6px;padding-bottom: 0;position: absolute;top: 0px;z-index: 99;white-space: normal;}.ace_search.left {border-left: 0 none;border-radius: 0px 0px 5px 0px;left: 0;}.ace_search.right {border-radius: 0px 0px 0px 5px;border-right: 0 none;right: 0;}.ace_search_form, .ace_replace_form {border-radius: 3px;border: 1px solid #cbcbcb;float: left;margin-bottom: 4px;overflow: hidden;}.ace_search_form.ace_nomatch {outline: 1px solid red;}.ace_search_field {background-color: white;border-right: 1px solid #cbcbcb;border: 0 none;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;display: block;float: left;height: 22px;outline: 0;padding: 0 7px;width: 214px;margin: 0;}.ace_searchbtn,.ace_replacebtn {background: #fff;border: 0 none;border-left: 1px solid #dcdcdc;cursor: pointer;display: block;float: left;height: 22px;margin: 0;padding: 0;position: relative;}.ace_searchbtn:last-child,.ace_replacebtn:last-child {border-top-right-radius: 3px;border-bottom-right-radius: 3px;}.ace_searchbtn:disabled {background: none;cursor: default;}.ace_searchbtn {background-position: 50% 50%;background-repeat: no-repeat;width: 27px;}.ace_searchbtn.prev {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADFJREFUeNpiSU1NZUAC/6E0I0yACYskCpsJiySKIiY0SUZk40FyTEgCjGgKwTRAgAEAQJUIPCE+qfkAAAAASUVORK5CYII=);    }.ace_searchbtn.next {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADRJREFUeNpiTE1NZQCC/0DMyIAKwGJMUAYDEo3M/s+EpvM/mkKwCQxYjIeLMaELoLMBAgwAU7UJObTKsvAAAAAASUVORK5CYII=);    }.ace_searchbtn_close {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;border-radius: 50%;border: 0 none;color: #656565;cursor: pointer;display: block;float: right;font-family: Arial;font-size: 16px;height: 14px;line-height: 16px;margin: 5px 1px 9px 5px;padding: 0;text-align: center;width: 14px;}.ace_searchbtn_close:hover {background-color: #656565;background-position: 50% 100%;color: white;}.ace_replacebtn.prev {width: 54px}.ace_replacebtn.next {width: 27px}.ace_button {margin-left: 2px;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;overflow: hidden;opacity: 0.7;border: 1px solid rgba(100,100,100,0.23);padding: 1px;-moz-box-sizing: border-box;box-sizing:    border-box;color: black;}.ace_button:hover {background-color: #eee;opacity:1;}.ace_button:active {background-color: #ddd;}.ace_button.checked {border-color: #3399ff;opacity:1;}.ace_search_options{margin-bottom: 3px;text-align: right;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;}",u=e("../keyboard/hash_handler").HashHandler,a=e("../lib/keys");r.importCssString(o,"ace_searchbox");var f='<div class="ace_search right">    <button type="button" action="hide" class="ace_searchbtn_close"></button>    <div class="ace_search_form">        <input class="ace_search_field" placeholder="Search for" spellcheck="false"></input>        <button type="button" action="findNext" class="ace_searchbtn next"></button>        <button type="button" action="findPrev" class="ace_searchbtn prev"></button>    </div>    <div class="ace_replace_form">        <input class="ace_search_field" placeholder="Replace with" spellcheck="false"></input>        <button type="button" action="replaceAndFindNext" class="ace_replacebtn">Replace</button>        <button type="button" action="replaceAll" class="ace_replacebtn">All</button>    </div>    <div class="ace_search_options">        <span action="toggleRegexpMode" class="ace_button" title="RegExp Search">.*</span>        <span action="toggleCaseSensitive" class="ace_button" title="CaseSensitive Search">Aa</span>        <span action="toggleWholeWords" class="ace_button" title="Whole Word Search">\\b</span>    </div></div>'.replace(/>\s+/g,">"),l=function(e,t,n){var i=r.createElement("div");i.innerHTML=f,this.element=i.firstChild,this.$init(),this.setEditor(e)};(function(){this.setEditor=function(e){e.searchBox=this,e.container.appendChild(this.element),this.editor=e},this.$initElements=function(e){this.searchBox=e.querySelector(".ace_search_form"),this.replaceBox=e.querySelector(".ace_replace_form"),this.searchOptions=e.querySelector(".ace_search_options"),this.regExpOption=e.querySelector("[action=toggleRegexpMode]"),this.caseSensitiveOption=e.querySelector("[action=toggleCaseSensitive]"),this.wholeWordOption=e.querySelector("[action=toggleWholeWords]"),this.searchInput=this.searchBox.querySelector(".ace_search_field"),this.replaceInput=this.replaceBox.querySelector(".ace_search_field")},this.$init=function(){var e=this.element;this.$initElements(e);var t=this;s.addListener(e,"mousedown",function(e){setTimeout(function(){t.activeInput.focus()},0),s.stopPropagation(e)}),s.addListener(e,"click",function(e){var n=e.target||e.srcElement,r=n.getAttribute("action");r&&t[r]?t[r]():t.$searchBarKb.commands[r]&&t.$searchBarKb.commands[r].exec(t),s.stopPropagation(e)}),s.addCommandKeyListener(e,function(e,n,r){var i=a.keyCodeToString(r),o=t.$searchBarKb.findKeyCommand(n,i);o&&o.exec&&(o.exec(t),s.stopEvent(e))}),this.$onChange=i.delayedCall(function(){t.find(!1,!1)}),s.addListener(this.searchInput,"input",function(){t.$onChange.schedule(20)}),s.addListener(this.searchInput,"focus",function(){t.activeInput=t.searchInput,t.searchInput.value&&t.highlight()}),s.addListener(this.replaceInput,"focus",function(){t.activeInput=t.replaceInput,t.searchInput.value&&t.highlight()})},this.$closeSearchBarKb=new u([{bindKey:"Esc",name:"closeSearchBar",exec:function(e){e.searchBox.hide()}}]),this.$searchBarKb=new u,this.$searchBarKb.bindKeys({"Ctrl-f|Command-f|Ctrl-H|Command-Option-F":function(e){var t=e.isReplace=!e.isReplace;e.replaceBox.style.display=t?"":"none",e[t?"replaceInput":"searchInput"].focus()},"Ctrl-G|Command-G":function(e){e.findNext()},"Ctrl-Shift-G|Command-Shift-G":function(e){e.findPrev()},esc:function(e){setTimeout(function(){e.hide()})},Return:function(e){e.activeInput==e.replaceInput&&e.replace(),e.findNext()},"Shift-Return":function(e){e.activeInput==e.replaceInput&&e.replace(),e.findPrev()},Tab:function(e){(e.activeInput==e.replaceInput?e.searchInput:e.replaceInput).focus()}}),this.$searchBarKb.addCommands([{name:"toggleRegexpMode",bindKey:{win:"Alt-R|Alt-/",mac:"Ctrl-Alt-R|Ctrl-Alt-/"},exec:function(e){e.regExpOption.checked=!e.regExpOption.checked,e.$syncOptions()}},{name:"toggleCaseSensitive",bindKey:{win:"Alt-C|Alt-I",mac:"Ctrl-Alt-R|Ctrl-Alt-I"},exec:function(e){e.caseSensitiveOption.checked=!e.caseSensitiveOption.checked,e.$syncOptions()}},{name:"toggleWholeWords",bindKey:{win:"Alt-B|Alt-W",mac:"Ctrl-Alt-B|Ctrl-Alt-W"},exec:function(e){e.wholeWordOption.checked=!e.wholeWordOption.checked,e.$syncOptions()}}]),this.$syncOptions=function(){r.setCssClass(this.regExpOption,"checked",this.regExpOption.checked),r.setCssClass(this.wholeWordOption,"checked",this.wholeWordOption.checked),r.setCssClass(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked),this.find(!1,!1)},this.highlight=function(e){this.editor.session.highlight(e||this.editor.$search.$options.re),this.editor.renderer.updateBackMarkers()},this.find=function(e,t){var n=this.editor.find(this.searchInput.value,{skipCurrent:e,backwards:t,wrap:!0,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked}),i=!n&&this.searchInput.value;r.setCssClass(this.searchBox,"ace_nomatch",i),this.editor._emit("findSearchBox",{match:!i}),this.highlight()},this.findNext=function(){this.find(!0,!1)},this.findPrev=function(){this.find(!0,!0)},this.replace=function(){this.editor.getReadOnly()||this.editor.replace(this.replaceInput.value)},this.replaceAndFindNext=function(){this.editor.getReadOnly()||(this.editor.replace(this.replaceInput.value),this.findNext())},this.replaceAll=function(){this.editor.getReadOnly()||this.editor.replaceAll(this.replaceInput.value)},this.hide=function(){this.element.style.display="none",this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb),this.editor.focus()},this.show=function(e,t){this.element.style.display="",this.replaceBox.style.display=t?"":"none",this.isReplace=t,e&&(this.searchInput.value=e),this.searchInput.focus(),this.searchInput.select(),this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb)}}).call(l.prototype),t.SearchBox=l,t.Search=function(e,t){var n=e.searchBox||new l(e);n.show(e.session.getTextRange(),t)}}),function(){window.require(["ace/ext/searchbox"],function(){})}(),define("thirdparty/ace/ext-searchbox",function(){}),define("dashboard/module/theme/edit",["require","underscore","mustache","tictail/component/api","tictail/component/log","tictail/model/theme","../../model/store/base","../../view","./editor","i18n!../../nls/themes","thirdparty/ace/ace","thirdparty/ace/mode-html","thirdparty/ace/ext-searchbox","./ace/mode-tictail","./ace/theme-textmate"],function(e,t,n,r,i,s,o,u,a,f){var l=this;l.Dashboard=l.Dashboard||{},l.Dashboard.Module=l.Dashboard.Module||{},l.Dashboard.Module.Theme=l.Dashboard.Module.Theme={};var c=l.Dashboard.Module.Theme.EditView=u.extend({className:"theme-edit-view content-view",template:"module/theme/edit",container:".content",events:{"click .preview-button":"onClickPreview","click .save-button":"onClickSave","click .reattach-button":"onClickReattach"},initialize:function(){c.__super__.initialize.apply(this,arguments),this.isModified=!1,this.isModifiedSincePreview=!1},didAppend:function(){this.bindTo(this.options.sidebar,"onResize",this.onSidebarResize)},willRemove:function(){this.closeStandaloneEditor(),t.isUndefined(this._uniqueId)||(delete l.Dashboard[this._uniqueId],delete this._uniqueId),t.isUndefined(this.previewTheme)||this.model.trigger("preview",this.model.id,this)},getEditor:function(){return t.isUndefined(this.editor)?t.isUndefined(this.standaloneEditor)?null:this.standaloneEditor:this.editor},getEditorValue:function(){var e=this.getEditor();return e!==null?e.getValue():null},_checkSyntax:function(e){var t=this.getEditor().getAceEditor(),r=t.getSession(),s=[],o=f.index.sidebar.edit.confirm_syntax_error_message;try{n.compile(e)}catch(u){i.warn("Error compiling store template",u),s.push(this._parseSyntaxError(u,e))}if(r!==null){r.setAnnotations(s);if(s.length!==0&&!confirm(o))return t.moveCursorTo(s[0].row,0),t.centerSelection(),!1}return!0},_parseSyntaxError:function(e,t){var n=/ at ([0-9]+).*$/m,r=e.message.match(n),i=null,s=0,o=e.message;return r!==null&&(i=parseInt(r[1],10)),i!==null&&!isNaN(i)&&(s=(t.substr(0,i).match(/[\n\r]/g)||[]).length),o=o.replace(n,function(){return""}),{row:s,column:0,text:o,type:"error"}},preview:function(){if(this.saving===!0||this.isModifiedSincePreview!==!0)return;var e=t.isUndefined(this.previewTheme)?this.model.id:this.previewTheme.id,n=this.getEditorValue();if(n===null||!this._checkSyntax(n))return;var i=new r.Request("theme.update",{theme_id:e,content:n,is_preview:!0},"POST");i.on("success",function(e){t.isUndefined(this.previewTheme)&&(this.previewTheme=new s),this.previewTheme.clear({silent:!0}).set(e),this.isModifiedSincePreview=!1,this.trigger("onPreview",this),this.model.trigger("preview",e.id,this)},this),i.on("error",this._onError,this),i.on("complete",function(){delete this.saving,this._updateEnabled()},this),this.saving=!0,this._updateEnabled(),i.send()},save:function(){if(this.saving===!0||this.isModified!==!0)return;var e=this.getEditorValue();if(e===null||!this._checkSyntax(e))return;var t=new r.Request("store.theme.update",{store_id:this.getCurrentStore().id,content:e,is_preview:!1},"POST");t.on("success",function(e){this.model.clear({silent:!0}).set(e),delete this.previewTheme,this.isModified=this.isModifiedSincePreview=!1,this.trigger("onSave",this),this.model.trigger("preview",this.model.id,this)},this),t.on("error",this._onError,this),t.on("complete",function(){delete this.saving,this._updateEnabled()},this),this.saving=!0,this._updateEnabled(),t.send()},_onError:function(e){var t=f.index.sidebar.edit.error_messages,n=e.code,i=r.ERROR_CODES;switch(n){case i.INSUFFICIENT_PERMISSIONS:alert(t.not_theme_author);break;case i.THEME_TOO_LARGE:var s={cur_size:this.getEditorValue().length,limit:e.data.max_length};alert(TT.lang(t.theme_too_large,s));break;default:alert(t.update_failed)}},createEditor:function(){var e=new a({value:(this.previewTheme||this.model).get("theme")});return e},registerEditor:function(e){e.on("onChange",this.onEditorChange,this),e.on("onSaveCommand",this.save,this),e.on("onPreviewCommand",this.preview,this),e.on("onDetachCommand",this.detachEditor,this)},unregisterEditor:function(e){e.off(null,null,this)},detachEditor:function(){if(!t.isUndefined(this.standaloneEditor))return;t.isUndefined(this._uniqueId)&&(this._uniqueId="theme-edit-"+this.cid,l.Dashboard[this._uniqueId]=this);var e=window.location,n=e.protocol+"//"+e.host+o.generateCurrentBaseUrl("/themes/standalone-editor")+"?"+this._uniqueId,r=window.open(n,"themeEditorWin","menubar=no,location=no,toolbar=no,status=no");r!==null&&r.focus()},reattachEditor:function(){var e=a,n=null;t.isUndefined(this.standaloneEditor)||(n=e.storeState(this.standaloneEditor)),this.closeStandaloneEditor();var r=this.options.sidebar;r.setFixedWidthEnabled(!1,!1),r.setVisible(!0);if(t.isUndefined(this.editor)){var i=this.editor=this.createEditor();n!==null&&e.restoreState(i,n),this.registerEditor(i),this.addChildView(i,this.$(this.container))}this._updateEnabled()},registerStandaloneEditor:function(e,n){var r=a,i=null;t.isUndefined(this.editor)||(i=r.storeState(this.editor),this.unregisterEditor(this.editor),this.removeChildView(this.editor),delete this.editor);var s=this.options.sidebar;return s.setFixedWidthEnabled(!0),s.setVisible(!1),this.editorWindow=e,this.standaloneEditor=n,i!==null&&r.restoreState(n,i),this.registerEditor(n),this._updateEnabled(),{closeCallback:t.bind(this.onCloseStandaloneEditor,this)}},closeStandaloneEditor:function(){t.isUndefined(this.standaloneEditor)||(this.unregisterEditor(this.standaloneEditor),delete this.standaloneEditor),t.isUndefined(this.editorWindow)||(this.editorWindow.closed||this.editorWindow.close(),delete this.editorWindow)},_updateEnabled:function(){this.$(".preview-button").prop("disabled",this.saving===!0),this.$(".save-button").prop("disabled",this.saving===!0),this.$el.toggleClass("modified",this.isModified===!0).toggleClass("modified-since-preview",this.isModifiedSincePreview===!0).toggleClass("standalone-editor",t.isUndefined(this.editor)),this.trigger("onStateChange",this)},getTemplateData:function(){var e=f.index.sidebar.edit;return{preview_button_label:e.preview_button.label,back_button_label:e.back_button.label,save_button_label:e.save_button.label,reattach_button_label:e.reattach_button.label}},getContent:function(){var e=this.editor=this.createEditor();return this.registerEditor(e),e},didRender:function(){return this._updateEnabled(),this},onClickPreview:function(){this.preview()},onClickSave:function(){this.save()},onClickReattach:function(){this.reattachEditor()},onEditorChange:function(){this.isModified=this.isModifiedSincePreview=!0,this.saving!==!0&&this._updateEnabled()},onSidebarResize:function(){t.isUndefined(this.editor)||this.editor.getAceEditor().resize()},onCloseStandaloneEditor:function(e){if(e!==this.standaloneEditor)return;this.reattachEditor()},onBeforeUnload:function(){t.isUndefined(this.editorWindow)||this.reattachEditor();if(this.isModified===!0)return f.index.sidebar.edit.confirm_discard_message}});return c}),define("dashboard/module/theme/gallery",["underscore","tictail/core","tictail/component/api","../../view","i18n!../../nls/themes"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.Module=s.Dashboard.Module||{},s.Dashboard.Module.Theme=s.Dashboard.Module.Theme={};var o=s.Dashboard.Module.Theme.Gallery=r.extend({className:"theme-gallery-view content-view",template:"module/theme/gallery",events:{"click .use-theme-button":"onClickUseTheme","click .theme-thumb":"onClickTheme"},initialize:function(){o.__super__.initialize.apply(this,arguments),this.selectedThemeId=this.model.id;if(!e.isUndefined(this.options.collection))this.collection=this.options.collection;else{var t=this.getCurrentStore().getInitiatedForeignAttribute("theme");if(t.isEmpty()){var n=this;t.fetch({success:function(){n.collection=t,n.render()}})}else this.collection=t}},willRemove:function(){this.selectedThemeId!==this.model.id&&this.model.trigger("preview",this.model.id,this)},selectTheme:function(e){if(e===this.selectedThemeId)return;this.selectedThemeId=e,this._markAsSelected(e),this._updateEnabled(),this.model.trigger("preview",e,this)},_markAsSelected:function(e){this.$(".theme-thumb").removeClass("selected").filter("#theme-thumb-"+e).addClass("selected")},save:function(){if(this.selectedThemeId===this.model.id||this.saving===!0)return;if(e.isUndefined(this.collection.get(this.model.id))&&!confirm(i.index.sidebar.gallery.confirm_replace_message))return;var t=new n.Request("store.theme.set",{store_id:this.getCurrentStore().id,theme_id:this.selectedThemeId},"POST");t.on("success",function(e){this.model.clear({silent:!0}).set(e),this.navigate("/themes")},this),t.on("error",function(){delete this.saving,this._updateEnabled()},this),this.saving=!0,this._updateEnabled(),t.send()},_updateEnabled:function(){var e=i.index.sidebar.gallery,n=!!this.selectedThemeId&&!!this.collection,r=n?this.collection.get(this.selectedThemeId):null;this.$(".use-theme-button").prop("disabled",this.saving===!0).toggle(n&&!!r&&this.selectedThemeId!==this.model.id).text(r?t.lang(e.use_theme_button.label,{theme_name:r.get("name")}):""),this.$el.toggleClass("disabled",this.saving===!0)},getTemplateData:function(){var e=i.index.sidebar.gallery,t={back_button_label:e.back_button.label};return this.collection&&(t.themes=this.collection.toJSON()),t},didRender:function(){var e=i.index.sidebar.gallery;return this.collection&&this.collection.each(function(n){this.$("#theme-thumb-"+n.id+" .byline").text(t.lang(e.byline,{author_name:n.get("author_name")||"Unknown"}))},this),this._markAsSelected(this.selectedThemeId),this._updateEnabled(),this},onClickUseTheme:function(){this.save()},onClickTheme:function(e){var t=$(e.currentTarget),n=parseInt(t.attr("data-id"),10);if(this.saving===!0)return;this.selectTheme(n)}});return o}),define("tictail/form/field/checkbox_description",["jquery","./checkbox"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{},n.TT.Form.Field=n.TT.Form.Field||{};var r=n.TT.Form.Field.Checkbox=t.extend({getCheckboxDescription:function(){var t=this.options;return t.description?e('<p class="description" />').html(t.description):null},renderField:function(){this.$el.append(this._getFieldNode()).append(this.getCheckboxLabel()).append(this.getCheckboxDescription())}});return r}),define("dashboard/form/theme/mobile",["jquery","underscore","tictail/core","tictail/component/api","tictail/form/core","tictail/form/field/checkbox_description","dashboard/nls/themes"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.Form=u.Dashboard.Form||{},u.Dashboard.Form.Theme=u.Dashboard.Form.Theme||{};var a=u.Dashboard.Form.Theme.Mobile=i.extend({allFields:["mobile"],createField:function(e){switch(e){case"mobile":return new s({key:e,model:{instance:this.model,attribute:"mobile"},label:o.root.index.sidebar.start.mobile.label,description:o.root.index.sidebar.start.mobile.description});default:throw new Error("Unknown field")}},renderFields:function(){var e=this.getFields(this.allFields);return t.isEmpty(e)?!1:(this.addChildView(this.getField("mobile")),!0)},render:function(){return this.empty(),this.renderFields(),this.didRender()},save:function(){this.setLoadingSaveButton()}});return a}),define("tictail/model/store/theme/mobile",["../../../core"],function(e){var t=e.Model.extend({API_NAMESPACE:"store.theme.mobile",getDefaultParams:function(){return{id:e.session.getCurrentStore().id}}});return t}),define("dashboard/module/theme/start",["../../view","dashboard/form/theme/mobile","tictail/model/store/theme/mobile","i18n!../../nls/themes"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Module=i.Dashboard.Module||{},i.Dashboard.Module.Theme=i.Dashboard.Module.Theme={};var s=i.Dashboard.Module.Theme.StartView=e.extend({className:"theme-start-view content-view",template:"module/theme/start",events:{"click button.save-button":"onClickSave"},initialize:function(e){var t=this;s.__super__.initialize.apply(this,arguments),this.saving=!1,this.mobileModel=new n,this.mobileModel.fetch({success:function(){t.didLoadMobileModel()}})},onClickSave:function(e){var t=this;this.saving=!0,this._updateButton(),this.mobileModel.save(null,{success:function(){t.saving=!1,t._updateButton(),t.saveButton.hide()},error:function(){t.saving=!1,t._updateButton()}})},_updateButton:function(){this.saveButton.prop("disabled",this.saving===!0)},didLoadMobileModel:function(){this.mobileModel.on("change:mobile",this.onChangedValue,this)},remove:function(){this.mobileModel.off(null,null,this)},onChangedValue:function(){this.saveButton.show()},getTemplateData:function(){var e=r.index.sidebar.start,t={back_button_label:e.back_button.label,current_theme_heading:e.current_theme_heading,edit_link_label:e.edit_link.label,gallery_button_label:e.gallery_button.label};return this.model&&(t.current_theme=this.model.attributes),t},getContent:function(){var e=new t({model:this.mobileModel});return e},renderContent:function(e){return e=e||this.getContent(),this.addChildView(e,this.$(".content .options")),this},didRender:function(){this.saveButton=this.$("button.save-button")}});return s}),define("dashboard/module/theme/sidebar",["underscore","tictail/core","../../view","./edit","./gallery","./start","i18n!../../nls/themes"],function(e,t,n,r,i,s,o){var u=373,a=51,f=300,l=200,c="themesSidebarWidth",h=this;h.Dashboard=h.Dashboard||{},h.Dashboard.Module=h.Dashboard.Module||{},h.Dashboard.Module.Theme=h.Dashboard.Module.Theme={};var p=h.Dashboard.Module.Theme.Sidebar=n.extend({className:"theme-sidebar",template:"module/theme/sidebar",events:{"click .navigation-bar .item-lock a":"onMouseDownLock","mousedown .resize-handle":"onMouseDownHandle"},initialize:function(){p.__super__.initialize.apply(this,arguments),this._width=parseFloat(t.localStorage.getItem(c))||Math.round($(document).width()/2),this._fixedWidth=!1},didAppend:function(){var e=this.options.parent;e&&this.bindTo(e,"onToggleColumnsMode",this.onToggleColumnsMode)},setContentView:function(t){var n=p.CONTENT_VIEWS[t];if(e.isUndefined(n))throw new Error("Invalid view name given");if(this.contentView instanceof n.viewClass)return;var r=this,i=!e.isUndefined(r.contentView),s=t!=="start",o=n.fixedWidth===!0,u=this._fixedWidth&&!o,f=!this._fixedWidth&&o,l="contentSwitch",c=function(e){r.setFixedWidthEnabled(!0,i,e)},h=function(e){r.setFixedWidthEnabled(!1,i,e)},d=function(e){if(r.contentView){var t=r.contentView;i?t.$el.animate({left:s?"-100%":"100%"},{duration:300,easing:"easeInOutCirc",complete:function(){r.removeChildView(t)},queue:!1}):r.removeChildView(t)}var o=new n.viewClass({sidebar:r,model:r.model});r.contentView=o,r.addChildView(o,r.$(".content-wrap")),i?o.$el.css({left:s?"100%":"-100%",width:u?r._width-a:"100%"}).animate({left:"0%"},{duration:300,easing:"easeInOutCirc",complete:function(){o.$el.css("width","100%"),e()},queue:!1}):e()};u?this.$el.queue(l,[d,h]).dequeue(l):f?this.$el.queue(l,[c,d]).dequeue(l):d(function(){}),this.$(".navigation-bar .content-menu li").removeClass("selected").filter(".item-"+(n.menuItem||t)).addClass("selected")},setVisible:function(e,t){var n=this.options.parent;n&&n.setSidebarVisible(e,t)},setFixedWidthEnabled:function(t,n,r){t=!!t;if(t!==this._fixedWidth){this._fixedWidth=t,this.$el.toggleClass("fixed-width",t);if(n!==!1){this.$el.animate({width:this._getWidth()},300,"easeInOutCirc",function(){e.isUndefined(r)||r()});return}this.$el.css("width",this._getWidth())}e.isUndefined(r)||r()},_getWidth:function(){return this._fixedWidth?u:this._width},getTemplateData:function(){var e=o.index.sidebar,t=e.navigation;return{columns_mode_supported:this.options.parent&&this.options.parent.columnsModeSupported(),start_item_label:t.start,edit_item_label:t.edit,dropbox_item_label:t.dropbox,lock_item_label:t.lock}},renderContent:function(){var t=this.options.contentView;return e.has(p.CONTENT_VIEWS,t)||(t="start"),this.setContentView(t),this},didRender:function(){this.$el.css("width",this._getWidth());var e=this.options.parent;return e&&this.$(".navigation-bar .item-lock").toggleClass("selected",e.columnsModeEnabled()),this},onMouseDownLock:function(e){e.preventDefault();var t=this.options.parent;t&&t.toggleColumnsMode()},onMouseDownHandle:function(e){e.preventDefault();var t=this.options.parent;if(!t)return;var n=t.$el.offset(),r={self:this,x:n.left-(e.offsetX||0),width:t.$el.width()};this._dragSurface=$('<div class="theme-sidebar-drag-surface"/>').appendTo(document.body),$(document).bind("mousemove",r,this.onMouseMove).one("mouseup",r,this.onMouseUp),this.trigger("onBeginResize",this)},onMouseMove:function(e){var t=e.data,n=t.self,r=Math.min(Math.max(t.width-t.x-e.pageX,f),t.width-l);n._width=r,n.$el.css("width",r),n.trigger("onResize",r,this)},onMouseUp:function(n){var r=n.data.self;$(document).unbind("mousemove",this.onMouseMove),e.isUndefined(r._dragSurface)||(r._dragSurface.remove(),delete r._dragSurface),t.localStorage.setItem(c,String(r.$el.width())),r.trigger("onEndResize",this)},onToggleColumnsMode:function(e){this.$(".navigation-bar .item-lock").toggleClass("selected",e)},onBeforeUnload:function(){return this.contentView&&!e.isUndefined(this.contentView.onBeforeUnload)?this.contentView.onBeforeUnload():!1}},{CONTENT_VIEWS:{start:{viewClass:s,fixedWidth:!0},gallery:{viewClass:i,menuItem:"start",fixedWidth:!0},edit:{viewClass:r}}});return p}),define("dashboard/view/theme/index",["jquery","underscore","tictail/core","tictail/component/api","tictail/model/store/theme","../../module/page","../../module/theme/previewcontainer","../../module/theme/sidebar","i18n!../../nls/themes"],function(e,t,n,r,i,s,o,u,a){var f="themesColumnsMode",l=1280,c=this;c.Dashboard=c.Dashboard||{},c.Dashboard.View=c.Dashboard.View||{},c.Dashboard.View.Theme=c.Dashboard.View.Theme={};var h=c.Dashboard.View.Theme.Index=s.extend({bodyId:"theme-index",sectionName:"settings",id:"themes-page",className:null,template:null,initialize:function(){h.__super__.initialize.apply(this,arguments),this.view=this.options.view||"start";if(!this.model){var e=this,t=new i({store_id:n.session.getCurrentStore().id});t.fetch({success:function(){e.model=t,e.render()}})}},setView:function(e){if(e===this.view)return;this.view=e,t.isUndefined(this.sidebar)||this.sidebar.setContentView(e)},columnsModeSupported:function(){return!e.browser.msie},columnsModeEnabled:function(){return this.columnsModeSupported()?this.$el.hasClass("columns"):!1},toggleColumnsMode:function(e){if(!this.columnsModeSupported())return;e=t.isUndefined(e)?!this.columnsModeEnabled():Boolean(e),this.$el.toggleClass("columns",e),n.localStorage.setItem(f,String(e)),e||(this._visible=!1,this.setSidebarVisible(!0,!1)),this.trigger("onToggleColumnsMode",e,this)},setSidebarVisible:function(e,n){if(this.columnsModeEnabled()||t.isUndefined(this.sidebar))return;e=!!e;if(e===this._visible)return;this._visible=e;var r=this.sidebar.$el.stop(!0,!0),i=0;e||(i=(parseFloat(this.previewContainer.$el.css("right"))||50)-r.width()),n!==!1?r.animate({right:i},300,"easeInOutCirc"):r.css("right",i);if(e)this.previewContainer.on("onMouseOverPreview",function o(){this.previewContainer.off("onMouseOverPreview",o,this),this.setSidebarVisible(!1)},this);else{var s=this;r.one("mousedown",function(){s.setSidebarVisible(!0)})}},getContent:function(){var e=this.previewContainer=new o({model:this.model});e.$el.addClass("preview");var t=this.sidebar=new u({parent:this,model:this.model,contentView:this.view});return t.$el.addClass("sidebar"),[e,t]},renderContent:function(){if(this.model){var t=e('<div class="wrap"/>').appendTo(this.$el);this.addChildView(this.getContent(),t)}return this},didRender:function(){if(this.columnsModeSupported()){var t=n.localStorage.getItem(f);t==="true"?this.$el.addClass("columns"):t===null&&this.$el.toggleClass("columns",e(window).width()>=l)}return this._visible=!1,this.setSidebarVisible(!0,!1),this},onBeforeUnload:function(){return t.isUndefined(this.sidebar)?!1:this.sidebar.onBeforeUnload()}});return h}),define("dashboard/view/theme/standaloneeditor",["underscore","tictail/core","tictail/component/log","../../module/page","../../module/theme/editor","i18n!../../nls/themes"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.View=o.Dashboard.View||{},o.Dashboard.View.Theme=o.Dashboard.View.Theme={};var u=o.Dashboard.View.Theme.StandaloneEditor=r.extend({bodyId:"theme-standalone-editor",id:"theme-editor-page",className:null,template:"theme/standaloneeditor",events:{"click .preview-button":"onClickPreview","click .save-button":"onClickSave"},initialize:function(){u.__super__.initialize.apply(this,arguments);var t=null;window.opener&&!e.isUndefined(window.opener.Dashboard)&&(t=window.opener.Dashboard[this.options.parentId]);if(!t){var n=this;setTimeout(function(){n.navigate("/")},0);return}this.options.parentView=t},didAppend:function(){this.options.parentView&&this.bindTo(this.options.parentView,"onStateChange",this.onStateChange)},willRemove:function(){this._cleanUp()},_cleanUp:function(){var t=this.options.closeCallback;this.options={},this.unbindAll(),!e.isUndefined(t)&&!e.isUndefined(this.editor)&&t.call(window,this.editor)},createEditor:function(){var t=this.options.parentView;if(!t)return null;var n=new i({detachable:!1}),r=t.registerStandaloneEditor(window,n);return e.extend(this.options,r),n},_updateEnabled:function(){var e=this.options.parentView;if(!e)return;this.$(".preview-button").prop("disabled",e.saving===!0),this.$(".save-button").prop("disabled",e.saving===!0),this.$el.toggleClass("modified",e.isModified===!0).toggleClass("modified-since-preview",e.isModifiedSincePreview===!0)},getTemplateData:function(){var e=s.index.sidebar.edit;return{preview_button_label:e.preview_button.label,save_button_label:e.save_button.label}},getContent:function(){return this.editor=this.createEditor(),this.editor},didRender:function(){return this._updateEnabled(),this},onClickPreview:function(){var e=this.options.parentView;e&&e.preview()},onClickSave:function(){var e=this.options.parentView;e&&e.save()},onStateChange:function(){this._updateEnabled()},onBeforeUnload:function(){return this._cleanUp()}});return u}),define("tictail/component/oauth",["jquery","underscore","tictail/component/api","tictail/component/log","tictail/component/xsrf","tictail/utility"],function(e,t,n,r,i,s){var o=this;o.TT=o.TT||{};var u=o.TT.OAuth={};return u.containsParams=function(e){return t.has(e,"client_id")&&t.has(e,"response_type")},u.getParams=function(){var e=s.getCurrentQueryParams();if(!u.containsParams(e))return{};var n={client_id:e.client_id,response_type:e.response_type};return t.each(["redirect_uri","scope","state"],function(r){t.has(e,r)&&(n[r]=e[r])}),n},u.getAppInfo=function(e,r,i,s){var o=u.getParams();t.isEmpty(o)||(r.oauth_credentials=o);var a=new n.Request("appstore.apps."+e,r,"GET");return a.setOnSuccess(i),a.setOnError(s),a.send(),a},u.getAppByNamespace=function(e,t,n,r){var i={store_id:e,namespace:t};return u.getAppInfo("get_by_namespace",i,n,r)},u.getAppById=function(e,t,n,r){var i={store_id:e,app_id:t};return u.getAppInfo("get_by_id",i,n,r)},u.getAuthorizationParams=function(e,n,r){var s=null;t.has(n,"state")&&(s=n.state);var o=r;return t.isUndefined(o)&&(o=n.redirect_uri),{_xsrf:i.get(),client_id:n.client_id,scope:encodeURIComponent(n.scopes),state:s,redirect_uri:o,store_ids:e,app_id:n.id}},u.getImplicitURL=function(n,i,o,a,f){var l=u.getAuthorizationParams(n,i,o);return l.as_json=1,e.post("/oauth/authorize",l,function(e){if(t.isEmpty(e.url))return r.error("No redirect URL in the /oauth/authorize response!"),f();var n=e.url.indexOf("#"),i=e.url.slice(0,n),o=e.url.slice(n+1),u=s.getQueryParams(o);r.info("Got OAuth bearer",u);var l=TT.session.getCurrentStore();l.set("oauth_bearer",u),a(e)},"json").fail(f)},u.redirectToAuthorization=function(t,n){var r=u.getAuthorizationParams(t,n),i=e('<form action="/oauth/authorize" method="post"/>');for(var s in r)i.append(e('<input type="hidden" name="'+s+'" />').val(r[s]));i.appendTo(e("body")).submit()},u}),define("dashboard/view/app/load",["require","underscore","icanhaz","tictail/core","../../view","../../module/viewloader"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.View=o.Dashboard.View||{},o.Dashboard.View.App=o.Dashboard.View.App={};var u=o.Dashboard.View.App.Load=i.extend({sectionName:"apps",className:"app-container",initialize:function(){u.__super__.initialize.apply(this,arguments);if(!this.options.slug)throw new Error("No slug given to app loader");this.loader=null,this.appView=null},didAppend:function(){this.appView===null&&this.loader===null&&(this.setLoadingSpinner(),this.load())},willRemove:function(){this.loader!==null&&(this.loader.abort(),this.loader=null)},isActiveApplication:function(e){var n=!0;switch(e){case"klarna":n=t.contains(r.session.get("klarna_countries"),r.session.getCurrentStore().get("country"))}return n},load:function(){if(!this.isActiveApplication(this.options.slug))return;var n="app/"+this.options.slug;if(!e.specified(n)){var r=this.loader=new s(n,n);r.on("complete",this.onLoadComplete,this),r.load()}else e([n],t.bind(this.initAppView,this))},onLoadComplete:function(e){this.initAppView(e),this.loader=null},initAppView:function(e){var n=t.extend({},this.options,{rootUrl:"/app/"+this.options.slug});this.appView=new e(n),this.render()},getContent:function(){return this.appView}});return u}),define("dashboard/module/apploader",["jquery","underscore","tictail/core","tictail/component/api","tictail/component/log","tictail/component/oauth","tictail/utility","../view/app/load"],function(e,t,n,r,i,s,o,u){var a=this,f=a.Dashboard=a.Dashboard||{};a.Dashboard.Module=a.Dashboard.Module||{};var l=a.Dashboard.Module.AppLoader=function(e){e=e||{},this.store=e.store,this.namespace=e.namespace,this.app_path=e.app_path?e.app_path:"",this.isLoading=!1,this.options=e,e.autoload!==!1&&this.load()};return l.prototype={ENVIRONMENT_CORE:1,ENVIRONMENT_EMBEDDED:2,ENVIRONMENT_EXTERNAL:3,load:function(){var e=this;if(e.isLoading){i.info("Already in the process of loading application.",this);return}e.isLoading=!0,e.loading();var t=s.getAppByNamespace(e.store.get("id"),e.namespace,function(t,n,r,i){e.loaded(),e.isLoading=!1,e.handle(t)},function(){e.loaded(),e.onError()})},handle:function(e){switch(e.environment){case this.ENVIRONMENT_CORE:return this.onCoreApplicationLoaded(e);case this.ENVIRONMENT_EMBEDDED:return this.onEmbeddedApplicationLoaded(e);case this.ENVIRONMENT_EXTERNAL:return this.onExternalApplicationLoaded(e)}this.onError()},loading:function(){},loaded:function(){},onCoreApplicationLoaded:function(e){var n=this.ensureInstalled(e);if(!n)return;var r="/app/"+this.namespace;t.isEmpty(this.app_path)||(r+="/"+this.app_path);var i=t.extend({},this.options,{slug:this.namespace,uri:this.app_path});this.options.navigate!==!1&&f.router.navigate(this.store.generateUrl(r)),f.setStoreDocumentTitle(e.name),f.router.layoutView.setContentView(new u(i))},onEmbeddedApplicationLoaded:function(e){var n=this.ensureInstalled(e);if(!n)return;var r="/app/"+this.namespace,i=t.extend({},this.options,{slug:"embedded",app_id:e.id});this.options.navigate!==!1&&f.router.navigate(this.store.generateUrl(r)),f.setStoreDocumentTitle(e.name),f.router.layoutView.setContentView(new u(i))},onExternalApplicationLoaded:function(e){var t=this.ensureInstalled(e);if(!t)return;i.info("Going to authorize external application",e),s.redirectToAuthorization(this.store.get("id"),e)},onError:function(){f.router.navigate(this.store.generateUrl("/apps"),{trigger:!0})},ensureInstalled:function(e){return e.is_installed?!0:(f.router.navigate(this.store.generateUrl("/apps?install="+e.namespace),{trigger:!0}),!1)}},l}),define("dashboard/module/social/follow",["underscore","tictail/core","tictail/component/api","tictail/component/actionbar","tictail/form/core","tictail/form/field/textarea","../../view"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.Module=u.Dashboard.Module||{},u.Dashboard.Module.Social=u.Dashboard.Module.Social||{};var a=u.Dashboard.Module.Social.Follow=o.extend({id:"social-prompt-view",template:"module/overlay",container:".content",initialize:function(e){a.__super__.initialize.apply(this,arguments),this.model||(this.model=new t.Model),this.lang=e.lang},getTemplateData:function(){return{heading:this.lang.heading,description:this.lang.description}},getContent:function(){return t.getLazy(this,"followView",function(){var e=new f({model:this.model,lang:this.lang});return e.on("onSave",this.onSave,this),e})},onSave:function(){this.trigger("onDone",this)},onCancel:function(){this.trigger("onDone",this)}}),f=u.Dashboard.Module.Social.Follow.FollowView=o.extend({id:"social-prompt-follow-view",template:"module/social/follow",events:{"click .continue-link":"onClickContinue"},initialize:function(e){f.__super__.initialize.apply(this,arguments),this.lang=e.lang},getTemplateData:function(){return{continue_link_label:this.lang.continue_link_label}},onClickContinue:function(e){e.preventDefault(),this.trigger("onSave",this)}});return a}),define("dashboard/module/subnavigation",["jquery","underscore","tictail/component/actionbar"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Module=r.Dashboard.Module||{};var i=r.Dashboard.Module.Subnavigation=n.extend({id:"subnav",tagName:"nav",attributes:{},template:"module/subnavigation",paramsCacheKey:"subnavigationParams",dataCacheKey:"subnavigationData",delegateEventPrefix:"subnavigation",getInitializedPage:function(e){var n=this.getParamsByName(e)||{},r=n.page;if(r===undefined)return!1;var i=t.extend({isSubpage:!0},r.params),s=new r.cls(i);return r.cached=s,s},setSelectedPage:function(n){var r=this.getParams()||{},i=null;t.each(r,function(e,t){e.page&&e.page.cached===n&&(i=t)}),e("li",this.el).removeClass("selected"),i&&e("#name-"+i,this.el).parent("li").addClass("selected")}});return i}),define("dashboard/module/layout",["tictail/core","./subnavigation","../view"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Module=r.Dashboard.Module||{};var i=r.Dashboard.Module.Layout=n.extend({id:"page",attributes:{"class":"appsize"},hasSubnavigation:!1,template:"module/layout",page:undefined,previousPage:undefined,initialize:function(e,n){i.__super__.initialize.call(this,e),this.setPage(n);if(this.hasSubnavigation!==!0)return;this.subnavigation=new t({},this)},setPage:function(e){var t=this.page;this.page=e?e:this.page;if(this.page===undefined)return;this.previousPage=t},setPageBySubnavigationName:function(e){this.setPage(this.subnavigation.getInitializedPage(e))},subnavigationGetParams:function(){throw new Error("No data specified for subnavigation in layout")},subnavigationDidClickItem:function(e,t,n){if(n.isButton)return;var r=n.url;r!==undefined&&Dashboard.router.navigate(r,{trigger:!1}),this.setPageBySubnavigationName(t),this.renderPage()},getTemplateData:function(){var t=this;return e.getLazy(this,"data",function(){return{has_subnavigation:t.hasSubnavigation,page_title:t.page.getTitle()}})},renderContent:function(){return this.subnavigation!==undefined&&this.addChildView(this.subnavigation),this.renderPage(),this},renderPage:function(){this.previousPage!==undefined&&(this.removeChildView(this.previousPage),this.previousPage=undefined);var e=this.page;return e.id="page",e.attributes={},e.$el.removeClass("appsize"),this.addChildView(e),this.subnavigation.setSelectedPage(e),!0}});return i}),define("tictail/model/store/logotype",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Logotype=e.Model.extend({API_NAMESPACE:"store.media.logotype"});return n}),define("tictail/model/store/description",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Description=e.Model.extend({API_NAMESPACE:"store.description",sync:function(t,n,r){return t==="create"&&(t="update"),e.sync(t,n,r)}});return n}),define("tictail/model/store/settings/general",["../../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{},t.TT.Model.Store.Settings=t.TT.Model.Store.Settings||{};var n=t.TT.Model.Store.Settings.General=e.Model.extend({API_NAMESPACE:"store.settings.general",sync:function(t,n,r){return t==="create"&&(t="save"),e.sync(t,n,r)}});return n}),define("dashboard/form/field/store/name",["tictail/form/field/text"],function(e){var t=this;t.Dashboard=t.Dashboard||{},t.Dashboard.Form=t.Dashboard.Form||{},t.Dashboard.Form.Field=t.Dashboard.Form.Field={},t.Dashboard.Form.Field.Store=t.Dashboard.Form.Field.Store||{};var n=t.Dashboard.Form.Field.Store.Name=e.extend({});return n}),define("dashboard/form/field/store/logo",["underscore","tictail/core","tictail/component/api","tictail/form/field/input","../../../module/imageupload"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.Form=s.Dashboard.Form||{},s.Dashboard.Form.Field=s.Dashboard.Form.Field={},s.Dashboard.Form.Field.Store=s.Dashboard.Form.Field.Store||{};var o=s.Dashboard.Form.Field.Store.Logo=r.extend({fieldTagName:"div",attributes:{"class":"field full-width"},initialize:function(){o.__super__.initialize.apply(this,arguments),this._uploadsInProgress=0,this._pendingDeferreds=[],this._pendingRequest=null},hasPendingRequest:function(){return this._pendingRequest!==null},getPendingRequest:function(){return this._pendingRequest},clearPendingRequest:function(){this._pendingRequest=null},getLabel:function(){return null},renderField:function(){this.addChildView(this._getImageUploader())},_getFieldNode:function(){return null},_getFieldValue:function(){var e=this._getImageUploader().images.first();if(e){var t={filename:e.get("filename"),extension:e.get("extension"),width:e.get("width"),height:e.get("height")};return e.id&&(t.id=e.id),t}return null},_validateRemote:function(e,t){this._uploadsInProgress>0?this._pendingDeferreds.push(t):t.resolve(this)},_getImageUploader:function(){var n=this;return t.getLazy(this,"_imageUploader",function(){var r=t.session.getCurrentStore().get("id"),s=new t.Collection,o=n.getValueFromModel();e.isEmpty(o)||s.add(o);var u=new i({url:"/media/upload/logotype/"+r,type:"logotype",thumbnailWidth:150,thumbnailHeight:150,images:s});return u.tabIndex=n.tabIndex,u.on("onStart",n.onUploadStart,n),u.on("onComplete",n.onUploadComplete,n),u.on("onImageAdd",n.onImageAdd,n),u.on("onImageRemove",n.onImageRemove,n),u})},onUploadStart:function(e){this._uploadsInProgress++},onUploadComplete:function(e){var t=1,n=e.result[0].width,r=e.result[0].height;n>=r?(max_width=n>300?300:n,t=max_width/n,n*=t,r*=t):(max_height=r>300?300:r,t=max_height/r,n*=t,r*=t),this.$("li.file").css("width",n),this.$("li.file").css("height",r),this._uploadsInProgress--;if(this._uploadsInProgress>0)return;var i=this._pendingDeferreds;if(i.length!==0){for(var s=i.length-1;s>=0;s--)i[s].resolve(this);i.length=0}},onImageAdd:function(e){this.onChange(),this._pendingRequest=new n.Request("store.media.logotype.set",{store_id:t.session.getCurrentStore().id,filename:e.get("filename"),width:e.get("width"),height:e.get("height")},"POST")},onImageRemove:function(e){this.onChange(),this._pendingRequest=new n.Request("store.media.logotype.delete",{store_id:t.session.getCurrentStore().id},"POST")}});return o}),define("tictail/form/field/url",["jquery","./text"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{},n.TT.Form.Field=n.TT.Form.Field||{};var r=n.TT.Form.Field.URL=t.extend({fieldAttributes:{type:"url"},pattern:/^\S+\.\S+/,protocolPattern:/^\S+:\/\//,_sanitize:function(t){return t&&!this.protocolPattern.test(t)&&(t="http://"+t),e.trim(t)},_validate:function(e){var t=r.__super__._validate.call(this,e);return this.pattern.test(e)||t.push("This does not seem like a valid URL"),t}});return r}),define("dashboard/form/field/store/blogurl",["jquery","tictail/core","tictail/form/field/url","i18n!../../../nls/settings"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Form=i.Dashboard.Form||{},i.Dashboard.Form.Field=i.Dashboard.Form.Field={},i.Dashboard.Form.Field.Store=i.Dashboard.Form.Field.Store||{};var s=i.Dashboard.Form.Field.Store.BlogURL=n.extend({attributes:{"class":"field store-blog-url-field"},setNodeValue:function(e){s.__super__.setNodeValue.call(this,e),this.$el.toggleClass("closed",!e)},renderField:function(){var t=e('<div class="imprint"/>').append(this._getOpenButtonNode()).append(this._getFieldNode());this.$el.append(t)},_getOpenButtonNode:function(){var n=this;return t.getLazy(this,"_openButton",function(){return e('<button type="button" class="open-button"/>').attr("tabindex",n.tabIndex).text(r.general.button.blog.label).click(function(){n.$el.removeClass("closed"),n.setFocus()})})}});return s}),define("dashboard/form/field/store/subdomain",["jquery","tictail/component/log","tictail/component/api","tictail/form/field/text"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Form=i.Dashboard.Form||{},i.Dashboard.Form.Field=i.Dashboard.Form.Field={},i.Dashboard.Form.Field.Store=i.Dashboard.Form.Field.Store||{};var s=i.Dashboard.Form.Field.Store.Subdomain=r.extend({attributes:{"class":"field store-subdomain-field"},pattern:/^[a-z0-9]+$/,initialize:function(e){e=e||{},e.minLength=4,e.maxLength=32,this.dbValue=null,this.lastValidValue=null,s.__super__.initialize.call(this,e)},setInitValue:function(e){s.__super__.setInitValue.call(this,e),this.dbValue=e,this.lastValidValue=e},_sanitize:function(e){return e.toLowerCase()},_validate:function(e){var t=s.__super__._validate.call(this,e);return this.pattern.test(e)||t.push("This is not a valid subdomain (only letters and number are allowed)"),t},_validateRemote:function(e,r){if(e===this.lastValidValue||e===this.dbValue){r.resolve(this);return}var i=this,s=new n.Request("store.exists",{subdomain:e},"GET",null);s.setOnSuccess(function(t,n,s,o){t.exists?r.reject(["This domain is unavailable"],i):(i.lastValidValue=e,r.resolve(i))}),s.setOnError(function(e,n,s,o){t.error("Subdomain lookup failed",e,s,o,n),r.reject(["We couldn't check the availability of this subdomain"],i)}),s.send()},renderField:function(){e('<div class="wrap"/>').append(this._getFieldNode()).append('<span class="base-domain">.tictail.com</span>').appendTo(this.el)},onChange:function(e){s.__super__.onChange.call(this,e),this.value!==this.lastValidValue&&this.validate()}});return s}),define("dashboard/form/settings/general",["underscore","tictail/core","tictail/component/api","tictail/component/tracker","tictail/form/core","tictail/form/fieldset","tictail/form/field/wysiwyg","tictail/form/field/email","tictail/form/field/switch","../field/store/name","../field/store/logo","../field/store/blogurl","../field/store/subdomain","i18n!../../nls/settings"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=this;d.Dashboard=d.Dashboard||{},d.Dashboard.Form=d.Dashboard.Form||{},d.Dashboard.Form.Settings=d.Dashboard.Form.Settings={};var v=d.Dashboard.Form.Settings.General=i.extend({storeInfoFields:["set-store-name","set-store-description","set-store-subdomain"],logoFields:["set-store-logo"],contactFields:["set-store-email"],socialFields:["set-store-blog-url"],statusFields:["set-store-online"],allFields:function(){return this.allFields=this.storeInfoFields.concat(this.logoFields,this.contactFields,this.socialFields,this.statusFields),this.allFields},createField:function(e){return e==="set-store-name"?new f({key:e,model:{attribute:"name",instance:this.model},label:p.general.field.store_name.label,required:!0,minLength:1,maxLength:255}):e==="set-store-description"?new o({key:e,model:{attribute:"description",instance:this.model},label:p.general.field.store_description.label,information:p.general.field.store_description.information,minLength:1,maxLength:65535}):e==="set-store-logo"?new l({key:e,model:{attribute:"logotype",instance:this.model}}):e==="set-store-email"?new u({key:e,model:{attribute:"email",instance:this.model},label:p.general.field.store_email.label,information:p.general.field.store_email.information,maxLength:128}):e==="set-store-subdomain"?new h({key:e,model:{attribute:"subdomain",instance:this.model},label:p.general.field.store_subdomain.label,information:p.general.field.store_subdomain.information,required:!0}):e==="set-store-online"?new a({key:e,model:{attribute:"online",instance:this.model},label:p.general.field.store_online.label,information:p.general.field.store_online.information}):e==="set-store-blog-url"?new c({key:e,label:p.general.field.store_blog_url.label,model:{attribute:"blog_url",instance:this.model},fieldAttributes:{placeholder:p.general.field.store_blog_url.placeholder},information:p.general.field.store_blog_url.information,maxLength:255}):null},renderStoreInfo:function(){var t=this.getFields(this.storeInfoFields);if(e.isEmpty(t))return!1;var n=new s({title:p.general.section.info.title,description:p.general.section.info.description,rightColumnContent:t});return this.addChildView(n),!0},renderLogo:function(){var t=this.getFields(this.logoFields);if(e.isEmpty(t))return!1;var n=new s({title:p.general.section.logo.title,description:p.general.section.logo.description,rightColumnContent:this.getFields(this.logoFields)});return this.addChildView(n),!0},renderContact:function(){var t=this.getFields(this.contactFields);if(e.isEmpty(t))return!1;var n=new s({title:p.general.section.contact.title,description:p.general.section.contact.description,rightColumnContent:t});return this.addChildView(n),!0},renderSocial:function(){var t=this.getFields(this.socialFields);if(e.isEmpty(t))return!1;var n=new s({title:p.general.section.social.title,description:p.general.section.social.description,rightColumnContent:this.getFields(this.socialFields)});return this.addChildView(n),!0},renderStatus:function(){var t=this.getFields(this.statusFields);if(e.isEmpty(t))return!1;var n=new s({title:p.general.section.status.title,description:p.general.section.status.description,rightColumnContent:t});return this.addChildView(n),!0},render:function(){return this.empty(),this.renderStoreInfo(),this.renderLogo(),this.renderSocial(),this.renderContact(),this.renderStatus(),this.addChildView(this.actionbar),this.didRender()},save:function(){var e;if(this.isIncluded("set-store-logo")===!0){var t=this.getField("set-store-logo"),n=t.getPendingRequest();n!==null&&(e=[n],t.clearPendingRequest())}v.__super__.save.call(this,e)},onSuccessfulSave:function(){var e=t.session.getCurrentStore(),n={name:this.model.get("name"),email:this.model.get("email"),subdomain:this.model.get("subdomain"),url:this.model.get("url"),blog_url:this.model.get("blog_url"),online:this.model.get("online"),logotype:this.model.get("logotype")};this.trackSavedAttributes(e),e.set(n),v.__super__.onSuccessfulSave.apply(this,arguments)},trackSavedAttributes:function(t){e.each(this.getAllFields(),function(e){var n=e.modelAttributeName;if(e.value!=t.get(n)){var i="From "+t.get(n)+" to "+e.value;r.track("Changed Store "+n,i)}}),this.isIncluded("set-store-online")&&this.model.get("online")!=t.get("online")&&(this.model.get("online")?r.track("Set Store Online"):r.track("Set Store Offline")),r.register({store_subdomain:this.model.get("subdomain"),store_online:this.model.get("online")}),(e.isUndefined(this.included)===!0||this.getSortedFields().length==this.allFields.length)&&r.track("Saved General Settings")}});return v}),define("dashboard/view/settings/general",["underscore","tictail/core","tictail/component/api","tictail/model/store/logotype","tictail/model/store/description","tictail/model/store/settings/general","../../module/loadpage","../../form/settings/general","i18n!../../nls/settings"],function(e,t,n,r,i,s,o,u,a){var f=this;f.Dashboard=f.Dashboard||{},f.Dashboard.View=f.Dashboard.View||{},f.Dashboard.View.Settings=f.Dashboard.View.Settings={};var l=f.Dashboard.View.Settings.General=o.extend({bodyId:"settings-general-view",included:["store-info","logo","contact","social","status"],initialize:function(t){t=t||{},e.isArray(t.include)===!0&&(this.included=t.include),l.__super__.initialize.call(this,t)},isIncluded:function(t){return e.indexOf(this.included,t)!==-1},load:function(){var e=new n.Batch,o=t.session.getCurrentStore().id,u=new s,a=function(t){var n=t.fetch({getRequest:!0,success:function(){u.set(t.attributes)}});n.params||(n.params={}),n.params.store_id=o,e.appendRequest(n)};this.isIncluded("logo")&&a(new r),this.isIncluded("store-info")&&a(new i);if(e.getStackLength()===0){this.useCachedData(u);return}e.on("complete",function(e){this.didLoad(u)},this),e.send()},getStoreData:function(){var e=t.session.getCurrentStore();return{store_id:e.id,name:e.get("name"),email:e.get("email"),subdomain:e.get("subdomain"),blog_url:e.get("blog_url"),online:e.get("online")}},didLoad:function(t){if(t){var n=this.getStoreData(),r={silent:!0};e.each(n,function(e,n){t.has(n)||t.set(n,e,r)}),t.change()}l.__super__.didLoad.call(this,t)},getForm:function(){return t.getLazy(this,"form",function(){var t,n=u.prototype;this.formInclude!==undefined?t=this.formInclude:(t=[],this.isIncluded("store-info")&&(t=t.concat(n.storeInfoFields)),this.isIncluded("logo")&&(t=t.concat(n.logoFields)),this.isIncluded("contact")&&(t=t.concat(n.contactFields)),this.isIncluded("social")&&(t=t.concat(n.socialFields)),this.isIncluded("status")&&(t=t.concat(n.statusFields)));var r=e.extend({model:this.data,include:t},this.formOptions),i=new u(r);return i.on("onSave",this.onSave,this),i.on("onSaveError",this.onSaveError,this),i})},onSave:function(){Dashboard.showStatusHud("Saved!")},onSaveError:function(){},getLoadedContent:function(){return this.getForm()},getTitle:function(){return a.general.page_title},setFocus:function(){this.form!==undefined&&this.form.setFocus()}});return l}),define("tictail/model/store/tax",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Tax=e.Model.extend({API_NAMESPACE:"store.settings.tax"});return n}),define("tictail/model/store/payment/paypal",["../../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{},t.TT.Model.Store.Payment=t.TT.Model.Store.Payment||{};var n=t.TT.Model.Store.Payment.Paypal=e.Model.extend({API_NAMESPACE:"store.payment.paypal",getReadParams:function(){return{store_id:this.get("store_id")}}});return n}),define("tictail/model/store/settings/fulfillment",["tictail/core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{},t.TT.Model.Store.Settings=t.TT.Model.Store.Settings||{};var n=t.TT.Model.Store.Settings.Fulfillment=e.Model.extend({API_NAMESPACE:"store.settings.fulfillment",sync:function(t,n,r){if(t=="create")return t="save",e.sync(t,n,r)}});return n}),define("tictail/component/state",["underscore"],function(e){var t=this;t.TT=t.TT||{};var n=t.TT.State={states:window.States,orderList:window.StateOrder,asList:[],getByCode:function(e){if(!e)return null;var t=e.substr(0,2);return t=this.states[t],t?t[e]||null:null},getNameByCode:function(e){var t=this.getByCode(e);return t?t.name:null},getTaxByCode:function(e){var t=this.getByCode(e);return t?t.tax||0:0},getList:function(t){var n=this,r=[],i=this.asList[t];return e.isUndefined(i)!==!0?i:(e.each(this.orderList[t],function(e){var i=n.states[t][e];i.code=e,r.push(i)}),this.asList[t]=r,r)},explodeStateCode:function(e){var t=String(e).split("-");return{country:t[0],state:t[1]}},implodeStateCode:function(e,t){return typeof e!="string"&&(t=e.state,e=e.country),e+"-"+t},countryHasStates:function(t){return!e.isEmpty(this.states[t])}};return n}),define("tictail/form/field/percentage",["underscore","./number"],function(e,t){var n=this;n.TT=n.TT||{},n.TT.Form=n.TT.Form||{},n.TT.Form.Field=n.TT.Form.Field||{};var r=n.TT.Form.Field.Percentage=t.extend({attributes:{"class":"field percentage-field"},fieldAttributes:{type:"number"},_sanitize:function(e){return e},_validate:function(n){var r=t.__super__._validate.call(this,n),i=this.options;return n*=100,e.isNumber(i.minValue)&&n<i.minValue?r.push("Cannot be less than "+i.minValue):e.isNumber(i.maxValue)&&n>i.maxValue&&r.push("Cannot be more than "+i.maxValue),r},_setFieldValue:function(e){e=this.roundToFieldPrecision(e*100),r.__super__._setFieldValue.call(this,e)},_getFieldValue:function(){return this._getFieldNode().val()/100}});return r}),define("tictail/component/region",["underscore"],function(e){var t=this;t.TT=t.TT||{};var n=t.TT.Region={regions:window.Regions,getCodesByCountry:function(t){var n=[];return this.regions==void 0?n:($.each(this.regions,function(r,i){var s=e.indexOf(i.members,t)>=0;s&&n.push(r)}),n)},getRegionsByCountry:function(t){var n=[];return this.regions==void 0?n:($.each(this.regions,function(r,i){var s=e.indexOf(i.members,t)>=0;s&&n.push({code:r,name:i.name})}),n)}};return n}),define("tictail/component/continent",["underscore","./country"],function(e,t){var n=this;n.TT=n.TT||{};var r=n.TT.Continent={world:"C_WORLD",continents:window.Continents,cachedList:undefined,getByCode:function(e){return this.continents[e]},getNameByCode:function(e){var t=this.getByCode(e);return t?t.name:null},getCodeByCountry:function(e){var n=t.getByCode(e);return n?n.continent:null},getList:function(){var t=[],n=this.cachedList;return e.isUndefined(n)!==!0?n:($.each(this.continents,function(e,n){n.code=e,t.push(n)}),this.cachedList=t,t)}};return r}),define("dashboard/form/field/store/tax",["tictail/core","tictail/component/state","tictail/component/region","tictail/component/country","tictail/component/continent","tictail/form/field/select","tictail/form/field/compound","tictail/form/field/percentage","tictail/form/field/switch","i18n!../../../nls/settings"],function(e,t,n,r,i,s,o,u,a,f){var l=this;l.Dashboard=l.Dashboard||{},l.Dashboard.Form=l.Dashboard.Form||{},l.Dashboard.Form.Field=l.Dashboard.Form.Field={},l.Dashboard.Form.Field.Store=l.Dashboard.Form.Field.Store||{};var c=o.extend({attributes:{"class":"field imprint tax-options-field"},getTaxShippingField:function(){var t=f.fulfillment.field.tax,n=t.shipping.label,r=t.shipping.labelDescription;return e.getLazy(this,"_taxShippingField",function(){var e=new a({key:"set-taxshipping-field",model:{instance:this.model,attribute:"shipping"},attributes:{"class":"field tax-shipping-field"},label:n,labelDescription:r}),t=this;return e.on("onChange",function(){t.trigger("onChange")}),this.registerSubfield(e),e})},getPricesIncludeTaxField:function(){var t=f.fulfillment.field.tax,n=t.pricesIncludeTax.label,r=t.pricesIncludeTax.labelDescription;return e.getLazy(this,"_pricesIncludeTaxField",function(){var e=new a({key:"set-prices-include-tax-field",model:{instance:this.model,attribute:"prices_include_tax"},attributes:{"class":"field prices-include-tax-field"},label:n,labelDescription:r}),t=this;return e.on("onChange",function(){t.trigger("onChange")}),this.registerSubfield(e),e})},renderField:function(){var e=$("<div/>").appendTo(this.$el);this.addChildView(this.getPricesIncludeTaxField(),e),this.addChildView(this.getTaxShippingField(),e)}}),h=l.Dashboard.Form.Field.Store.Tax=o.extend({attributes:{"class":"field tax-field full-width"},initialize:function(){h.__super__.initialize.apply(this,arguments),this.selectedCountry=this.options.selectedCountry||e.session.getCurrentStore().get("country"),this.selectedState=this.options.selectedState||e.session.getCurrentStore().get("state")},setSelectedState:function(e){if(e===this.selectedState)return;this.selectedState=e,this.model.set("percentage",t.getTaxByCode(this.selectedState)),this.getTaxRegionField().setChoices(this.getTaxRegions()),this.model.set("region",this.selectedState)},setSelectedCountry:function(e){if(e===this.selectedCountry)return;this.selectedCountry=e,this.selectedState=null,this.model.set("percentage",r.getTaxByCode(e)),this.getTaxRegionField().setChoices(this.getTaxRegions());var t=n.getRegionsByCountry(e);t.length!==0&&this.model.set("region",t[0].code)},getPercentageField:function(){return e.getLazy(this,"_percentageField",function(){var e=new u({key:"set-percentage-field",model:{instance:this.model,attribute:"percentage"},label:f.fulfillment.field.tax.percentage.label,minValue:0,maxValue:100,stepSize:1e-4}),t=this;return e.on("onChange",function(){t.trigger("onChange")}),this.registerSubfield(e),e})},getTaxRegions:function(){var e=[],s=f.fulfillment.field.tax.world_label,o=this.selectedCountry,u=r.getNameByCode(o),a=this.selectedState,l=t.getNameByCode(a),c=n.getRegionsByCountry(o);return l&&e.push({value:a,label:l}),e.push({value:o,label:u}),$.each(c,function(t,n){e.push({value:n.code,label:n.name})}),e.push({value:i.world,label:s}),e},getTaxRegionField:function(){return e.getLazy(this,"_taxRegionField",function(){var e=new s({key:"set-taxregion-field",model:{instance:this.model,attribute:"region"},attributes:{"class":"field tax-region-field"},label:f.fulfillment.field.tax.region.label,choices:this.getTaxRegions()}),t=this;return e.on("onChange",function(){t.trigger("onChange")}),this.registerSubfield(e),e})},getTaxOptionsField:function(){var t=f.fulfillment.field.tax,n=t.options.information;return e.getLazy(this,"_taxOptionsField",function(){var e=new c({key:"tax-options-field",model:{instance:this.model},information:n}),t=this;return e.on("onChange",function(){t.trigger("onChange")}),this.registerSubfield(e),e})},renderField:function(){var e=$("<div/>").appendTo(this.$el);this.addChildView(this.getPercentageField(),e),this.addChildView(this.getTaxRegionField(),e),this.addChildView(this.getTaxOptionsField(),e)}});return h}),define("tictail/form/field/multiselect",["jquery","underscore","./select","i18n!../../nls/field"],function(e,t,n,r){var i=this;i.TT=i.TT||{},i.TT.Form=i.TT.Form||{},i.TT.Form.Field=i.TT.Form.Field||{};var s=8,o=9,u=13,a=16,f=17,l=18,c=19,h=20,p=27,d=33,v=34,m=35,g=36,y=37,b=38,w=39,E=40,S=45,x=46,T=91,N=92,C=i.TT.Form.Field.MultiSelect=n.extend({chosen:[],dividers:[],attributes:{"class":"field multi-select-field"},fieldAttributes:{multiple:"multiple"},itemRemoved:!1,firstAction:!1,events:function(){var e=C.__super__.events.call(this);return e["click .search-container"]="onClickContainer",e["focusin .search-field"]="onFocusIn",e["keydown .search-field"]="onKeyDown",e["keyup .search-field"]="onKeyUp",e},initialize:function(e){e=e||{},this.chosen=[],this.dividers=e.dividers||[],this.fieldAttributes=t.extend({},this.fieldAttributes,e.fieldAttributes||{}),C.__super__.initialize.call(this,e),this.fieldNode=this._getFieldNode()},setChoices:function(e){var t=this._getFieldNode(),n=t.val();this.choices=e||[],this.renderChoices(),t.triggerHandler("changeOptions"),this.$(".chosen-option").remove(),this.didAppend(),t.val()!==n&&t.change()},renderField:function(){this.renderChoices(),this.resultContainer=e('<div class="result-container"/>'),this.searchContainer=e('<div class="search-container"/>');var t=e("<ul/>").addClass("result-list"),n=e("<ul/>").addClass("search-list"),r=e("<input/>").addClass("search-field"),i=e("<li/>").addClass("search-field-container");n.append(i.append(r)),this.$el.append(this.fieldNode),this.$el.append(this.searchContainer.append(n)),this.$el.append(this.resultContainer.append(t)),r.attr("tabindex",this.fieldNode.attr("tabindex"))},didAppend:function(){this.chosen=this.fieldNode.val()||[],this.chosen.length?(this.populateField(this.chosen),this.resizeInputField()):this.showPlaceholder()},populateField:function(t){var n=this;e.each(t,function(e,t){var r='option[value="'+t+'"]',i=n.fieldNode.find(r).text();n.addChosenItem(i,t)})},showPlaceholder:function(){var e=this.$(".search-field"),t=this.fieldAttributes.placeholder;e.css("width",this.searchContainer.width()+"px").attr("placeholder",t)},hidePlaceholder:function(){this.$(".search-field").attr("placeholder",null)},getDivider:function(e){return t.find(this.dividers,function(n){return t.isObject(n)?n.index===e:n===e})},renderOptions:function(n,i){var s=this,o=[],u=0,a=0,f=this.$(".result-list"),l=this.fieldNode[0].options;try{var c=new RegExp(n,"ig")}catch(h){var c=new RegExp("","ig")}n?(this.resultContainer.show(),e.each(l,function(e,n){var r=t.indexOf(i,n.value)<0;r&&n.text.match(c)&&o.push(n)})):o=l,f.empty(),e.each(o,function(r,o){var l=s.getDivider(r);if(a&&!n&&l){var c;t.isObject(l)?(c=sprintf('<div><hr><span class="divider-label">%s</span></div>',l.label),c=e(c)):c=e("<hr>"),c.appendTo(f),a=0}if(t.indexOf(i,o.value)<0){var h=e('<li class="result-option"/>').click(function(t){s.onClickOption(e(this))}).data("index",o.value).text(o.text).appendTo(f);if(t.isUndefined(o.icon)===!1){var p=e('<span class="icon">');o.icon!==""&&p.css("background-image","url("+o.icon+")"),h.append(p)}t.isUndefined(o.className)===!1&&h.addClass(o.className),u++,a++}});if(!u){if(n)var p=r.multiselect.no_match;else var p=r.multiselect.no_left;e("<li/>").text(p).addClass("sorry").appendTo(f)}else this.selectOption(this.$(".result-option").first())},addChosenItem:function(t,n){var i=this,s=r.multiselect.remove_item,o=e('<a href="#" class="remove manual"/>').text(s).click(function(t){t.preventDefault(),i.removeOption(e(this).parent())}),u=e('<li class="chosen-option"/>').data("index",n).insertBefore(this.$(".search-field-container"));u.append(o,t)},selectNext:function(){this.navigateList("next")},selectPrevious:function(){this.navigateList("prev")},navigateList:function(e){var t=this.$(".result-list").find(".selected"),n=t[e](".result-option");n.length||(n=t[e]()[e](".result-option")),n.length&&(this.selectOption(n),this.ensureItemIsVisible(n))},selectOption:function(e){this.$(".result-list li").removeClass("selected"),e.addClass("selected")},deselectOption:function(){var e=this.$(".result-list").find(".selected");e.removeClass("selected")},ensureItemIsVisible:function(e){var t=this.resultContainer,n=t.offset(),r=t.height(),i=e.offset(),s=e.outerHeight();n.top>i.top?t.scrollTop(i.top-n.top+t.scrollTop()):n.top+r<i.top+s&&t.scrollTop(i.top+s-(n.top+r)+t.scrollTop())},onEnterOption:function(e){this.addOption(e)},onClickOption:function(e){this.addOption(e),this.$("input").focus()},addOption:function(e){if(!e.length)return!1;var n=e.data("index"),r=this.fieldNode.val()||[];r.push(n),this.fieldNode.val(r).change(),t.indexOf(this.chosen,n)<0&&this.chosen.push(n),this.addChosenItem(e.text(),n),this.$("input").val(""),this.renderOptions(null,this.chosen),this.closeResult(),this.hidePlaceholder(),this.resizeInputField()},removeOption:function(e){var n=-1,r=e.data("index"),i=this.fieldNode.val()||[];n=t.indexOf(i,r),n>=0&&(i.splice(n,1),this.fieldNode.val(i).change()),n=t.indexOf(this.chosen,r),n>=0&&this.chosen.splice(n,1),this.chosen.length==0&&this.showPlaceholder(),e.remove(),this.itemRemoved=!0},setError:function(e){C.__super__.setError.call(this,e),this.searchContainer.addClass("error")},unsetError:function(){C.__super__.unsetError.call(this),this.searchContainer.removeClass("error")},resizeInputField:function(){var t=this.$("input");if(this.chosen.length>0){var n=e("<span/>").css("font-size",t.css("font-size")).append(t.val()).appendTo("body"),r=n.width()+50;n.remove(),r<this.searchContainer.width()?t.width(r):t.width(this.searchContainer.width())}},onClickContainer:function(){var e=this.$("input");e.is(":focus")||e.focus(),this.isResultOpen()||this.openResult()},onFocusIn:function(){this.openResult(),this.firstAction=!0},openResult:function(){var t=this.$("input");this.onClickOutside=this.onClickOutside||function(t){e(t.target).parents().add(t.target).is(t.data.$el)||t.data.closeResult()},this.resultContainer.show(),this.renderOptions(t.val(),this.chosen),e("html").bind("click",this,this.onClickOutside)},closeResult:function(){this.resultContainer.hide(),this.deselectOption(),e("html").unbind("click",this.onClickOutside)},isResultOpen:function(){return this.resultContainer.is(":visible")},onKeyDown:function(e){var t=this.$(".search-list").find("li").last().prev();switch(e.which){case s:if(this.$("input").val())break;t.hasClass("selected")?this.removeOption(t):t.addClass("selected");return;case u:e.preventDefault();var n=this.$(".result-list").find(".selected");this.onEnterOption(n);break;case p:var r=this.$("input");this.closeResult(),r.val(""),this.resizeInputField();break;case o:var n=this.$(".result-list").find(".selected"),r=this.$("input");n.length>0&&!this.firstAction?(e.preventDefault(),this.onEnterOption(n)):(this.closeResult(),r.val(""));break;case b:this.selectPrevious(),e.preventDefault();break;case E:this.isResultOpen()?this.selectNext():this.openResult()}this.firstAction=this.toggleFirstAction(e.which),t.removeClass("selected")},toggleFirstAction:function(e){if(this.firstAction)switch(e){case a:case f:case l:case c:case h:case d:case v:case m:case g:case S:case x:case T:case N:return!0}return!1},onKeyUp:function(e){switch(e.which){case u:case b:case E:case p:case o:case a:case f:case l:case c:case h:case d:case v:case m:case g:case S:case x:case T:case N:return}this.resizeInputField();var t=this.$("input").val();if(e.which===s){var n=this.$(".search-list").find("li").last().prev();if(n.hasClass("selected")||this.itemRemoved===!0){this.closeResult();return}}this.itemRemoved=!1,this.renderOptions(t,this.chosen)}});return C}),define("dashboard/form/field/store/shippingoption",["jquery","tictail/core","tictail/form/field/compound","tictail/form/field/number","tictail/form/field/text","tictail/form/field/checkbox","tictail/form/field/multiselect","tictail/component/region","tictail/component/state","tictail/component/country","tictail/component/continent","i18n!../../../nls/settings"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this;h.Dashboard=h.Dashboard||{},h.Dashboard.Form=h.Dashboard.Form||{},h.Dashboard.Form.Field=h.Dashboard.Form.Field={},h.Dashboard.Form.Field.Store=h.Dashboard.Form.Field.Store||{};var p=h.Dashboard.Form.Field.Store.ShippingOption=n.extend({attributes:{"class":"field shipping-delivery-field"},getMinimumField:function(){var e=this;return t.getLazy(this,"_minimumField",function(){var t=new r({key:"set-minimum-delivery-"+e.model.cid,model:{instance:e.model,attribute:"minimum_delivery_days"},fieldAttributes:{placeholder:e.options.minimumPlaceholder},minValue:0,maxValue:255,stepSize:1,validateOnSet:e.options.validateOnSet});return t.on("onChange",function(){e.trigger("onChange")}),e.registerSubfield(t),t})},getMaximumField:function(){var e=this;return t.getLazy(this,"_maximumField",function(){var t=new r({key:"set-maximum-delivery-"+e.model.cid,model:{instance:e.model,attribute:"maximum_delivery_days"},fieldAttributes:{placeholder:e.options.maximumPlaceholder},minValue:0,maxValue:255,stepSize:1,validateOnSet:e.options.validateOnSet});return t.on("onChange",function(){e.trigger("onChange")}),e.registerSubfield(t),t})},renderField:function(){this.addChildView(this.getMinimumField()),this.$el.append(" - "),this.addChildView(this.getMaximumField())}}),d=n.extend({attributes:{"class":"field full-width bottom-gap shipping-option-field"},initialize:function(){d.__super__.initialize.apply(this,arguments),this.collection=this.options.collection;if(!this.collection)throw new Error("ShippingOptionField must be given a collection")},events:function(){var e={};return e["click .more-options"]="onClickMoreOptions",e},setCurrency:function(e){var t=this.getCostField();t.options.currency=e,t.render()},updateDestination:function(e){var t=this.getDestinationField();shippingRegions=this.getShippingRegions(e),t.dividers=this.getDestinationDividers(e),t.setChoices(shippingRegions)},getDestinationDividers:function(e){var t=this.getCurrentLocation(e).length,n=t+this.getCountryList().length-1;states=this.getStateList([e.get("state")],e.get("country")).length,countryName=f.getNameByCode(e.get("country"));if(states>0){var r=states+t,n=r+n-t;return[{index:t,label:countryName},{index:r,label:"Countries"},{index:n,label:"Continents"}]}return[{index:t,label:"Countries"},{index:n,label:"Continents"}]},getStateList:function(t,n){var r=[],i=t||[],s=a.getList(n);return e.each(s,function(e,t){_.indexOf(i,t.code)<0&&r.push({value:t.code,label:t.name})}),r},getCountryList:function(t){var n=[],r=t||[],i=f.getList();return e.each(i,function(e,t){_.indexOf(r,t.code)<0&&n.push({value:t.code,label:t.name})}),n},getContinentList:function(t){var n=[],r=t||[],i=l.getList();return e.each(i,function(e,t){_.indexOf(r,t.code)<0&&n.push({value:t.code,label:t.name})}),n},getCurrentLocation:function(t){var n=[],r=c.fulfillment.field.shipping.world_label,i=t.get("country"),s=f.getNameByCode(i),o=t.get("state"),h=a.getNameByCode(o),p=l.getCodeByCountry(i),d=l.getNameByCode(p),v=u.getRegionsByCountry(i);return o&&n.push({value:o,label:h}),n.push({value:i,label:s}),e.each(v,function(e,t){n.push({value:t.code,label:t.name})}),n.push({value:l.world,label:r}),n},getShippingRegions:function(e){var t=this.getCurrentLocation(e),n=e.get("state")?1:0;return countries=this.getCountryList([t[n].value]),continents=this.getContinentList([t[n+1].value]),states=this.getStateList([e.get("state")],e.get("country")),t.concat(states,countries,continents)},getLabel:function(){return null},getLabelField:function(){var e=this;return t.getLazy(this,"_labelField",function(){var t=new i({key:"set-label-"+e.model.cid,model:{instance:e.model,attribute:"label"},attributes:{"class":"field shipping-label-field"},fieldAttributes:{placeholder:c.fulfillment.field.shipping.title.placeholder},label:c.fulfillment.field.shipping.title.label,required:!0,maxLength:255,validateOnSet:!1});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0,changedSubfield:t})}),e.registerSubfield(t),t})},getDeliveryField:function(){var e=this;return t.getLazy(this,"_deliveryField",function(){var t=new p({key:"set-delivery-"+e.model.cid,model:{instance:e.model},label:c.fulfillment.field.shipping.delivery_days.label,labelDescription:c.fulfillment.field.shipping.delivery_days.label_description,minimumPlaceholder:c.fulfillment.field.shipping.delivery_days.placeholder_min,maximumPlaceholder:c.fulfillment.field.shipping.delivery_days.placeholder_max,validateOnSet:!1});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0,changedSubfield:t})}),e.registerSubfield(t),t})},getDescriptionField:function(){var e=this;return t.getLazy(this,"_descriptionField",function(){var t=new i({key:"set-description-"+e.model.cid,model:{instance:e.model,attribute:"description"},label:c.fulfillment.field.shipping.description.label,maxLength:500,validateOnSet:!1});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0,changedSubfield:t})}),e.registerSubfield(t),t})},getCostField:function(){var e=this;return t.getLazy(this,"_costField",function(){var n=new r({key:"set-cost-"+e.model.cid,model:{instance:e.model,attribute:"cost"},attributes:{"class":"field number-field shipping-cost-field"},required:!0,minValue:0,maxValue:9999999.99,stepSize:.01,label:c.fulfillment.field.shipping.cost.label,labelDescription:function(){var e=n.options.currency||t.session.getCurrentStore().get("currency");return c.fulfillment.field.shipping.cost.label_description+e},currency:e.options.currency,validateOnSet:!1});return n.on("onChange",function(){e.validate({outputError:!0,localOnly:!0,changedSubfield:n})}),e.registerSubfield(n),n})},getZeroCostField:function(){var e=this;return t.getLazy(this,"_zeroCostField",function(){var t=new r({key:"set-zero-cost-"+e.model.cid,model:{instance:e.model,attribute:"zero_cost_at_price"},minValue:0,maxValue:9999999.99,stepSize:.01,label:c.fulfillment.field.shipping.zero_cost.label,validateOnSet:!1});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0,changedSubfield:t})}),e.registerSubfield(t),t})},getDestinationField:function(){var e=this,n=t.session.getCurrentStore();return t.getLazy(this,"_destinationField",function(){var t=new o({key:"set-destination-"+e.model.cid,label:c.fulfillment.field.shipping.destination.label,model:{instance:e.model,attribute:"destination"},fieldAttributes:{placeholder:c.fulfillment.field.shipping.destination.placeholder},required:!0,choices:e.getShippingRegions(n),dividers:e.getDestinationDividers(n)});return t.on("onChange",function(){e.validate({outputError:!0,localOnly:!0,changedSubfield:t})}),e.registerSubfield(t),t})},validate:function(e){e=e||{};var t=this,n=e.changedSubfield,r=!1;e.outputError!==!1&&(e=_.clone(e),e.outputError=!1,r=!0),this.unsetError();var i;return _.isUndefined(n)?i=d.__super__.validate.call(this,e):i=n.validate(e),r&&i.fail(function(e,n){n.setError([]),t.setError(e)}),i},onClickMoreOptions:function(){this.showMoreOptions()},showMoreOptions:function(){this.$("a.more-options").remove(),this.$("div.options").show()},renderField:function(){var t=this,n=e('<div class="options"/>').hide(),r=e('<div class="imprint"/>').appendTo(this.$el);e('<span class="ui remove"/>').click(function(){t.collection.remove(t.model)}).appendTo(r),this.addChildView(this.getLabelField(),r),this.addChildView(this.getCostField(),r),this.addChildView(this.getDestinationField(),r),this.addChildView(this.getDeliveryField(),r),e("<a>").text(c.fulfillment.link.shipping.show_more_options).addClass("more-options action-link manual").appendTo(r),this.addChildView(this.getDescriptionField(),n),this.addChildView(this.getZeroCostField(),n),this.addChildView(n,r),(this.model.get("description")||this.model.get("zero_cost_at_price"))&&this.showMoreOptions()}});return d}),define("dashboard/form/field/store/shippingoptions",["jquery","underscore","tictail/form/field/collection","tictail/model/store/shipping","./shippingoption","i18n!../../../nls/settings"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.Form=o.Dashboard.Form||{},o.Dashboard.Form.Field=o.Dashboard.Form.Field={},o.Dashboard.Form.Field.Store=o.Dashboard.Form.Field.Store||{};var u=o.Dashboard.Form.Field.Store.ShippingOptions=n.extend({attributes:{"class":"field full-width shipping-options-field"},events:function(){var e={};return e["click .add-shipping-option"]="onClickAddShippingOption",e},createSubfield:function(e,t){var n=new i({key:"set-shipping-option-"+e.cid,model:{instance:e},collection:this.value,currency:this.model.get("currency")});return n},addModelListeners:function(){u.__super__.addModelListeners.apply(this,arguments),this.model.on("change:currency",this.onCurrencyChange,this)},removeModelListeners:function(){u.__super__.removeModelListeners.apply(this,arguments),this.model.off("change:currency",this.onCurrencyChange,this)},getLabel:function(){return null},getAddLink:function(){return e("<a>").attr("href","#").addClass("add-shipping-option action-link manual").text(s.fulfillment.link.shipping.add_link)},getSubfieldsContainerNode:function(){return this._subfieldsContainerNode},renderField:function(){this._subfieldsContainerNode=e('<div class="shipping-options bottom-gap"/>').appendTo(this.$el),u.__super__.renderField.apply(this,arguments),this.$el.append(this.getAddLink())},onClickAddShippingOption:function(e){e.preventDefault();var t=new r;this.value.add(t),this._subfields[this._subfields.length-1].setFocus()},onCurrencyChange:function(e,n){t.each(this._subfields,function(e){e.setCurrency(n)})}});return u}),define("dashboard/form/field/store/ship_message_template",["tictail/form/field/textarea","i18n!../../../nls/settings"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Form=n.Dashboard.Form||{},n.Dashboard.Form.Field=n.Dashboard.Form.Field={},n.Dashboard.Form.Field.Store=n.Dashboard.Form.Field.Store||{};var r=e.extend({attributes:{"class":"field full-width ship-message-template-field"}});return n.Dashboard.Form.Field.Store.ShipMessageTemplate=r,r}),define("dashboard/form/field/store/legaltext",["jquery","underscore","tictail/core","tictail/form/field/wysiwyg","../../../templates"],function(e,t,n,r){var i=this;i.Dashboard=i.Dashboard||{},i.Dashboard.Form=i.Dashboard.Form||{},i.Dashboard.Form.Field=i.Dashboard.Form.Field={},i.Dashboard.Form.Field.Store=i.Dashboard.Form.Field.Store||{};var s=i.Dashboard.Form.Field.Store.LegalText=r.extend({attributes:{"class":"field legal-text-field"},setNodeValue:function(e){s.__super__.setNodeValue.call(this,e),s.__super__.setValueOnModel.call(this,e),this.toggleSuggestionBox(!e)},addExampleText:function(){var e=this._getFieldNode().data("editor"),t=ich[this.options.exampleTemplate];if(!e||!t)return;this.setNodeValue(t(this.getExampleTemplateParams(),!0)),this.toggleSuggestionBox(!1),this.setFocus();try{e.currentView===e.composer&&e.composer.element.ownerDocument.execCommand("selectAll",!1,null)}catch(n){}},getExampleTemplateParams:function(){var e=this.options.store||n.session.getCurrentStore(),t=this.options.storekeeper||n.session.getStorekeeper();return{store_name:e.get("name")||"<Store Name>",store_email:e.get("email")||t.email||"<Store E-mail>",store_url:e.get("url")||"<Store URL>"}},renderField:function(){s.__super__.renderField.apply(this,arguments);var t=this,n=e('<div class="ui close"/>').click(function(){t.$el.addClass("suggestion-box-closed"),t.setFocus()});e('<div class="suggestion-box"/>').append(n).append(this._getAddExampleButton()).append(e("<p/>").text("Read and change text to fit your needs.")).appendTo(this.$(".wysiwyg-editor"))},_getAddExampleButton:function(){var r=this;return n.getLazy(this,"_addExampleButton",function(){return e('<button type="button" class="suggestion-button"/>').attr("tabindex",r.tabIndex).text(r.options.buttonLabel).click(t.bind(r.addExampleText,r))})},toggleSuggestionBox:function(e){if(t.isUndefined(e)){var n=this._getFieldNode().data("editor");n&&(e=!n.getValue(!1))}this.$el.toggleClass("suggestion-box-closed",!e)},onBlur:function(){s.__super__.onBlur.apply(this,arguments),this.toggleSuggestionBox()},onKeyUp:function(){s.__super__.onKeyUp.apply(this,arguments),this.toggleSuggestionBox()}});return s}),define("dashboard/form/field/store/paypal",["jquery","tictail/form/field/email"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Form=n.Dashboard.Form||{},n.Dashboard.Form.Field=n.Dashboard.Form.Field={},n.Dashboard.Form.Field.Store=n.Dashboard.Form.Field.Store||{};var r=n.Dashboard.Form.Field.Store.Paypal=t.extend({attributes:{"class":"field email-field paypal-field"},getLabel:function(){var t=r.__super__.getLabel.apply(this,arguments);if(t===null)return null;var n=t.contents().eq(0);return n.length!==0&&n.get(0).nodeType===3&&n.replaceWith(e('<span class="paypal-logo"/>').text(n.get(0).nodeValue)),t}});return r}),define("dashboard/form/settings/fulfillment",["underscore","tictail/core","tictail/component/grid","tictail/component/country","tictail/component/state","tictail/component/tracker","tictail/component/i18n","tictail/component/log","tictail/form/core","tictail/form/fieldset","tictail/form/field/select","tictail/form/field/percentage","../field/store/tax","../field/store/shippingoptions","../field/store/ship_message_template","../field/store/legaltext","../field/store/paypal","i18n!../../nls/settings"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=this;y.Dashboard=y.Dashboard||{},y.Dashboard.Form=y.Dashboard.Form||{},y.Dashboard.Form.Settings=y.Dashboard.Form.Settings={};var b=function(t){var n=[],r=i.getList(t);return e.isEmpty(r)===!0?n:($.each(r,function(e,t){n.push({value:t.code,label:t.name})}),n)},w=function(){var t=[],n=r.getList();return e.isEmpty(n)===!0?t:($.each(n,function(e,n){t.push({value:n.code,label:n.name})}),t)},E=function(){var e=[],t=o.supportedLanguages;return $.each(t,function(t,n){e.push({value:n,label:o.friendlyNames[n]})}),e},S=function(){var e=[];return window.CurrencyList===undefined?e:($.each(window.CurrencyList,function(t,n){e.push({value:n.code,label:n.name+" ("+n.code+")"})}),e)},x=y.Dashboard.Form.Settings.Fulfillment=a.extend({countryFields:["set-store-country","set-store-state","set-store-currency"],taxFields:["set-store-tax"],languageFields:["set-store-language"],paymentFields:["set-store-paypal-email"],shippingFields:["set-shipping-options"],shipMessageTemplateFields:["set-ship-message-template"],legalFields:["set-store-return-policy","set-store-tos"],allFields:function(){return this.allFields=this.countryFields.concat(this.taxFields,this.languageFields,this.paymentFields,this.shippingFields,this.shipMessageTemplateFields,this.legalFields),this.allFields},didAppend:function(){this.model.on("change:country",this.onCountryChange,this),this.model.on("change:state",this.onStateChange,this)},willRemove:function(){this.model.off(null,null,this)},createField:function(t){switch(t){case"set-store-state":return new l({key:t,model:{attribute:"state",instance:this.model},label:g.general.field.store_state.label,choices:b(this.model.get("country")),placeholder:g.general.field.store_state.placeholder});case"set-store-country":return new l({key:t,model:{attribute:"country",instance:this.model},label:g.general.field.store_country.label,choices:w()});case"set-store-currency":return new l({key:t,model:{attribute:"currency",instance:this.model},label:g.fulfillment.field.currency.label,choices:S()});case"set-store-tax":return new h({key:t,model:{instance:this.model.get("tax")},selectedCountry:this.model.get("country")});case"set-store-language":return new l({key:t,model:{attribute:"language",instance:this.model},label:g.general.field.store_language.label,choices:E()});case"set-store-paypal-email":var n=g.fulfillment.field.paypal.labelDescription;return e.isUndefined(this.model.get("paypal").get("id"))&&(n=g.fulfillment.field.paypal.unsetLabelDescription),new m({key:t,model:{attribute:"email",instance:this.model.get("paypal")},label:g.fulfillment.field.paypal.label,labelDescription:n,information:g.fulfillment.field.paypal.information,fieldAttributes:{placeholder:g.fulfillment.field.paypal.placeholder},maxLength:255});case"set-shipping-options":return new p({key:t,model:{instance:this.model,attribute:"shipping"},validateOnSet:!0});case"set-ship-message-template":return new d({key:t,model:{instance:this.model,attribute:"ship_message_template"},maxLength:800,label:g.fulfillment.field.ship_message_template.label,labelDescription:g.fulfillment.field.ship_message_template.label_description,information:g.fulfillment.field.ship_message_template.information,validateOnSet:!0});case"set-store-tos":return new v({key:t,model:{attribute:"terms_of_service",instance:this.model},label:g.fulfillment.field.tos.label,buttonLabel:g.fulfillment.field.tos.buttonLabel,exampleTemplate:"legaltext/termsandconditions",minLength:0,maxLength:65535});case"set-store-return-policy":return new v({key:t,model:{attribute:"return_policy",instance:this.model},label:g.fulfillment.field.return_policy.label,buttonLabel:g.fulfillment.field.return_policy.buttonLabel,exampleTemplate:"legaltext/returnpolicy",minLength:0,maxLength:65535});default:return null}},renderCountry:function(){var e=this.getField("set-store-country"),t=this.getField("set-store-state"),r=this.getField("set-store-currency"),i=[];if(e&&r){e.$el.addClass("full-width"),r.$el.addClass("full-width");var s=[{size:"1/2",content:e,gutterClass:"no-gutter-l"},{size:"1/2",content:r,gutterClass:"no-gutter-r"}];i.push(new n({columns:s,className:"row field-row with-overflow"}))}else e?i.push(e):r&&i.push(r);t&&(t.choices.length===0?t.$el.hide():t.setRequired(),i.push(t));if(i.length===0)return!1;var o=new f({title:g.fulfillment.section.country.title,description:g.fulfillment.section.country.description,rightColumnContent:i});return this.addChildView(o),!0},renderTax:function(){var t=this.getFields(this.taxFields);if(e.isEmpty(t))return!1;var n=new f({title:g.fulfillment.section.tax.title,rightColumnContent:t});return this.addChildView(n),!0},renderLanguage:function(){if(!y.Dashboard.featureActive("translation"))return!1;var t=this.getFields(this.languageFields);if(e.isEmpty(t))return!1;var n=new f({title:"Translation",description:undefined,rightColumnContent:t});return this.addChildView(n),!0},renderPayment:function(){var t=this.getFields(this.paymentFields);if(e.isEmpty(t))return!1;var n=new f({title:g.fulfillment.section.payment.title,description:g.fulfillment.section.payment.description,rightColumnContent:t});return this.addChildView(n),!0},renderShipping:function(){var t=this.getFields(this.shippingFields);if(e.isEmpty(t))return!1;var n=new f({title:g.fulfillment.section.shipping.title,description:g.fulfillment.section.shipping.description,rightColumnContent:t});return this.addChildView(n),!0},renderShipMessageTemplate:function(){var t=this.getFields(this.shipMessageTemplateFields);if(e.isEmpty(t))return!1;var n=new f({title:g.fulfillment.section.ship_message_template.title,rightColumnContent:t});return this.addChildView(n),!0},renderLegal:function(){var t=this.getFields(this.legalFields);if(e.isEmpty(t))return!1;var n=new f({title:g.fulfillment.section.legal.title,description:g.fulfillment.section.legal.description,rightColumnContent:t});return this.addChildView(n),!0},render:function(){return this.empty(),this.renderCountry(),this.renderTax(),this.renderLanguage(),this.renderPayment(),this.renderShipping(),this.renderShipMessageTemplate(),this.renderLegal(),this.addChildView(this.actionbar),this.didRender()},updateShipping:function(t){var n=this;e.each(t.getSubfields(),function(e){e.updateDestination(n.model)})},onStateChange:function(){var e=this.getField("set-store-tax"),t=this.model.get("state"),n=this.getField("set-shipping-options");e&&e.setSelectedState(t),n&&this.updateShipping(n)},onCountryChange:function(){var e=this.getField("set-store-tax"),t=this.getField("set-store-state"),n=this.getField("set-shipping-options"),r=this.model.get("country"),i=b(r);e&&e.setSelectedCountry(r),t&&(i.length>0?(t.setRequired(),t.$el.show()):(t.setOptional(),t.$el.hide()),t.setChoices(i,!1),this.model.set("state",null)),n&&this.updateShipping(n)},onSuccessfulSave:function(){var e=t.session.getCurrentStore();this.trackSavedAttributes(e),e.set("currency",this.model.get("currency")),e.set("language",this.model.get("language")),e.set("country",this.model.get("country")),e.set("state",this.model.get("state")),x.__super__.onSuccessfulSave.apply(this,arguments)},trackSavedAttributes:function(t){e.each(this.getAllFields(),function(e){var n=e.modelAttributeName;if(e.value!=t.get(n)){var r="From "+t.get(n)+" to "+e.value;s.track("Changed Store "+n,r)}}),s.register({store_country:this.model.get("country"),store_state:this.model.get("state"),store_language:this.model.get("language"),store_currency:this.model.get("currency")});if(this.isIncluded("set-store-tax")){var n=this.model.get("tax");s.register({store_vat:n.get("percentage")})}this.isIncluded("set-shipping-options")&&e.each(this.model.get("shipping").models,function(t){if(e.isUndefined(t.get("id"))){var n='"'+t.get("label")+'" for '+t.get("cost");s.track("Added Shipping Option",n),t.get("is_international")===!0&&s.track("Added International Shipping Option",n)}});if(this.isIncluded("set-store-paypal-email")){var r=this.model.get("paypal");r.isNew()&&e.isUndefined(r.get("email"))!==!0&&s.track("Added Paypal Email")}(e.isUndefined(this.included)===!0||this.getSortedFields().length==this.allFields.length)&&s.track("Saved Fulfillment Settings")}});return x}),define("dashboard/view/settings/fulfillment",["underscore","tictail/core","tictail/component/api","tictail/model/store/tax","tictail/model/store/legal","tictail/model/store/shipping","tictail/model/store/payment/paypal","tictail/model/store/ship_message_template","tictail/model/store/settings/fulfillment","tictail/collection/store/shipping","../../module/loadpage","../../form/settings/fulfillment","i18n!dashboard/nls/settings"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=this;p.Dashboard=p.Dashboard||{},p.Dashboard.View=p.Dashboard.View||{},p.Dashboard.View.Settings=p.Dashboard.View.Settings={};var d=p.Dashboard.View.Settings.Fulfillment=l.extend({bodyId:"settings-fulfillment-view",included:["country","tax","language","payment","shipping","ship-message-template","legal"],initialize:function(t){t=t||{},e.isArray(t.include)===!0&&(this.included=t.include),d.__super__.initialize.call(this,t)},isIncluded:function(t){return e.indexOf(this.included,t)!==-1},load:function(){var e=new n.Batch,l=t.session.getCurrentStore().id,c=new a,h=function(t){t.params||(t.params={}),t.params.store_id=l,e.appendRequest(t)};if(this.isIncluded("tax")){var p=new r;h(p.fetch({getRequest:!0,success:function(){c.set("tax",p)}}))}if(this.isIncluded("shipping")){var d=new f(s,{storeId:l});h(d.fetch({getRequest:!0,success:function(){c.set("shipping",d)}}))}if(this.isIncluded("legal")){var v=new i;h(v.fetch({getRequest:!0,success:function(){c.set(v.attributes)}}))}if(this.isIncluded("payment")){var m=new o;h(m.fetch({getRequest:!0,success:function(){c.set("paypal",m)}}))}if(this.isIncluded("ship-message-template")){var g=new u;h(g.fetch({getRequest:!0,success:function(e){c.set("ship_message_template",g.getTemplate())}}))}if(e.getStackLength()===0){this.useCachedData(c);return}e.on("complete",function(){this.didLoad(c)},this),e.send()},getStoreData:function(){var e=t.session.getCurrentStore();return{store_id:e.id,name:e.get("name"),country:e.get("country"),state:e.get("state"),currency:e.get("currency"),language:e.get("language")}},didLoad:function(t){if(t){var n=this.getStoreData(),r={silent:!0};e.each(n,function(e,n){t.has(n)||t.set(n,e,r)}),t.change()}d.__super__.didLoad.call(this,t)},getForm:function(){return t.getLazy(this,"form",function(){var t,n=c.prototype;this.formInclude!==undefined?t=this.formInclude:(t=[],this.isIncluded("country")&&(t=t.concat(n.countryFields)),this.isIncluded("tax")&&(t=t.concat(n.taxFields)),this.isIncluded("language")&&(t=t.concat(n.languageFields)),this.isIncluded("payment")&&(t=t.concat(n.paymentFields)),this.isIncluded("shipping")&&(t=t.concat(n.shippingFields)),this.isIncluded("ship-message-template")&&(t=t.concat(n.shipMessageTemplateFields)),this.isIncluded("legal")&&(t=t.concat(n.legalFields)));var r=e.extend({model:this.data,include:t},this.formOptions),i=new c(r);return i.on("onSave",this.onSave,this),i.on("onSaveError",this.onSaveError,this),i})},onSave:function(){Dashboard.showStatusHud("Saved!")},onSaveError:function(){},getLoadedContent:function(){return this.getForm()},getTitle:function(){return h.fulfillment.page_title},setFocus:function(){this.form!==undefined&&this.form.setFocus()}});return d}),Braintree=function(){function e(t,n){t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=n)}function t(e,t,n,r,i){this.stream=e,this.header=t,this.length=n,this.tag=r,this.sub=i}function i(e){var t,i,s="";for(t=0;t+3<=e.length;t+=3)i=parseInt(e.substring(t,t+3),16),s+=n.charAt(i>>6)+n.charAt(i&63);t+1==e.length?(i=parseInt(e.substring(t,t+1),16),s+=n.charAt(i<<2)):t+2==e.length&&(i=parseInt(e.substring(t,t+2),16),s+=n.charAt(i>>2)+n.charAt((i&3)<<4));while((s.length&3)>0)s+=r;return s}function s(e){var t="",i,s=0,o;for(i=0;i<e.length;++i){if(e.charAt(i)==r)break;v=n.indexOf(e.charAt(i));if(v<0)continue;s==0?(t+=E(v>>2),o=v&3,s=1):s==1?(t+=E(o<<2|v>>4),o=v&15,s=2):s==2?(t+=E(o),t+=E(v>>2),o=v&3,s=3):(t+=E(o<<2|v>>4),t+=E(v&15),s=0)}return s==1&&(t+=E(o<<2)),t}function o(e){var t=s(e),n,r=new Array;for(n=0;2*n<t.length;++n)r[n]=parseInt(t.substring(2*n,2*n+2),16);return r}function l(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function c(){return new l(null)}function h(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function p(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function d(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function E(e){return g.charAt(e)}function S(e,t){var n=y[e.charCodeAt(t)];return n==null?-1:n}function x(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function T(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0}function N(e){var t=c();return t.fromInt(e),t}function C(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,i=!1,s=0;while(--r>=0){var o=n==8?e[r]&255:S(e,r);if(o<0){e.charAt(r)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&l.ZERO.subTo(this,this)}function L(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function A(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=E(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=E(r))}return i?s:"0"}function O(){var e=c();return l.ZERO.subTo(this,e),e}function M(){return this.s<0?this.negate():this}function _(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return this.s<0?-t:t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function D(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function P(){return this.t<=0?0:this.DB*(this.t-1)+D(this[this.t-1]^this.s&this.DM)}function H(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function B(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function j(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function F(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function I(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function q(e,t){var n=this.abs(),r=e.abs(),i=n.t;t.t=i+r.t;while(--i>=0)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&l.ZERO.subTo(t,t)}function R(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function U(e,t,n){var r=e.abs();if(r.t<=0)return;var i=this.abs();if(i.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=c());var s=c(),o=this.s,u=e.s,a=this.DB-D(r[r.t-1]);a>0?(r.lShiftTo(a,s),i.lShiftTo(a,n)):(r.copyTo(s),i.copyTo(n));var f=s.t,h=s[f-1];if(h==0)return;var p=h*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),d=this.FV/p,v=(1<<this.F1)/p,m=1<<this.F2,g=n.t,y=g-f,b=t==null?c():t;s.dlShiftTo(y,b),n.compareTo(b)>=0&&(n[n.t++]=1,n.subTo(b,n)),l.ONE.dlShiftTo(f,b),b.subTo(s,s);while(s.t<f)s[s.t++]=0;while(--y>=0){var w=n[--g]==h?this.DM:Math.floor(n[g]*d+(n[g-1]+m)*v);if((n[g]+=s.am(0,w,n,y,0,f))<w){s.dlShiftTo(y,b),n.subTo(b,n);while(n[g]<--w)n.subTo(b,n)}}t!=null&&(n.drShiftTo(f,t),o!=u&&l.ZERO.subTo(t,t)),n.t=f,n.clamp(),a>0&&n.rShiftTo(a,n),o<0&&l.ZERO.subTo(n,n)}function z(e){var t=c();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(l.ZERO)>0&&e.subTo(t,t),t}function W(e){this.m=e}function X(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function V(e){return e}function $(e){e.divRemTo(this.m,null,e)}function J(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function K(e,t){e.squareTo(t),this.reduce(t)}function Q(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function G(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Y(e){var t=c();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(l.ZERO)>0&&this.m.subTo(t,t),t}function Z(e){var t=c();return e.copyTo(t),this.reduce(t),t}function et(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function tt(e,t){e.squareTo(t),this.reduce(t)}function nt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function rt(){return(this.t>0?this[0]&1:this.s)==0}function it(e,t){if(e>4294967295||e<1)return l.ONE;var n=c(),r=c(),i=t.convert(this),s=D(e)-1;i.copyTo(n);while(--s>=0){t.sqrTo(n,r);if((e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}}return t.revert(n)}function st(e,t){var n;return e<256||t.isEven()?n=new W(t):n=new G(t),this.exp(e,n)}function ot(e,t){return new l(e,t)}function ut(e,t){var n="",r=0;while(r+t<e.length)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function at(e){return e<16?"0"+e.toString(16):e.toString(16)}function ft(e,t){if(t<e.length+11)return alert("Message too long for RSA"),null;var n=new Array,r=e.length-1;while(r>=0&&t>0){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=i&63|128,n[--t]=i>>6|192):(n[--t]=i&63|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;var s=0,o=0,u=0;while(t>2)u==0&&(o=vt.random.randomWords(1,0)[0]),s=o>>u&255,u=(u+8)%32,s!=0&&(n[--t]=s);return n[--t]=2,n[--t]=0,new l(n)}function lt(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function ct(e,t){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=ot(e,16),this.e=parseInt(t,16)):alert("Invalid RSA public key")}function ht(e){return e.modPowInt(this.e,this.n)}function pt(e){var t=ft(e,this.n.bitLength()+7>>3);if(t==null)return null;var n=this.doPublic(t);if(n==null)return null;var r=n.toString(16);return(r.length&1)==0?r:"0"+r}function dt(e){var t=this.encrypt(e);return t?i(t):null}e.prototype.get=function(e){e==undefined&&(e=this.pos++);if(e>=this.enc.length)throw"Requesting byte offset "+e+" on a stream of length "+this.enc.length;return this.enc[e]},e.prototype.hexDigits="0123456789ABCDEF",e.prototype.hexByte=function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(e&15)},e.prototype.hexDump=function(e,t){var n="";for(var r=e;r<t;++r){n+=this.hexByte(this.get(r));switch(r&15){case 7:n+="  ";break;case 15:n+="\n";break;default:n+=" "}}return n},e.prototype.parseStringISO=function(e,t){var n="";for(var r=e;r<t;++r)n+=String.fromCharCode(this.get(r));return n},e.prototype.parseStringUTF=function(e,t){var n="",r=0;for(var i=e;i<t;){var r=this.get(i++);r<128?n+=String.fromCharCode(r):r>191&&r<224?n+=String.fromCharCode((r&31)<<6|this.get(i++)&63):n+=String.fromCharCode((r&15)<<12|(this.get(i++)&63)<<6|this.get(i++)&63)}return n},e.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,e.prototype.parseTime=function(e,t){var n=this.parseStringISO(e,t),r=this.reTime.exec(n);return r?(n=r[1]+"-"+r[2]+"-"+r[3]+" "+r[4],r[5]&&(n+=":"+r[5],r[6]&&(n+=":"+r[6],r[7]&&(n+="."+r[7]))),r[8]&&(n+=" UTC",r[8]!="Z"&&(n+=r[8],r[9]&&(n+=":"+r[9]))),n):"Unrecognized time: "+n},e.prototype.parseInteger=function(e,t){var n=t-e;if(n>4){n<<=3;var r=this.get(e);if(r==0)n-=8;else while(r<128)r<<=1,--n;return"("+n+" bit)"}var i=0;for(var s=e;s<t;++s)i=i<<8|this.get(s);return i},e.prototype.parseBitString=function(e,t){var n=this.get(e),r=(t-e-1<<3)-n,i="("+r+" bit)";if(r<=20){var s=n;i+=" ";for(var o=t-1;o>e;--o){var u=this.get(o);for(var a=s;a<8;++a)i+=u>>a&1?"1":"0";s=0}}return i},e.prototype.parseOctetString=function(e,t){var n=t-e,r="("+n+" byte) ";n>20&&(t=e+20);for(var i=e;i<t;++i)r+=this.hexByte(this.get(i));return n>20&&(r+=String.fromCharCode(8230)),r},e.prototype.parseOID=function(e,t){var n,r=0,i=0;for(var s=e;s<t;++s){var o=this.get(s);r=r<<7|o&127,i+=7,o&128||(n==undefined?n=parseInt(r/40)+"."+r%40:n+="."+(i>=31?"bigint":r),r=i=0),n+=String.fromCharCode()}return n},t.prototype.typeName=function(){if(this.tag==undefined)return"unknown";var e=this.tag>>6,t=this.tag>>5&1,n=this.tag&31;switch(e){case 0:switch(n){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+n.toString(16)};case 1:return"Application_"+n.toString(16);case 2:return"["+n+"]";case 3:return"Private_"+n.toString(16)}},t.prototype.content=function(){if(this.tag==undefined)return null;var e=this.tag>>6;if(e!=0)return this.sub==null?null:"("+this.sub.length+")";var t=this.tag&31,n=this.posContent(),r=Math.abs(this.length);switch(t){case 1:return this.stream.get(n)==0?"false":"true";case 2:return this.stream.parseInteger(n,n+r);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(n,n+r);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(n,n+r);case 6:return this.stream.parseOID(n,n+r);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(n,n+r);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(n,n+r);case 23:case 24:return this.stream.parseTime(n,n+r)}return null},t.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(this.sub==null?"null":this.sub.length)+"]"},t.prototype.print=function(e){e==undefined&&(e=""),document.writeln(e+this);if(this.sub!=null){e+="  ";for(var t=0,n=this.sub.length;t<n;++t)this.sub[t].print(e)}},t.prototype.toPrettyString=function(e){e==undefined&&(e="");var t=e+this.typeName()+" @"+this.stream.pos;this.length>=0&&(t+="+"),t+=this.length,this.tag&32?t+=" (constructed)":(this.tag==3||this.tag==4)&&this.sub!=null&&(t+=" (encapsulates)"),t+="\n";if(this.sub!=null){e+="  ";for(var n=0,r=this.sub.length;n<r;++n)t+=this.sub[n].toPrettyString(e)}return t},t.prototype.posStart=function(){return this.stream.pos},t.prototype.posContent=function(){return this.stream.pos+this.header},t.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},t.decodeLength=function(e){var t=e.get(),n=t&127;if(n==t)return n;if(n>3)throw"Length over 24 bits not supported at position "+(e.pos-1);if(n==0)return-1;t=0;for(var r=0;r<n;++r)t=t<<8|e.get();return t},t.hasContent=function(n,r,i){if(n&32)return!0;if(n<3||n>4)return!1;var s=new e(i);n==3&&s.get();var o=s.get();if(o>>6&1)return!1;try{var u=t.decodeLength(s);return s.pos-i.pos+u==r}catch(a){return!1}},t.decode=function(n){n instanceof e||(n=new e(n,0));var r=new e(n),i=n.get(),s=t.decodeLength(n),o=n.pos-r.pos,u=null;if(t.hasContent(i,s,n)){var a=n.pos;i==3&&n.get(),u=[];if(s>=0){var f=a+s;while(n.pos<f)u[u.length]=t.decode(n);if(n.pos!=f)throw"Content size is not correct for container starting at offset "+a}else try{for(;;){var l=t.decode(n);if(l.tag==0)break;u[u.length]=l}s=a-n.pos}catch(c){throw"Exception while decoding undefined length content: "+c}}else n.pos+=s;return new t(r,o,s,i,u)};var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="=",u,a=0xdeadbeefcafe,f=(a&16777215)==15715070;f&&navigator.appName=="Microsoft Internet Explorer"?(l.prototype.am=p,u=30):f&&navigator.appName!="Netscape"?(l.prototype.am=h,u=26):(l.prototype.am=d,u=28),l.prototype.DB=u,l.prototype.DM=(1<<u)-1,l.prototype.DV=1<<u;var m=52;l.prototype.FV=Math.pow(2,m),l.prototype.F1=m-u,l.prototype.F2=2*u-m;var g="0123456789abcdefghijklmnopqrstuvwxyz",y=new Array,b,w;b="0".charCodeAt(0);for(w=0;w<=9;++w)y[b++]=w;b="a".charCodeAt(0);for(w=10;w<36;++w)y[b++]=w;b="A".charCodeAt(0);for(w=10;w<36;++w)y[b++]=w;W.prototype.convert=X,W.prototype.revert=V,W.prototype.reduce=$,W.prototype.mulTo=J,W.prototype.sqrTo=K,G.prototype.convert=Y,G.prototype.revert=Z,G.prototype.reduce=et,G.prototype.mulTo=nt,G.prototype.sqrTo=tt,l.prototype.copyTo=x,l.prototype.fromInt=T,l.prototype.fromString=C,l.prototype.clamp=L,l.prototype.dlShiftTo=H,l.prototype.drShiftTo=B,l.prototype.lShiftTo=j,l.prototype.rShiftTo=F,l.prototype.subTo=I,l.prototype.multiplyTo=q,l.prototype.squareTo=R,l.prototype.divRemTo=U,l.prototype.invDigit=Q,l.prototype.isEven=rt,l.prototype.exp=it,l.prototype.toString=A,l.prototype.negate=O,l.prototype.abs=M,l.prototype.compareTo=_,l.prototype.bitLength=P,l.prototype.mod=z,l.prototype.modPowInt=st,l.ZERO=N(0),l.ONE=N(1),lt.prototype.doPublic=ht,lt.prototype.setPublic=ct,lt.prototype.encrypt=pt,lt.prototype.encrypt_b64=dt,"use strict";var vt={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};typeof module!="undefined"&&module.exports&&(module.exports=vt),vt.cipher.aes=function(e){this._tables[0][0][0]||this._precompute();var t,n,r,i,s,o=this._tables[0][4],u=this._tables[1],a=e.length,f=1;if(a!==4&&a!==6&&a!==8)throw new vt.exception.invalid("invalid aes key size");this._key=[i=e.slice(0),s=[]];for(t=a;t<4*a+28;t++){r=i[t-1];if(t%a===0||a===8&&t%a===4)r=o[r>>>24]<<24^o[r>>16&255]<<16^o[r>>8&255]<<8^o[r&255],t%a===0&&(r=r<<8^r>>>24^f<<24,f=f<<1^(f>>7)*283);i[t]=i[t-a]^r}for(n=0;t;n++,t--)r=i[n&3?t:t-4],t<=4||n<4?s[n]=r:s[n]=u[0][o[r>>>24]]^u[1][o[r>>16&255]]^u[2][o[r>>8&255]]^u[3][o[r&255]]},vt.cipher.aes.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var e=this._tables[0],t=this._tables[1],n=e[4],r=t[4],i,s,o,u=[],a=[],f,l,c,h,p,d;for(i=0;i<256;i++)a[(u[i]=i<<1^(i>>7)*283)^i]=i;for(s=o=0;!n[s];s^=f||1,o=a[o]||1){h=o^o<<1^o<<2^o<<3^o<<4,h=h>>8^h&255^99,n[s]=h,r[h]=s,c=u[l=u[f=u[s]]],d=c*16843009^l*65537^f*257^s*16843008,p=u[h]*257^h*16843008;for(i=0;i<4;i++)e[i][s]=p=p<<24^p>>>8,t[i][h]=d=d<<24^d>>>8}for(i=0;i<5;i++)e[i]=e[i].slice(0),t[i]=t[i].slice(0)},_crypt:function(e,t){if(e.length!==4)throw new vt.exception.invalid("invalid aes block size");var n=this._key[t],r=e[0]^n[0],i=e[t?3:1]^n[1],s=e[2]^n[2],o=e[t?1:3]^n[3],u,a,f,l=n.length/4-2,c,h=4,p=[0,0,0,0],d=this._tables[t],v=d[0],m=d[1],g=d[2],y=d[3],b=d[4];for(c=0;c<l;c++)u=v[r>>>24]^m[i>>16&255]^g[s>>8&255]^y[o&255]^n[h],a=v[i>>>24]^m[s>>16&255]^g[o>>8&255]^y[r&255]^n[h+1],f=v[s>>>24]^m[o>>16&255]^g[r>>8&255]^y[i&255]^n[h+2],o=v[o>>>24]^m[r>>16&255]^g[i>>8&255]^y[s&255]^n[h+3],h+=4,r=u,i=a,s=f;for(c=0;c<4;c++)p[t?3&-c:c]=b[r>>>24]<<24^b[i>>16&255]<<16^b[s>>8&255]<<8^b[o&255]^n[h++],u=r,r=i,i=s,s=o,o=u;return p}},vt.bitArray={bitSlice:function(e,t,n){return e=vt.bitArray._shiftRight(e.slice(t/32),32-(t&31)).slice(1),n===undefined?e:vt.bitArray.clamp(e,n-t)},extract:function(e,t,n){var r,i=Math.floor(-t-n&31);return(t+n-1^t)&-32?r=e[t/32|0]<<32-i^e[t/32+1|0]>>>i:r=e[t/32|0]>>>i,r&(1<<n)-1},concat:function(e,t){if(e.length===0||t.length===0)return e.concat(t);var n,r,i=e[e.length-1],s=vt.bitArray.getPartial(i);return s===32?e.concat(t):vt.bitArray._shiftRight(t,s,i|0,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length,n;return t===0?0:(n=e[t-1],(t-1)*32+vt.bitArray.getPartial(n))},clamp:function(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t&=31,n>0&&t&&(e[n-1]=vt.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,n){return e===32?t:(n?t|0:t<<32-e)+e*1099511627776},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(vt.bitArray.bitLength(e)!==vt.bitArray.bitLength(t))return!1;var n=0,r;for(r=0;r<e.length;r++)n|=e[r]^t[r];return n===0},_shiftRight:function(e,t,n,r){var i,s=0,o;r===undefined&&(r=[]);for(;t>=32;t-=32)r.push(n),n=0;if(t===0)return r.concat(e);for(i=0;i<e.length;i++)r.push(n|e[i]>>>t),n=e[i]<<32-t;return s=e.length?e[e.length-1]:0,o=vt.bitArray.getPartial(s),r.push(vt.bitArray.partial(t+o&31,t+o>32?n:r.pop(),1)),r},_xor4:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},vt.codec.hex={fromBits:function(e){var t="",n,r;for(n=0;n<e.length;n++)t+=((e[n]|0)+0xf00000000000).toString(16).substr(4);return t.substr(0,vt.bitArray.bitLength(e)/4)},toBits:function(e){var t,n=[],r;e=e.replace(/\s|0x/g,""),r=e.length,e+="00000000";for(t=0;t<e.length;t+=8)n.push(parseInt(e.substr(t,8),16)^0);return vt.bitArray.clamp(n,r*4)}},vt.codec.utf8String={fromBits:function(e){var t="",n=vt.bitArray.bitLength(e),r,i;for(r=0;r<n/8;r++)(r&3)===0&&(i=e[r/4]),t+=String.fromCharCode(i>>>24),i<<=8;return decodeURIComponent(escape(t))},toBits:function(e){e=unescape(encodeURIComponent(e));var t=[],n,r=0;for(n=0;n<e.length;n++)r=r<<8|e.charCodeAt(n),(n&3)===3&&(t.push(r),r=0);return n&3&&t.push(vt.bitArray.partial(8*(n&3),r)),t}},vt.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var r="",i,s=0,o=vt.codec.base64._chars,u=0,a=vt.bitArray.bitLength(e);n&&(o=o.substr(0,62)+"-_");for(i=0;r.length*6<a;)r+=o.charAt((u^e[i]>>>s)>>>26),s<6?(u=e[i]<<6-s,s+=26,i++):(u<<=6,s-=6);while(r.length&3&&!t)r+="=";return r},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n=[],r,i=0,s=vt.codec.base64._chars,o=0,u;t&&(s=s.substr(0,62)+"-_");for(r=0;r<e.length;r++){u=s.indexOf(e.charAt(r));if(u<0)throw new vt.exception.invalid("this isn't base64!");i>26?(i-=26,n.push(o^u>>>i),o=u<<32-i):(i+=6,o^=u<<32-i)}return i&56&&n.push(vt.bitArray.partial(i&56,o,1)),n}},vt.codec.base64url={fromBits:function(e){return vt.codec.base64.fromBits(e,1,1)},toBits:function(e){return vt.codec.base64.toBits(e,1)}},vt.beware===undefined&&(vt.beware={}),vt.beware["CBC mode is dangerous because it doesn't protect message integrity."]=function(){vt.mode.cbc={name:"cbc",encrypt:function(e,t,n,r){if(r&&r.length)throw new vt.exception.invalid("cbc can't authenticate data");if(vt.bitArray.bitLength(n)!==128)throw new vt.exception.invalid("cbc iv must be 128 bits");var i,s=vt.bitArray,o=s._xor4,u=s.bitLength(t),a=0,f=[];if(u&7)throw new vt.exception.invalid("pkcs#5 padding only works for multiples of a byte");for(i=0;a+128<=u;i+=4,a+=128)n=e.encrypt(o(n,t.slice(i,i+4))),f.splice(i,0,n[0],n[1],n[2],n[3]);return u=(16-(u>>3&15))*16843009,n=e.encrypt(o(n,s.concat(t,[u,u,u,u]).slice(i,i+4))),f.splice(i,0,n[0],n[1],n[2],n[3]),f},decrypt:function(e,t,n,r){if(r&&r.length)throw new vt.exception.invalid("cbc can't authenticate data");if(vt.bitArray.bitLength(n)!==128)throw new vt.exception.invalid("cbc iv must be 128 bits");if(vt.bitArray.bitLength(t)&127||!t.length)throw new vt.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");var i,s=vt.bitArray,o=s._xor4,u,a,f=[];r=r||[];for(i=0;i<t.length;i+=4)u=t.slice(i,i+4),a=o(n,e.decrypt(u)),f.splice(i,0,a[0],a[1],a[2],a[3]),n=u;u=f[i-1]&255;if(u==0||u>16)throw new vt.exception.corrupt("pkcs#5 padding corrupt");a=u*16843009;if(!s.equal(s.bitSlice([a,a,a,a],0,u*8),s.bitSlice(f,f.length*32-u*8,f.length*32)))throw new vt.exception.corrupt("pkcs#5 padding corrupt");return s.bitSlice(f,0,f.length*32-u*8)}}},vt.misc.hmac=function(e,t){this._hash=t=t||vt.hash.sha256;var n=[[],[]],r,i=t.prototype.blockSize/32;this._baseHash=[new t,new t],e.length>i&&(e=t.hash(e));for(r=0;r<i;r++)n[0][r]=e[r]^909522486,n[1][r]=e[r]^1549556828;this._baseHash[0].update(n[0]),this._baseHash[1].update(n[1])},vt.misc.hmac.prototype.encrypt=vt.misc.hmac.prototype.mac=function(e,t){var n=(new this._hash(this._baseHash[0])).update(e,t).finalize();return(new this._hash(this._baseHash[1])).update(n).finalize()},vt.hash.sha256=function(e){this._key[0]||this._precompute(),e?(this._h=e._h.slice(0),this._buffer=e._buffer.slice(0),this._length=e._length):this.reset()},vt.hash.sha256.hash=function(e){return(new vt.hash.sha256).update(e).finalize()},vt.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(e){typeof e=="string"&&(e=vt.codec.utf8String.toBits(e));var t,n=this._buffer=vt.bitArray.concat(this._buffer,e),r=this._length,i=this._length=r+vt.bitArray.bitLength(e);for(t=512+r&-512;t<=i;t+=512)this._block(n.splice(0,16));return this},finalize:function(){var e,t=this._buffer,n=this._h;t=vt.bitArray.concat(t,[vt.bitArray.partial(1,1)]);for(e=t.length+2;e&15;e++)t.push(0);t.push(Math.floor(this._length/4294967296)),t.push(this._length|0);while(t.length)this._block(t.splice(0,16));return this.reset(),n},_init:[],_key:[],_precompute:function(){function r(e){return(e-Math.floor(e))*4294967296|0}var e=0,t=2,n;e:for(;e<64;t++){for(n=2;n*n<=t;n++)if(t%n===0)continue e;e<8&&(this._init[e]=r(Math.pow(t,.5))),this._key[e]=r(Math.pow(t,1/3)),e++}},_block:function(e){var t,n,r,i,s=e.slice(0),o=this._h,u=this._key,a=o[0],f=o[1],l=o[2],c=o[3],h=o[4],p=o[5],d=o[6],v=o[7];for(t=0;t<64;t++)t<16?n=s[t]:(r=s[t+1&15],i=s[t+14&15],n=s[t&15]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+s[t&15]+s[t+9&15]|0),n=n+v+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(d^h&(p^d))+u[t],v=d,d=p,p=h,h=c+n|0,c=l,l=f,f=a,a=n+(f&l^c&(f^l))+(f>>>2^f>>>13^f>>>22^f<<30^f<<19^f<<10)|0;o[0]=o[0]+a|0,o[1]=o[1]+f|0,o[2]=o[2]+l|0,o[3]=o[3]+c|0,o[4]=o[4]+h|0,o[5]=o[5]+p|0,o[6]=o[6]+d|0,o[7]=o[7]+v|0}},vt.random={randomWords:function(e,t){var n=[],r,i=this.isReady(t),s;if(i===this._NOT_READY)throw new vt.exception.notReady("generator isn't seeded");i&this._REQUIRES_RESEED&&this._reseedFromPools(!(i&this._READY));for(r=0;r<e;r+=4)(r+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),s=this._gen4words(),n.push(s[0],s[1],s[2],s[3]);return this._gate(),n.slice(0,e)},setDefaultParanoia:function(e){this._defaultParanoia=e},addEntropy:function(e,t,n){n=n||"user";var r,i,s,o=(new Date).valueOf(),u=this._robins[n],a=this.isReady(),f=0;r=this._collectorIds[n],r===undefined&&(r=this._collectorIds[n]=this._collectorIdNext++),u===undefined&&(u=this._robins[n]=0),this._robins[n]=(this._robins[n]+1)%this._pools.length;switch(typeof e){case"number":t===undefined&&(t=1),this._pools[u].update([r,this._eventId++,1,t,o,1,e|0]);break;case"object":var l=Object.prototype.toString.call(e);if(l==="[object Uint32Array]"){s=[];for(i=0;i<e.length;i++)s.push(e[i]);e=s}else{l!=="[object Array]"&&(f=1);for(i=0;i<e.length&&!f;i++)typeof e[i]!="number"&&(f=1)}if(!f){if(t===undefined){t=0;for(i=0;i<e.length;i++){s=e[i];while(s>0)t++,s>>>=1}}this._pools[u].update([r,this._eventId++,2,t,o,e.length].concat(e))}break;case"string":t===undefined&&(t=e.length),this._pools[u].update([r,this._eventId++,3,t,o,e.length]),this._pools[u].update(e);break;default:f=1}if(f)throw new vt.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[u]+=t,this._poolStrength+=t,a===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(e){var t=this._PARANOIA_LEVELS[e!==undefined?e:this._defaultParanoia];return this._strength&&this._strength>=t?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=t?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(e){var t=this._PARANOIA_LEVELS[e?e:this._defaultParanoia];return this._strength>=t?1:this._poolStrength>t?1:this._poolStrength/t},startCollectors:function(){if(this._collectorsStarted)return;if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else{if(!document.attachEvent)throw new vt.exception.bug("can't attach event");document.attachEvent("onload",this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=!0},stopCollectors:function(){if(!this._collectorsStarted)return;window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector,!1),window.removeEventListener("mousemove",this._mouseCollector,!1)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=!1},addEventListener:function(e,t){this._callbacks[e][this._callbackI++]=t},removeEventListener:function(e,t){var n,r,i=this._callbacks[e],s=[];for(r in i)i.hasOwnProperty(r)&&i[r]===t&&s.push(r);for(n=0;n<s.length;n++)r=s[n],delete i[r]},_pools:[new vt.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:undefined,_defaultParanoia:6,_collectorsStarted:!1,_callbacks:{progress:{},seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3e4,_BITS_PER_RESEED:80,_gen4words:function(){for(var e=0;e<4;e++){this._counter[e]=this._counter[e]+1|0;if(this._counter[e])break}return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new vt.cipher.aes(this._key)},_reseed:function(e){this._key=vt.hash.sha256.hash(this._key.concat(e)),this._cipher=new vt.cipher.aes(this._key);for(var t=0;t<4;t++){this._counter[t]=this._counter[t]+1|0;if(this._counter[t])break}},_reseedFromPools:function(e){var t=[],n=0,r;this._nextReseed=t[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(r=0;r<16;r++)t.push(Math.random()*4294967296|0);for(r=0;r<this._pools.length;r++){t=t.concat(this._pools[r].finalize()),n+=this._poolEntropy[r],this._poolEntropy[r]=0;if(!e&&this._reseedCount&1<<r)break}this._reseedCount>=1<<this._pools.length&&(this._pools.push(new vt.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=n,n>this._strength&&(this._strength=n),this._reseedCount++,this._reseed(t)},_mouseCollector:function(e){var t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0;vt.random.addEntropy([t,n],2,"mouse")},_loadTimeCollector:function(e){vt.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(e,t){var n,r=vt.random._callbacks[e],i=[];for(n in r)r.hasOwnProperty(n)&&i.push(r[n]);for(n=0;n<i.length;n++)i[n](t)}},function(){try{var e=new Uint32Array(32);crypto.getRandomValues(e),vt.random.addEntropy(e,1024,"crypto.getRandomValues")}catch(t){}}();for(k in vt.beware)vt.beware.hasOwnProperty(k)&&vt.beware[k]();return Braintree={sjcl:vt,version:"1.2.0"},Braintree.create=function(e){var n={publicKey:e},r=function(){return{key:vt.random.randomWords(8,0),encrypt:function(e){return this.encryptWithIv(e,vt.random.randomWords(4,0))},encryptWithIv:function(e,t){var n=new vt.cipher.aes(this.key),r=vt.codec.utf8String.toBits(e),i=vt.mode.cbc.encrypt(n,r,t),s=vt.bitArray.concat(t,i);return vt.codec.base64.fromBits(s)}}},i=function(){return{key:vt.random.randomWords(8,0),sign:function(e){var t=new vt.misc.hmac(this.key,vt.hash.sha256),n=t.encrypt(e);return vt.codec.base64.fromBits(n)}}},s=function(e){var t=[];if(e.typeName()=="INTEGER"){var n=e.posContent(),r=e.posEnd(),i=e.stream.hexDump(n,r).replace(/[ \n]/g,"");t.push(i)}if(e.sub!=null)for(var o=0;o<e.sub.length;o++)t=t.concat(s(e.sub[o]));return t},u=function(e){var n=o(e),r=t.decode(n),i=s(r);if(i.length!=2)throw"Malformed public key";var u=i[0],a=i[1],f=new lt;return f.setPublic(u,a),f},a=function(e){var t=u(n.publicKey),s=r(),o=i(),a=s.encrypt(e),f=o.sign(vt.codec.base64.toBits(a)),l=vt.bitArray.concat(s.key,o.key),c=vt.codec.base64.fromBits(l),h=t.encrypt_b64(c),p="$bt4|javascript_"+Braintree.version.replace(/\./g,"_")+"$";return p+h+"$"+a+"$"+f},f=new function(){this.encrypt=a,this.generateAesKey=r,this.generateRsaKey=u,this.publicKey=n.publicKey,this.version=Braintree.version,this.formEncrypter=new Braintree.FormEncrypter(this),this.onSubmitEncryptForm=this.formEncrypter.onSubmitEncryptForm};return vt.random.startCollectors(),f},function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e){this.bt=e,this.onSubmitEncryptForm=t(this.onSubmitEncryptForm,this),this.encryptForm=t(this.encryptForm,this)}return e.prototype.create=function(e,t){var n,r,i;t==null&&(t={}),n=document.createElement(e);for(r in t)i=t[r],n.setAttribute(r,i);return n},e.prototype.inputElements=function(e){var t,n;return n=[],t=function(e){var r,i,s,o,u;o=e.children,u=[];for(i=0,s=o.length;i<s;i++)r=o[i],r.attributes["data-encrypted-name"]?u.push(n.push(r)):u.push(t(r));return u},t(e),n},e.prototype.encryptForm=function(e){var t,n,r,i,s,o,u,a;u=this.inputElements(e),a=[];for(s=0,o=u.length;s<o;s++)t=u[s],r=t.getAttribute("data-encrypted-name"),n=this.bt.encrypt(t.value),t.removeAttribute("name"),i=this.create("input",{value:n,type:"hidden",name:r}),a.push(e.appendChild(i));return a},e.prototype.extractForm=function(e){return window.jQuery&&e instanceof jQuery?e[0]:e instanceof Object?e:document.getElementById(e)},e.prototype.onSubmitEncryptForm=function(e,t){var n,r=this;t==null&&(t=function(e){return e}),e=this.extractForm(e),n=function(n){return r.encryptForm(e),t(n)};if(window.jQuery)return window.jQuery(e).submit(n);if(e.addEventListener)return e.addEventListener("submit",n,!1);if(e.attachEvent)return e.attachEvent("onsubmit",n)},e}(),Braintree.FormEncrypter=e}.call(this),Braintree}(),define("thirdparty/braintree",function(){}),define("tictail/model/store/credit_card",["jquery","underscore","../../core","thirdparty/braintree"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Model=r.TT.Model||{},r.TT.Model.Store=r.TT.Model.Store||{};var i=r.TT.Model.Store.CreditCard=n.Model.extend({API_NAMESPACE:"store.credit_card",API_ACTIONS:{create:"store.credit_card.save"},getEncryptedModelParams:function(e){var n=Braintree.create(braintree_public_key),r=t.clone(e.attributes),i=["card_number","card_cvv","expiry_month","expiry_year"];return t.each(i,function(t){r[t]=n.encrypt(e.get(t))}),r},sync:function(e,t,r){return e==="create"?(r.getRequest=!0,request=n.sync(e,t,r),request.params=this.getEncryptedModelParams(t),request.send(),request):n.sync(e,t,r)}});return i}),define("tictail/model/store/upcoming_billing",["jquery","underscore","../../core"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Model=r.TT.Model||{},r.TT.Model.Store=r.TT.Model.Store||{};var i=r.TT.Model.Store.UpcomingBilling=n.Model.extend({API_NAMESPACE:"store.billing.upcoming",API_ACTIONS:{read:"store.billing.upcoming.get"}});return i}),define("tictail/model/store/billing_history",["jquery","underscore","../../core"],function(e,t,n){var r=this;r.TT=r.TT||{},r.TT.Model=r.TT.Model||{},r.TT.Model.Store=r.TT.Model.Store||{};var i=r.TT.Model.Store.BillingHistory=n.Model.extend({API_NAMESPACE:"store.billing.history",API_ACTIONS:{read:"store.billing.history.get"}});return i}),define("dashboard/form/field/store/credit_card_type",["jquery","tictail/form/field/core"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Form=n.Dashboard.Form||{},n.Dashboard.Form.Field=n.Dashboard.Form.Field={},n.Dashboard.Form.Field.Store=n.Dashboard.Form.Field.Store||{};var r=n.Dashboard.Form.Field.Store.CreditCardType=t.extend({events:{"click .card-type":"onClickCard"},initialize:function(e){return r.__super__.initialize.apply(this,arguments),this.key=e.key,e.value!==undefined&&this.setValue(e.value),this.supportedCards=e.supportedCards||[],this},addModelListeners:function(){this.model.on("change:"+this.modelAttributeName,this.onModelAttributeChange,this)},removeModelListeners:function(){this.model.off("change:"+this.modelAttributeName,this.onModelAttributeChange,this)},onModelAttributeChange:function(e,t,n){if(this._isOurModelChangeEvent)return;this.setValue(t)},onClickCard:function(t){var n=e(t.currentTarget).data("type");this.setValue(n)},render:function(){var t=e("<div/>").addClass(this.key);return e.each(this.supportedCards,function(n,r){var i=e("<div/>").addClass("card-type").addClass(r).data("type",r);t.append(i)}),this.$el.append(t),this.didRender()},setValue:function(e){r.__super__.setValue.apply(this,arguments),this.$(".card-type").removeClass("selected"),this.$(".credit-card-card-type").removeClass("selected"),_.indexOf(this.supportedCards,e)>=0&&(this.$(".credit-card-card-type").addClass("selected"),this.$("."+e).addClass("selected"))}});return r}),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=[].slice,w=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},E=this;e=jQuery,e.payment={},e.payment.fn={},e.fn.payment=function(){var t,n;return n=arguments[0],t=2<=arguments.length?b.call(arguments,1):[],e.payment.fn[n].apply(this,t)},i=/(\d{1,4})/g,r=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:i,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:i,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:i,length:[13,14,15,16],cvcLength:[3],luhn:!0}],t=function(e){var t,n,i;e=(e+"").replace(/\D/g,"");for(n=0,i=r.length;n<i;n++){t=r[n];if(t.pattern.test(e))return t}},n=function(e){var t,n,i;for(n=0,i=r.length;n<i;n++){t=r[n];if(t.type===e)return t}},h=function(e){var t,n,r,i,s,o;r=!0,i=0,n=(e+"").split("").reverse();for(s=0,o=n.length;s<o;s++){t=n[s],t=parseInt(t,10);if(r=!r)t*=2;t>9&&(t-=9),i+=t}return i%10===0},c=function(e){var t;return e.prop("selectionStart")!=null&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:(typeof document!="undefined"&&document!==null?(t=document.selection)!=null?typeof t.createRange=="function"?t.createRange().text:void 0:void 0:void 0)?!0:!1},p=function(t){var n=this;return setTimeout(function(){var n,r;return n=e(t.currentTarget),r=n.val(),r=e.payment.formatCardNumber(r),n.val(r)})},u=function(n){var r,i,s,o,u,a,f;s=String.fromCharCode(n.which);if(!/^\d+$/.test(s))return;r=e(n.currentTarget),f=r.val(),i=t(f+s),o=(f.replace(/\D/g,"")+s).length,a=16,i&&(a=i.length[i.length.length-1]);if(o>=a)return;if(r.prop("selectionStart")!=null&&r.prop("selectionStart")!==f.length)return;i&&i.type==="amex"?u=/^(\d{4}|\d{4}\s\d{6})$/:u=/(?:^|\s)(\d{4})$/;if(u.test(f))return n.preventDefault(),r.val(f+" "+s);if(u.test(f+s))return n.preventDefault(),r.val(f+s+" ")},s=function(t){var n,r;n=e(t.currentTarget),r=n.val();if(t.meta)return;if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==r.length)return;if(t.which===8&&/\s\d?$/.test(r))return t.preventDefault(),n.val(r.replace(/\s\d?$/,""))},a=function(t){var n,r,i;r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;n=e(t.currentTarget),i=n.val()+r;if(/^\d$/.test(i)&&i!=="0"&&i!=="1")return t.preventDefault(),n.val("0"+i+" / ");if(/^\d\d$/.test(i))return t.preventDefault(),n.val(""+i+" / ")},f=function(t){var n,r,i;r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;n=e(t.currentTarget),i=n.val();if(/^\d\d$/.test(i))return n.val(""+i+" / ")},l=function(t){var n,r,i;r=String.fromCharCode(t.which);if(r!=="/")return;n=e(t.currentTarget),i=n.val();if(/^\d$/.test(i)&&i!=="0")return n.val("0"+i+" / ")},o=function(t){var n,r;if(t.meta)return;n=e(t.currentTarget),r=n.val();if(t.which!==8)return;if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==r.length)return;if(/\s\/\s?\d?$/.test(r))return t.preventDefault(),n.val(r.replace(/\s\/\s?\d?$/,""))},g=function(e){var t;return e.metaKey||e.ctrlKey?!0:e.which===32?!1:e.which===0?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},v=function(n){var r,i,s,o;r=e(n.currentTarget),s=String.fromCharCode(n.which);if(!/^\d+$/.test(s))return;if(c(r))return;return o=(r.val()+s).replace(/\D/g,""),i=t(o),i?o.length<=i.length[i.length.length-1]:o.length<=16},m=function(t){var n,r,i;n=e(t.currentTarget),r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;if(c(n))return;i=n.val()+r,i=i.replace(/\D/g,"");if(i.length>6)return!1},d=function(t){var n,r,i;n=e(t.currentTarget),r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;return i=n.val()+r,i.length<=4},y=function(t){var n,i,s,o,u;n=e(t.currentTarget),u=n.val(),o=e.payment.cardType(u)||"unknown";if(!n.hasClass(o))return i=function(){var e,t,n;n=[];for(e=0,t=r.length;e<t;e++)s=r[e],n.push(s.type);return n}(),n.removeClass("unknown"),n.removeClass(i.join(" ")),n.addClass(o),n.toggleClass("identified",o!=="unknown"),n.trigger("payment.cardType",o)},e.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",d),this},e.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",m),this.on("keypress",a),this.on("keypress",l),this.on("keypress",f),this.on("keydown",o),this},e.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",v),this.on("keypress",u),this.on("keydown",s),this.on("keyup",y),this.on("paste",p),this},e.payment.fn.restrictNumeric=function(){return this.on("keypress",g),this},e.payment.fn.cardExpiryVal=function(){return e.payment.cardExpiryVal(e(this).val())},e.payment.cardExpiryVal=function(e){var t,n,r,i;return e=e.replace(/\s/g,""),i=e.split("/",2),t=i[0],r=i[1],(r!=null?r.length:void 0)===2&&/^\d+$/.test(r)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),r=n+r),t=parseInt(t,10),r=parseInt(r,10),{month:t,year:r}},e.payment.validateCardNumber=function(e){var n,r;return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)?(n=t(e),n?(r=e.length,w.call(n.length,r)>=0)&&(n.luhn===!1||h(e)):!1):!1},e.payment.validateCardExpiry=function(t,n){var r,i,s,o;return typeof t=="object"&&"month"in t&&(o=t,t=o.month,n=o.year),!t||!n?!1:(t=e.trim(t),n=e.trim(n),/^\d+$/.test(t)?/^\d+$/.test(n)?parseInt(t,10)<=12?(n.length===2&&(s=(new Date).getFullYear(),s=s.toString().slice(0,2),n=s+n),i=new Date(n,t),r=new Date,i.setMonth(i.getMonth()-1),i.setMonth(i.getMonth()+1,1),i>r):!1:!1:!1)},e.payment.validateCardCVC=function(t,r){var i,s;return t=e.trim(t),/^\d+$/.test(t)?r?(i=t.length,w.call((s=n(r))!=null?s.cvcLength:void 0,i)>=0):t.length>=3&&t.length<=4:!1},e.payment.cardType=function(e){var n;return e?((n=t(e))!=null?n.type:void 0)||null:null},e.payment.formatCardNumber=function(e){var n,r,i,s;return n=t(e),n?(i=n.length[n.length.length-1],e=e.replace(/\D/g,""),e=e.slice(0,+i+1||9e9),n.format.global?(s=e.match(n.format))!=null?s.join(" "):void 0:(r=n.format.exec(e),r!=null&&r.shift(),r!=null?r.join(" "):void 0)):e}}.call(this),define("thirdparty/jquery/payment",function(){}),define("dashboard/form/field/store/credit_card_number",["jquery","tictail/form/field/text","thirdparty/jquery/payment"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Form=n.Dashboard.Form||{},n.Dashboard.Form.Field=n.Dashboard.Form.Field={},n.Dashboard.Form.Field.Store=n.Dashboard.Form.Field.Store||{};var r=n.Dashboard.Form.Field.Store.CreditCardNumber=t.extend({fieldAttributes:{type:"text",placeholder:"XXXX XXXX XXXX XXXX",autocompletetype:"cc-number",pattern:"\\d*"},initialize:function(e){return r.__super__.initialize.apply(this,arguments),this.disabled&&(this.readOnly=!0,this.fieldTagName="em"),this._getFieldNode().payment("formatCardNumber"),this.supportedCards=e.supportedCards||[],this},addModelListeners:function(){r.__super__.addModelListeners.apply(this,arguments),this.model.on("change:"+this.modelAttributeName,this.onCardChange,this)},removeModelListeners:function(){r.__super__.removeModelListeners.apply(this,arguments),this.model.off("change:"+this.modelAttributeName,this.onCardChange,this)},onCardChange:function(t,n,r){var i=e.payment.cardType(n);t.set("card_type",i)},_validate:function(t){var n=e.payment.validateCardNumber(t);return n?_.indexOf(this.supportedCards,e.payment.cardType(t))<0?["Unsupported card type"]:[]:["Invalid card number"]},didRender:function(){return this.readOnly===!0&&this._getFieldNode().html(this.value),r.__super__.didRender.apply(this,arguments)}});return r}),define("dashboard/form/field/store/credit_card_cvv",["jquery","tictail/form/field/text"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Form=n.Dashboard.Form||{},n.Dashboard.Form.Field=n.Dashboard.Form.Field={},n.Dashboard.Form.Field.Store=n.Dashboard.Form.Field.Store||{};var r=n.Dashboard.Form.Field.Store.CreditCardNumber=t.extend({fieldAttributes:{type:"text",autocomplete:"off",placeholder:"CVC / CVV"},initialize:function(e){return r.__super__.initialize.apply(this,arguments),this._getFieldNode().payment("formatCardCVC"),this},_validate:function(t){var n=e.payment.validateCardCVC(t);return n?[]:["Invalid CVC"]}});return r}),define("dashboard/form/field/store/credit_card_expiry_year",["jquery","tictail/form/field/select"],function(e,t){var n=this;n.Dashboard=n.Dashboard||{},n.Dashboard.Form=n.Dashboard.Form||{},n.Dashboard.Form.Field=n.Dashboard.Form.Field={},n.Dashboard.Form.Field.Store=n.Dashboard.Form.Field.Store||{};var r=n.Dashboard.Form.Field.Store.CreditCardExpiryYear=t.extend({initialize:function(e){r.__super__.initialize.apply(this,arguments);var t=[],n;for(n=0;n<10;n++){var i=(new Date).getFullYear()+n;t.push({value:i,label:i})}this.choices=t}});return r}),define("dashboard/nls/payment",{root:{credit_card:{month:{1:"01 - January",2:"02 - February",3:"03 - March",4:"04 - April",5:"05 - May",6:"06 - June",7:"07 - July",8:"08 - August",9:"09 - September",10:"10 - October",11:"11 - November",12:"12 - December"}},field:{credit_card_number:{label:"Card Number"},credit_card_cvv:{label:"Security Code"},credit_card_expiry_month:{label:"Expiration Date"}},overlay:{cancel:"Cancel",save:"Save",heading:"Credit card information",legal:'By entering your credit card information, you agree to the <a href="https://tictail.com/legal/terms-of-service" target="_blank">terms of service</a>.'}}}),define("dashboard/form/field/store/credit_card_expiry_month",["jquery","tictail/form/field/select","i18n!../../../nls/payment"],function(e,t,n){var r=this;r.Dashboard=r.Dashboard||{},r.Dashboard.Form=r.Dashboard.Form||{},r.Dashboard.Form.Field=r.Dashboard.Form.Field={},r.Dashboard.Form.Field.Store=r.Dashboard.Form.Field.Store||{};var i=r.Dashboard.Form.Field.Store.CreditCardExpiryMonth=t.extend({initialize:function(e){i.__super__.initialize.apply(this,arguments);var t=n.credit_card.month;this.choices=[{value:1,label:t[1]},{value:2,label:t[2]},{value:3,label:t[3]},{value:4,label:t[4]},{value:5,label:t[5]},{value:6,label:t[6]},{value:7,label:t[7]},{value:8,label:t[8]},{value:9,label:t[9]},{value:10,label:t[10]},{value:11,label:t[11]},{value:12,label:t[12]}]}});return i}),define("dashboard/form/payment/creditcard",["underscore","tictail/core","tictail/component/api","tictail/component/grid","tictail/form/core","dashboard/form/field/store/credit_card_type","dashboard/form/field/store/credit_card_number","dashboard/form/field/store/credit_card_cvv","dashboard/form/field/store/credit_card_expiry_year","dashboard/form/field/store/credit_card_expiry_month","i18n!../../nls/payment"],function(e,t,n,r,i,s,o,u,a,f,l){var c=this;c.Dashboard=c.Dashboard||{},c.Dashboard.Form=c.Dashboard.Form||{},c.Dashboard.Form.Payment=c.Dashboard.Form.Payment||{};var h=c.Dashboard.Form.Payment.CreditCardForm=i.extend({buttonLabel:l.overlay.save,buttonId:"name-save",allFields:["credit-card-card-type","credit-card-card-number","credit-card-card-cvv","credit-card-expiry-month","credit-card-expiry-year"],createField:function(e){var n=t.session.getCurrentStore().get("id"),r=SupportedCreditCards[n];switch(e){case"credit-card-card-type":return new s({key:e,model:{instance:this.model,attribute:"card_type"},attributes:{"class":"field credit-card-type-field"},supportedCards:r});case"credit-card-card-number":return new o({key:e,label:l.field.credit_card_number.label,model:{instance:this.model,attribute:"card_number"},required:!0,attributes:{"class":"field credit-card-number-field"},supportedCards:r});case"credit-card-card-cvv":return new u({key:e,label:l.field.credit_card_cvv.label,model:{instance:this.model,attribute:"card_cvv"},required:!0,attributes:{"class":"field credit-card-cvv-field"}});case"credit-card-expiry-month":return new f({key:e,label:l.field.credit_card_expiry_month.label,model:{instance:this.model,attribute:"expiry_month"},attributes:{"class":"field credit-card-expiry-month-field"}});case"credit-card-expiry-year":return new a({key:e,label:"&nbsp;",model:{instance:this.model,attribute:"expiry_year"},attributes:{"class":"field credit-card-expiry-year-field"}});default:throw new Error("Unknown field")}},renderFields:function(){var t=this.getFields(this.allFields);if(e.isEmpty(t))return!1;var n=[{content:this.getField("credit-card-card-type"),gutterClass:"no-gutter"},{content:this.getField("credit-card-card-number"),gutterClass:"no-gutter"},{content:this.getField("credit-card-card-cvv"),gutterClass:"no-gutter-r"}],i=[{content:this.getField("credit-card-expiry-month"),gutterClass:"no-gutter"},{content:this.getField("credit-card-expiry-year"),gutterClass:"no-gutter-r"}];return this.addChildView(new r({columns:n,className:"row field-row with-overflow"})),this.addChildView(new r({columns:i,className:"row field-row with-overflow"})),this.addChildView($("<p></p>").addClass("legal").html(l.overlay.legal)),!0},render:function(){return this.empty(),this.renderFields(),this.addChildView(this.actionbar),this.didRender()},actionbarGetParams:function(){var t=h.__super__.actionbarGetParams.apply(this,arguments);return t.link={label:l.overlay.cancel,callback:e.bind(this.cancel,this)},t},setLoadingSaveButton:function(e,t){h.__super__.setLoadingSaveButton.apply(this,arguments),this.actionbar.$("a").toggleClass("disabled",e)},cancel:function(){this.trigger("onCancel",this)},onSuccessfulSave:function(e,t){this.trigger("onSuccessfulSave",e,t,this)},onSaveError:function(e,t){var n=(t.data||"card_number").replace("_","-"),r=this.getField("credit-card-"+n);r&&r.setError([t.message]),this.setLoadingSaveButton(!1),this.trigger("onSaveError",e,t,this)}});return h}),define("dashboard/nls/apps",{root:{index:{page_title:"Apps",list:{title:"Apps",free_label:"Free"}},overlay:{credit_card:{sub_heading:{missing_credit_card:"Please add a credit card to use apps",expired_credit_card:"Your current credit card has expired.<br>You need to add a new one to use apps."}}},errors:{prorate_payment_failed:"The transaction failed. Are there enough funds on the account?",unknown_error:"Oh no! The transaction failed, no funds have been withdrawn."}}}),define("dashboard/module/payment/creditcard_overlay",["underscore","tictail/core","tictail/utility","tictail/component/api","tictail/component/tracker","tictail/model/store/credit_card","dashboard/form/payment/creditcard","../../view","i18n!../../nls/payment","i18n!../../nls/apps","thirdparty/jquery/payment"],function(e,t,n,r,i,s,o,u,a,f){var l=this;l.Dashboard=l.Dashboard||{},l.Dashboard.Module=l.Dashboard.Module||{},l.Dashboard.Module.Payment=l.Dashboard.Module.Payment||{};var c=l.Dashboard.Module.Payment.CreditCardEditView=u.extend({id:"creditcard-edit-view",template:"module/overlay",container:".content",initialize:function(n){return this.model=new s({store_id:t.session.getCurrentStore().get("id")}),this.errorCode=n.errorCode,this.errorCode?this.errorCode===r.ERROR_CODES.APPSTORE_INSTALLATION_REQUIRES_CREDIT_CARD?this.sub_heading=f.overlay.credit_card.sub_heading.missing_credit_card:this.errorCode===r.ERROR_CODES.APPSTORE_INSTALLATION_CREDIT_CARD_EXPIRED?this.sub_heading=f.overlay.credit_card.sub_heading.expired_credit_card:this.errorCode===r.ERROR_CODES.APPSTORE_PRORATE_PAYMENT_FAILED?this.errorMessage=f.errors.prorate_payment_failed:this.errorMessage=f.errors.unknown_error:this.sub_heading=e.isUndefined(n.sub_heading)?undefined:n.sub_heading,c.__super__.initialize.apply(this,arguments)},getTemplateData:function(){return{error_message:this.errorMessage,heading:a.overlay.heading,sub_heading:this.sub_heading}},getContent:function(){var e=this;return this.errorMessage?(this.$(".cancel").one("click",function(){e.onCancel()}),{}):t.getLazy(this,"creditCardForm",function(){var e=new o({model:this.model,buttonLabel:this.options.buttonLabel});return e.on("onSuccessfulSave",this.onSuccessfulSave,this),e.on("onCancel",this.onCancel,this),e.on("onSaveError",this.onSaveError,this),e})},render:function(){return c.__super__.render.apply(this,arguments)},onSuccessfulSave:function(){i.track("Saved CreditCardEditView"),this.trigger("onSuccessfulSave",this)},onCancel:function(){i.track("Cancelled CreditCardEditView"),this.trigger("onCancel",this)},onSaveError:function(){n.shake(this.$el.parent(".inner"))}});return c}),define("dashboard/module/creditcard",["tictail/core","tictail/view","tictail/form/field/button","dashboard/module/payment/creditcard_overlay","i18n!../nls/settings"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.View=s.Dashboard.View||{};var o=s.Dashboard.View.CreditCard=t.extend({template:"module/creditcard",attributes:{"class":"credit-card-view"},initialize:function(e){o.__super__.initialize.apply(this,arguments),this.modelAttributeName=e.model.attribute,this.model=this.getModel(this.modelAttributeName)},getModel:function(e){return this.model.instance.get(e)},getUpdateCreditCardButton:function(){var e=this,t=i.billing.field.credit_card.button,s=t.add;switch(this.model.get("status")){case"expired":case"valid":s=t.update}var o=new n({key:"store-update-credit-card",value:s,onClick:function(){var t={buttonLabel:s},n=new r(t);n.on("onCancel",function(e){e.remove(),this.trigger("onCancel",this)},e),n.on("onSuccessfulSave",function(e){this.model.set(e.model.attributes),e.remove(),this.render(),this.trigger("onSuccessfulSave",this)},e),n.overlay({parentView:e,closeButton:!1})}});return o},getTemplateData:function(){var e={card_type:this.model.get("card_type"),masked_number:this.model.get("masked_number"),status:this.model.get("status"),expiry_month:this.model.get("expiry_month"),expiry_year:this.model.get("expiry_year")};return _.isUndefined(this.options.infoOnInvalidCard)===!1&&(e.info_on_invalid_card=this.options.infoOnInvalidCard),e},getContent:function(e){return this.getUpdateCreditCardButton()}});return o}),define("dashboard/module/installed_apps",["jquery","underscore","tictail/core","tictail/view","tictail/model/store/app"],function(e,t,n,r,i){var s=this;s.Dashboard=s.Dashboard||{},s.Dashboard.View=s.Dashboard.View||{};var o=s.Dashboard.View.InstalledApps=r.extend({template:"module/installed_apps",events:{"click .remove-app":"onClickRemoveApp","click .app-store-link":"onClickAppStoreLink"},initialize:function(){o.__super__.initialize.apply(this,arguments);var e=t.map(this.options.apps,function(e){return new i(e)});e=t.filter(e,function(e){return e.get("is_preinstalled")!==!0}),this.apps=t.sortBy(e,"name")},getTemplateData:function(){var e=t.map(this.apps,this.formatApp);return{apps:e,has_apps:!t.isEmpty(e)}},formatApp:function(e){return t.extend({},e.toJSON(),{is_free:e.get("cost_type")==="free"})},onClickRemoveApp:function(n){var r=e(n.target).data("id"),i=t.find(this.apps,function(e){return e.get("id")==r});n.preventDefault();if(!i)return;var s=this;i.uninstall(function(){s.apps=t.filter(s.apps,function(e){return e.get("id")!==r}),s.render()})},onClickAppStoreLink:function(e){e.preventDefault(),Dashboard.router.navigate("/dashboard/apps",{trigger:!0})}});return o}),define("dashboard/module/upcoming_billing",["underscore","icanhaz","tictail/core","tictail/utility","tictail/view","tictail/form/field/button","i18n!../nls/settings"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.View=u.Dashboard.View||{};var a=u.Dashboard.View.UpcomingBilling=i.extend({initialize:function(e){a.__super__.initialize.apply(this,arguments),this.modelAttributeName=e.model.attribute,this.model=this.getModel(this.modelAttributeName)},getModel:function(e){return this.model.instance.get(e)},getTemplateData:function(){if(!this.model)return{};var t=e.clone(this.model.attributes);return e.each(t.orders,function(t){t.at=r.getDate(t.at),t.price=r.formatPrice(t.amount,t.currency),e.each(t.installations,function(e){e.price=r.formatPrice(e.amount,e.currency)})}),t.has_orders=!e.isEmpty(t.orders),t},getContent:function(e){return t["module/upcoming_billing"](this.getTemplateData())}});return a}),define("dashboard/module/billing_history",["underscore","icanhaz","tictail/core","tictail/utility","tictail/view","tictail/form/field/button","i18n!../nls/settings"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.View=u.Dashboard.View||{};var a=u.Dashboard.View.BillingHistory=i.extend({initialize:function(e){a.__super__.initialize.apply(this,arguments),this.modelAttributeName=e.model.attribute,this.model=this.getModel(this.modelAttributeName)},getModel:function(e){return this.model.instance.get(e)},getTemplateData:function(){if(!this.model)return{};var t=e.clone(this.model.attributes);return e.each(t.orders,function(e){e.at=r.getDate(e.at),e.price=r.formatPrice(e.amount,e.currency)}),t.has_orders=!e.isEmpty(t.orders),t},getContent:function(e){return t["module/billing_history"](this.getTemplateData())}});return a}),define("dashboard/form/settings/billing",["underscore","tictail/core","tictail/form/core","tictail/form/fieldset","../../module/creditcard","../../module/installed_apps","../../module/upcoming_billing","../../module/billing_history","i18n!../../nls/settings"],function(e,t,n,r,i,s,o,u,a){var f=this;f.Dashboard=f.Dashboard||{},f.Dashboard.Form=f.Dashboard.Form||{},f.Dashboard.Form.Settings=f.Dashboard.Form.Settings={};var l=f.Dashboard.Form.Settings.Billing=n.extend({creditCardFields:["set-store-credit-card"],installedAppsFields:["installed-apps"],upcomingBillingFields:["upcoming-billing"],billingHistoryFields:["billing-history"],allFields:function(){return this.allFields=this.creditCardFields.concat(this.installedAppsFields,this.upcomingBillingFields,this.billingHistoryFields),this.allFields},willRemove:function(){this.model.off(null,null,this)},createField:function(e){switch(e){case"set-store-credit-card":var t;return this.model.get("credit_card").get("status")!=="valid"&&(t=a.billing.field.credit_card.infoOnInvalidCard),new i({model:{attribute:"credit_card",instance:this.model},infoOnInvalidCard:t});case"installed-apps":return new s({apps:this.model.get("installed_apps")});case"upcoming-billing":return new o({model:{attribute:"upcoming_billing",instance:this.model}});case"billing-history":return new u({model:{attribute:"billing_history",instance:this.model}});default:return null}},renderCreditCard:function(){var t=this.getFields(this.creditCardFields);if(e.isEmpty(t))return!1;var n=new r({title:a.billing.section.credit_card.title,description:a.billing.section.credit_card.description,rightColumnContent:t});return this.addChildView(n),!0},renderInstalledApps:function(){var t=this.getFields(this.installedAppsFields);if(e.isEmpty(t))return!1;var n=new r({title:a.billing.section.installed_apps.title,description:a.billing.section.installed_apps.description,rightColumnContent:t});return this.addChildView(n),!0},renderUpcomingBilling:function(){var t=this.getFields(this.upcomingBillingFields);if(e.isEmpty(t))return!1;var n=new r({title:a.billing.section.upcoming.title,description:a.billing.section.upcoming.description,rightColumnContent:t});return this.addChildView(n),!0},renderBillingHistory:function(){var t=this.getFields(this.billingHistoryFields);if(e.isEmpty(t))return!1;var n=new r({title:a.billing.section.history.title,description:a.billing.section.history.description,rightColumnContent:t});return this.addChildView(n),!0},render:function(){return this.empty(),this.renderCreditCard(),this.renderInstalledApps(),this.renderUpcomingBilling(),this.renderBillingHistory(),this.didRender()}});return l}),define("dashboard/view/settings/billing",["underscore","tictail/core","tictail/component/api","tictail/model/store/credit_card","tictail/model/store/upcoming_billing","tictail/model/store/billing_history","../../module/loadpage","../../form/settings/billing","i18n!dashboard/nls/settings"],function(e,t,n,r,i,s,o,u,a){var f=this;f.Dashboard=f.Dashboard||{},f.Dashboard.View=f.Dashboard.View||{},f.Dashboard.View.Settings=f.Dashboard.View.Settings={};var l=f.Dashboard.View.Settings.Billing=o.extend({bodyId:"settings-billing-view",included:["credit_card","installed_apps","upcoming_billing","billing_history"],initialize:function(t){t=t||{},e.isArray(t.include)===!0&&(this.included=t.include),l.__super__.initialize.call(this,t)},isIncluded:function(t){return e.indexOf(this.included,t)!==-1},load:function(){var e=new n.Batch,o=t.session.getCurrentStore().id,u=new t.Model,a=function(t){t.params||(t.params={}),t.params.store_id=o,e.appendRequest(t)};if(this.isIncluded("credit_card")){var f=new r;a(f.fetch({getRequest:!0,success:function(){u.set("credit_card",f)}}))}if(this.isIncluded("installed_apps")){var l=new n.Request("appstore.apps.get_installed",{store_id:o},"GET");l.setOnSuccess(function(e){u.set("installed_apps",e)}),a(l)}if(this.isIncluded("upcoming_billing")){var c=new i;a(c.fetch({getRequest:!0,success:function(){u.set("upcoming_billing",c)}}))}if(this.isIncluded("billing_history")){var h=new s;a(h.fetch({getRequest:!0,success:function(){u.set("billing_history",h)}}))}if(e.getStackLength()===0){this.useCachedData(u);return}e.on("complete",function(){this.didLoad(u)},this),e.send()},getStoreData:function(){var e=t.session.getCurrentStore();return{store_id:e.id,name:e.get("name"),country:e.get("country"),currency:e.get("currency")}},didLoad:function(t){if(t){var n=this.getStoreData(),r={silent:!0};e.each(n,function(e,n){t.has(n)||t.set(n,e,r)}),t.change()}l.__super__.didLoad.call(this,t)},getForm:function(){return t.getLazy(this,"form",function(){var t,n=u.prototype;this.formInclude!==undefined?t=this.formInclude:(t=[],this.isIncluded("credit_card")&&(t=t.concat(n.creditCardFields)),this.isIncluded("installed_apps")&&(t=t.concat(n.installedAppsFields)),this.isIncluded("upcoming_billing")&&(t=t.concat(n.upcomingBillingFields)),this.isIncluded("billing_history")&&(t=t.concat(n.billingHistoryFields)));var r=e.extend({model:this.data,include:t},this.formOptions),i=new u(r);return i})},getLoadedContent:function(){return this.getForm()},getTitle:function(){return a.billing.page_title},setFocus:function(){this.form!==undefined&&this.form.setFocus()}});return l}),define("dashboard/layout/settings",["tictail/component/log","../model/store/base","../module/layout","../view/settings/general","../view/settings/fulfillment","../view/settings/billing"],function(e,t,n,r,i,s){var o=this;o.Dashboard=o.Dashboard||{},o.Dashboard.Layout=o.Dashboard.Layout||{};var u=o.Dashboard.Layout.Settings=n.extend({sectionName:"settings",hasSubnavigation:!0,initialize:function(t,n){u.__super__.initialize.call(this,n),this.setBodyId(),this.setPageBySubnavigationName(t||"general"),e.info("Did initialize store settings layout")},setBodyId:function(e){e=e||this.sectionName||"",$("body").attr("id",e)},subnavigationGetParams:function(){var e={general:{label:"General",url:t.generateCurrentStoreUrl("/settings"),page:{cls:r}},fulfillment:{label:"Payments, Shipping & Legal",url:t.generateCurrentStoreUrl("/settings/fulfillment"),page:{cls:i}},"theme-editor":{label:"Edit Storefront Design",callback:this.didClickDesignButton,isButton:!0}};return Dashboard.featureActive("creditcard")===!0&&(e.billing={label:"Billing",url:t.generateCurrentStoreUrl("/settings/billing"),page:{cls:s}}),e},didClickDesignButton:function(){this.navigate("/themes")}});return u}),define("dashboard/nls/custom_domain",{root:{test:{empty:"Enter your domain name (eg. example.com) to test whether it has been configured correctly.",valid:"All good under the hood!<br/>Your domain is configured and ready to go.",invalid:"This is not a valid domain (only letters and number are allowed)",ends_with_tictail:"Uh-oh, custom domains can't end with tictail.com!",occupied:"This domain is in use by another store.",no_response:"We were unable to determine if your domain has been setup correctly. Please try again.",invalid_response:"This domain is not pointing to Tictail. To use it for your store, change your domain's <strong>{expected_type}</strong> record to the below. It can take a couple of hours for the change to be visible to Tictail.",error:"An error occurred while testing your domain.<br/>Please try again."},labels:{have_domain_link:"I already have a domain I want to connect",buy_domain_link:"Buy a preconfigured domain",buy_domain:"Buy a Preconfigured Domain",test_domain:"Test Domain",help_link:"How do I set up my custom domain?"}}}),define("dashboard/form/field/store/domain",["jquery","underscore","tictail/core","tictail/component/tracker","tictail/component/log","tictail/component/api","tictail/form/field/text","i18n!../../../nls/custom_domain"],function(e,t,n,r,i,s,o,u){var a=this;a.Dashboard=a.Dashboard||{},a.Dashboard.Form=a.Dashboard.Form||{},a.Dashboard.Form.Field=a.Dashboard.Form.Field={},a.Dashboard.Form.Field.Store=a.Dashboard.Form.Field.Store||{};var f=a.Dashboard.Form.Field.Store.Domain=o.extend({attributes:{"class":"field store-domain-field"},fieldAttributes:{type:"text","class":"domain-name"},buyDomainLink:"http://www.shareasale.com/r.cfm?u=714148&b=210737&m=25581&afftrack=&urllink=iwantmyname%2Ecom%2Fservices%2Fecommerce%2Dhosting%2Ftictail%2Dstore%2Dcustom%2Ddomain",helpLink:"http://help.tictail.com/customer/portal/articles/1333300?utm_source=custom-domain-app&utm_medium=referral",pattern:/^[\-a-z0-9\.]+\.[a-z\.]+$/,baseUrlPattern:/\.tictail\.com$/,buyDomaindId:"store-domain-buy",events:function(){var e=f.__super__.events.call(this);return e[this.getEventKey("keydown")]="onKeyDown",e[this.getEventKey("keyup")]="onKeyUp",e},initialize:function(e){e=e||{},e.minLength=3,e.maxLength=255,this.lastTestedValue=null,this.lastValidValue=null,f.__super__.initialize.call(this,e)},testDomain:function(){var t=this,n=this._getFieldValue(),r=this._getFieldNode().add(this.getTestButtonNode()),i;if(!n){t.showResult(u.test.empty),this._getFieldNode().focus();return}if(this._validate(n).length){t.showResult(!1);return}r.prop("disabled",!0),i=e.Deferred().always(function(){r.prop("disabled",!1)}),this._validateRemote(n,i,!0,!0)},showResult:function(e,t){e?this.$el.find(".message").html(e).end().find(".target").val(t||"").toggle(!!t).end().addClass("with-result"):this.$el.removeClass("with-result")},setInitValue:function(e){f.__super__.setInitValue.call(this,e),this.lastValidValue=e},setNodeValue:function(e){f.__super__.setNodeValue.call(this,e),this.$el.toggleClass("expanded",!!e),this.showResult(!1)},_sanitize:function(e){if(t.isUndefined(e)===!0)return;return e.toLowerCase()},_validate:function(e){var t=f.__super__._validate.call(this,e);return this.pattern.test(e)||t.push(u.test.invalid),this.baseUrlPattern.test(e)&&t.push(u.test.ends_with_tictail),t},_validateRemote:function(e,t,r,o){if(!e||!r&&e===this.lastValidValue){t.resolve(this);return}var a=this,f=new s.Request("store.domain.check",{store_id:n.session.getCurrentStore().id,domain:e},"GET",null);f.setOnSuccess(function(r,i,s,f){r.success?(a.lastValidValue=e,a.showResult(u.test.valid),t.resolve(a)):(r.occupied?a.showResult(u.test.occupied):r.expected_type&&r.expected_value?a.showResult(n.lang(u.test.invalid_response,r),r.expected_value):a.showResult(u.test.no_response),t.reject(o?[]:["This domain has not been configured correctly."],a))}),f.setOnError(function(e,n,r,s){i.error("Domain lookup failed",e,r,s,n),a.showResult(u.test.error),t.reject(o?[]:["We couldn't test your domain"],a)}),f.send(),this.lastTestedValue=e},setError:function(e){e&&e.length!==0&&f.__super__.setError.call(this,e)},getLabel:function(){return null},renderField:function(){var t=e('<div class="imprint bottom-gap"/>'),n=e('<div class="domain-selector"/>');e('<div class="buy-view"/>').append(this.getBuyDomainButton()).appendTo(t),this.addChildView(this._getFieldNode(),n),n.append(this._getFieldNode()).append(this.getTestButtonNode()).append(this.getResultsField()).appendTo(t),this.$el.append(t).append(this.getOpenDialogLink()).append(this.getBuyDomainLink()).append(this.getHelpLink())},onKeyDown:function(e){e.which===13&&(e.preventDefault(),this._enterKeyDown!==!0&&(this._enterKeyDown=!0,this._getFieldNode().change(),this.testDomain()))},onKeyUp:function(t){if(t.which===13){this._enterKeyDown=!1;return}e(t.currentTarget).val()!==this.lastTestedValue&&this.showResult(!1)},goBuyDomain:function(){window.open(this.buyDomainLink)},openHelpPage:function(){window.open(this.helpLink,"_blank").focus()},getOpenDialogLink:function(){var t=this;return n.getLazy(this,"_openLink",function(){return e('<a href="#" class="open-link action-link"/>').text(u.labels.have_domain_link).click(function(e){e.preventDefault(),t.$el.addClass("expanded"),t.setFocus(),r.track("Clicked 'Connect Domain'")})})},getBuyDomainButton:function(){var t=this;return n.getLazy(this,"_buyButton",function(){return e('<button type="button" class="buy-domain-button"/>').text(u.labels.buy_domain).attr("tabindex",t.tabIndex).click(function(e){e.preventDefault(),t.goBuyDomain(),t.$el.addClass("expanded"),t.setFocus(),r.track("Clicked 'Buy Domain'")})})},getBuyDomainLink:function(){var t=this;return n.getLazy(this,"_buyLink",function(){return e('<a href="#" class="buy-domain-link action-link"/>').text(u.labels.buy_domain_link).click(function(e){e.preventDefault(),t.goBuyDomain(),r.track("Clicked 'Buy Domain'")})})},getHelpLink:function(){var t=this;return n.getLazy(this,"_helpLink",function(){return e('<a href="#" class="help-link action-link"/>').text(u.labels.help_link).click(function(e){e.preventDefault(),t.openHelpPage(),r.track("Opened Domain Help Page")})})},getTestButtonNode:function(){var r=this;return n.getLazy(this,"_testButton",function(){return e('<button type="button" class="test-button"/>').attr("tabindex",r.tabIndex).text(u.labels.test_domain).click(t.bind(r.testDomain,r))})},getResultsField:function(){return n.getLazy(this,"_resultsField",function(){return e('<div class="result"/>').append(e('<div class="message"/>')).append(e('<input type="text" class="target"/>').click(function(){e(this).select()}))})}});return f}),define("tictail/model/store/domain",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Domain=e.Model.extend({API_NAMESPACE:"store.domain",sync:function(t,n,r){return t==="create"&&(t="save"),e.sync(t,n,r)},getDefaultParams:function(){return{store_id:e.session.getCurrentStore().id}}});return n}),define("app/embedded/nls",{root:{share:{heading:"",description:"",status_message:"",message_label:"Message",services_label:"Sharing options",share_button_label:"Share",not_now_link_label:"Not now"}}}),define("dashboard/module/embedded/nls",function(){}),define("app/embedded/app-handler",["jquery","underscore","tictail/core","tictail/component/api","tictail/component/oauth","tictail/mediator","tictail/component/log","tictail/model/store/app","dashboard/module/payment/creditcard_overlay","dashboard/module/social/share","i18n!app/embedded/nls"],function(e,t,n,r,i,s,o,u,a,f,l){var c=this,h=function(t){this.appUrl=t.appUrl,this.appOrigin=t.appOrigin,this.appId=t.appId,this.options=t,this.events=e({}),this.setupMessageEvents(),this.setupListeners(),t.isPrivileged&&this.setupPrivilegedListeners()};return e.extend(h.prototype,{setupMessageEvents:function(){var t=this;e(window).off("message.appevents").on("message.appevents",function(e){o.debug("Got message",e.originalEvent.data);if(e.originalEvent.origin!==t.appOrigin){o.warn("Discarded message from",e.originalEvent.origin,"due to incorrect origin");return}var n;try{n=JSON.parse(e.originalEvent.data)}catch(r){o.warn("Discarded message",e.originalEvent.data,"due to JSON parse failure!");return}t.events.trigger(n.eventName,n.eventData)})},setupListeners:function(){this.events.on({requestAccess:t.bind(this.onRequestAccess,this),showStatus:t.bind(this.onShowStatus,this),showShareDialog:t.bind(this.onShowShareDialog,this),loading:t.bind(s.publish,s,"app.loading"),loaded:t.bind(s.publish,s,"app.loaded")})},setupPrivilegedListeners:function(){this.events.on({installApp:t.bind(this.onInstallApp,this)})},trigger:function(e,t){var n=document.getElementById(this.appId);if(!n)return;var r=JSON.stringify({eventName:e,eventData:t});n.contentWindow.postMessage(r,this.appUrl)},onRequestAccess:function(){var r=n.session.getCurrentStore().get("oauth_bearer");if(t.isUndefined(r)){o.error("No OAuth bearer found in session!");return}var i=r.access_token;if(t.isEmpty(i)){o.error("No access token could be retrieved!");return}var s=this,u=n.session.getCurrentStore().get("external_id"),a=n.session.get("rest_api_base_url");a=a+"/v1/stores/"+u,a+="?access_token="+i,e.get(a,function(e){t.has(e,"id")?s.trigger("access",{accessToken:i,store:e}):o.error("Could not fetch store resource!")},"json")},onShowStatus:function(e,t){c.Dashboard.showStatusHud(t)},onShowShareDialog:function(e,n){var r=this,i={heading:n.heading,status_message:n.message},s=new f({lang:t.extend(l.share,i)});s.overlay({closeButton:!1}),s.on("onDone",function(e,t){e.remove(),r.trigger("shareDialogShown",t)})},navigateToApp:function(e){e.get("is_external")?window.open(e.getExternalPath(),e.get("namespace")):c.Dashboard.router.navigate(e.getPath(),{trigger:!0})},onInstallApp:function(e,o){var f=this,l={},c=n.session.getCurrentStore().get("id");t.isObject(o)&&(l=o,o=l.namespace),i.getAppByNamespace(c,o,function(c){var h=new u(c),p=n.session.getCurrentStore().id,d={store_id:p,app_id:h.get("id")},v=i.getParams();t.isEmpty(v)||(d.oauth_credentials=v);var m=new r.Request("store.app.install",d,"POST");m.setOnSuccess(function(e,n,r,i){h.clear({silent:!0}).set(e);if(!h.get("is_installed"))return;s.publish("app.installed",h),l.performCard?(f.events.trigger("perform",{sendRequest:!1}),setTimeout(t.bind(f.navigateToApp,f,h),1e3)):f.navigateToApp(h)}),m.setOnError(function(t,n,r,i){var s={buttonLabel:"Save card",errorCode:t.code},u=new a(s);u.on("onCancel",function(){u.remove()}),u.on("onSuccessfulSave",function(){u.remove(),f.onInstallApp(e,o)}),u.overlay({closeButton:!1})}),m.send()})}}),h}),define("dashboard/module/embedded/app-handler",function(){}),define("app/embedded",["jquery","underscore","tictail/component/log","tictail/component/oauth","dashboard/module/loadpage","app/embedded/app-handler"],function(e,t,n,r,i,s){var o=i.extend({className:"app-embedded",template:"module/embedded/index",bodyId:"app-embedded",initialize:function(){var e=this;e.loadingApp=!0,o.__super__.initialize.apply(this,arguments),this.options.autoload!==!1&&this.loadApp()},loadApp:function(){var e=this,i=this.getCurrentStore().get("id"),s=this.options.app_id;if(t.isUndefined(s)){n.error("No app_id in embedded options!");return}r.getAppById(i,s,function(t){e.setupOAuthBearer(i,t,e.options.uri)},function(){e.onError()})},setupOAuthBearer:function(e,i,s){var o=this;n.info("Setup OAuth bearer with url",s),r.getImplicitURL(e,i,s,function(e){t.isUndefined(e.url)&&o.onError("No URL to redirect to, check destination");var n=e.url.replace(/#.*/,"");o.loadAppView(n,e.origin)},o.onError)},loadAppView:function(e,n){this.loadingApp=!1,this.uniqueFrameId="embedded-app-"+t.uniqueId(),this.url=e;var r=t.extend({},this.options,{appId:this.uniqueFrameId,appUrl:e,appOrigin:n});this.appHandler=new s(r),this.appHandler.events.trigger("loading"),this.render()},onError:function(e){n.error("Couldn't load the requested embedded app",e)},getTemplateData:function(){return{app_uri:this.url,app_id:this.uniqueFrameId,appendPath:this.options.appendPath}}});return o}),define("dashboard/module/embedded/main",function(){}),define("feed/store/embedded/card",["jquery","underscore","tictail/component/log","tictail/component/api","tictail/component/oauth","app/embedded"],function(e,t,n,r,i,s){var o=s.extend({id:null,className:"feed-item-view app-embedded",$iframe:null,initialize:function(e){var t=this;this.feedItemContainer=e.feedItemContainer||{},this.data=this.feedItemContainer.data||{},this.item=this.feedItemContainer.item||{},this.options=e||{},this.data.content&&(this.options.uri=this.data.content.url),this.options.app_id=this.item.get("app_id"),n.info("Setting up card with url",this.options.uri),o.__super__.initialize.apply(this,arguments)},resizeFrame:function(e,t){this.$iframe.css("height",t.height)},appLoaded:function(){this.trigger("onLoad"),this.appHandler.trigger("requestSize")},perform:function(){if(!this.feedItemContainer.isOpen())return;this.trigger("onPerform"),this.requestPerform()},requestPerform:function(){var e=new r.Request("feed.dispatch.embedded.perform",{store_id:TT.session.getCurrentStore().id,app_id:this.item.get("app_id"),external_id:this.item.get("external_id")},"POST");e.send()},didRender:function(){var e=this;if(e.loadingApp)return;return e.appHandler.events.on({reportSize:t.bind(e.resizeFrame,e),loaded:t.bind(e.appLoaded,e),perform:t.bind(e.perform,e)}),e.$iframe=e.$el.find("iframe"),e}});return o}),define("dashboard/module/embedded/card",function(){}),define("dashboard/module/embedded/all",["./nls","./app-handler","./main","./card"],function(){}),define("dashboard/form/field/store/password",["jquery","underscore","tictail/core","tictail/component/log","tictail/component/api","tictail/form/field/text","i18n!../../../nls/settings"],function(e,t,n,r,i,s,o){var u=this;u.Dashboard=u.Dashboard||{},u.Dashboard.Form=u.Dashboard.Form||{},u.Dashboard.Form.Field=u.Dashboard.Form.Field={},u.Dashboard.Form.Field.Store=u.Dashboard.Form.Field.Store||{};var a=u.Dashboard.Form.Field.Store.Password=s.extend({attributes:{"class":"field store-password-field"},fieldAttributes:{type:"text","class":"store-password"},checkboxId:"store-password-enabled",initialize:function(e){e=e||{},e.minLength=3,e.maxLength=255,this.lastTestedValue=null,this.lastValidValue=null,a.__super__.initialize.call(this,e)},setNodeValue:function(e){a.__super__.setNodeValue.call(this,e),this._getCheckboxNode().prop("checked",!!e),this.$el.toggleClass("expanded",!!e)},getLabel:function(){return null},renderField:function(){var t=e('<div class="imprint password-selector top-gap"/>').append(this._getFieldNode());this.$el.append(this._getCheckboxNode()).append(e('<label class="for-checkbox"/>').attr("for",this.checkboxId).text(this.options.label)).append(t)},_getCheckboxNode:function(){var t=this;return n.getLazy(this,"_checkbox",function(){return e('<input type="checkbox" class="ui"/>').attr("id",t.checkboxId).attr("tabindex",t.tabIndex).change(function(){e(this).prop("checked")?(t.$el.addClass("expanded"),t.setValue(t._getFieldValue()),t._getFieldNode().focus().select()):(t.$el.removeClass("expanded"),t.setValue(""),t.setValueOnModel(""))})})}});return a}),define("tictail/model/store/password",["../../core"],function(e){var t=this;t.TT=t.TT||{},t.TT.Model=t.TT.Model||{},t.TT.Model.Store=t.TT.Model.Store||{};var n=t.TT.Model.Store.Password=e.Model.extend({API_NAMESPACE:"store.password",sync:function(t,n,r){return t==="create"&&(t="save"),e.sync(t,n,r)},getDefaultParams:function(){return{store_id:e.session.getCurrentStore().id}}});return n}),define("dashboard/main",["jquery","underscore","tictail/core","tictail/mediator","tictail/utility","tictail/component/api","tictail/component/tracker","tictail/component/grid","tictail/component/xsrf","tictail/component/session","tictail/component/i18n","tictail/component/log","tictail/collection/experiment","./model/store/base","./view/layout","./view/feed/index","./view/welcome/index","./view/user/settings","./view/product/create","./view/product/edit","./view/product/index","./view/order/index","./view/order/manage","./view/theme/index","./view/theme/standaloneeditor","./module/apploader","./module/social/share","./module/social/follow","./layout/settings","./form/field/store/domain","tictail/model/store/domain","./module/embedded/all","./form/field/store/password","tictail/model/store/password"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L){var A=this,O=A.Dashboard=A.Dashboard||{};t.extend(O,{storeRegExp:new RegExp("dashboard/store/.*"),initialize:function(){var t=this;e(document).ready(function(){t.onLoadComplete()}),o.prefix="Dashboard",l.setLanguage()},initApp:function(){u.Column.useBorderBoxGutter=!0,this.router=new M,this.originalTitle=document.title,this._setupUnloadHooks(),this.experiments=new h,this.experiments.fetch(),n.history.start({pushState:!0,root:"/dashboard/"}),r.subscribe("api.error",this.onError,this),o.init(),o.track("Opened",n.session.getCurrentStore().get("subdomain")),this.setupRaven(),this.setupTrackJs()},setupRaven:function(){if(!window.Raven)return;var r=n.session.getStorekeeper(),i=n.session.getCurrentStore().get("subdomain");window.Raven.setUser({email:r.email,id:r.id,subdomain:i}),window.ravenDataCallback&&(window.ravenDataCallback=t.wrap(window.ravenDataCallback,function(n,r){return t.extend(r,{tags:{deprecated_browser:e("html").hasClass("deprecated"),subdomain:i}}),n(r)}))},setupTrackJs:function(){if(!window.trackJs)return;window.trackJs.configure({userId:n.session.getStorekeeper().id})},hasExperiment:function(e,n){var r=!1;return this.experiments.each(function(i){e===i.get("name")&&(t.isUndefined(n)?r=!0:n===i.get("variant")&&(r=!0))}),r},getCurrentPathComponents:function(){var e="",t=O.getCurrentPath(),n=t.indexOf("?");if(n!==-1){var r=t.slice(0,n);e=t.slice(n),t=r}return{path:t,query:e}},_setupUnloadHooks:function(){n.history.navigate=function(){var e=O.router.onBeforeUnload();return e&&!confirm(e)?!1:n.History.prototype.navigate.apply(this,arguments)},n.history.loadUrl=function(e){var r=this.getFragment(this.fragment),i=this.fragment=this.getFragment(e),s=t.any(this.handlers,function(e){if(e.route.test(i)){if(i!==r){var t=O.router.onBeforeUnload();if(t&&!confirm(t))return n.History.prototype.navigate.call(this,r,{trigger:!1}),!0}return e.callback(i),!0}},this);return s},n.history.checkUrl=function(e){var r=function(){if(!t.isUndefined(this.options)){var e=this.options.root+this.getFragment();e==this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe)));if(e==this.fragment)return!1}return n.History.prototype.checkUrl.apply(n.history,arguments)};return r.apply(n.history,arguments)},e(window).on("beforeunload",function(){var e=O.router.onBeforeUnload();if(e)return e})},getCurrentPath:function(){if(n.history&&n.history.fragment){var e=n.history,t=e.options.root,r=e.fragment.replace(t,"");return(t||"/")+r}var i=window.location,s=function(e){return e?"/"+e.replace(/^\/|^#|\/$|#$/g,""):""};return s(i.pathname)+s(i.hash)},setDocumentTitle:function(e){t.isArray(e)&&(e=e.join(" - "));var n=this.originalTitle+" - "+e;document.title=n},setStoreDocumentTitle:function(e){var r=n.session.getCurrentStore().get("name");t.isArray(e)!==!0&&(e=new Array(e));var i=new Array(r);t.extend(i,e),this.setDocumentTitle(i)},redirectToLogin:function(e,t){t===undefined&&(t=this.getCurrentPath());var n="/user/signin?next="+encodeURIComponent(t);e===!0?window.location.replace(n):window.location=n},logout:function(){e('<form action="/user/signout" method="post"/>').append(e('<input type="hidden" name="_xsrf"/>').val(a.get())).appendTo(e("body")).submit()},showStatusHud:function(t,n){this.hideStatusHud(!1);var r=this,i=e("body"),s=e('<div id="status-hud"/>').text(t).hide().fadeIn(200).appendTo(i);i.one("click",function(){r.hideStatusHud()}),n!==!1&&s.delay(400).fadeOut(200,function(){s.remove()})},hideStatusHud:function(t){var n=e("#status-hud");t!==!1?n.stop(!0).fadeOut(200,function(){n.remove()}):n.remove()},featureActive:function(e){var t={feed:window.FeedActive,developer:window.DeveloperActive,creditcard:window.CreditcardActive,translation:window.TranslationActive};return this.featureActive=function(e){return t[e]===1},this.featureActive(e)},onLoadComplete:function(){var e="";window.ClientSession!==undefined&&(e=window.ClientSession),n.session=new f(e);if(!n.session.authenticated){this.redirectToLogin(!0);return}var t=[];n.session.getStorekeeper().stores.forEach(function(e){t.push(new p(e.attributes))}),n.session.getStorekeeper().stores.reset(t,{silent:!0});if(this.storeRegExp.test(this.getCurrentPath())){var r=p.getStoreSubdomainByUrlPath();if(!n.session.hasStore(r)){this.logout();return}n.session.setCurrentStoreBySubdomain(r)}this.initApp()},onError:function(e){if(e&&e.code){var n=e.code,r=s.ERROR_CODES;switch(n){case r.INSUFFICIENT_PERMISSIONS:if(t.isUndefined(e.data)||t.indexOf(e.data.required_permissions,"storekeeper")===-1)break;case r.UNAUTHENTICATED:this.redirectToLogin()}}}});var M=O.Router=n.Router.extend({routes:{"":"index","user/settings":"userSettings","store/:subdomain/":"index","store/:subdomain/home":"feedIndex","store/:subdomain/home/:feed_item":"feedIndex","store/:subdomain/welcome":"welcomeIndex","store/:subdomain/orders":"orderIndex","store/:subdomain/order/:id":"orderManagement","store/:subdomain/products":"productIndex","store/:subdomain/product/create":"productCreate","store/:subdomain/product/:slug":"productEdit","store/:subdomain/apps":"appIndex","store/:subdomain/apps?*queryString":"appAuthorizationIndex","store/:subdomain/app/*uri":"appLoad","store/:subdomain/settings":"settingsIndex","store/:subdomain/settings/*subpage":"settingsIndex","store/:subdomain/themes":"themeIndex","store/:subdomain/themes/standalone-editor?:parentId":"themeStandaloneEditor","store/:subdomain/themes/:subpage":"themeIndex","*url":"fallback"},storeGlobalRoutes:["/","/home","/welcome","/orders","/products","/product/create","/apps","/settings","/settings/general","/settings/fulfillment","/settings/billing"],layoutView:null,initialize:function(){return this.layoutView=new d,this.layoutView.prependTo(e("body")),r.subscribe("store.changed",this.onStoreChange,this),this},navigate:function(e){var i=n.history.fragment,s=M.__super__.navigate.apply(this,arguments);return i!==n.history.fragment&&(e=e.replace("store/",""),e=e.slice(e.indexOf("/")),/^\//.test(e)||(e="/"+e),o.track("Navigate",n.history.fragment),r.publish("navigate",{fragment:n.history.fragment,route:e}),t.isUndefined(window.dataLayer)===!1&&window.dataLayer.push({event:"dashboardPageView",dashboard_url:e})),s},onStoreChange:function(){var e=O.getCurrentPathComponents(),r=e.path,i=e.query;O.storeRegExp.test(r)?(r=r.replace("/dashboard/store/",""),r=r.slice(r.indexOf("/")),t.indexOf(this.storeGlobalRoutes,r)===-1&&(r="/")):r="/";var s=n.session.getCurrentStore(),u=n.session.getStorekeeper();o.register({store_count:u.stores.length,store_subdomain:s.get("subdomain"),store_country:s.get("country"),store_language:s.get("language"),store_currency:s.get("currency"),store_online:s.get("online")});var a=p.generateCurrentStoreUrl(r)+i;this.navigate(a,{trigger:!0})},onBeforeUnload:function(){var e=this.layoutView.contentView;return e&&!t.isUndefined(e.onBeforeUnload)?e.onBeforeUnload():!1},index:function(){var e="/home";O.featureActive("feed")||(e="/products"),this.navigate(p.generateCurrentStoreUrl(e),{trigger:!0,replace:!0})},fallback:function(e){var n=O.getCurrentPathComponents(),r=n.path,i=n.query;r=r.replace("/dashboard/","/");var s=r.search("/app/")===0,o=t.indexOf(this.storeGlobalRoutes,r)!==-1;!s&&!o&&(r="/"+i);var e=p.generateCurrentStoreUrl(r)+i;this.navigate(e,{trigger:!0})},userSettings:function(){O.setDocumentTitle(new Array("User","Settings")),this.layoutView.setContentView(new g)},feedIndex:function(e,n){if(!O.featureActive("feed"))return this.index();t.isEmpty(n)||(n=parseInt(n));var r=new v({feedItemToOpen:n});O.setDocumentTitle(new Array("Feed")),this.layoutView.setContentView(r)},welcomeIndex:function(e){O.setDocumentTitle(new Array("Welcome")),this.layoutView.setContentView(new m)},productIndex:function(e){O.setStoreDocumentTitle("Products");var t=new w;this.layoutView.setContentView(t)},productCreate:function(e){O.setStoreDocumentTitle("Add product"),this.layoutView.setContentView(new y)},productEdit:function(e,t){O.setStoreDocumentTitle("Edit product"),this.layoutView.setContentView(new b({slug:t}))},orderIndex:function(e){O.setStoreDocumentTitle("Orders"),this.layoutView.setContentView(new E)},orderManagement:function(e,t){O.setStoreDocumentTitle("Manage order"),this.layoutView.setContentView(new S({orderId:t}))},appIndex:function(e){var t,r=i.getCurrentQueryParams();r.install&&(O.router.navigate(n.session.getCurrentStore().generateUrl("/apps"),{replace:!0,trigger:!1}),t=r.install),new N({store:n.session.getCurrentStore(),namespace:"app-store",isPrivileged:!0,navigate:!1,appendPath:t})},appAuthorizationIndex:function(e,t){this.appIndex(e)},appLoad:function(e,t){var r,i=t.indexOf("/");i===-1?(r=t,t=""):(r=t.substr(0,i),t=t.substr(i+1));var s=r.indexOf("?");if(s!=-1){var o=r.slice(0,s);t+=r.slice(s),r=o}new N({store:n.session.getCurrentStore(),namespace:r,app_path:t})},settingsIndex:function(e,t){O.setStoreDocumentTitle("Settings");var n=new L(t);this.layoutView.setContentView(n)},themeIndex:function(e,t){t||(t="start"),O.setStoreDocumentTitle("Themes");if(this.layoutView.contentView instanceof x)try{this.layoutView.contentView.setView(t)}catch(n){}else this.layoutView.setContentView(new x({view:t}))},themeStandaloneEditor:function(e,t){O.setStoreDocumentTitle("Themes"),this.layoutView.setContentView(new T({parentId:t}))}});return O.initialize(),O}),define("dashboard",["dashboard/main"],function(e){return e}),require(["dashboard"])