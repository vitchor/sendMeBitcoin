/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

(function(e,t){if(typeof exports=="object"&&exports)t(exports);else{var n={};t(n),typeof define=="function"&&define.amd?define([],n):e.Mustache=n}})(this,function(e){function a(e,t){return u.call(e,t)}function f(e){return!a(r,e)}function h(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(e){return String(e).replace(/[&<>"'\/]/g,function(e){return p[e]})}function v(e){return this.gettext!==undefined?this.gettext(e):e}function m(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e||{},this.parent=t,this._cache={}}function y(){this.clearCache()}function b(t,n,r,i){var s="",o,u,a;for(var f=0,l=t.length;f<l;++f){o=t[f],u=o[1];switch(o[0]){case"#":a=r.lookup(u);if(typeof a=="object")if(c(a))for(var h=0,p=a.length;h<p;++h)s+=b(o[4],n,r.push(a[h]),i);else a&&(s+=b(o[4],n,r.push(a),i));else if(typeof a=="function"){var d=i==null?null:i.slice(o[3],o[5]);a=a.call(r.view,d,function(e){return n.render(e,r)}),a!=null&&(s+=a)}else a&&(s+=b(o[4],n,r,i));break;case"^":a=r.lookup(u);if(!a||c(a)&&a.length===0)s+=b(o[4],n,r,i);break;case">":a=n.getPartial(u),typeof a=="function"&&(s+=a(r));break;case"&":a=r.lookup(u),a!=null&&(s+=a);break;case"name":a=r.lookup(u),a!=null&&(s+=e.escape(a));break;case"text":s+=u}}return s}function w(e){var t=[],n=t,r=[],i;for(var s=0,o=e.length;s<o;++s){i=e[s];switch(i[0]){case"#":case"^":r.push(i),n.push(i),n=i[4]=[];break;case"/":var u=r.pop();u[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function E(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i)n=e[i],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(r=n,t.push(n)));return t}function S(e){return[new RegExp(h(e[0])+"\\s*"),new RegExp("\\s*"+h(e[1]))]}function x(r,u){function y(){if(v&&!g)while(d.length)delete p[d.pop()];else d=[];v=!1,g=!1}r=r||"",u=u||e.tags,typeof u=="string"&&(u=u.split(n));if(u.length!==2)throw new Error("Invalid tags: "+u.join(", "));var a=S(u),l=new m(r),c=[],p=[],d=[],v=!1,g=!1,b,x,T,N,C;while(!l.eos()){b=l.pos,T=l.scanUntil(a[0]);if(T)for(var k=0,L=T.length;k<L;++k)N=T.charAt(k),f(N)?d.push(p.length):g=!0,p.push(["text",N,b,b+1]),b+=1,N=="\n"&&y();if(!l.scan(a[0]))break;v=!0,x=l.scan(o)||"name",l.scan(t),x==="="?(T=l.scanUntil(i),l.scan(i),l.scanUntil(a[1])):x==="{"?(T=l.scanUntil(new RegExp("\\s*"+h("}"+u[1]))),l.scan(s),l.scanUntil(a[1]),x="&"):T=l.scanUntil(a[1]);if(!l.scan(a[1]))throw new Error("Unclosed tag at "+l.pos);C=[x,T,b,l.pos],p.push(C);if(x==="#"||x==="^")c.push(C);else if(x==="/"){if(c.length===0)throw new Error('Unopened section "'+T+'" at '+b);var A=c.pop();if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+b)}else if(x==="name"||x==="{"||x==="&")g=!0;else if(x==="="){u=T.split(n);if(u.length!==2)throw new Error("Invalid tags at "+b+": "+u.join(", "));a=S(u)}}var A=c.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+l.pos);return p=E(p),w(p)}var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,u=RegExp.prototype.test,l=Object.prototype.toString,c=Array.isArray||function(e){return l.call(e)==="[object Array]"},p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};m.prototype.eos=function(){return this.tail===""},m.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},m.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},g.make=function(e){return e instanceof g?e:new g(e)},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(t){var n=this._cache[t];if(!n){if(t==e.self_tag)n=this.view;else if(t===e.i18n_tag)n=function(){return function(t){var n=e.parse(v(t));return T.compileTokens(n)(this)}};else{var r=this;while(r){if(t.indexOf(".")>0){n=r.view;var i=t.split("."),s=0;while(n&&s<i.length)n=n[i[s++]]}else n=r.view[t];if(n!=null)break;r=r.parent}}this._cache[t]=n}return typeof n=="function"&&(n=n.call(this.view)),n},y.prototype.clearCache=function(){this._cache={},this._partialCache={}},y.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},y.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},y.prototype.getPartial=function(e){return!(e in this._partialCache)&&this._loadPartial&&this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},y.prototype.compileTokens=function(e,t){var n=this;return function(r,i){if(i)if(typeof i=="function")n._loadPartial=i;else for(var s in i)n.compilePartial(s,i[s]);return b(e,n,g.make(r),t)}},y.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.self_tag=".",e.i18n_tag="lang",e.Scanner=m,e.Context=g,e.Writer=y,e.parse=x,e.escape=d;var T=new y;e.clearCache=function(){return T.clearCache()},e.compile=function(e,t){return T.compile(e,t)},e.compilePartial=function(e,t,n){return T.compilePartial(e,t,n)},e.compileTokens=function(e,t){return T.compileTokens(e,t)},e.render=function(e,t,n){return T.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(typeof i!="function")return s;i(s)}})